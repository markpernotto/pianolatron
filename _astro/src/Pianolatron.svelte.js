import{y as e,x as t,s as i,z as n,A as s,B as r,C as o,D as a,i as l,E as h,q as u,F as c,r as d,u as p,G as m,H as g,I as f,o as v,J as y,K as _,k as w,t as b,n as x,L as k,b as T,M as S,N as E,O as C,P,Q as M,R,T as D,U as A,V as O,W as I,X as F,c as j,f as z,m as N,l as L,Y as B,Z as W,_ as q,$,a0 as V,a1 as H,a2 as U,a3 as G,a4 as Z,a5 as X,a as Y,a6 as K,a7 as Q,a8 as J,h as ee,e as te,a9 as ie,aa as ne,ab as se,ac as re,ad as oe,ae,af as le,ag as he,ah as ue,ai as ce,aj as de,ak as pe,j as me,al as ge,am as fe}from"../../svelte.internal.v3.42.4-cb11eb31.js";if("undefined"!=typeof document){const e='#app.svelte-hmwwtk.svelte-hmwwtk{height:100vh;display:flex;flex-direction:column;overflow:hidden}#app.svelte-hmwwtk>div.svelte-hmwwtk:first-child{flex:1 0 auto;position:relative;display:grid;grid-template-rows:1fr;grid-template-columns:auto 1fr auto;grid-template-areas:"left center right"}#left-sidebar{grid-area:left}#left-sidebar p.svelte-hmwwtk.svelte-hmwwtk{opacity:0.5;padding:0.5em 1em}#roll.svelte-hmwwtk.svelte-hmwwtk{position:relative;flex:1 0 auto;grid-area:center}#right-sidebar{grid-area:right}#keyboard-container.svelte-hmwwtk.svelte-hmwwtk{flex:0 1 auto;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#keyboard-overlay.svelte-hmwwtk.svelte-hmwwtk{position:absolute;bottom:0;width:calc(100% - var(--navigator-width));opacity:0.5;z-index:5}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function ve(e){const t=e-1;return t*t*t+1}function ye(t,{delay:i=0,duration:n=400,easing:s=e}={}){const r=+getComputedStyle(t).opacity;return{delay:i,duration:n,easing:s,css:e=>"opacity: "+e*r}}function _e(e,{delay:t=0,duration:i=400,easing:n=ve,x:s=0,y:r=0,opacity:o=0}={}){const a=getComputedStyle(e),l=+a.opacity,h="none"===a.transform?"":a.transform,u=l*(1-o);return{delay:t,duration:i,easing:n,css:(e,t)=>`\n\t\t\ttransform: ${h} translate(${(1-e)*s}px, ${(1-e)*r}px);\n\t\t\topacity: ${l-u*t}`}}var we=function(e,t,i,n){var s=i?i.call(n,e,t):void 0;if(void 0!==s)return!!s;if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;var r=Object.keys(e),o=Object.keys(t);if(r.length!==o.length)return!1;for(var a=Object.prototype.hasOwnProperty.bind(t),l=0;l<r.length;l++){var h=r[l];if(!a(h))return!1;var u=e[h],c=t[h];if(!1===(s=i?i.call(n,u,c,h):void 0)||void 0===s&&u!==c)return!1}return!0};function be(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var xe,ke,Te=(function(e,t){function i(e){return void 0===e?-1:e.height}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.intervalTree=e,this.records=[],this.height=0,this.key=t.low,this.max=t.high,this.records.push(t)}return e.prototype.getNodeHigh=function(){for(var e=this.records[0].high,t=1;t<this.records.length;t++)this.records[t].high>e&&(e=this.records[t].high);return e},e.prototype.updateHeight=function(){this.height=Math.max(i(this.left),i(this.right))+1},e.prototype.updateMaxOfParents=function(){if(void 0!==this){var e=this.getNodeHigh();void 0!==this.left&&void 0!==this.right?this.max=Math.max(Math.max(this.left.max,this.right.max),e):void 0!==this.left&&void 0===this.right?this.max=Math.max(this.left.max,e):void 0===this.left&&void 0!==this.right?this.max=Math.max(this.right.max,e):this.max=e,this.parent&&this.parent.updateMaxOfParents()}},e.prototype._updateMaxAfterRightRotate=function(){var e=this.parent,t=e.left,i=t.getNodeHigh();void 0===t.left&&void 0!==t.right?t.max=Math.max(i,t.right.max):void 0!==t.left&&void 0===t.right?t.max=Math.max(i,t.left.max):void 0===t.left&&void 0===t.right?t.max=i:t.max=Math.max(Math.max(t.left.max,t.right.max),i);var n=this.getNodeHigh();void 0===this.left&&void 0!==this.right?this.max=Math.max(n,this.right.max):void 0!==this.left&&void 0===this.right?this.max=Math.max(n,this.left.max):void 0===this.left&&void 0===this.right?this.max=n:this.max=Math.max(Math.max(this.left.max,this.right.max),n),e.max=Math.max(Math.max(e.left.max,e.right.max),e.getNodeHigh())},e.prototype._updateMaxAfterLeftRotate=function(){var e=this.parent,t=e.right,i=t.getNodeHigh();void 0===t.left&&void 0!==t.right?t.max=Math.max(i,t.right.max):void 0!==t.left&&void 0===t.right?t.max=Math.max(i,t.left.max):void 0===t.left&&void 0===t.right?t.max=i:t.max=Math.max(Math.max(t.left.max,t.right.max),i);var n=this.getNodeHigh();void 0===this.left&&void 0!==this.right?this.max=Math.max(n,this.right.max):void 0!==this.left&&void 0===this.right?this.max=Math.max(n,this.left.max):void 0===this.left&&void 0===this.right?this.max=n:this.max=Math.max(Math.max(this.left.max,this.right.max),n),e.max=Math.max(Math.max(e.left.max,t.max),e.getNodeHigh())},e.prototype._leftRotate=function(){var e=this.right;e.parent=this.parent,void 0===e.parent?this.intervalTree.root=e:e.parent.left===this?e.parent.left=e:e.parent.right===this&&(e.parent.right=e),this.right=e.left,void 0!==this.right&&(this.right.parent=this),e.left=this,this.parent=e,this.updateHeight(),e.updateHeight()},e.prototype._rightRotate=function(){var e=this.left;e.parent=this.parent,void 0===e.parent?this.intervalTree.root=e:e.parent.left===this?e.parent.left=e:e.parent.right===this&&(e.parent.right=e),this.left=e.right,void 0!==this.left&&(this.left.parent=this),e.right=this,this.parent=e,this.updateHeight(),e.updateHeight()},e.prototype._rebalance=function(){if(i(this.left)>=2+i(this.right)){var e=this.left;i(e.left)>=i(e.right)?(this._rightRotate(),this._updateMaxAfterRightRotate()):(e._leftRotate(),this._rightRotate(),this._updateMaxAfterRightRotate())}else if(i(this.right)>=2+i(this.left)){var t=this.right;i(t.right)>=i(t.left)?(this._leftRotate(),this._updateMaxAfterLeftRotate()):(t._rightRotate(),this._leftRotate(),this._updateMaxAfterLeftRotate())}},e.prototype.insert=function(t){t.low<this.key?void 0===this.left?(this.left=new e(this.intervalTree,t),this.left.parent=this):this.left.insert(t):void 0===this.right?(this.right=new e(this.intervalTree,t),this.right.parent=this):this.right.insert(t),this.max<t.high&&(this.max=t.high),this.updateHeight(),this._rebalance()},e.prototype._getOverlappingRecords=function(e,t,i){if(e.key<=i&&t<=e.getNodeHigh()){for(var n=[],s=0;s<e.records.length;s++)e.records[s].high>=t&&n.push(e.records[s]);return n}return[]},e.prototype.search=function(e,t){if(void 0===this)return[];var i,n=[],s=[];return e>this.max?[]:(void 0!==this.left&&this.left.max>=e&&(n=this.left.search(e,t)),i=this._getOverlappingRecords(this,e,t),t<this.key?n.concat(i):(void 0!==this.right&&(s=this.right.search(e,t)),n.concat(i,s)))},e.prototype.searchExisting=function(e){if(void 0!==this){if(this.key===e)return this;if(e<this.key){if(void 0!==this.left)return this.left.searchExisting(e)}else if(void 0!==this.right)return this.right.searchExisting(e)}},e.prototype._minValue=function(){return void 0===this.left?this:this.left._minValue()},e.prototype.remove=function(e){var t=this.parent;if(e.key<this.key)return void 0!==this.left?this.left.remove(e):void 0;if(e.key>this.key)return void 0!==this.right?this.right.remove(e):void 0;if(void 0!==this.left&&void 0!==this.right){var i=this.right._minValue();return this.key=i.key,this.records=i.records,this.right.remove(this)}return t.left===this?(void 0!==this.right?(t.left=this.right,this.right.parent=t):(t.left=this.left,void 0!==this.left&&(this.left.parent=t)),t.updateMaxOfParents(),t.updateHeight(),t._rebalance(),this):t.right===this?(void 0!==this.right?(t.right=this.right,this.right.parent=t):(t.right=this.left,void 0!==this.left&&(this.left.parent=t)),t.updateMaxOfParents(),t.updateHeight(),t._rebalance(),this):void 0},e}();t.Node=n;var s=function(){function e(){this.count=0}return e.prototype.insert=function(e){if(e.low>e.high)throw new Error("`low` value must be lower or equal to `high` value");if(void 0===this.root)return this.root=new n(this,e),this.count++,!0;var t=this.root.searchExisting(e.low);if(void 0!==t){for(var i=0;i<t.records.length;i++)if(we(t.records[i],e))return!1;return t.records.push(e),e.high>t.max&&(t.max=e.high,t.parent&&t.parent.updateMaxOfParents()),this.count++,!0}return this.root.insert(e),this.count++,!0},e.prototype.search=function(e,t){return void 0===this.root?[]:this.root.search(e,t)},e.prototype.remove=function(e){if(void 0===this.root)return!1;var t=this.root.searchExisting(e.low);if(void 0===t)return!1;if(t.records.length>1){for(var i=void 0,s=0;s<t.records.length;s++)if(we(t.records[s],e)){i=t.records[s],t.records.splice(s,1);break}if(i){if(i=void 0,e.high===t.max){var r=t.getNodeHigh();void 0!==t.left&&void 0!==t.right?t.max=Math.max(Math.max(t.left.max,t.right.max),r):void 0!==t.left&&void 0===t.right?t.max=Math.max(t.left.max,r):void 0===t.left&&void 0!==t.right?t.max=Math.max(t.right.max,r):t.max=r,t.parent&&t.parent.updateMaxOfParents()}return this.count--,!0}return!1}if(1===t.records.length){if(we(t.records[0],e)){if(this.root.key===t.key){var o=new n(this,{low:e.low,high:e.low});o.left=this.root,this.root.parent=o;var a=this.root.remove(t);return this.root=o.left,void 0!==this.root&&(this.root.parent=void 0),!!a&&(a=void 0,this.count--,!0)}return!!(a=this.root.remove(t))&&(a=void 0,this.count--,!0)}return!1}return!1},e.prototype.inOrder=function(){return new o(this.root)},e.prototype.preOrder=function(){return new a(this.root)},e}();t.IntervalTree=s;var r=function(){function e(){this.tree=new s}return e.prototype.insert=function(e,t,i){return this.tree.insert({low:e,high:t,data:i})},e.prototype.remove=function(e,t,i){return this.tree.remove({low:e,high:t,data:i})},e.prototype.search=function(e,t){return this.tree.search(e,t).map((function(e){return e.data}))},e.prototype.inOrder=function(){return this.tree.inOrder()},e.prototype.preOrder=function(){return this.tree.preOrder()},Object.defineProperty(e.prototype,"count",{get:function(){return this.tree.count},enumerable:!0,configurable:!0}),e}();t.default=r;var o=function(){function e(e){this.stack=[],void 0!==e&&this.push(e)}return e.prototype.next=function(){return void 0===this.currentNode?{done:!0,value:void 0}:this.i<this.currentNode.records.length?{done:!1,value:this.currentNode.records[this.i++]}:(void 0!==this.currentNode.right?this.push(this.currentNode.right):this.pop(),this.next())},e.prototype.push=function(e){for(this.currentNode=e,this.i=0;void 0!==this.currentNode.left;)this.stack.push(this.currentNode),this.currentNode=this.currentNode.left},e.prototype.pop=function(){this.currentNode=this.stack.pop(),this.i=0},e}();t.InOrder=o,"function"==typeof Symbol&&(o.prototype[Symbol.iterator]=function(){return this});var a=function(){function e(e){this.stack=[],this.i=0,this.currentNode=e}return e.prototype.next=function(){return void 0===this.currentNode?{done:!0,value:void 0}:this.i<this.currentNode.records.length?{done:!1,value:this.currentNode.records[this.i++]}:(void 0!==this.currentNode.right&&this.push(this.currentNode.right),void 0!==this.currentNode.left&&this.push(this.currentNode.left),this.pop(),this.next())},e.prototype.push=function(e){this.stack.push(e)},e.prototype.pop=function(){this.currentNode=this.stack.pop(),this.i=0},e}();t.PreOrder=a,"function"==typeof Symbol&&(a.prototype[Symbol.iterator]=function(){return this})}(ke={path:xe,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&ke.path)}},ke.exports),ke.exports),Se=be(Te);Te.InOrder,Te.IntervalTree,Te.Node,Te.PreOrder;const Ee=[];function Ce(e,n=t){let s;const r=new Set;function o(t){if(i(e,t)&&(e=t,s)){const t=!Ee.length;for(const t of r)t[1](),Ee.push(t,e);if(t){for(let e=0;e<Ee.length;e+=2)Ee[e][0](Ee[e+1]);Ee.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(i,a=t){const l=[i,a];return r.add(l),1===r.size&&(s=n(o)||t),i(e),()=>{r.delete(l),0===r.size&&(s(),s=null)}}}}function Pe(e,i,o){const a=!Array.isArray(e),l=a?[e]:e,h=i.length<2;return function(e,t){return{subscribe:Ce(e,t).subscribe}}(o,(e=>{let o=!1;const u=[];let c=0,d=t;const p=()=>{if(c)return;d();const n=i(a?u[0]:u,e);h?e(n):d=r(n)?n:t},m=l.map(((e,t)=>n(e,(e=>{u[t]=e,c&=~(1<<t),o&&p()}),(()=>{c|=1<<t}))));return o=!0,p(),function(){s(m),d()}}))}const Me=e=>{const{set:t,subscribe:i,update:n}=Ce(e);return{reset:()=>t(e),set:t,subscribe:i,update:n}},Re=(e,t)=>{const i=localStorage.getItem(e);let n="object"==typeof t?{...t}:t;try{i&&(n="object"==typeof t?Object.assign(n,JSON.parse(i)):JSON.parse(i))}catch{}const s=Ce(n),{set:r,subscribe:a}=s;return{set(t){localStorage.setItem(e,JSON.stringify(t)),r(t)},update(e){const t=e(o(s));this.set(t)},reset(){localStorage.removeItem(e),this.set("object"==typeof t?{...t}:t)},subscribe:a}};class De{constructor(e,t){this.firstMidi=e,this.lastMidi=t,this.velocityCurve=null,this.velocityPoints=null}}const Ae=Me({}),Oe=Pe(Ae,(e=>"65-note"!==e.ROLL_TYPE)),Ie=Pe(Ae,(e=>["welte-red","welte-green","welte-licensee","duo-art"].includes(e.ROLL_TYPE))),Fe=Pe(Ae,(e=>"welte-red"===e.ROLL_TYPE)),je=Me(!1),ze=Me(!1),Ne=Me(!1),Le=Me(!1),Be=Me(!1),We=Me(1.5),qe=Me(1),$e=Me(1),Ve=Me(1),He=Me(!0),Ue=Me(!0),Ge=Me(!0),Ze=Re("sampleVolumes",{strings:-15,harmonics:-10,pedal:-10,keybed:-10}),Xe=Re("sampleVelocities",4),Ye=Re("reverbWetDry",.8),Ke=Re("velocityCurveLow",new De(21,49)),Qe=Re("velocityCurveMid",new De(50,78)),Je=Re("velocityCurveHigh",new De(79,108)),et=Me([]),tt=Me([]),it=Me(0),nt=Me(0),st=(()=>{const{subscribe:e,update:t,set:i}=Ce(new Set);return{subscribe:e,add:e=>t((t=>t.add(e))),delete:e=>t((t=>(t.delete(e),t))),reset:e=>i(new Set(e))}})(),rt=Re("userSettings",{theme:"cardinal",activeNoteDetails:!1,showNoteVelocities:!1,highlightEnabledHoles:!1,showKeyboard:!0,overlayKeyboard:!1,welcomeScreenInhibited:!1,useWebMidi:!1}),ot={"welte-red":{bassCtrlBegin:14,bassCtrlEnd:23,bassNotesBegin:24,bassNotesEnd:66,trebleNotesBegin:67,trebleNotesEnd:103,trebleCtrlBegin:104,trebleCtrlEnd:113,ctrlMap:{14:"mf_off",15:"mf_on",16:"cresc_off",17:"cresc_on",18:"sf_off",19:"sf_on",20:"soft_off",21:"soft_on",22:"motor_off",23:"motor_on",104:"rewind",105:"elec_off",106:"sust_on",107:"sust_off",108:"sf_on",109:"sf_off",110:"cresc_on",111:"cresc_off",112:"mf_on",113:"mf_off"}},"welte-green":{bassCtrlBegin:16,bassCtrlEnd:20,bassNotesBegin:21,bassNotesEnd:66,trebleNotesBegin:67,trebleNotesEnd:108,trebleCtrlBegin:109,trebleCtrlEnd:113,ctrlMap:{16:"sfp",17:"mf",18:"sust",19:"cresc",20:"sff",109:"sff",110:"cresc",111:"soft",112:"mf",113:"sfp"}},"welte-licensee":{bassCtrlBegin:16,bassCtrlEnd:23,bassNotesBegin:24,bassNotesEnd:66,trebleNotesBegin:67,trebleNotesEnd:103,trebleCtrlBegin:104,trebleCtrlEnd:113,ctrlMap:{16:"mf_off",17:"mf_on",18:"cresc_off",19:"cresc_on",20:"sf_on",21:"sf_off",22:"soft_on",23:"soft_off",104:"rewind",106:"sust_on",107:"sust_off",108:"sf_on",109:"sf_off",110:"cresc_on",111:"cresc_off",112:"mf_on",113:"mf_off"}},"duo-art":{bassCtrlBegin:16,bassCtrlEnd:24,bassNotesBegin:25,bassNotesEnd:63,trebleNotesBegin:64,trebleNotesEnd:104,trebleCtrlBegin:105,trebleCtrlEnd:113,ctrlMap:{16:"rewind",18:"soft",19:"acc",20:"acc",21:"vol+1",22:"vol+2",23:"vol+4",24:"vol+8",105:"vol+8",106:"vol+4",107:"vol+2",108:"vol+1",109:"acc",110:"acc",113:"sust"}},"65-note":{bassNotesBegin:33,trebleNotesEnd:97},"88-note":{bassCtrlBegin:15,bassCtrlEnd:20,bassNotesBegin:21,bassNotesEnd:64,trebleNotesBegin:65,trebleNotesEnd:108,trebleCtrlBegin:109,trebleCtrlEnd:110,ctrlMap:{16:"rewind",18:"sust",19:"acc",20:"acc",109:"acc",110:"acc"}}},at=(e,t,i)=>Math.min(Math.max(e,t),i),lt=e=>{const t=parseInt(e/12,10)-1;return`${["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"][(e-21)%12]}${t}`},ht=(e,t=200,i=5,n=1.1)=>{let s,r=t;const o=()=>{e(),r=Math.max(Math.floor(r/n),i),s=setTimeout(o,r)};return s=setTimeout(o,r),{clear:()=>{s&&(clearTimeout(s),s=null)}}},ut=["232, 53%, 49%","229, 64%, 58%","225, 78%, 66%","223, 91%, 73%","221, 98%, 79%","219, 95%, 83%","217, 73%, 86%","21, 28%, 86%","20, 69%, 83%","18, 85%, 79%","16, 85%, 73%","13, 80%, 67%","9, 70%, 59%","2, 59%, 51%","348, 96%, 36%"],ct=(e,{ROLL_TYPE:t,IMAGE_LENGTH:i},n)=>{const s=e.map((({v:e})=>e)).filter((e=>e)),r=s.length?Math.min(...s):64,o=s.length?Math.max(...s):64,a=parseInt(i,10);e.forEach((e=>{switch(e.startY=n?e.y:a-e.y-e.h,e.endY=n?e.y+e.h:a-e.y,(({m:e},t)=>{const{bassNotesBegin:i,trebleNotesEnd:n,ctrlMap:s}=ot[t];return e>=i&&e<=n?"note":s[e]?.includes("soft")||s[e]?.includes("sust")?"pedal":"control"})(e,t)){case"pedal":e.color="39, 100%, 50%",e.type="pedal";break;case"control":e.color="120, 73%, 75%",e.type="control";break;case"note":e.color=(({v:e})=>{return ut[Math.round(((e,t,i)=>e*(ut.length-1-t)+t)((t=e,i=r,n=o,n-i==0?0:(t-i)/(n-i)),0))];var t,i,n})(e),e.type="note";break;default:e.color="60, 100%, 50%"}}))};function dt(e){return(dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function pt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function gt(e,t,i){return t&&mt(e.prototype,t),i&&mt(e,i),e}for(var ft={VERSION:"2.0.16",NOTES:[],HEADER_CHUNK_LENGTH:14,CIRCLE_OF_FOURTHS:["C","F","Bb","Eb","Ab","Db","Gb","Cb","Fb","Bbb","Ebb","Abb"],CIRCLE_OF_FIFTHS:["C","G","D","A","E","B","F#","C#","G#","D#","A#","E#"]},vt=[["C"],["C#","Db"],["D"],["D#","Eb"],["E"],["F"],["F#","Gb"],["G"],["G#","Ab"],["A"],["A#","Bb"],["B"]],yt=0,_t=function(e){vt.forEach((function(t){t.forEach((function(t){return ft.NOTES[yt]=t+e})),yt++}))},wt=-1;wt<=9;wt++)_t(wt);var bt=function(){function e(){pt(this,e)}return gt(e,null,[{key:"byteToHex",value:function(e){return("0"+e.toString(16)).slice(-2)}},{key:"bytesToHex",value:function(t){var i=[];return t.forEach((function(t){return i.push(e.byteToHex(t))})),i.join("")}},{key:"hexToNumber",value:function(e){return parseInt(e,16)}},{key:"bytesToNumber",value:function(t){return e.hexToNumber(e.bytesToHex(t))}},{key:"bytesToLetters",value:function(e){var t=[];return e.forEach((function(e){return t.push(String.fromCharCode(e))})),t.join("")}},{key:"decToBinary",value:function(e){return(e>>>0).toString(2)}},{key:"getVarIntLength",value:function(e){for(var t=e[0],i=1;t>=128;)t=e[i],i++;return i}},{key:"readVarInt",value:function(e){var t=0;return e.forEach((function(e){128&e?(t+=127&e,t<<=7):t+=e})),t}},{key:"atob",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return"function"==typeof atob?atob(e):Buffer.from(e,"base64").toString("binary")}))}]),e}(),xt=function(){function e(t,i){pt(this,e),this.enabled=!0,this.eventIndex=0,this.pointer=0,this.lastTick=0,this.lastStatus=null,this.index=t,this.data=i,this.delta=0,this.runningDelta=0,this.events=[];var n=this.data.subarray(this.data.length-3,this.data.length);if(255!==n[0]||47!==n[1]||0!==n[2])throw"Invalid MIDI file; Last three bytes of track "+this.index+"must be FF 2F 00 to mark end of track"}return gt(e,[{key:"reset",value:function(){return this.enabled=!0,this.eventIndex=0,this.pointer=0,this.lastTick=0,this.lastStatus=null,this.delta=0,this.runningDelta=0,this}},{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"setEventIndexByTick",value:function(e){for(var t in e=e||0,this.events)if(this.events[t].tick>=e)return this.eventIndex=t,this}},{key:"getCurrentByte",value:function(){return this.data[this.pointer]}},{key:"getDeltaByteCount",value:function(){return bt.getVarIntLength(this.data.subarray(this.pointer))}},{key:"getDelta",value:function(){return bt.readVarInt(this.data.subarray(this.pointer,this.pointer+this.getDeltaByteCount()))}},{key:"handleEvent",value:function(e,t){if(t=t||!1){var i=e-this.lastTick>=this.getDelta();if(this.pointer<this.data.length&&(t||i)){var n=this.parseEvent();if(this.enabled)return n}}else if(this.events[this.eventIndex]&&this.events[this.eventIndex].tick<=e&&(this.eventIndex++,this.enabled))return this.events[this.eventIndex-1];return null}},{key:"getStringData",value:function(e){var t=bt.getVarIntLength(this.data.subarray(e+2)),i=bt.readVarInt(this.data.subarray(e+2,e+2+t));return bt.bytesToLetters(this.data.subarray(e+2+t,e+2+t+i))}},{key:"parseEvent",value:function(){var e=this.pointer+this.getDeltaByteCount(),t={},i=this.getDeltaByteCount();if(t.track=this.index+1,t.delta=this.getDelta(),this.lastTick=this.lastTick+t.delta,this.runningDelta+=t.delta,t.tick=this.runningDelta,t.byteIndex=this.pointer,255==this.data[e]){switch(this.data[e+1]){case 0:t.name="Sequence Number";break;case 1:t.name="Text Event",t.string=this.getStringData(e);break;case 2:t.name="Copyright Notice";break;case 3:t.name="Sequence/Track Name",t.string=this.getStringData(e);break;case 4:t.name="Instrument Name",t.string=this.getStringData(e);break;case 5:t.name="Lyric",t.string=this.getStringData(e);break;case 6:t.name="Marker";break;case 7:t.name="Cue Point",t.string=this.getStringData(e);break;case 9:t.name="Device Name",t.string=this.getStringData(e);break;case 32:t.name="MIDI Channel Prefix";break;case 33:t.name="MIDI Port",t.data=bt.bytesToNumber([this.data[e+3]]);break;case 47:t.name="End of Track";break;case 81:t.name="Set Tempo",t.data=Math.round(6e7/bt.bytesToNumber(this.data.subarray(e+3,e+6))),this.tempo=t.data;break;case 84:t.name="SMTPE Offset";break;case 88:t.name="Time Signature",t.data=this.data.subarray(e+3,e+7),t.timeSignature=t.data[0]+"/"+Math.pow(2,t.data[1]);break;case 89:t.name="Key Signature",t.data=this.data.subarray(e+3,e+5),t.data[0]>=0?t.keySignature=ft.CIRCLE_OF_FIFTHS[t.data[0]]:t.data[0]<0&&(t.keySignature=ft.CIRCLE_OF_FOURTHS[Math.abs(t.data[0])]),0==t.data[1]?t.keySignature+=" Major":1==t.data[1]&&(t.keySignature+=" Minor");break;case 127:t.name="Sequencer-Specific Meta-event";break;default:t.name="Unknown: "+this.data[e+1].toString(16)}var n=bt.getVarIntLength(this.data.subarray(e+2)),s=bt.readVarInt(this.data.subarray(e+2,e+2+n));this.pointer+=i+3+s}else if(240===this.data[e]){t.name="Sysex";var r=bt.getVarIntLength(this.data.subarray(e+1)),o=bt.readVarInt(this.data.subarray(e+1,e+1+r));t.data=this.data.subarray(e+1+r,e+1+r+o),this.pointer+=i+1+r+o}else if(247===this.data[e]){t.name="Sysex (escape)";var a=bt.getVarIntLength(this.data.subarray(e+1)),l=bt.readVarInt(this.data.subarray(e+1,e+1+a));t.data=this.data.subarray(e+1+a,e+1+a+l),this.pointer+=i+1+a+l}else if(this.data[e]<128)if(t.running=!0,t.noteNumber=this.data[e],t.noteName=ft.NOTES[this.data[e]],t.velocity=this.data[e+1],this.lastStatus<=143)t.name="Note off",t.channel=this.lastStatus-128+1,this.pointer+=i+2;else if(this.lastStatus<=159)t.name="Note on",t.channel=this.lastStatus-144+1,this.pointer+=i+2;else if(this.lastStatus<=175)t.name="Polyphonic Key Pressure",t.channel=this.lastStatus-160+1,t.note=ft.NOTES[this.data[e+1]],t.pressure=event[1],this.pointer+=i+2;else if(this.lastStatus<=191)t.name="Controller Change",t.channel=this.lastStatus-176+1,t.number=this.data[e+1],t.value=this.data[e+2],this.pointer+=i+2;else if(this.lastStatus<=207)t.name="Program Change",t.channel=this.lastStatus-192+1,t.value=this.data[e+1],this.pointer+=i+1;else if(this.lastStatus<=223)t.name="Channel Key Pressure",t.channel=this.lastStatus-208+1,this.pointer+=i+1;else{if(!(this.lastStatus<=239))throw"Unknown event (running): ".concat(this.lastStatus);t.name="Pitch Bend",t.channel=this.lastStatus-224+1,t.value=this.data[e+2],this.pointer+=i+2}else if(this.lastStatus=this.data[e],this.data[e]<=143)t.name="Note off",t.channel=this.lastStatus-128+1,t.noteNumber=this.data[e+1],t.noteName=ft.NOTES[this.data[e+1]],t.velocity=Math.round(this.data[e+2]/127*100),this.pointer+=i+3;else if(this.data[e]<=159)t.name="Note on",t.channel=this.lastStatus-144+1,t.noteNumber=this.data[e+1],t.noteName=ft.NOTES[this.data[e+1]],t.velocity=Math.round(this.data[e+2]/127*100),this.pointer+=i+3;else if(this.data[e]<=175)t.name="Polyphonic Key Pressure",t.channel=this.lastStatus-160+1,t.note=ft.NOTES[this.data[e+1]],t.pressure=event[2],this.pointer+=i+3;else if(this.data[e]<=191)t.name="Controller Change",t.channel=this.lastStatus-176+1,t.number=this.data[e+1],t.value=this.data[e+2],this.pointer+=i+3;else if(this.data[e]<=207)t.name="Program Change",t.channel=this.lastStatus-192+1,t.value=this.data[e+1],this.pointer+=i+2;else if(this.data[e]<=223)t.name="Channel Key Pressure",t.channel=this.lastStatus-208+1,this.pointer+=i+2;else{if(!(this.data[e]<=239))throw"Unknown event: ".concat(this.data[e]);t.name="Pitch Bend",t.channel=this.lastStatus-224+1,this.pointer+=i+3}return this.delta+=t.delta,this.events.push(t),t}},{key:"endOfTrack",value:function(){return 255==this.data[this.pointer+1]&&47==this.data[this.pointer+2]&&0==this.data[this.pointer+3]}}]),e}();Uint8Array.prototype.forEach||Object.defineProperty(Uint8Array.prototype,"forEach",{value:Array.prototype.forEach});var kt={Player:function(){function e(t,i){pt(this,e),this.sampleRate=5,this.startTime=0,this.buffer=i||null,this.midiChunksByteLength=null,this.division,this.format,this.setIntervalId=!1,this.tracks=[],this.instruments=[],this.defaultTempo=120,this.tempo=null,this.startTick=0,this.tick=0,this.lastTick=null,this.inLoop=!1,this.totalTicks=0,this.events=[],this.totalEvents=0,this.eventListeners={},"function"==typeof t&&this.on("midiEvent",t)}return gt(e,[{key:"loadFile",value:function(e){throw"loadFile is only supported on Node.js"}},{key:"loadArrayBuffer",value:function(e){return this.buffer=new Uint8Array(e),this.fileLoaded()}},{key:"loadDataUri",value:function(e){for(var t=bt.atob(e.split(",")[1]),i=new Uint8Array(t.length),n=0;n<t.length;n++)i[n]=t.charCodeAt(n);return this.buffer=i,this.fileLoaded()}},{key:"getFilesize",value:function(){return this.buffer?this.buffer.length:0}},{key:"fileLoaded",value:function(){if(!this.validate())throw"Invalid MIDI file; should start with MThd";return this.setTempo(this.defaultTempo).getDivision().getFormat().getTracks().dryRun()}},{key:"validate",value:function(){return"MThd"===bt.bytesToLetters(this.buffer.subarray(0,4))}},{key:"getFormat",value:function(){return this.format=bt.bytesToNumber(this.buffer.subarray(8,10)),this}},{key:"getTracks",value:function(){this.tracks=[];for(var e=0;e<this.buffer.length;){if("MTrk"==bt.bytesToLetters(this.buffer.subarray(e,e+4))){var t=bt.bytesToNumber(this.buffer.subarray(e+4,e+8));this.tracks.push(new xt(this.tracks.length,this.buffer.subarray(e+8,e+8+t)))}e+=bt.bytesToNumber(this.buffer.subarray(e+4,e+8))+8}var i=0;return this.tracks.forEach((function(e){i+=8+e.data.length})),this.midiChunksByteLength=ft.HEADER_CHUNK_LENGTH+i,this}},{key:"enableTrack",value:function(e){return this.tracks[e-1].enable(),this}},{key:"disableTrack",value:function(e){return this.tracks[e-1].disable(),this}},{key:"getDivision",value:function(){return this.division=bt.bytesToNumber(this.buffer.subarray(12,ft.HEADER_CHUNK_LENGTH)),this}},{key:"playLoop",value:function(e){this.inLoop||(this.inLoop=!0,this.tick=this.getCurrentTick(),this.tracks.forEach((function(t,i){if(!e&&this.endOfFile())this.triggerPlayerEvent("endOfFile"),this.stop();else{var n=t.handleEvent(this.tick,e);e&&n?(n.hasOwnProperty("name")&&"Set Tempo"===n.name&&(this.defaultTempo=n.data,this.setTempo(n.data)),n.hasOwnProperty("name")&&"Program Change"===n.name&&(this.instruments.includes(n.value)||this.instruments.push(n.value))):n&&(n.hasOwnProperty("name")&&"Set Tempo"===n.name&&(this.setTempo(n.data),this.isPlaying()&&this.pause().play()),this.emitEvent(n))}}),this),e||this.triggerPlayerEvent("playing",{tick:this.tick}),this.inLoop=!1)}},{key:"setTempo",value:function(e){return this.tempo=e,this}},{key:"setStartTime",value:function(e){return this.startTime=e,this}},{key:"play",value:function(){if(this.isPlaying())throw"Already playing...";return this.startTime||(this.startTime=(new Date).getTime()),this.setIntervalId=setInterval(this.playLoop.bind(this),this.sampleRate),this}},{key:"loop",value:function(){setTimeout(function(){this.playLoop(),this.loop()}.bind(this),this.sampleRate)}},{key:"pause",value:function(){return clearInterval(this.setIntervalId),this.setIntervalId=!1,this.startTick=this.tick,this.startTime=0,this}},{key:"stop",value:function(){return clearInterval(this.setIntervalId),this.setIntervalId=!1,this.startTick=0,this.startTime=0,this.resetTracks(),this}},{key:"skipToTick",value:function(e){return this.stop(),this.startTick=e,this.tracks.forEach((function(t){t.setEventIndexByTick(e)})),this}},{key:"skipToPercent",value:function(e){if(e<0||e>100)throw"Percent must be number between 1 and 100.";return this.skipToTick(Math.round(e/100*this.totalTicks)),this}},{key:"skipToSeconds",value:function(e){var t=this.getSongTime();if(e<0||e>t)throw e+" seconds not within song time of "+t;return this.skipToPercent(e/t*100),this}},{key:"isPlaying",value:function(){return this.setIntervalId>0||"object"===dt(this.setIntervalId)}},{key:"dryRun",value:function(){for(this.resetTracks();!this.endOfFile();)this.playLoop(!0);return this.events=this.getEvents(),this.totalEvents=this.getTotalEvents(),this.totalTicks=this.getTotalTicks(),this.startTick=0,this.startTime=0,this.resetTracks(),this.triggerPlayerEvent("fileLoaded",this),this}},{key:"resetTracks",value:function(){return this.tracks.forEach((function(e){return e.reset()})),this}},{key:"getEvents",value:function(){return this.tracks.map((function(e){return e.events}))}},{key:"getTotalTicks",value:function(){return Math.max.apply(null,this.tracks.map((function(e){return e.delta})))}},{key:"getTotalEvents",value:function(){return this.tracks.reduce((function(e,t){return{events:{length:e.events.length+t.events.length}}}),{events:{length:0}}).events.length}},{key:"getSongTime",value:function(){return this.totalTicks/this.division/this.tempo*60}},{key:"getSongTimeRemaining",value:function(){return Math.round((this.totalTicks-this.getCurrentTick())/this.division/this.tempo*60)}},{key:"getSongPercentRemaining",value:function(){return Math.round(this.getSongTimeRemaining()/this.getSongTime()*100)}},{key:"bytesProcessed",value:function(){return ft.HEADER_CHUNK_LENGTH+8*this.tracks.length+this.tracks.reduce((function(e,t){return{pointer:e.pointer+t.pointer}}),{pointer:0}).pointer}},{key:"eventsPlayed",value:function(){return this.tracks.reduce((function(e,t){return{eventIndex:e.eventIndex+t.eventIndex}}),{eventIndex:0}).eventIndex}},{key:"endOfFile",value:function(){return this.isPlaying()?this.totalTicks-this.tick<=0:this.bytesProcessed()>=this.midiChunksByteLength}},{key:"getCurrentTick",value:function(){return this.startTime?Math.round(((new Date).getTime()-this.startTime)/1e3*(this.division*(this.tempo/60)))+this.startTick:this.startTick}},{key:"emitEvent",value:function(e){return this.triggerPlayerEvent("midiEvent",e),this}},{key:"on",value:function(e,t){return this.eventListeners.hasOwnProperty(e)||(this.eventListeners[e]=[]),this.eventListeners[e].push(t),this}},{key:"triggerPlayerEvent",value:function(e,t){return this.eventListeners.hasOwnProperty(e)&&this.eventListeners[e].forEach((function(e){return e(t||{})})),this}}]),e}(),Utils:bt,Constants:ft};const Tt=(e,t,i)=>({endTime:t,insertTime:i,type:"exponentialRampToValue",value:e}),St=(e,t,i)=>({endTime:t,insertTime:i,type:"linearRampToValue",value:e}),Et=(e,t)=>({startTime:t,type:"setValue",value:e}),Ct=(e,t,i)=>({duration:i,startTime:t,type:"setValueCurve",values:e}),Pt=(e,t,{startTime:i,target:n,timeConstant:s})=>n+(t-n)*Math.exp((i-e)/s),Mt=e=>"exponentialRampToValue"===e.type,Rt=e=>"linearRampToValue"===e.type,Dt=e=>Mt(e)||Rt(e),At=e=>"setValue"===e.type,Ot=e=>"setValueCurve"===e.type,It=(e,t,i,n)=>{const s=e[t];return void 0===s?n:Dt(s)||At(s)?s.value:Ot(s)?s.values[s.values.length-1]:Pt(i,It(e,t-1,s.startTime,n),s)},Ft=(e,t,i,n,s)=>void 0===i?[n.insertTime,s]:Dt(i)?[i.endTime,i.value]:At(i)?[i.startTime,i.value]:Ot(i)?[i.startTime+i.duration,i.values[i.values.length-1]]:[i.startTime,It(e,t-1,i.startTime,s)],jt=e=>"cancelAndHold"===e.type,zt=e=>"cancelScheduledValues"===e.type,Nt=e=>jt(e)||zt(e)?e.cancelTime:Mt(e)||Rt(e)?e.endTime:e.startTime,Lt=(e,t,i,{endTime:n,value:s})=>i===s?s:0<i&&0<s||i<0&&s<0?i*(s/i)**((e-t)/(n-t)):0,Bt=(e,t,i,{endTime:n,value:s})=>i+(e-t)/(n-t)*(s-i),Wt=(e,{duration:t,startTime:i,values:n})=>((e,t)=>{const i=Math.floor(t),n=Math.ceil(t);return i===n?e[i]:(1-(t-i))*e[i]+(1-(n-t))*e[n]})(n,(e-i)/t*(n.length-1)),qt=e=>"setTarget"===e.type;class $t{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=Nt(e);if(jt(e)||zt(e)){const i=this._automationEvents.findIndex((i=>zt(e)&&Ot(i)?i.startTime+i.duration>=t:Nt(i)>=t)),n=this._automationEvents[i];if(-1!==i&&(this._automationEvents=this._automationEvents.slice(0,i)),jt(e)){const e=this._automationEvents[this._automationEvents.length-1];if(void 0!==n&&Dt(n)){if(qt(e))throw new Error("The internal list is malformed.");const i=Ot(e)?e.startTime+e.duration:Nt(e),s=Ot(e)?e.values[e.values.length-1]:e.value,r=Mt(n)?Lt(t,i,s,n):Bt(t,i,s,n),o=Mt(n)?Tt(r,t,this._currenTime):St(r,t,this._currenTime);this._automationEvents.push(o)}void 0!==e&&qt(e)&&this._automationEvents.push(Et(this.getValue(t),t)),void 0!==e&&Ot(e)&&e.startTime+e.duration>t&&(this._automationEvents[this._automationEvents.length-1]=Ct(new Float32Array([6,7]),e.startTime,t-e.startTime))}}else{const i=this._automationEvents.findIndex((e=>Nt(e)>t)),n=-1===i?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[i-1];if(void 0!==n&&Ot(n)&&Nt(n)+n.duration>t)return!1;const s=Mt(e)?Tt(e.value,e.endTime,this._currenTime):Rt(e)?St(e.value,t,this._currenTime):e;if(-1===i)this._automationEvents.push(s);else{if(Ot(e)&&t+e.duration>Nt(this._automationEvents[i]))return!1;this._automationEvents.splice(i,0,s)}}return!0}flush(e){const t=this._automationEvents.findIndex((t=>Nt(t)>e));if(t>1){const e=this._automationEvents.slice(t-1),i=e[0];qt(i)&&e.unshift(Et(It(this._automationEvents,t-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=e}}getValue(e){if(0===this._automationEvents.length)return this._defaultValue;const t=this._automationEvents.findIndex((t=>Nt(t)>e)),i=this._automationEvents[t],n=(-1===t?this._automationEvents.length:t)-1,s=this._automationEvents[n];if(void 0!==s&&qt(s)&&(void 0===i||!Dt(i)||i.insertTime>e))return Pt(e,It(this._automationEvents,n-1,s.startTime,this._defaultValue),s);if(void 0!==s&&At(s)&&(void 0===i||!Dt(i)))return s.value;if(void 0!==s&&Ot(s)&&(void 0===i||!Dt(i)||s.startTime+s.duration>e))return e<s.startTime+s.duration?Wt(e,s):s.values[s.values.length-1];if(void 0!==s&&Dt(s)&&(void 0===i||!Dt(i)))return s.value;if(void 0!==i&&Mt(i)){const[t,r]=Ft(this._automationEvents,n,s,i,this._defaultValue);return Lt(e,t,r,i)}if(void 0!==i&&Rt(i)){const[t,r]=Ft(this._automationEvents,n,s,i,this._defaultValue);return Bt(e,t,r,i)}return this._defaultValue}}const Vt=new WeakSet,Ht=new WeakMap,Ut=new WeakMap,Gt=new WeakMap,Zt=new WeakMap,Xt=new WeakMap,Yt=new WeakMap,Kt=new WeakMap,Qt=new WeakMap,Jt=new WeakMap,ei={construct:()=>ei},ti=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,ii=(e,t)=>{const i=[];let n=e.replace(/^[\s]+/,""),s=n.match(ti);for(;null!==s;){const e=s[1].slice(1,-1),r=s[0].replace(/([\s]+)?;?$/,"").replace(e,new URL(e,t).toString());i.push(r),n=n.slice(s[0].length).replace(/^[\s]+/,""),s=n.match(ti)}return[i.join(";"),n]},ni=e=>{if(void 0!==e&&!Array.isArray(e))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},si=e=>{if(!(e=>{try{new new Proxy(e,ei)}catch{return!1}return!0})(e))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===e.prototype||"object"!=typeof e.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},ri=(e,t)=>{const i=e.get(t);if(void 0===i)throw new Error("A value with the given key could not be found.");return i},oi=(e,t)=>{const i=Array.from(e).filter(t);if(i.length>1)throw Error("More than one element was found.");if(0===i.length)throw Error("No element was found.");const[n]=i;return e.delete(n),n},ai=(e,t,i,n)=>{const s=ri(e,t),r=oi(s,(e=>e[0]===i&&e[1]===n));return 0===s.size&&e.delete(t),r},li=e=>ri(Yt,e),hi=e=>{if(Vt.has(e))throw new Error("The AudioNode is already stored.");Vt.add(e),li(e).forEach((e=>e(!0)))},ui=e=>"port"in e,ci=e=>{if(!Vt.has(e))throw new Error("The AudioNode is not stored.");Vt.delete(e),li(e).forEach((e=>e(!1)))},di=(e,t)=>{!ui(e)&&t.every((e=>0===e.size))&&ci(e)},pi={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},mi=(e,t)=>e.context===t,gi=e=>{try{e.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},fi=()=>new DOMException("","IndexSizeError"),vi=e=>{var t;e.getChannelData=(t=e.getChannelData,i=>{try{return t.call(e,i)}catch(e){if(12===e.code)throw fi();throw e}})},yi={numberOfChannels:1},_i=-34028234663852886e22,wi=-_i,bi=e=>Vt.has(e),xi={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},ki=e=>ri(Ht,e),Ti=e=>ri(Gt,e),Si=(e,t)=>{const{activeInputs:i}=ki(e);i.forEach((i=>i.forEach((([i])=>{t.includes(e)||Si(i,[...t,e])}))));const n=(e=>"playbackRate"in e)(e)?[e.playbackRate]:ui(e)?Array.from(e.parameters.values()):(e=>"frequency"in e&&"gain"in e)(e)?[e.Q,e.detune,e.frequency,e.gain]:(e=>"offset"in e)(e)?[e.offset]:(e=>!("frequency"in e)&&"gain"in e)(e)?[e.gain]:(e=>"detune"in e&&"frequency"in e)(e)?[e.detune,e.frequency]:(e=>"pan"in e)(e)?[e.pan]:[];for(const e of n){const i=Ti(e);void 0!==i&&i.activeInputs.forEach((([e])=>Si(e,t)))}bi(e)&&ci(e)},Ei=e=>{Si(e.destination,[])},Ci=e=>"context"in e,Pi=e=>Ci(e[0]),Mi=(e,t,i,n)=>{for(const t of e)if(i(t)){if(n)return!1;throw Error("The set contains at least one similar element.")}return e.add(t),!0},Ri=(e,t,[i,n],s)=>{Mi(e,[t,i,n],(e=>e[0]===t&&e[1]===i),s)},Di=(e,[t,i,n],s)=>{const r=e.get(t);void 0===r?e.set(t,new Set([[i,n]])):Mi(r,[i,n],(e=>e[0]===i),s)},Ai=e=>"inputs"in e,Oi=(e,t,i,n)=>{if(Ai(t)){const s=t.inputs[n];return e.connect(s,i,0),[s,i,0]}return e.connect(t,i,n),[t,i,n]},Ii=(e,t,i)=>{for(const n of e)if(n[0]===t&&n[1]===i)return e.delete(n),n;return null},Fi=(e,t)=>{if(!li(e).delete(t))throw new Error("Missing the expected event listener.")},ji=(e,t,i)=>{const n=ri(e,t),s=oi(n,(e=>e[0]===i));return 0===n.size&&e.delete(t),s},zi=(e,t,i,n)=>{Ai(t)?e.disconnect(t.inputs[n],i,0):e.disconnect(t,i,n)},Ni=e=>ri(Ut,e),Li=e=>ri(Zt,e),Bi=e=>Kt.has(e),Wi=e=>!Vt.has(e),qi=e=>new Promise((t=>{const i=e.createScriptProcessor(256,1,1),n=e.createGain(),s=e.createBuffer(1,2,44100),r=s.getChannelData(0);r[0]=1,r[1]=1;const o=e.createBufferSource();o.buffer=s,o.loop=!0,o.connect(i).connect(e.destination),o.connect(n),o.disconnect(n),i.onaudioprocess=n=>{const s=n.inputBuffer.getChannelData(0);Array.prototype.some.call(s,(e=>1===e))?t(!0):t(!1),o.stop(),i.onaudioprocess=null,o.disconnect(i),i.disconnect(e.destination)},o.start()})),$i=(e,t)=>{const i=new Map;for(const t of e)for(const e of t){const t=i.get(e);i.set(e,void 0===t?1:t+1)}i.forEach(((e,i)=>t(i,e)))},Vi=e=>"context"in e,Hi=e=>{const t=new Map;e.connect=(e=>(i,n=0,s=0)=>{const r=Vi(i)?e(i,n,s):e(i,n),o=t.get(i);return void 0===o?t.set(i,[{input:s,output:n}]):o.every((e=>e.input!==s||e.output!==n))&&o.push({input:s,output:n}),r})(e.connect.bind(e)),e.disconnect=(i=>(n,s,r)=>{if(i.apply(e),void 0===n)t.clear();else if("number"==typeof n)for(const[e,i]of t){const s=i.filter((e=>e.output!==n));0===s.length?t.delete(e):t.set(e,s)}else if(t.has(n))if(void 0===s)t.delete(n);else{const e=t.get(n);if(void 0!==e){const i=e.filter((e=>e.output!==s&&(e.input!==r||void 0===r)));0===i.length?t.delete(n):t.set(n,i)}}for(const[i,n]of t)n.forEach((t=>{Vi(i)?e.connect(i,t.output,t.input):e.connect(i,t.output)}))})(e.disconnect)},Ui=(e,t,i,n)=>{const{activeInputs:s,passiveInputs:r}=Ti(t),{outputs:o}=ki(e),a=li(e),l=o=>{const a=Ni(e),l=Li(t);if(o){const t=ji(r,e,i);Ri(s,e,t,!1),n||Bi(e)||a.connect(l,i)}else{const t=((e,t,i)=>oi(e,(e=>e[0]===t&&e[1]===i)))(s,e,i);Di(r,t,!1),n||Bi(e)||a.disconnect(l,i)}};return!!Mi(o,[t,i],(e=>e[0]===t&&e[1]===i),!0)&&(a.add(l),bi(e)?Ri(s,e,[i,l],!0):Di(r,[e,i,l],!0),!0)},Gi=(e,t,i,n,s)=>{const[r,o]=((e,t,i,n)=>{const{activeInputs:s,passiveInputs:r}=ki(t),o=Ii(s[n],e,i);if(null===o)return[ai(r,e,i,n)[2],!1];return[o[2],!0]})(e,i,n,s);if(null!==r&&(Fi(e,r),!o||t||Bi(e)||zi(Ni(e),Ni(i),n,s)),bi(i)){const{activeInputs:e}=ki(i);di(i,e)}},Zi=(e,t,i,n)=>{const[s,r]=((e,t,i)=>{const{activeInputs:n,passiveInputs:s}=Ti(t),r=Ii(n,e,i);if(null===r)return[ji(s,e,i)[1],!1];return[r[2],!0]})(e,i,n);null!==s&&(Fi(e,s),!r||t||Bi(e)||Ni(e).disconnect(Li(i),n))};class Xi{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach(((i,n)=>e.call(t,i,n,this)))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const Yi={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function Ki(e,t,i,n,s){if("function"==typeof e.copyFromChannel)0===t[i].byteLength&&(t[i]=new Float32Array(128)),e.copyFromChannel(t[i],n,s);else{const r=e.getChannelData(n);if(0===t[i].byteLength)t[i]=r.slice(s,s+128);else{const e=new Float32Array(r.buffer,s*Float32Array.BYTES_PER_ELEMENT,128);t[i].set(e)}}}const Qi=(e,t,i,n,s)=>{"function"==typeof e.copyToChannel?0!==t[i].byteLength&&e.copyToChannel(t[i],n,s):0!==t[i].byteLength&&e.getChannelData(n).set(t[i],s)},Ji=(e,t)=>{const i=[];for(let n=0;n<e;n+=1){const e=[],s="number"==typeof t?t:t[n];for(let t=0;t<s;t+=1)e.push(new Float32Array(128));i.push(e)}return i},en=async(e,t,i,n,s,r,o)=>{const a=null===t?128*Math.ceil(e.context.length/128):t.length,l=n.channelCount*n.numberOfInputs,h=s.reduce(((e,t)=>e+t),0),u=0===h?null:i.createBuffer(h,a,i.sampleRate);if(void 0===r)throw new Error("Missing the processor constructor.");const c=ki(e),d=await((e,t)=>{const i=ri(Jt,e),n=Ni(t);return ri(i,n)})(i,e),p=Ji(n.numberOfInputs,n.channelCount),m=Ji(n.numberOfOutputs,s),g=Array.from(e.parameters.keys()).reduce(((e,t)=>({...e,[t]:new Float32Array(128)})),{});for(let h=0;h<a;h+=128){if(n.numberOfInputs>0&&null!==t)for(let e=0;e<n.numberOfInputs;e+=1)for(let i=0;i<n.channelCount;i+=1)Ki(t,p[e],i,i,h);void 0!==r.parameterDescriptors&&null!==t&&r.parameterDescriptors.forEach((({name:e},i)=>{Ki(t,g,e,l+i,h)}));for(let e=0;e<n.numberOfInputs;e+=1)for(let t=0;t<s[e];t+=1)0===m[e][t].byteLength&&(m[e][t]=new Float32Array(128));try{const e=p.map(((e,t)=>0===c.activeInputs[t].size?[]:e)),t=o(h/i.sampleRate,i.sampleRate,(()=>d.process(e,m,g)));if(null!==u)for(let e=0,t=0;e<n.numberOfOutputs;e+=1){for(let i=0;i<s[e];i+=1)Qi(u,m[e],i,t+i,h);t+=s[e]}if(!t)break}catch(t){e.dispatchEvent(new ErrorEvent("processorerror",{colno:t.colno,filename:t.filename,lineno:t.lineno,message:t.message}));break}}return u},tn={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},nn={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},sn={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},rn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},on={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},an=e=>{const{port1:t,port2:i}=new MessageChannel;return new Promise((n=>{const s=()=>{i.onmessage=null,t.close(),i.close(),n()};i.onmessage=()=>s();try{t.postMessage(e,[e])}finally{s()}}))},ln={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},hn=(e,t,i)=>{const n=t[i];if(void 0===n)throw e();return n},un={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},cn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},dn=()=>new DOMException("","InvalidStateError"),pn=()=>new DOMException("","InvalidAccessError"),mn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},gn=(e,t,i,n,s,r,o,a,l,h,u)=>{const c=h.length;let d=a;for(let a=0;a<c;a+=1){let c=i[0]*h[a];for(let t=1;t<s;t+=1){const n=d-t&l-1;c+=i[t]*r[n],c-=e[t]*o[n]}for(let e=s;e<n;e+=1)c+=i[e]*r[d-e&l-1];for(let i=s;i<t;i+=1)c-=e[i]*o[d-i&l-1];r[d]=h[a],o[d]=c,d=d+1&l-1,u[a]=c}return d},fn={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},vn=e=>{const t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const i=e.decodeAudioData(t.buffer,(()=>{}));return void 0!==i&&(i.catch((()=>{})),!0)}catch{}return!1},yn=(e,t,i)=>{const n=t[i];void 0!==n&&n!==e[i]&&(e[i]=n)},_n=(e,t)=>{yn(e,t,"channelCount"),yn(e,t,"channelCountMode"),yn(e,t,"channelInterpretation")},wn=e=>"function"==typeof e.getFloatTimeDomainData,bn=(e,t,i)=>{const n=t[i];void 0!==n&&n!==e[i].value&&(e[i].value=n)},xn=e=>{e.start=(t=>(i=0,n=0,s)=>{if("number"==typeof s&&s<0||n<0||i<0)throw new RangeError("The parameters can't be negative.");t.call(e,i,n,s)})(e.start)},kn=e=>{var t;e.stop=(t=e.stop,(i=0)=>{if(i<0)throw new RangeError("The parameter can't be negative.");t.call(e,i)})},Tn=(e,t)=>null===e?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(e*t))))),Sn=async(e,t)=>new e(await(e=>new Promise(((t,i)=>{const{port1:n,port2:s}=new MessageChannel;n.onmessage=({data:e})=>{n.close(),s.close(),t(e)},n.onmessageerror=({data:e})=>{n.close(),s.close(),i(e)},s.postMessage(e)})))(t)),En=(e,t)=>{const i=e.createBiquadFilter();return _n(i,t),bn(i,t,"Q"),bn(i,t,"detune"),bn(i,t,"frequency"),bn(i,t,"gain"),yn(i,t,"type"),i},Cn=(e,t)=>{const i=e.createChannelSplitter(t.numberOfOutputs);return _n(i,t),(e=>{const t=e.numberOfOutputs;Object.defineProperty(e,"channelCount",{get:()=>t,set:e=>{if(e!==t)throw dn()}}),Object.defineProperty(e,"channelCountMode",{get:()=>"explicit",set:e=>{if("explicit"!==e)throw dn()}}),Object.defineProperty(e,"channelInterpretation",{get:()=>"discrete",set:e=>{if("discrete"!==e)throw dn()}})})(i),i},Pn=(e,t)=>(e.connect=t.connect.bind(t),e.disconnect=t.disconnect.bind(t),e),Mn=(e,t)=>{const i=e.createDelay(t.maxDelayTime);return _n(i,t),bn(i,t,"delayTime"),i},Rn=(e,t)=>{const i=e.createGain();return _n(i,t),bn(i,t,"gain"),i};function Dn(e,t){const i=t[0]*t[0]+t[1]*t[1];return[(e[0]*t[0]+e[1]*t[1])/i,(e[1]*t[0]-e[0]*t[1])/i]}function An(e,t){let i=[0,0];for(let r=e.length-1;r>=0;r-=1)s=t,i=[(n=i)[0]*s[0]-n[1]*s[1],n[0]*s[1]+n[1]*s[0]],i[0]+=e[r];var n,s;return i}const On=(e,t,i,n)=>e.createScriptProcessor(t,i,n),In=()=>new DOMException("","NotSupportedError"),Fn={numberOfChannels:1},jn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},zn={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Nn={disableNormalization:!1},Ln={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Bn={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Wn=(e,t,i)=>void 0===e.copyFromChannel?e.getChannelData(i)[0]:(e.copyFromChannel(t,i),t[0]),qn=e=>{if(null===e)return!1;const t=e.length;return t%2!=0?0!==e[Math.floor(t/2)]:e[t/2-1]+e[t/2]!==0},$n=(e,t,i,n)=>{let s=e;for(;!s.hasOwnProperty(t);)s=Object.getPrototypeOf(s);const{get:r,set:o}=Object.getOwnPropertyDescriptor(s,t);Object.defineProperty(e,t,{get:i(r),set:n(o)})},Vn=(e,t,i)=>{try{e.setValueAtTime(t,i)}catch(n){if(9!==n.code)throw n;Vn(e,t,i+1e-7)}},Hn=e=>{const t=e.createOscillator();try{t.start(-1)}catch(e){return e instanceof RangeError}return!1},Un=e=>{const t=e.createBuffer(1,1,44100),i=e.createBufferSource();i.buffer=t,i.start(),i.stop();try{return i.stop(),!0}catch{return!1}},Gn=e=>{const t=e.createOscillator();try{t.stop(-1)}catch(e){return e instanceof RangeError}return!1},Zn=(e,t)=>{const i=t.createGain();e.connect(i);const n=(t=>()=>{t.call(e,i),e.removeEventListener("ended",n)})(e.disconnect);e.addEventListener("ended",n),Pn(e,i),e.stop=(t=>{let n=!1;return(s=0)=>{if(n)try{t.call(e,s)}catch{i.gain.setValueAtTime(0,s)}else t.call(e,s),n=!0}})(e.stop)},Xn=(e,t)=>i=>{const n={value:e};return Object.defineProperties(i,{currentTarget:n,target:n}),"function"==typeof t?t.call(e,i):t.handleEvent.call(e,i)},Yn=(e=>(t,i,[n,s,r],o)=>{e(t[s],[i,n,r],(e=>e[0]===i&&e[1]===n),o)})(Mi),Kn=(e=>(t,i,[n,s,r],o)=>{const a=t.get(n);void 0===a?t.set(n,new Set([[s,i,r]])):e(a,[s,i,r],(e=>e[0]===s&&e[1]===i),o)})(Mi),Qn=(e=>(t,i,n,s)=>e(t[s],(e=>e[0]===i&&e[1]===n)))(oi),Jn=new WeakMap,es=(e=>t=>{var i;return null!==(i=e.get(t))&&void 0!==i?i:0})(Jn),ts=(is=new Map,ns=new WeakMap,(e,t)=>{const i=ns.get(e);if(void 0!==i)return i;const n=is.get(e);if(void 0!==n)return n;try{const i=t();return i instanceof Promise?(is.set(e,i),i.catch((()=>!1)).then((t=>(is.delete(e),ns.set(e,t),t)))):(ns.set(e,i),i)}catch{return ns.set(e,!1),!1}});var is,ns;const ss="undefined"==typeof window?null:window,rs=((e,t)=>(i,n)=>{const s=i.createAnalyser();if(_n(s,n),!(n.maxDecibels>n.minDecibels))throw t();return yn(s,n,"fftSize"),yn(s,n,"maxDecibels"),yn(s,n,"minDecibels"),yn(s,n,"smoothingTimeConstant"),e(wn,(()=>wn(s)))||(e=>{e.getFloatTimeDomainData=t=>{const i=new Uint8Array(t.length);e.getByteTimeDomainData(i);const n=Math.max(i.length,e.fftSize);for(let e=0;e<n;e+=1)t[e]=.0078125*(i[e]-128);return t}})(s),s})(ts,fi),os=(e=>t=>{const i=e(t);if(null===i.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return i.renderer})(ki),as=((e,t,i)=>async(n,s,r,o)=>{const a=e(n),l=[...o,n];await Promise.all(a.activeInputs.map(((e,o)=>Array.from(e).filter((([e])=>!l.includes(e))).map((async([e,a])=>{const h=t(e),u=await h.render(e,s,l),c=n.context.destination;i(e)||n===c&&i(n)||u.connect(r,a,o)})))).reduce(((e,t)=>[...e,...t]),[]))})(ki,os,Bi),ls=((e,t,i)=>()=>{const n=new WeakMap;return{render(s,r,o){const a=n.get(r);return void 0!==a?Promise.resolve(a):(async(s,r,o)=>{let a=t(s);if(!mi(a,r)){const t={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=e(r,t)}return n.set(r,a),await i(s,r,a,o),a})(s,r,o)}}})(rs,Ni,as),hs=(us=Xt,e=>{const t=us.get(e);if(void 0===t)throw dn();return t});var us;const cs=(e=>null===e?null:e.hasOwnProperty("OfflineAudioContext")?e.OfflineAudioContext:e.hasOwnProperty("webkitOfflineAudioContext")?e.webkitOfflineAudioContext:null)(ss),ds=(e=>t=>null!==e&&t instanceof e)(cs),ps=new WeakMap,ms=(e=>class{constructor(e){this._nativeEventTarget=e,this._listeners=new WeakMap}addEventListener(t,i,n){if(null!==i){let s=this._listeners.get(i);void 0===s&&(s=e(this,i),"function"==typeof i&&this._listeners.set(i,s)),this._nativeEventTarget.addEventListener(t,s,n)}}dispatchEvent(e){return this._nativeEventTarget.dispatchEvent(e)}removeEventListener(e,t,i){const n=null===t?void 0:this._listeners.get(t);this._nativeEventTarget.removeEventListener(e,void 0===n?null:n,i)}})(Xn),gs=(e=>null===e?null:e.hasOwnProperty("AudioContext")?e.AudioContext:e.hasOwnProperty("webkitAudioContext")?e.webkitAudioContext:null)(ss),fs=(e=>t=>null!==e&&t instanceof e)(gs),vs=(e=>t=>null!==e&&"function"==typeof e.AudioNode&&t instanceof e.AudioNode)(ss),ys=(e=>t=>null!==e&&"function"==typeof e.AudioParam&&t instanceof e.AudioParam)(ss),_s=((e,t,i,n,s,r,o,a,l,h,u,c,d,p,m)=>class extends h{constructor(t,n,s,r){super(s),this._context=t,this._nativeAudioNode=s;const o=u(t);c(o)&&!0!==i(qi,(()=>qi(o)))&&Hi(s),Ut.set(this,s),Yt.set(this,new Set),"closed"!==t.state&&n&&hi(this),e(this,r,s)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(e){this._nativeAudioNode.channelCount=e}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(e){this._nativeAudioNode.channelCountMode=e}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(e){this._nativeAudioNode.channelInterpretation=e}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(e,i=0,a=0){if(i<0||i>=this._nativeAudioNode.numberOfOutputs)throw s();const h=u(this._context),c=m(h);if(d(e)||p(e))throw r();if(Ci(e)){const s=Ni(e);try{const t=Oi(this._nativeAudioNode,s,i,a),n=Wi(this);(c||n)&&this._nativeAudioNode.disconnect(...t),"closed"!==this.context.state&&!n&&Wi(e)&&hi(e)}catch(e){if(12===e.code)throw r();throw e}if(t(this,e,i,a,c)){const t=l([this],e);$i(t,n(c))}return e}const g=Li(e);if("playbackRate"===g.name&&1024===g.maxValue)throw o();try{this._nativeAudioNode.connect(g,i),(c||Wi(this))&&this._nativeAudioNode.disconnect(g,i)}catch(e){if(12===e.code)throw r();throw e}if(Ui(this,e,i,c)){const t=l([this],e);$i(t,n(c))}}disconnect(e,t,i){let n;const o=u(this._context),h=m(o);if(void 0===e)n=((e,t)=>{const i=ki(e),n=[];for(const s of i.outputs)Pi(s)?Gi(e,t,...s):Zi(e,t,...s),n.push(s[0]);return i.outputs.clear(),n})(this,h);else if("number"==typeof e){if(e<0||e>=this.numberOfOutputs)throw s();n=((e,t,i)=>{const n=ki(e),s=[];for(const r of n.outputs)r[1]===i&&(Pi(r)?Gi(e,t,...r):Zi(e,t,...r),s.push(r[0]),n.outputs.delete(r));return s})(this,h,e)}else{if(void 0!==t&&(t<0||t>=this.numberOfOutputs))throw s();if(Ci(e)&&void 0!==i&&(i<0||i>=e.numberOfInputs))throw s();if(n=((e,t,i,n,s)=>{const r=ki(e);return Array.from(r.outputs).filter((e=>!(e[0]!==i||void 0!==n&&e[1]!==n||void 0!==s&&e[2]!==s))).map((i=>(Pi(i)?Gi(e,t,...i):Zi(e,t,...i),r.outputs.delete(i),i[0])))})(this,h,e,t,i),0===n.length)throw r()}for(const e of n){const t=l([this],e);$i(t,a)}}})((ws=Ht,(e,t,i)=>{const n=[];for(let e=0;e<i.numberOfInputs;e+=1)n.push(new Set);ws.set(e,{activeInputs:n,outputs:new Set,passiveInputs:new WeakMap,renderer:t})}),((e,t,i,n,s,r,o,a,l,h,u,c,d)=>{const p=new WeakMap;return(m,g,f,v,y)=>{const{activeInputs:_,passiveInputs:w}=r(g),{outputs:b}=r(m),x=a(m),k=r=>{const a=l(g),h=l(m);if(r){const t=ai(w,m,f,v);e(_,m,t,!1),y||c(m)||i(h,a,f,v),d(g)&&hi(g)}else{const e=n(_,m,f,v);t(w,v,e,!1),y||c(m)||s(h,a,f,v);const i=o(g);if(0===i)u(g)&&di(g,_);else{const e=p.get(g);void 0!==e&&clearTimeout(e),p.set(g,setTimeout((()=>{u(g)&&di(g,_)}),1e3*i))}}};return!!h(b,[g,f,v],(e=>e[0]===g&&e[1]===f&&e[2]===v),!0)&&(x.add(k),u(m)?e(_,m,[f,v,k],!0):t(w,v,[m,f,k],!0),!0)}})(Yn,Kn,Oi,Qn,zi,ki,es,li,Ni,Mi,bi,Bi,Wi),ts,((e,t,i,n,s,r)=>o=>(a,l)=>{const h=e.get(a);if(void 0===h){if(!o&&r(a)){const e=n(a),{outputs:r}=i(a);for(const i of r)if(Pi(i)){const s=n(i[0]);t(e,s,i[1],i[2])}else{const t=s(i[0]);e.disconnect(t,i[1])}}e.set(a,l)}else e.set(a,h+l)})(Kt,zi,ki,Ni,Li,bi),fi,pn,In,((e,t,i,n,s,r,o,a)=>(l,h)=>{const u=t.get(l);if(void 0===u)throw new Error("Missing the expected cycle count.");const c=r(l.context),d=a(c);if(u===h){if(t.delete(l),!d&&o(l)){const t=n(l),{outputs:r}=i(l);for(const i of r)if(Pi(i)){const s=n(i[0]);e(t,s,i[1],i[2])}else{const e=s(i[0]);t.connect(e,i[1])}}}else t.set(l,u-h)})(Oi,Kt,ki,Ni,Li,hs,bi,ds),((e,t,i)=>function n(s,r){const o=Ci(r)?r:i(e,r);if((e=>"delayTime"in e)(o))return[];if(s[0]===o)return[s];if(s.includes(o))return[];const{outputs:a}=t(o);return Array.from(a).map((e=>n([...s,o],e[0]))).reduce(((e,t)=>e.concat(t)),[])})(ps,ki,ri),ms,hs,fs,vs,ys,ds);var ws;const bs=((e,t,i,n,s,r)=>class extends e{constructor(e,i){const o=s(e),a={...pi,...i},l=n(o,a);super(e,!1,l,r(o)?t():null),this._nativeAnalyserNode=l}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(e){this._nativeAnalyserNode.fftSize=e}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(e){const t=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=e,!(e>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=t,i()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(e){const t=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=e,!(this._nativeAnalyserNode.maxDecibels>e))throw this._nativeAnalyserNode.minDecibels=t,i()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(e){this._nativeAnalyserNode.smoothingTimeConstant=e}getByteFrequencyData(e){this._nativeAnalyserNode.getByteFrequencyData(e)}getByteTimeDomainData(e){this._nativeAnalyserNode.getByteTimeDomainData(e)}getFloatFrequencyData(e){this._nativeAnalyserNode.getFloatFrequencyData(e)}getFloatTimeDomainData(e){this._nativeAnalyserNode.getFloatTimeDomainData(e)}})(_s,ls,fi,rs,hs,ds),xs=new WeakSet,ks=(e=>null===e?null:e.hasOwnProperty("AudioBuffer")?e.AudioBuffer:null)(ss),Ts=(Ss=new Uint32Array(1),e=>(Ss[0]=e,Ss[0]));var Ss;const Es=((e,t)=>i=>{i.copyFromChannel=(n,s,r=0)=>{const o=e(r),a=e(s);if(a>=i.numberOfChannels)throw t();const l=i.length,h=i.getChannelData(a),u=n.length;for(let e=o<0?-o:0;e+o<l&&e<u;e+=1)n[e]=h[e+o]},i.copyToChannel=(n,s,r=0)=>{const o=e(r),a=e(s);if(a>=i.numberOfChannels)throw t();const l=i.length,h=i.getChannelData(a),u=n.length;for(let e=o<0?-o:0;e+o<l&&e<u;e+=1)h[e+o]=n[e]}})(Ts,fi),Cs=(e=>t=>{t.copyFromChannel=(i=>(n,s,r=0)=>{const o=e(r),a=e(s);if(o<t.length)return i.call(t,n,a,o)})(t.copyFromChannel),t.copyToChannel=(i=>(n,s,r=0)=>{const o=e(r),a=e(s);if(o<t.length)return i.call(t,n,a,o)})(t.copyToChannel)})(Ts),Ps=((e,t,i,n,s,r,o,a)=>{let l=null;return class h{constructor(h){if(null===s)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:u,numberOfChannels:c,sampleRate:d}={...yi,...h};null===l&&(l=new s(1,1,44100));const p=null!==n&&t(r,r)?new n({length:u,numberOfChannels:c,sampleRate:d}):l.createBuffer(c,u,d);if(0===p.numberOfChannels)throw i();return"function"!=typeof p.copyFromChannel?(o(p),vi(p)):t(gi,(()=>gi(p)))||a(p),e.add(p),p}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===h.prototype||e.has(t)}}})(xs,ts,In,ks,cs,(e=>()=>{if(null===e)return!1;try{new e({length:1,sampleRate:44100})}catch{return!1}return!0})(ks),Es,Cs),Ms=(e=>(t,i)=>{const n=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.connect(n).connect(t.destination);const s=()=>{i.removeEventListener("ended",s),i.disconnect(n),n.disconnect()};i.addEventListener("ended",s)})(Rn),Rs=((e,t,i)=>async(n,s,r,o)=>{const a=t(n);await Promise.all(Array.from(a.activeInputs).map((async([t,n])=>{const a=e(t),l=await a.render(t,s,o);i(t)||l.connect(r,n)})))})(os,Ti,Bi),Ds=(e=>(t,i,n,s)=>e(i,t,n,s))(Rs),As=((e,t,i,n,s,r,o,a,l,h,u)=>(c,d)=>{const p=c.createBufferSource();return _n(p,d),bn(p,d,"playbackRate"),yn(p,d,"buffer"),yn(p,d,"loop"),yn(p,d,"loopEnd"),yn(p,d,"loopStart"),t(i,(()=>i(c)))||(e=>{e.start=(t=>{let i=!1;return(n=0,s=0,r)=>{if(i)throw dn();t.call(e,n,s,r),i=!0}})(e.start)})(p),t(n,(()=>n(c)))||l(p),t(s,(()=>s(c)))||h(p,c),t(r,(()=>r(c)))||xn(p),t(o,(()=>o(c)))||u(p,c),t(a,(()=>a(c)))||kn(p),e(c,p),p})(Ms,ts,(e=>{const t=e.createBufferSource();t.start();try{t.start()}catch{return!0}return!1}),(e=>{const t=e.createBufferSource(),i=e.createBuffer(1,1,44100);t.buffer=i;try{t.start(0,1)}catch{return!1}return!0}),(e=>{const t=e.createBufferSource();t.start();try{t.stop()}catch{return!1}return!0}),Hn,Un,Gn,(e=>{e.start=(t=>(i=0,n=0,s)=>{const r=e.buffer,o=null===r?n:Math.min(r.duration,n);null!==r&&o>r.duration-.5/e.context.sampleRate?t.call(e,i,0,0):t.call(e,i,o,s)})(e.start)}),(e=>(t,i)=>{const n=i.createBuffer(1,1,44100);null===t.buffer&&(t.buffer=n),e(t,"buffer",(e=>()=>{const i=e.call(t);return i===n?null:i}),(e=>i=>e.call(t,null===i?n:i)))})($n),Zn),Os=((e,t)=>(i,n,s,r)=>(e(n).replay(s),t(n,i,s,r)))((e=>t=>{const i=e(t);if(null===i.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return i.renderer})(Ti),Rs),Is=((e,t,i,n,s)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(e){o=e},set stop(e){a=e},render(l,h,u){const c=r.get(h);return void 0!==c?Promise.resolve(c):(async(l,h,u)=>{let c=i(l);const d=mi(c,h);if(!d){const e={buffer:c.buffer,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,loop:c.loop,loopEnd:c.loopEnd,loopStart:c.loopStart,playbackRate:c.playbackRate.value};c=t(h,e),null!==o&&c.start(...o),null!==a&&c.stop(a)}return r.set(h,c),d?await e(h,l.playbackRate,c.playbackRate,u):await n(h,l.playbackRate,c.playbackRate,u),await s(l,h,c,u),c})(l,h,u)}}})(Ds,As,Ni,Os,as),Fs=((e,t,i,n,s,r,o,a,l,h,u,c,d)=>(p,m,g,f=null,v=null)=>{const y=new $t(g.defaultValue),_=m?n(y):null,w={get defaultValue(){return g.defaultValue},get maxValue(){return null===f?g.maxValue:f},get minValue(){return null===v?g.minValue:v},get value(){return g.value},set value(e){g.value=e,w.setValueAtTime(e,p.context.currentTime)},cancelAndHoldAtTime(e){if("function"==typeof g.cancelAndHoldAtTime)null===_&&y.flush(p.context.currentTime),y.add(s(e)),g.cancelAndHoldAtTime(e);else{const t=Array.from(y).pop();null===_&&y.flush(p.context.currentTime),y.add(s(e));const i=Array.from(y).pop();g.cancelScheduledValues(e),t!==i&&void 0!==i&&("exponentialRampToValue"===i.type?g.exponentialRampToValueAtTime(i.value,i.endTime):"linearRampToValue"===i.type?g.linearRampToValueAtTime(i.value,i.endTime):"setValue"===i.type?g.setValueAtTime(i.value,i.startTime):"setValueCurve"===i.type&&g.setValueCurveAtTime(i.values,i.startTime,i.duration))}return w},cancelScheduledValues:e=>(null===_&&y.flush(p.context.currentTime),y.add(r(e)),g.cancelScheduledValues(e),w),exponentialRampToValueAtTime(e,t){if(0===e)throw new RangeError;if(!Number.isFinite(t)||t<0)throw new RangeError;return null===_&&y.flush(p.context.currentTime),y.add(o(e,t)),g.exponentialRampToValueAtTime(e,t),w},linearRampToValueAtTime:(e,t)=>(null===_&&y.flush(p.context.currentTime),y.add(a(e,t)),g.linearRampToValueAtTime(e,t),w),setTargetAtTime:(e,t,i)=>(null===_&&y.flush(p.context.currentTime),y.add(l(e,t,i)),g.setTargetAtTime(e,t,i),w),setValueAtTime:(e,t)=>(null===_&&y.flush(p.context.currentTime),y.add(h(e,t)),g.setValueAtTime(e,t),w),setValueCurveAtTime(e,t,i){const n=e instanceof Float32Array?e:new Float32Array(e);if(null!==c&&"webkitAudioContext"===c.name){const e=t+i,s=p.context.sampleRate,r=Math.ceil(t*s),o=Math.floor(e*s),a=o-r,l=new Float32Array(a);for(let e=0;e<a;e+=1){const o=(n.length-1)/i*((r+e)/s-t),a=Math.floor(o),h=Math.ceil(o);l[e]=a===h?n[a]:(1-(o-a))*n[a]+(1-(h-o))*n[h]}null===_&&y.flush(p.context.currentTime),y.add(u(l,t,i)),g.setValueCurveAtTime(l,t,i);const h=o/s;h<e&&d(w,l[l.length-1],h),d(w,n[n.length-1],e)}else null===_&&y.flush(p.context.currentTime),y.add(u(n,t,i)),g.setValueCurveAtTime(n,t,i);return w}};return i.set(w,g),t.set(w,p),e(w,_),w})((js=Gt,(e,t)=>{js.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})}),ps,Zt,(e=>({replay(t){for(const i of e)if("exponentialRampToValue"===i.type){const{endTime:e,value:n}=i;t.exponentialRampToValueAtTime(n,e)}else if("linearRampToValue"===i.type){const{endTime:e,value:n}=i;t.linearRampToValueAtTime(n,e)}else if("setTarget"===i.type){const{startTime:e,target:n,timeConstant:s}=i;t.setTargetAtTime(n,e,s)}else if("setValue"===i.type){const{startTime:e,value:n}=i;t.setValueAtTime(n,e)}else{if("setValueCurve"!==i.type)throw new Error("Can't apply an unknown automation.");{const{duration:e,startTime:n,values:s}=i;t.setValueCurveAtTime(s,n,e)}}}})),(e=>({cancelTime:e,type:"cancelAndHold"})),(e=>({cancelTime:e,type:"cancelScheduledValues"})),((e,t)=>({endTime:t,type:"exponentialRampToValue",value:e})),((e,t)=>({endTime:t,type:"linearRampToValue",value:e})),((e,t,i)=>({startTime:t,target:e,timeConstant:i,type:"setTarget"})),Et,Ct,gs,Vn);var js;const zs=((e,t,i,n,s,r,o,a)=>class extends e{constructor(e,n){const a=r(e),l={...xi,...n},h=s(a,l),u=o(a),c=u?t():null;super(e,!1,h,c),this._audioBufferSourceNodeRenderer=c,this._isBufferNullified=!1,this._isBufferSet=null!==l.buffer,this._nativeAudioBufferSourceNode=h,this._onended=null,this._playbackRate=i(this,u,h.playbackRate,wi,_i)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(e){if(this._nativeAudioBufferSourceNode.buffer=e,null!==e){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(e){this._nativeAudioBufferSourceNode.loop=e}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(e){this._nativeAudioBufferSourceNode.loopEnd=e}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(e){this._nativeAudioBufferSourceNode.loopStart=e}get onended(){return this._onended}set onended(e){const t="function"==typeof e?a(this,e):null;this._nativeAudioBufferSourceNode.onended=t;const i=this._nativeAudioBufferSourceNode.onended;this._onended=null!==i&&i===t?e:i}get playbackRate(){return this._playbackRate}start(e=0,t=0,i){if(this._nativeAudioBufferSourceNode.start(e,t,i),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===i?[e,t]:[e,t,i]),"closed"!==this.context.state){hi(this);const e=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",e),bi(this)&&ci(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",e)}}stop(e=0){this._nativeAudioBufferSourceNode.stop(e),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=e)}})(_s,Is,Fs,dn,As,hs,ds,Xn),Ns=((e,t,i,n,s,r,o,a)=>class extends e{constructor(e,i){const n=r(e),l=o(n),h=s(n,i,l);super(e,!1,h,l?t(a):null),this._isNodeOfNativeOfflineAudioContext=l,this._nativeAudioDestinationNode=h}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(e){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(e>this._nativeAudioDestinationNode.maxChannelCount)throw i();this._nativeAudioDestinationNode.channelCount=e}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(e){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=e}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(_s,(e=>{let t=null;return{render:(i,n,s)=>(null===t&&(t=(async(t,i,n)=>{const s=i.destination;return await e(t,i,s,n),s})(i,n,s)),t)}}),fi,dn,((e,t)=>(i,n,s)=>{const r=i.destination;if(r.channelCount!==n)try{r.channelCount=n}catch{}s&&"explicit"!==r.channelCountMode&&(r.channelCountMode="explicit"),0===r.maxChannelCount&&Object.defineProperty(r,"maxChannelCount",{value:n});const o=e(i,{channelCount:n,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return t(o,"channelCount",(e=>()=>e.call(o)),(e=>t=>{e.call(o,t);try{r.channelCount=t}catch(e){if(t>r.maxChannelCount)throw e}})),t(o,"channelCountMode",(e=>()=>e.call(o)),(e=>t=>{e.call(o,t),r.channelCountMode=t})),t(o,"channelInterpretation",(e=>()=>e.call(o)),(e=>t=>{e.call(o,t),r.channelInterpretation=t})),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o})(Rn,$n),hs,ds,as),Ls=((e,t,i,n,s)=>()=>{const r=new WeakMap;return{render(o,a,l){const h=r.get(a);return void 0!==h?Promise.resolve(h):(async(o,a,l)=>{let h=i(o);const u=mi(h,a);if(!u){const e={Q:h.Q.value,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,detune:h.detune.value,frequency:h.frequency.value,gain:h.gain.value,type:h.type};h=t(a,e)}return r.set(a,h),u?(await e(a,o.Q,h.Q,l),await e(a,o.detune,h.detune,l),await e(a,o.frequency,h.frequency,l),await e(a,o.gain,h.gain,l)):(await n(a,o.Q,h.Q,l),await n(a,o.detune,h.detune,l),await n(a,o.frequency,h.frequency,l),await n(a,o.gain,h.gain,l)),await s(o,a,h,l),h})(o,a,l)}}})(Ds,En,Ni,Os,as),Bs=(e=>(t,i)=>e.set(t,i))(Jn),Ws=((e,t,i,n,s,r,o,a)=>class extends e{constructor(e,n){const l=r(e),h={...tn,...n},u=s(l,h),c=o(l);super(e,!1,u,c?i():null),this._Q=t(this,c,u.Q,wi,_i),this._detune=t(this,c,u.detune,1200*Math.log2(wi),-1200*Math.log2(wi)),this._frequency=t(this,c,u.frequency,e.sampleRate/2,0),this._gain=t(this,c,u.gain,40*Math.log10(wi),_i),this._nativeBiquadFilterNode=u,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(e){this._nativeBiquadFilterNode.type=e}getFrequencyResponse(e,t,i){try{this._nativeBiquadFilterNode.getFrequencyResponse(e,t,i)}catch(e){if(11===e.code)throw n();throw e}if(e.length!==t.length||t.length!==i.length)throw n()}})(_s,Fs,Ls,pn,En,hs,ds,Bs),qs=((e,t)=>(i,n,s)=>{const r=new Set;return i.connect=(s=>(o,a=0,l=0)=>{const h=0===r.size;if(t(o))return s.call(i,o,a,l),e(r,[o,a,l],(e=>e[0]===o&&e[1]===a&&e[2]===l),!0),h&&n(),o;s.call(i,o,a),e(r,[o,a],(e=>e[0]===o&&e[1]===a),!0),h&&n()})(i.connect),i.disconnect=(e=>(n,o,a)=>{const l=r.size>0;if(void 0===n)e.apply(i),r.clear();else if("number"==typeof n){e.call(i,n);for(const e of r)e[1]===n&&r.delete(e)}else{t(n)?e.call(i,n,o,a):e.call(i,n,o);for(const e of r)e[0]!==n||void 0!==o&&e[1]!==o||void 0!==a&&e[2]!==a||r.delete(e)}const h=0===r.size;l&&h&&s()})(i.disconnect),i})(Mi,vs),$s=((e,t)=>(i,n)=>{const s=i.createChannelMerger(n.numberOfInputs);return null!==e&&"webkitAudioContext"===e.name&&t(i,s),_n(s,n),s})(gs,((e,t)=>(i,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw e()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw e()}});const s=i.createBufferSource();t(n,(()=>{const e=n.numberOfInputs;for(let t=0;t<e;t+=1)s.connect(n,0,t)}),(()=>s.disconnect(n)))})(dn,qs)),Vs=((e,t,i,n,s)=>class extends e{constructor(e,r){const o=n(e),a={...nn,...r};super(e,!1,i(o,a),s(o)?t():null)}})(_s,((e,t,i)=>()=>{const n=new WeakMap;return{render(s,r,o){const a=n.get(r);return void 0!==a?Promise.resolve(a):(async(s,r,o)=>{let a=t(s);if(!mi(a,r)){const t={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=e(r,t)}return n.set(r,a),await i(s,r,a,o),a})(s,r,o)}}})($s,Ni,as),$s,hs,ds),Hs=((e,t,i,n,s,r)=>class extends e{constructor(e,o){const a=n(e),l=r({...sn,...o});super(e,!1,i(a,l),s(a)?t():null)}})(_s,((e,t,i)=>()=>{const n=new WeakMap;return{render(s,r,o){const a=n.get(r);return void 0!==a?Promise.resolve(a):(async(s,r,o)=>{let a=t(s);if(!mi(a,r)){const t={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=e(r,t)}return n.set(r,a),await i(s,r,a,o),a})(s,r,o)}}})(Cn,Ni,as),Cn,hs,ds,(e=>({...e,channelCount:e.numberOfOutputs}))),Us=((e,t,i,n)=>(s,{offset:r,...o})=>{const a=s.createBuffer(1,2,44100),l=t(s,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),h=i(s,{...o,gain:r}),u=a.getChannelData(0);u[0]=1,u[1]=1,l.buffer=a,l.loop=!0;const c={get bufferSize(){},get channelCount(){return h.channelCount},set channelCount(e){h.channelCount=e},get channelCountMode(){return h.channelCountMode},set channelCountMode(e){h.channelCountMode=e},get channelInterpretation(){return h.channelInterpretation},set channelInterpretation(e){h.channelInterpretation=e},get context(){return h.context},get inputs(){return[]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return h.numberOfOutputs},get offset(){return h.gain},get onended(){return l.onended},set onended(e){l.onended=e},addEventListener:(...e)=>l.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>l.dispatchEvent(e[0]),removeEventListener:(...e)=>l.removeEventListener(e[0],e[1],e[2]),start(e=0){l.start.call(l,e)},stop(e=0){l.stop.call(l,e)}};return e(s,l),n(Pn(c,h),(()=>l.connect(h)),(()=>l.disconnect(h)))})(Ms,As,Rn,qs),Gs=((e,t,i,n,s)=>(r,o)=>{if(void 0===r.createConstantSource)return i(r,o);const a=r.createConstantSource();return _n(a,o),bn(a,o,"offset"),t(n,(()=>n(r)))||xn(a),t(s,(()=>s(r)))||kn(a),e(r,a),a})(Ms,ts,Us,Hn,Gn),Zs=((e,t,i,n,s,r,o)=>class extends e{constructor(e,o){const a=s(e),l={...rn,...o},h=n(a,l),u=r(a),c=u?i():null;super(e,!1,h,c),this._constantSourceNodeRenderer=c,this._nativeConstantSourceNode=h,this._offset=t(this,u,h.offset,wi,_i),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(e){const t="function"==typeof e?o(this,e):null;this._nativeConstantSourceNode.onended=t;const i=this._nativeConstantSourceNode.onended;this._onended=null!==i&&i===t?e:i}start(e=0){if(this._nativeConstantSourceNode.start(e),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=e),"closed"!==this.context.state){hi(this);const e=()=>{this._nativeConstantSourceNode.removeEventListener("ended",e),bi(this)&&ci(this)};this._nativeConstantSourceNode.addEventListener("ended",e)}}stop(e=0){this._nativeConstantSourceNode.stop(e),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=e)}})(_s,Fs,((e,t,i,n,s)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(e){o=e},set stop(e){a=e},render(l,h,u){const c=r.get(h);return void 0!==c?Promise.resolve(c):(async(l,h,u)=>{let c=i(l);const d=mi(c,h);if(!d){const e={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,offset:c.offset.value};c=t(h,e),null!==o&&c.start(o),null!==a&&c.stop(a)}return r.set(h,c),d?await e(h,l.offset,c.offset,u):await n(h,l.offset,c.offset,u),await s(l,h,c,u),c})(l,h,u)}}})(Ds,Gs,Ni,Os,as),Gs,hs,ds,Xn),Xs=((e,t)=>(i,n)=>{const s=i.createConvolver();if(_n(s,n),n.disableNormalization===s.normalize&&(s.normalize=!n.disableNormalization),yn(s,n,"buffer"),n.channelCount>2)throw e();if(t(s,"channelCount",(e=>()=>e.call(s)),(t=>i=>{if(i>2)throw e();return t.call(s,i)})),"max"===n.channelCountMode)throw e();return t(s,"channelCountMode",(e=>()=>e.call(s)),(t=>i=>{if("max"===i)throw e();return t.call(s,i)})),s})(In,$n),Ys=((e,t,i,n,s,r)=>class extends e{constructor(e,o){const a=n(e),l={...on,...o},h=i(a,l);super(e,!1,h,s(a)?t():null),this._isBufferNullified=!1,this._nativeConvolverNode=h,null!==l.buffer&&r(this,l.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(e){if(this._nativeConvolverNode.buffer=e,null===e&&null!==this._nativeConvolverNode.buffer){const e=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=e.createBuffer(1,1,44100),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(e){this._nativeConvolverNode.normalize=e}})(_s,((e,t,i)=>()=>{const n=new WeakMap;return{render(s,r,o){const a=n.get(r);return void 0!==a?Promise.resolve(a):(async(s,r,o)=>{let a=t(s);if(!mi(a,r)){const t={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=e(r,t)}return n.set(r,a),Ai(a)?await i(s,r,a.inputs[0],o):await i(s,r,a,o),a})(s,r,o)}}})(Xs,Ni,as),Xs,hs,ds,Bs),Ks=((e,t,i,n,s,r,o)=>class extends e{constructor(e,a){const l=s(e),h={...ln,...a},u=n(l,h),c=r(l);super(e,!1,u,c?i(h.maxDelayTime):null),this._delayTime=t(this,c,u.delayTime),o(this,h.maxDelayTime)}get delayTime(){return this._delayTime}})(_s,Fs,((e,t,i,n,s)=>r=>{const o=new WeakMap;return{render(a,l,h){const u=o.get(l);return void 0!==u?Promise.resolve(u):(async(a,l,h)=>{let u=i(a);const c=mi(u,l);if(!c){const e={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,delayTime:u.delayTime.value,maxDelayTime:r};u=t(l,e)}return o.set(l,u),c?await e(l,a.delayTime,u.delayTime,h):await n(l,a.delayTime,u.delayTime,h),await s(a,l,u,h),u})(a,l,h)}}})(Ds,Mn,Ni,Os,as),Mn,hs,ds,Bs),Qs=(e=>(t,i)=>{const n=t.createDynamicsCompressor();if(_n(n,i),i.channelCount>2)throw e();if("max"===i.channelCountMode)throw e();return bn(n,i,"attack"),bn(n,i,"knee"),bn(n,i,"ratio"),bn(n,i,"release"),bn(n,i,"threshold"),n})(In),Js=((e,t,i,n,s,r,o,a)=>class extends e{constructor(e,s){const l=r(e),h={...un,...s},u=n(l,h),c=o(l);super(e,!1,u,c?i():null),this._attack=t(this,c,u.attack),this._knee=t(this,c,u.knee),this._nativeDynamicsCompressorNode=u,this._ratio=t(this,c,u.ratio),this._release=t(this,c,u.release),this._threshold=t(this,c,u.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(e){const t=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=e,e>2)throw this._nativeDynamicsCompressorNode.channelCount=t,s()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(e){const t=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=e,"max"===e)throw this._nativeDynamicsCompressorNode.channelCountMode=t,s()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(_s,Fs,((e,t,i,n,s)=>()=>{const r=new WeakMap;return{render(o,a,l){const h=r.get(a);return void 0!==h?Promise.resolve(h):(async(o,a,l)=>{let h=i(o);const u=mi(h,a);if(!u){const e={attack:h.attack.value,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,knee:h.knee.value,ratio:h.ratio.value,release:h.release.value,threshold:h.threshold.value};h=t(a,e)}return r.set(a,h),u?(await e(a,o.attack,h.attack,l),await e(a,o.knee,h.knee,l),await e(a,o.ratio,h.ratio,l),await e(a,o.release,h.release,l),await e(a,o.threshold,h.threshold,l)):(await n(a,o.attack,h.attack,l),await n(a,o.knee,h.knee,l),await n(a,o.ratio,h.ratio,l),await n(a,o.release,h.release,l),await n(a,o.threshold,h.threshold,l)),await s(o,a,h,l),h})(o,a,l)}}})(Ds,Qs,Ni,Os,as),Qs,In,hs,ds,Bs),er=((e,t,i,n,s,r)=>class extends e{constructor(e,o){const a=s(e),l={...cn,...o},h=n(a,l),u=r(a);super(e,!1,h,u?i():null),this._gain=t(this,u,h.gain,wi,_i)}get gain(){return this._gain}})(_s,Fs,((e,t,i,n,s)=>()=>{const r=new WeakMap;return{render(o,a,l){const h=r.get(a);return void 0!==h?Promise.resolve(h):(async(o,a,l)=>{let h=i(o);const u=mi(h,a);if(!u){const e={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,gain:h.gain.value};h=t(a,e)}return r.set(a,h),u?await e(a,o.gain,h.gain,l):await n(a,o.gain,h.gain,l),await s(o,a,h,l),h})(o,a,l)}}})(Ds,Rn,Ni,Os,as),Rn,hs,ds),tr=((e,t,i,n)=>(s,r,{channelCount:o,channelCountMode:a,channelInterpretation:l,feedback:h,feedforward:u})=>{const c=Tn(r,s.sampleRate),d=h instanceof Float64Array?h:new Float64Array(h),p=u instanceof Float64Array?u:new Float64Array(u),m=d.length,g=p.length,f=Math.min(m,g);if(0===m||m>20)throw n();if(0===d[0])throw t();if(0===g||g>20)throw n();if(0===p[0])throw t();if(1!==d[0]){for(let e=0;e<g;e+=1)p[e]/=d[0];for(let e=1;e<m;e+=1)d[e]/=d[0]}const v=i(s,c,o,o);v.channelCount=o,v.channelCountMode=a,v.channelInterpretation=l;const y=[],_=[],w=[];for(let e=0;e<o;e+=1){y.push(0);const e=new Float32Array(32),t=new Float32Array(32);e.fill(0),t.fill(0),_.push(e),w.push(t)}v.onaudioprocess=e=>{const t=e.inputBuffer,i=e.outputBuffer,n=t.numberOfChannels;for(let e=0;e<n;e+=1){const n=t.getChannelData(e),s=i.getChannelData(e);y[e]=gn(d,m,p,g,f,_[e],w[e],y[e],32,n,s)}};const b=s.sampleRate/2;return Pn({get bufferSize(){return c},get channelCount(){return v.channelCount},set channelCount(e){v.channelCount=e},get channelCountMode(){return v.channelCountMode},set channelCountMode(e){v.channelCountMode=e},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(e){v.channelInterpretation=e},get context(){return v.context},get inputs(){return[v]},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},addEventListener:(...e)=>v.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>v.dispatchEvent(e[0]),getFrequencyResponse(t,i,n){if(t.length!==i.length||i.length!==n.length)throw e();const s=t.length;for(let e=0;e<s;e+=1){const s=-Math.PI*(t[e]/b),r=[Math.cos(s),Math.sin(s)],o=Dn(An(p,r),An(d,r));i[e]=Math.sqrt(o[0]*o[0]+o[1]*o[1]),n[e]=Math.atan2(o[1],o[0])}},removeEventListener:(...e)=>v.removeEventListener(e[0],e[1],e[2])},v)})(pn,dn,On,In),ir=((e,t,i,n)=>s=>e(vn,(()=>vn(s)))?Promise.resolve(e(n,n)).then((e=>{if(!e){const e=i(s,512,0,1);s.oncomplete=()=>{e.onaudioprocess=null,e.disconnect()},e.onaudioprocess=()=>s.currentTime,e.connect(s.destination)}return s.startRendering()})):new Promise((e=>{const i=t(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});s.oncomplete=t=>{i.disconnect(),e(t.renderedBuffer)},i.connect(s.destination),s.startRendering()})))(ts,Rn,On,((e,t)=>()=>{if(null===t)return Promise.resolve(!1);const i=new t(1,1,44100),n=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((e=>{i.oncomplete=()=>{n.disconnect(),e(0!==i.currentTime)},i.startRendering()}))})(Rn,cs)),nr=((e,t,i,n,s)=>(r,o)=>{const a=new WeakMap;let l=null;const h=async(h,u,c)=>{let d=null,p=t(h);const m=mi(p,u);if(void 0===u.createIIRFilter?d=e(u,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):m||(p=u.createIIRFilter(o,r)),a.set(u,null===d?p:d),null!==d){if(null===l){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const e=new i(h.context.destination.channelCount,h.context.length,u.sampleRate);l=(async()=>{await n(h,e,e.destination,c);return((e,t,i,n)=>{const s=i instanceof Float64Array?i:new Float64Array(i),r=n instanceof Float64Array?n:new Float64Array(n),o=s.length,a=r.length,l=Math.min(o,a);if(1!==s[0]){for(let e=0;e<o;e+=1)r[e]/=s[0];for(let e=1;e<a;e+=1)s[e]/=s[0]}const h=new Float32Array(32),u=new Float32Array(32),c=t.createBuffer(e.numberOfChannels,e.length,e.sampleRate),d=e.numberOfChannels;for(let t=0;t<d;t+=1){const i=e.getChannelData(t),n=c.getChannelData(t);h.fill(0),u.fill(0),gn(s,o,r,a,l,h,u,0,32,i,n)}return c})(await s(e),u,r,o)})()}const e=await l;return d.buffer=e,d.start(0),d}return await n(h,u,p,c),p};return{render(e,t,i){const n=a.get(t);return void 0!==n?Promise.resolve(n):h(e,t,i)}}})(As,Ni,cs,as,ir),sr=((e,t,i,n,s,r)=>class extends e{constructor(e,o){const a=n(e),l=s(a),h={...mn,...o},u=t(a,l?null:e.baseLatency,h);super(e,!1,u,l?i(h.feedback,h.feedforward):null),(e=>{var t;e.getFrequencyResponse=(t=e.getFrequencyResponse,(i,n,s)=>{if(i.length!==n.length||n.length!==s.length)throw pn();return t.call(e,i,n,s)})})(u),this._nativeIIRFilterNode=u,r(this,1)}getFrequencyResponse(e,t,i){return this._nativeIIRFilterNode.getFrequencyResponse(e,t,i)}})(_s,(e=>(t,i,n)=>{if(void 0===t.createIIRFilter)return e(t,i,n);const s=t.createIIRFilter(n.feedforward,n.feedback);return _n(s,n),s})(tr),nr,hs,ds,Bs),rr=((e,t,i,n,s,r,o,a)=>(l,h)=>{const u=h.listener,{forwardX:c,forwardY:d,forwardZ:p,positionX:m,positionY:g,positionZ:f,upX:v,upY:y,upZ:_}=void 0===u.forwardX?(()=>{const c=new Float32Array(1),d=t(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),p=o(h);let m=!1,g=[0,0,-1,0,1,0],f=[0,0,0];const v=()=>{if(m)return;m=!0;const e=n(h,256,9,0);e.onaudioprocess=({inputBuffer:e})=>{const t=[r(e,c,0),r(e,c,1),r(e,c,2),r(e,c,3),r(e,c,4),r(e,c,5)];t.some(((e,t)=>e!==g[t]))&&(u.setOrientation(...t),g=t);const i=[r(e,c,6),r(e,c,7),r(e,c,8)];i.some(((e,t)=>e!==f[t]))&&(u.setPosition(...i),f=i)},d.connect(e)},y=e=>t=>{t!==g[e]&&(g[e]=t,u.setOrientation(...g))},_=e=>t=>{t!==f[e]&&(f[e]=t,u.setPosition(...f))},w=(t,n,r)=>{const o=i(h,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:n});o.connect(d,0,t),o.start(),Object.defineProperty(o.offset,"defaultValue",{get:()=>n});const u=e({context:l},p,o.offset,wi,_i);var c,m,g,f,y,_,w;return a(u,"value",(e=>()=>e.call(u)),(e=>t=>{try{e.call(u,t)}catch(e){if(9!==e.code)throw e}v(),p&&r(t)})),u.cancelAndHoldAtTime=(c=u.cancelAndHoldAtTime,p?()=>{throw s()}:(...e)=>{const t=c.apply(u,e);return v(),t}),u.cancelScheduledValues=(m=u.cancelScheduledValues,p?()=>{throw s()}:(...e)=>{const t=m.apply(u,e);return v(),t}),u.exponentialRampToValueAtTime=(g=u.exponentialRampToValueAtTime,p?()=>{throw s()}:(...e)=>{const t=g.apply(u,e);return v(),t}),u.linearRampToValueAtTime=(f=u.linearRampToValueAtTime,p?()=>{throw s()}:(...e)=>{const t=f.apply(u,e);return v(),t}),u.setTargetAtTime=(y=u.setTargetAtTime,p?()=>{throw s()}:(...e)=>{const t=y.apply(u,e);return v(),t}),u.setValueAtTime=(_=u.setValueAtTime,p?()=>{throw s()}:(...e)=>{const t=_.apply(u,e);return v(),t}),u.setValueCurveAtTime=(w=u.setValueCurveAtTime,p?()=>{throw s()}:(...e)=>{const t=w.apply(u,e);return v(),t}),u};return{forwardX:w(0,0,y(0)),forwardY:w(1,0,y(1)),forwardZ:w(2,-1,y(2)),positionX:w(6,0,_(0)),positionY:w(7,0,_(1)),positionZ:w(8,0,_(2)),upX:w(3,0,y(3)),upY:w(4,1,y(4)),upZ:w(5,0,y(5))}})():u;return{get forwardX(){return c},get forwardY(){return d},get forwardZ(){return p},get positionX(){return m},get positionY(){return g},get positionZ(){return f},get upX(){return v},get upY(){return y},get upZ(){return _}}})(Fs,$s,Gs,On,In,Wn,ds,$n),or=new WeakMap,ar=((e,t,i,n,s,r)=>class extends i{constructor(i,r){super(i),this._nativeContext=i,Xt.set(this,i),n(i)&&s.set(i,new Set),this._destination=new e(this,r),this._listener=t(this,i),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(e){const t="function"==typeof e?r(this,e):null;this._nativeContext.onstatechange=t;const i=this._nativeContext.onstatechange;this._onstatechange=null!==i&&i===t?e:i}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(Ns,rr,ms,ds,or,Xn),lr=((e,t,i,n,s,r)=>(o,a)=>{const l=o.createOscillator();return _n(l,a),bn(l,a,"detune"),bn(l,a,"frequency"),void 0!==a.periodicWave?l.setPeriodicWave(a.periodicWave):yn(l,a,"type"),t(i,(()=>i(o)))||xn(l),t(n,(()=>n(o)))||r(l,o),t(s,(()=>s(o)))||kn(l),e(o,l),l})(Ms,ts,Hn,Un,Gn,Zn),hr=((e,t,i,n,s)=>()=>{const r=new WeakMap;let o=null,a=null,l=null;return{set periodicWave(e){o=e},set start(e){a=e},set stop(e){l=e},render(h,u,c){const d=r.get(u);return void 0!==d?Promise.resolve(d):(async(h,u,c)=>{let d=i(h);const p=mi(d,u);if(!p){const e={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,detune:d.detune.value,frequency:d.frequency.value,periodicWave:null===o?void 0:o,type:d.type};d=t(u,e),null!==a&&d.start(a),null!==l&&d.stop(l)}return r.set(u,d),p?(await e(u,h.detune,d.detune,c),await e(u,h.frequency,d.frequency,c)):(await n(u,h.detune,d.detune,c),await n(u,h.frequency,d.frequency,c)),await s(h,u,d,c),d})(h,u,c)}}})(Ds,lr,Ni,Os,as),ur=((e,t,i,n,s,r,o)=>class extends e{constructor(e,o){const a=s(e),l={...jn,...o},h=i(a,l),u=r(a),c=u?n():null,d=e.sampleRate/2;super(e,!1,h,c),this._detune=t(this,u,h.detune,153600,-153600),this._frequency=t(this,u,h.frequency,d,-d),this._nativeOscillatorNode=h,this._onended=null,this._oscillatorNodeRenderer=c,null!==this._oscillatorNodeRenderer&&void 0!==l.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=l.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(e){const t="function"==typeof e?o(this,e):null;this._nativeOscillatorNode.onended=t;const i=this._nativeOscillatorNode.onended;this._onended=null!==i&&i===t?e:i}get type(){return this._nativeOscillatorNode.type}set type(e){this._nativeOscillatorNode.type=e,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(e){this._nativeOscillatorNode.setPeriodicWave(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=e)}start(e=0){if(this._nativeOscillatorNode.start(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=e),"closed"!==this.context.state){hi(this);const e=()=>{this._nativeOscillatorNode.removeEventListener("ended",e),bi(this)&&ci(this)};this._nativeOscillatorNode.addEventListener("ended",e)}}stop(e=0){this._nativeOscillatorNode.stop(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=e)}})(_s,Fs,lr,hr,hs,ds,Xn),cr=(e=>(t,i)=>{const n=e(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),s=t.createBuffer(1,2,44100);return n.buffer=s,n.loop=!0,n.connect(i),n.start(),()=>{n.stop(),n.disconnect(i)}})(As),dr=((e,t,i,n,s)=>(r,{curve:o,oversample:a,...l})=>{const h=r.createWaveShaper(),u=r.createWaveShaper();_n(h,l),_n(u,l);const c=i(r,{...l,gain:1}),d=i(r,{...l,gain:-1}),p=i(r,{...l,gain:1}),m=i(r,{...l,gain:-1});let g=null,f=!1,v=null;const y={get bufferSize(){},get channelCount(){return h.channelCount},set channelCount(e){c.channelCount=e,d.channelCount=e,h.channelCount=e,p.channelCount=e,u.channelCount=e,m.channelCount=e},get channelCountMode(){return h.channelCountMode},set channelCountMode(e){c.channelCountMode=e,d.channelCountMode=e,h.channelCountMode=e,p.channelCountMode=e,u.channelCountMode=e,m.channelCountMode=e},get channelInterpretation(){return h.channelInterpretation},set channelInterpretation(e){c.channelInterpretation=e,d.channelInterpretation=e,h.channelInterpretation=e,p.channelInterpretation=e,u.channelInterpretation=e,m.channelInterpretation=e},get context(){return h.context},get curve(){return v},set curve(i){if(null!==i&&i.length<2)throw t();if(null===i)h.curve=i,u.curve=i;else{const e=i.length,t=new Float32Array(e+2-e%2),n=new Float32Array(e+2-e%2);t[0]=i[0],n[0]=-i[e-1];const s=Math.ceil((e+1)/2),r=(e+1)/2-1;for(let o=1;o<s;o+=1){const a=o/s*r,l=Math.floor(a),h=Math.ceil(a);t[o]=l===h?i[l]:(1-(a-l))*i[l]+(1-(h-a))*i[h],n[o]=l===h?-i[e-1-l]:-(1-(a-l))*i[e-1-l]-(1-(h-a))*i[e-1-h]}t[s]=e%2==1?i[s-1]:(i[s-2]+i[s-1])/2,h.curve=t,u.curve=n}v=i,f&&(n(v)&&null===g?g=e(r,c):null!==g&&(g(),g=null))},get inputs(){return[c]},get numberOfInputs(){return h.numberOfInputs},get numberOfOutputs(){return h.numberOfOutputs},get oversample(){return h.oversample},set oversample(e){h.oversample=e,u.oversample=e},addEventListener:(...e)=>c.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>c.dispatchEvent(e[0]),removeEventListener:(...e)=>c.removeEventListener(e[0],e[1],e[2])};null!==o&&(y.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==y.oversample&&(y.oversample=a);return s(Pn(y,p),(()=>{c.connect(h).connect(p),c.connect(d).connect(u).connect(m).connect(p),f=!0,n(v)&&(g=e(r,c))}),(()=>{c.disconnect(h),h.disconnect(p),c.disconnect(d),d.disconnect(u),u.disconnect(m),m.disconnect(p),f=!1,null!==g&&(g(),g=null)}))})(cr,dn,Rn,qn,qs),pr=((e,t,i,n,s,r,o)=>(a,l)=>{const h=a.createWaveShaper();if(null!==r&&"webkitAudioContext"===r.name&&void 0===a.createGain().gain.automationRate)return i(a,l);_n(h,l);const u=null===l.curve||l.curve instanceof Float32Array?l.curve:new Float32Array(l.curve);if(null!==u&&u.length<2)throw t();yn(h,{curve:u},"curve"),yn(h,l,"oversample");let c=null,d=!1;o(h,"curve",(e=>()=>e.call(h)),(t=>i=>(t.call(h,i),d&&(n(i)&&null===c?c=e(a,h):n(i)||null===c||(c(),c=null)),i)));return s(h,(()=>{d=!0,n(h.curve)&&(c=e(a,h))}),(()=>{d=!1,null!==c&&(c(),c=null)}))})(cr,dn,dr,qn,qs,gs,$n),mr=(e=>(t,i)=>{const n=t.createPanner();return void 0===n.orientationX?e(t,i):(_n(n,i),bn(n,i,"orientationX"),bn(n,i,"orientationY"),bn(n,i,"orientationZ"),bn(n,i,"positionX"),bn(n,i,"positionY"),bn(n,i,"positionZ"),yn(n,i,"coneInnerAngle"),yn(n,i,"coneOuterAngle"),yn(n,i,"coneOuterGain"),yn(n,i,"distanceModel"),yn(n,i,"maxDistance"),yn(n,i,"panningModel"),yn(n,i,"refDistance"),yn(n,i,"rolloffFactor"),n)})(((e,t,i,n,s,r,o,a,l,h)=>(u,{coneInnerAngle:c,coneOuterAngle:d,coneOuterGain:p,distanceModel:m,maxDistance:g,orientationX:f,orientationY:v,orientationZ:y,panningModel:_,positionX:w,positionY:b,positionZ:x,refDistance:k,rolloffFactor:T,...S})=>{const E=u.createPanner();if(S.channelCount>2)throw o();if("max"===S.channelCountMode)throw o();_n(E,S);const C={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},P=i(u,{...C,channelInterpretation:"speakers",numberOfInputs:6}),M=n(u,{...S,gain:1}),R=n(u,{...C,gain:1}),D=n(u,{...C,gain:0}),A=n(u,{...C,gain:0}),O=n(u,{...C,gain:0}),I=n(u,{...C,gain:0}),F=n(u,{...C,gain:0}),j=s(u,256,6,1),z=r(u,{...C,curve:new Float32Array([1,1]),oversample:"none"});let N=[f,v,y],L=[w,b,x];const B=new Float32Array(1);j.onaudioprocess=({inputBuffer:e})=>{const t=[l(e,B,0),l(e,B,1),l(e,B,2)];t.some(((e,t)=>e!==N[t]))&&(E.setOrientation(...t),N=t);const i=[l(e,B,3),l(e,B,4),l(e,B,5)];i.some(((e,t)=>e!==L[t]))&&(E.setPosition(...i),L=i)},Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(A.gain,"defaultValue",{get:()=>0}),Object.defineProperty(O.gain,"defaultValue",{get:()=>0}),Object.defineProperty(I.gain,"defaultValue",{get:()=>0}),Object.defineProperty(F.gain,"defaultValue",{get:()=>0});const W={get bufferSize(){},get channelCount(){return E.channelCount},set channelCount(e){if(e>2)throw o();M.channelCount=e,E.channelCount=e},get channelCountMode(){return E.channelCountMode},set channelCountMode(e){if("max"===e)throw o();M.channelCountMode=e,E.channelCountMode=e},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(e){M.channelInterpretation=e,E.channelInterpretation=e},get coneInnerAngle(){return E.coneInnerAngle},set coneInnerAngle(e){E.coneInnerAngle=e},get coneOuterAngle(){return E.coneOuterAngle},set coneOuterAngle(e){E.coneOuterAngle=e},get coneOuterGain(){return E.coneOuterGain},set coneOuterGain(e){if(e<0||e>1)throw t();E.coneOuterGain=e},get context(){return E.context},get distanceModel(){return E.distanceModel},set distanceModel(e){E.distanceModel=e},get inputs(){return[M]},get maxDistance(){return E.maxDistance},set maxDistance(e){if(e<0)throw new RangeError;E.maxDistance=e},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},get orientationX(){return R.gain},get orientationY(){return D.gain},get orientationZ(){return A.gain},get panningModel(){return E.panningModel},set panningModel(e){E.panningModel=e},get positionX(){return O.gain},get positionY(){return I.gain},get positionZ(){return F.gain},get refDistance(){return E.refDistance},set refDistance(e){if(e<0)throw new RangeError;E.refDistance=e},get rolloffFactor(){return E.rolloffFactor},set rolloffFactor(e){if(e<0)throw new RangeError;E.rolloffFactor=e},addEventListener:(...e)=>M.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>M.dispatchEvent(e[0]),removeEventListener:(...e)=>M.removeEventListener(e[0],e[1],e[2])};c!==W.coneInnerAngle&&(W.coneInnerAngle=c),d!==W.coneOuterAngle&&(W.coneOuterAngle=d),p!==W.coneOuterGain&&(W.coneOuterGain=p),m!==W.distanceModel&&(W.distanceModel=m),g!==W.maxDistance&&(W.maxDistance=g),f!==W.orientationX.value&&(W.orientationX.value=f),v!==W.orientationY.value&&(W.orientationY.value=v),y!==W.orientationZ.value&&(W.orientationZ.value=y),_!==W.panningModel&&(W.panningModel=_),w!==W.positionX.value&&(W.positionX.value=w),b!==W.positionY.value&&(W.positionY.value=b),x!==W.positionZ.value&&(W.positionZ.value=x),k!==W.refDistance&&(W.refDistance=k),T!==W.rolloffFactor&&(W.rolloffFactor=T),1===N[0]&&0===N[1]&&0===N[2]||E.setOrientation(...N),0===L[0]&&0===L[1]&&0===L[2]||E.setPosition(...L);return h(Pn(W,E),(()=>{M.connect(E),e(M,z,0,0),z.connect(R).connect(P,0,0),z.connect(D).connect(P,0,1),z.connect(A).connect(P,0,2),z.connect(O).connect(P,0,3),z.connect(I).connect(P,0,4),z.connect(F).connect(P,0,5),P.connect(j).connect(u.destination)}),(()=>{M.disconnect(E),a(M,z,0,0),z.disconnect(R),R.disconnect(P),z.disconnect(D),D.disconnect(P),z.disconnect(A),A.disconnect(P),z.disconnect(O),O.disconnect(P),z.disconnect(I),I.disconnect(P),z.disconnect(F),F.disconnect(P),P.disconnect(j),j.disconnect(u.destination)}))})(Oi,dn,$s,Rn,On,pr,In,zi,Wn,qs)),gr=((e,t,i,n,s,r,o,a,l,h)=>()=>{const u=new WeakMap;let c=null;return{render(d,p,m){const g=u.get(p);return void 0!==g?Promise.resolve(g):(async(d,p,m)=>{let g=null,f=r(d);const v={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation},y={...v,coneInnerAngle:f.coneInnerAngle,coneOuterAngle:f.coneOuterAngle,coneOuterGain:f.coneOuterGain,distanceModel:f.distanceModel,maxDistance:f.maxDistance,panningModel:f.panningModel,refDistance:f.refDistance,rolloffFactor:f.rolloffFactor},_=mi(f,p);if("bufferSize"in f)g=n(p,{...v,gain:1});else if(!_){const e={...y,orientationX:f.orientationX.value,orientationY:f.orientationY.value,orientationZ:f.orientationZ.value,positionX:f.positionX.value,positionY:f.positionY.value,positionZ:f.positionZ.value};f=s(p,e)}if(u.set(p,null===g?f:g),null!==g){if(null===c){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const e=new o(6,d.context.length,p.sampleRate),n=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});n.connect(e.destination),c=(async()=>{const t=await Promise.all([d.orientationX,d.orientationY,d.orientationZ,d.positionX,d.positionY,d.positionZ].map((async(t,n)=>{const s=i(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===n?1:0});return await a(e,t,s.offset,m),s})));for(let e=0;e<6;e+=1)t[e].connect(n,0,e),t[e].start(0);return h(e)})()}const e=await c,r=n(p,{...v,gain:1});await l(d,p,r,m);const u=[];for(let t=0;t<e.numberOfChannels;t+=1)u.push(e.getChannelData(t));let f=[u[0][0],u[1][0],u[2][0]],_=[u[3][0],u[4][0],u[5][0]],w=n(p,{...v,gain:1}),b=s(p,{...y,orientationX:f[0],orientationY:f[1],orientationZ:f[2],positionX:_[0],positionY:_[1],positionZ:_[2]});r.connect(w).connect(b.inputs[0]),b.connect(g);for(let t=128;t<e.length;t+=128){const e=[u[0][t],u[1][t],u[2][t]],i=[u[3][t],u[4][t],u[5][t]];if(e.some(((e,t)=>e!==f[t]))||i.some(((e,t)=>e!==_[t]))){f=e,_=i;const o=t/p.sampleRate;w.gain.setValueAtTime(0,o),w=n(p,{...v,gain:0}),b=s(p,{...y,orientationX:f[0],orientationY:f[1],orientationZ:f[2],positionX:_[0],positionY:_[1],positionZ:_[2]}),w.gain.setValueAtTime(1,o),r.connect(w).connect(b.inputs[0]),b.connect(g)}}return g}return _?(await e(p,d.orientationX,f.orientationX,m),await e(p,d.orientationY,f.orientationY,m),await e(p,d.orientationZ,f.orientationZ,m),await e(p,d.positionX,f.positionX,m),await e(p,d.positionY,f.positionY,m),await e(p,d.positionZ,f.positionZ,m)):(await a(p,d.orientationX,f.orientationX,m),await a(p,d.orientationY,f.orientationY,m),await a(p,d.orientationZ,f.orientationZ,m),await a(p,d.positionX,f.positionX,m),await a(p,d.positionY,f.positionY,m),await a(p,d.positionZ,f.positionZ,m)),Ai(f)?await l(d,p,f.inputs[0],m):await l(d,p,f,m),f})(d,p,m)}}})(Ds,$s,Gs,Rn,mr,Ni,cs,Os,as,ir),fr=((e,t,i,n,s,r,o)=>class extends e{constructor(e,a){const l=s(e),h={...zn,...a},u=i(l,h),c=r(l);super(e,!1,u,c?n():null),this._nativePannerNode=u,this._orientationX=t(this,c,u.orientationX,wi,_i),this._orientationY=t(this,c,u.orientationY,wi,_i),this._orientationZ=t(this,c,u.orientationZ,wi,_i),this._positionX=t(this,c,u.positionX,wi,_i),this._positionY=t(this,c,u.positionY,wi,_i),this._positionZ=t(this,c,u.positionZ,wi,_i),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(e){this._nativePannerNode.coneInnerAngle=e}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(e){this._nativePannerNode.coneOuterAngle=e}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(e){this._nativePannerNode.coneOuterGain=e}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(e){this._nativePannerNode.distanceModel=e}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(e){this._nativePannerNode.maxDistance=e}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(e){this._nativePannerNode.panningModel=e}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(e){this._nativePannerNode.refDistance=e}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(e){this._nativePannerNode.rolloffFactor=e}})(_s,Fs,mr,gr,hs,ds,Bs),vr=((e,t,i,n)=>class s{constructor(s,r){const o=t(s),a=n({...Nn,...r}),l=e(o,a);return i.add(l),l}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===s.prototype||i.has(e)}})((e=>(t,{disableNormalization:i,imag:n,real:s})=>{const r=n instanceof Float32Array?n:new Float32Array(n),o=s instanceof Float32Array?s:new Float32Array(s),a=t.createPeriodicWave(o,r,{disableNormalization:i});if(Array.from(n).length<2)throw e();return a})(fi),hs,new WeakSet,(e=>{const{imag:t,real:i}=e;return void 0===t?void 0===i?{...e,imag:[0,0],real:[0,0]}:{...e,imag:Array.from(i,(()=>0)),real:i}:void 0===i?{...e,imag:t,real:Array.from(t,(()=>0))}:{...e,imag:t,real:i}})),yr=((e,t)=>(i,n)=>{const s=n.channelCountMode;if("clamped-max"===s)throw t();if(void 0===i.createStereoPanner)return e(i,n);const r=i.createStereoPanner();return _n(r,n),bn(r,n,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>s,set:e=>{if(e!==s)throw t()}}),r})(((e,t,i,n,s,r)=>{const o=16385,a=new Float32Array([1,1]),l=Math.PI/2,h={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...h,oversample:"none"},c=(e,r,c,d,p)=>{if(1===r)return((e,t,s,r)=>{const c=new Float32Array(o),d=new Float32Array(o);for(let e=0;e<o;e+=1){const t=e/16384*l;c[e]=Math.cos(t),d[e]=Math.sin(t)}const p=i(e,{...h,gain:0}),m=n(e,{...u,curve:c}),g=n(e,{...u,curve:a}),f=i(e,{...h,gain:0}),v=n(e,{...u,curve:d});return{connectGraph(){t.connect(p),t.connect(void 0===g.inputs?g:g.inputs[0]),t.connect(f),g.connect(s),s.connect(void 0===m.inputs?m:m.inputs[0]),s.connect(void 0===v.inputs?v:v.inputs[0]),m.connect(p.gain),v.connect(f.gain),p.connect(r,0,0),f.connect(r,0,1)},disconnectGraph(){t.disconnect(p),t.disconnect(void 0===g.inputs?g:g.inputs[0]),t.disconnect(f),g.disconnect(s),s.disconnect(void 0===m.inputs?m:m.inputs[0]),s.disconnect(void 0===v.inputs?v:v.inputs[0]),m.disconnect(p.gain),v.disconnect(f.gain),p.disconnect(r,0,0),f.disconnect(r,0,1)}}})(e,c,d,p);if(2===r)return((e,s,r,c)=>{const d=new Float32Array(o),p=new Float32Array(o),m=new Float32Array(o),g=new Float32Array(o),f=Math.floor(8192.5);for(let e=0;e<o;e+=1)if(e>f){const t=(e-f)/(16384-f)*l;d[e]=Math.cos(t),p[e]=Math.sin(t),m[e]=0,g[e]=1}else{const t=e/(16384-f)*l;d[e]=1,p[e]=0,m[e]=Math.cos(t),g[e]=Math.sin(t)}const v=t(e,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),y=i(e,{...h,gain:0}),_=n(e,{...u,curve:d}),w=i(e,{...h,gain:0}),b=n(e,{...u,curve:p}),x=n(e,{...u,curve:a}),k=i(e,{...h,gain:0}),T=n(e,{...u,curve:m}),S=i(e,{...h,gain:0}),E=n(e,{...u,curve:g});return{connectGraph(){s.connect(v),s.connect(void 0===x.inputs?x:x.inputs[0]),v.connect(y,0),v.connect(w,0),v.connect(k,1),v.connect(S,1),x.connect(r),r.connect(void 0===_.inputs?_:_.inputs[0]),r.connect(void 0===b.inputs?b:b.inputs[0]),r.connect(void 0===T.inputs?T:T.inputs[0]),r.connect(void 0===E.inputs?E:E.inputs[0]),_.connect(y.gain),b.connect(w.gain),T.connect(k.gain),E.connect(S.gain),y.connect(c,0,0),k.connect(c,0,0),w.connect(c,0,1),S.connect(c,0,1)},disconnectGraph(){s.disconnect(v),s.disconnect(void 0===x.inputs?x:x.inputs[0]),v.disconnect(y,0),v.disconnect(w,0),v.disconnect(k,1),v.disconnect(S,1),x.disconnect(r),r.disconnect(void 0===_.inputs?_:_.inputs[0]),r.disconnect(void 0===b.inputs?b:b.inputs[0]),r.disconnect(void 0===T.inputs?T:T.inputs[0]),r.disconnect(void 0===E.inputs?E:E.inputs[0]),_.disconnect(y.gain),b.disconnect(w.gain),T.disconnect(k.gain),E.disconnect(S.gain),y.disconnect(c,0,0),k.disconnect(c,0,0),w.disconnect(c,0,1),S.disconnect(c,0,1)}}})(e,c,d,p);throw s()};return(t,{channelCount:n,channelCountMode:o,pan:a,...l})=>{if("max"===o)throw s();const h=e(t,{...l,channelCount:1,channelCountMode:o,numberOfInputs:2}),u=i(t,{...l,channelCount:n,channelCountMode:o,gain:1}),d=i(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:a});let{connectGraph:p,disconnectGraph:m}=c(t,n,u,d,h);Object.defineProperty(d.gain,"defaultValue",{get:()=>0}),Object.defineProperty(d.gain,"maxValue",{get:()=>1}),Object.defineProperty(d.gain,"minValue",{get:()=>-1});const g={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(e){u.channelCount!==e&&(f&&m(),({connectGraph:p,disconnectGraph:m}=c(t,e,u,d,h)),f&&p()),u.channelCount=e},get channelCountMode(){return u.channelCountMode},set channelCountMode(e){if("clamped-max"===e||"max"===e)throw s();u.channelCountMode=e},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(e){u.channelInterpretation=e},get context(){return u.context},get inputs(){return[u]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get pan(){return d.gain},addEventListener:(...e)=>u.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>u.dispatchEvent(e[0]),removeEventListener:(...e)=>u.removeEventListener(e[0],e[1],e[2])};let f=!1;return r(Pn(g,h),(()=>{p(),f=!0}),(()=>{m(),f=!1}))}})($s,Cn,Rn,pr,In,qs),In),_r=((e,t,i,n,s)=>()=>{const r=new WeakMap;return{render(o,a,l){const h=r.get(a);return void 0!==h?Promise.resolve(h):(async(o,a,l)=>{let h=i(o);const u=mi(h,a);if(!u){const e={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,pan:h.pan.value};h=t(a,e)}return r.set(a,h),u?await e(a,o.pan,h.pan,l):await n(a,o.pan,h.pan,l),Ai(h)?await s(o,a,h.inputs[0],l):await s(o,a,h,l),h})(o,a,l)}}})(Ds,yr,Ni,Os,as),wr=((e,t,i,n,s,r)=>class extends e{constructor(e,o){const a=s(e),l={...Ln,...o},h=i(a,l),u=r(a);super(e,!1,h,u?n():null),this._pan=t(this,u,h.pan)}get pan(){return this._pan}})(_s,Fs,yr,_r,hs,ds),br=((e,t,i)=>()=>{const n=new WeakMap;return{render(s,r,o){const a=n.get(r);return void 0!==a?Promise.resolve(a):(async(s,r,o)=>{let a=t(s);if(!mi(a,r)){const t={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=e(r,t)}return n.set(r,a),Ai(a)?await i(s,r,a.inputs[0],o):await i(s,r,a,o),a})(s,r,o)}}})(pr,Ni,as),xr=((e,t,i,n,s,r,o)=>class extends e{constructor(e,t){const a=s(e),l={...Bn,...t},h=i(a,l);super(e,!0,h,r(a)?n():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=h,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(e){if(null===e)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(e.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=e}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(e){this._nativeWaveShaperNode.oversample=e}})(_s,dn,pr,br,hs,ds,Bs),kr=(e=>null!==e&&e.isSecureContext)(ss),Tr=(e=>(t,i,n)=>{Object.defineProperties(e,{currentFrame:{configurable:!0,get:()=>Math.round(t*i)},currentTime:{configurable:!0,get:()=>t}});try{return n()}finally{null!==e&&(delete e.currentFrame,delete e.currentTime)}})(ss),Sr=new WeakMap,Er=((e,t)=>i=>{let n=e.get(i);if(void 0!==n)return n;if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new t(1,1,44100),e.set(i,n),n})(Sr,cs),Cr=(e=>null===e?null:e.hasOwnProperty("AudioWorkletNode")?e.AudioWorkletNode:null)(ss),Pr=kr?((e,t,i,n,s,r,o,a,l,h,u,c,d)=>{let p=0;return(m,g,f={credentials:"omit"})=>{const v=u.get(m);if(void 0!==v&&v.has(g))return Promise.resolve();const y=h.get(m);if(void 0!==y){const e=y.get(g);if(void 0!==e)return e}const _=r(m),w=void 0===_.audioWorklet?s(g).then((([e,t])=>{const[n,s]=ii(e,t);return i(`${n};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${s}\n})})(window,'_AWGS')`)})).then((()=>{const e=d._AWGS.pop();if(void 0===e)throw new SyntaxError;n(_.currentTime,_.sampleRate,(()=>e(class{},void 0,((e,i)=>{if(""===e.trim())throw t();const n=Qt.get(_);if(void 0!==n){if(n.has(e))throw t();si(i),ni(i.parameterDescriptors),n.set(e,i)}else si(i),ni(i.parameterDescriptors),Qt.set(_,new Map([[e,i]]))}),_.sampleRate,void 0,void 0)))})):Promise.all([s(g),Promise.resolve(e(c,c))]).then((([[e,t],i])=>{const n=p+1;p=n;const[s,r]=ii(e,t),h=new Blob([`${s};((AudioWorkletProcessor,registerProcessor)=>{${r}\n})(${i?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${i?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${i?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${n}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),u=URL.createObjectURL(h);return _.audioWorklet.addModule(u,f).then((()=>{if(a(_))return _;const e=o(_);return e.audioWorklet.addModule(u,f).then((()=>e))})).then((e=>{if(null===l)throw new SyntaxError;try{new l(e,`__sac${n}`)}catch{throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(u)))}));return void 0===y?h.set(m,new Map([[g,w]])):y.set(g,w),w.then((()=>{const e=u.get(m);void 0===e?u.set(m,new Set([g])):e.add(g)})).finally((()=>{const e=h.get(m);void 0!==e&&e.delete(g)})),w}})(ts,In,(e=>t=>new Promise(((i,n)=>{if(null===e)return void n(new SyntaxError);const s=e.document.head;if(null===s)n(new SyntaxError);else{const r=e.document.createElement("script"),o=new Blob([t],{type:"application/javascript"}),a=URL.createObjectURL(o),l=e.onerror,h=()=>{e.onerror=l,URL.revokeObjectURL(a)};e.onerror=(t,i,s,r,o)=>i===a||i===e.location.href&&1===s&&1===r?(h(),n(o),!1):null!==l?l(t,i,s,r,o):void 0,r.onerror=()=>{h(),n(new SyntaxError)},r.onload=()=>{h(),i()},r.src=a,r.type="module",s.appendChild(r)}})))(ss),Tr,(e=>async t=>{try{const e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch{}throw e()})((()=>new DOMException("","AbortError"))),hs,Er,ds,Cr,new WeakMap,new WeakMap,((e,t)=>async()=>{if(null===e)return!0;if(null===t)return!1;const i=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new t(1,128,44100),s=URL.createObjectURL(i);let r=!1,o=!1;try{await n.audioWorklet.addModule(s);const t=new e(n,"a",{numberOfOutputs:0}),i=n.createOscillator();t.port.onmessage=()=>r=!0,t.onprocessorerror=()=>o=!0,i.connect(t),i.start(0),await n.startRendering()}catch{}finally{URL.revokeObjectURL(s)}return r&&!o})(Cr,cs),ss):void 0,Mr=((e,t)=>i=>e(i)||t(i))(fs,ds),Rr=((e,t,i,n,s,r,o,a,l,h,u,c,d,p,m,g,f,v,y,_)=>class extends m{constructor(t,i){super(t,i),this._nativeContext=t,this._audioWorklet=void 0===e?void 0:{addModule:(t,i)=>e(this,t,i)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new t(this)}createBiquadFilter(){return new s(this)}createBuffer(e,t,n){return new i({length:t,numberOfChannels:e,sampleRate:n})}createBufferSource(){return new n(this)}createChannelMerger(e=6){return new r(this,{numberOfInputs:e})}createChannelSplitter(e=6){return new o(this,{numberOfOutputs:e})}createConstantSource(){return new a(this)}createConvolver(){return new l(this)}createDelay(e=1){return new u(this,{maxDelayTime:e})}createDynamicsCompressor(){return new c(this)}createGain(){return new d(this)}createIIRFilter(e,t){return new p(this,{feedback:t,feedforward:e})}createOscillator(){return new g(this)}createPanner(){return new f(this)}createPeriodicWave(e,t,i={disableNormalization:!1}){return new v(this,{...i,imag:t,real:e})}createStereoPanner(){return new y(this)}createWaveShaper(){return new _(this)}decodeAudioData(e,t,i){return h(this._nativeContext,e).then((e=>("function"==typeof t&&t(e),e)),(e=>{throw"function"==typeof i&&i(e),e}))}})(Pr,bs,Ps,zs,Ws,Vs,Hs,Zs,Ys,((e,t,i,n,s,r,o,a,l,h,u)=>(c,d)=>{const p=o(c)?c:r(c);if(s.has(d)){const e=i();return Promise.reject(e)}try{s.add(d)}catch{}return t(l,(()=>l(p)))?p.decodeAudioData(d).then((i=>(an(d).catch((()=>{})),t(a,(()=>a(i)))||u(i),e.add(i),i))):new Promise(((t,i)=>{const s=async()=>{try{await an(d)}catch{}},r=e=>{i(e),s()};try{p.decodeAudioData(d,(i=>{"function"!=typeof i.copyFromChannel&&(h(i),vi(i)),e.add(i),s().then((()=>t(i)))}),(e=>{r(null===e?n():e)}))}catch(e){r(e)}}))})(xs,ts,(()=>new DOMException("","DataCloneError")),(()=>new DOMException("","EncodingError")),new WeakSet,hs,Mr,gi,vn,Es,Cs),Ks,Js,er,sr,ar,ur,fr,vr,wr,xr),Dr=((e,t,i,n)=>class extends e{constructor(e,s){const r=i(e),o=t(r,s);if(n(r))throw TypeError();super(e,!0,o,null),this._nativeMediaElementAudioSourceNode=o}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(_s,((e,t)=>e.createMediaElementSource(t.mediaElement)),hs,ds),Ar=((e,t,i,n)=>class extends e{constructor(e,s){const r=i(e);if(n(r))throw new TypeError;const o={...fn,...s},a=t(r,o);super(e,!1,a,null),this._nativeMediaStreamAudioDestinationNode=a}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(_s,((e,t)=>{const i=e.createMediaStreamDestination();return _n(i,t),1===i.numberOfOutputs&&Object.defineProperty(i,"numberOfOutputs",{get:()=>0}),i}),hs,ds),Or=((e,t,i,n)=>class extends e{constructor(e,s){const r=i(e),o=t(r,s);if(n(r))throw new TypeError;super(e,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(_s,((e,{mediaStream:t})=>{const i=t.getAudioTracks();i.sort(((e,t)=>e.id<t.id?-1:e.id>t.id?1:0));const n=i.slice(0,1),s=e.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(s,"mediaStream",{value:t}),s}),hs,ds),Ir=((e,t,i)=>class extends e{constructor(e,n){const s=i(e);super(e,!0,t(s,n),null)}})(_s,((e,t)=>(i,{mediaStreamTrack:n})=>{if("function"==typeof i.createMediaStreamTrackSource)return i.createMediaStreamTrackSource(n);const s=new MediaStream([n]),r=i.createMediaStreamSource(s);if("audio"!==n.kind)throw e();if(t(i))throw new TypeError;return r})(dn,ds),hs),Fr=((e,t,i,n,s,r,o,a,l)=>class extends e{constructor(e={}){if(null===l)throw new Error("Missing the native AudioContext constructor.");let t;try{t=new l(e)}catch(e){if(12===e.code&&"sampleRate is not in range"===e.message)throw i();throw e}if(null===t)throw n();if(!(e=>void 0===e||"number"==typeof e||"string"==typeof e&&("balanced"===e||"interactive"===e||"playback"===e))(e.latencyHint))throw new TypeError(`The provided value '${e.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==e.sampleRate&&t.sampleRate!==e.sampleRate)throw i();super(t,2);const{latencyHint:s}=e,{sampleRate:r}=t;if(this._baseLatency="number"==typeof t.baseLatency?t.baseLatency:"balanced"===s?512/r:"interactive"===s||void 0===s?256/r:"playback"===s?1024/r:128*Math.max(2,Math.min(128,Math.round(s*r/128)))/r,this._nativeAudioContext=t,"webkitAudioContext"===l.name?(this._nativeGainNode=t.createGain(),this._nativeOscillatorNode=t.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(t.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===t.state){this._state="suspended";const e=()=>{"suspended"===this._state&&(this._state=null),t.removeEventListener("statechange",e)};t.addEventListener("statechange",e)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw t()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),Ei(this)})))}createMediaElementSource(e){return new s(this,{mediaElement:e})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(e){return new o(this,{mediaStream:e})}createMediaStreamTrackSource(e){return new a(this,{mediaStreamTrack:e})}resume(){return"suspended"===this._state?new Promise(((e,t)=>{const i=()=>{this._nativeAudioContext.removeEventListener("statechange",i),"running"===this._nativeAudioContext.state?e():this.resume().then(e,t)};this._nativeAudioContext.addEventListener("statechange",i)})):this._nativeAudioContext.resume().catch((e=>{if(void 0===e||15===e.code)throw t();throw e}))}suspend(){return this._nativeAudioContext.suspend().catch((e=>{if(void 0===e)throw t();throw e}))}})(Rr,dn,In,(()=>new DOMException("","UnknownError")),Dr,Ar,Or,Ir,gs),jr=(e=>t=>{const i=e.get(t);if(void 0===i)throw new Error("The context has no set of AudioWorkletNodes.");return i})(or),zr=(e=>(t,i)=>{e(t).add(i)})(jr),Nr=(e=>(t,i,n=0,s=0)=>{const r=t[n];if(void 0===r)throw e();return Vi(i)?r.connect(i,0,s):r.connect(i,0)})(fi),Lr=(e=>(t,i)=>{e(t).delete(i)})(jr),Br=(e=>(t,i,n,s=0)=>void 0===i?t.forEach((e=>e.disconnect())):"number"==typeof i?hn(e,t,i).disconnect():Vi(i)?void 0===n?t.forEach((e=>e.disconnect(i))):void 0===s?hn(e,t,n).disconnect(i,0):hn(e,t,n).disconnect(i,0,s):void 0===n?t.forEach((e=>e.disconnect(i))):hn(e,t,n).disconnect(i,0))(fi),Wr=new WeakMap,qr=((e,t)=>i=>t(e,i))(Wr,ri),$r=((e,t,i,n,s,r,o,a,l,h,u,c,d)=>(p,m,g,f)=>{if(0===f.numberOfInputs&&0===f.numberOfOutputs)throw l();const v=Array.isArray(f.outputChannelCount)?f.outputChannelCount:Array.from(f.outputChannelCount);if(v.some((e=>e<1)))throw l();if(v.length!==f.numberOfOutputs)throw t();if("explicit"!==f.channelCountMode)throw l();const y=f.channelCount*f.numberOfInputs,_=v.reduce(((e,t)=>e+t),0),w=void 0===g.parameterDescriptors?0:g.parameterDescriptors.length;if(y+w>6||_>6)throw l();const b=new MessageChannel,x=[],k=[];for(let e=0;e<f.numberOfInputs;e+=1)x.push(o(p,{channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,gain:1})),k.push(s(p,{channelCount:f.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:f.channelCount}));const T=[];if(void 0!==g.parameterDescriptors)for(const{defaultValue:e,maxValue:t,minValue:i,name:n}of g.parameterDescriptors){const s=r(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==f.parameterData[n]?f.parameterData[n]:void 0===e?0:e});Object.defineProperties(s.offset,{defaultValue:{get:()=>void 0===e?0:e},maxValue:{get:()=>void 0===t?wi:t},minValue:{get:()=>void 0===i?_i:i}}),T.push(s)}const S=n(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,y+w)}),E=Tn(m,p.sampleRate),C=a(p,E,y+w,Math.max(1,_)),P=s(p,{channelCount:Math.max(1,_),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,_)}),M=[];for(let e=0;e<f.numberOfOutputs;e+=1)M.push(n(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[e]}));for(let e=0;e<f.numberOfInputs;e+=1){x[e].connect(k[e]);for(let t=0;t<f.channelCount;t+=1)k[e].connect(S,t,e*f.channelCount+t)}const R=new Xi(void 0===g.parameterDescriptors?[]:g.parameterDescriptors.map((({name:e},t)=>{const i=T[t];return i.connect(S,0,y+t),i.start(0),[e,i.offset]})));S.connect(C);let D=f.channelInterpretation,A=null;const O=0===f.numberOfOutputs?[C]:M,I={get bufferSize(){return E},get channelCount(){return f.channelCount},set channelCount(e){throw i()},get channelCountMode(){return f.channelCountMode},set channelCountMode(e){throw i()},get channelInterpretation(){return D},set channelInterpretation(e){for(const t of x)t.channelInterpretation=e;D=e},get context(){return C.context},get inputs(){return x},get numberOfInputs(){return f.numberOfInputs},get numberOfOutputs(){return f.numberOfOutputs},get onprocessorerror(){return A},set onprocessorerror(e){"function"==typeof A&&I.removeEventListener("processorerror",A),A="function"==typeof e?e:null,"function"==typeof A&&I.addEventListener("processorerror",A)},get parameters(){return R},get port(){return b.port2},addEventListener:(...e)=>C.addEventListener(e[0],e[1],e[2]),connect:e.bind(null,O),disconnect:h.bind(null,O),dispatchEvent:(...e)=>C.dispatchEvent(e[0]),removeEventListener:(...e)=>C.removeEventListener(e[0],e[1],e[2])},F=new Map;var j,z;b.port1.addEventListener=(j=b.port1.addEventListener,(...e)=>{if("message"===e[0]){const t="function"==typeof e[1]?e[1]:"object"==typeof e[1]&&null!==e[1]&&"function"==typeof e[1].handleEvent?e[1].handleEvent:null;if(null!==t){const i=F.get(e[1]);void 0!==i?e[1]=i:(e[1]=e=>{u(p.currentTime,p.sampleRate,(()=>t(e)))},F.set(t,e[1]))}}return j.call(b.port1,e[0],e[1],e[2])}),b.port1.removeEventListener=(z=b.port1.removeEventListener,(...e)=>{if("message"===e[0]){const t=F.get(e[1]);void 0!==t&&(F.delete(e[1]),e[1]=t)}return z.call(b.port1,e[0],e[1],e[2])});let N=null;Object.defineProperty(b.port1,"onmessage",{get:()=>N,set:e=>{"function"==typeof N&&b.port1.removeEventListener("message",N),N="function"==typeof e?e:null,"function"==typeof N&&(b.port1.addEventListener("message",N),b.port1.start())}}),g.prototype.port=b.port1;let L=null;((e,t,i,n)=>{let s=Jt.get(e);void 0===s&&(s=new WeakMap,Jt.set(e,s));const r=Sn(i,n);return s.set(t,r),r})(p,I,g,f).then((e=>L=e));const B=Ji(f.numberOfInputs,f.channelCount),W=Ji(f.numberOfOutputs,v),q=void 0===g.parameterDescriptors?[]:g.parameterDescriptors.reduce(((e,{name:t})=>({...e,[t]:new Float32Array(128)})),{});let $=!0;const V=()=>{f.numberOfOutputs>0&&C.disconnect(P);for(let e=0,t=0;e<f.numberOfOutputs;e+=1){const i=M[e];for(let n=0;n<v[e];n+=1)P.disconnect(i,t+n,n);t+=v[e]}},H=new Map;C.onaudioprocess=({inputBuffer:e,outputBuffer:t})=>{if(null!==L){const i=c(I);for(let n=0;n<E;n+=128){for(let t=0;t<f.numberOfInputs;t+=1)for(let i=0;i<f.channelCount;i+=1)Ki(e,B[t],i,i,n);void 0!==g.parameterDescriptors&&g.parameterDescriptors.forEach((({name:t},i)=>{Ki(e,q,t,y+i,n)}));for(let e=0;e<f.numberOfInputs;e+=1)for(let t=0;t<v[e];t+=1)0===W[e][t].byteLength&&(W[e][t]=new Float32Array(128));try{const e=B.map(((e,t)=>{if(i[t].size>0)return H.set(t,E/128),e;const n=H.get(t);return void 0===n?[]:(e.every((e=>e.every((e=>0===e))))&&(1===n?H.delete(t):H.set(t,n-1)),e)})),s=u(p.currentTime+n/p.sampleRate,p.sampleRate,(()=>L.process(e,W,q)));$=s;for(let e=0,i=0;e<f.numberOfOutputs;e+=1){for(let s=0;s<v[e];s+=1)Qi(t,W[e],s,i+s,n);i+=v[e]}}catch(e){$=!1,I.dispatchEvent(new ErrorEvent("processorerror",{colno:e.colno,filename:e.filename,lineno:e.lineno,message:e.message}))}if(!$){for(let e=0;e<f.numberOfInputs;e+=1){x[e].disconnect(k[e]);for(let t=0;t<f.channelCount;t+=1)k[n].disconnect(S,t,e*f.channelCount+t)}if(void 0!==g.parameterDescriptors){const e=g.parameterDescriptors.length;for(let t=0;t<e;t+=1){const e=T[t];e.disconnect(S,0,y+t),e.stop()}}S.disconnect(C),C.onaudioprocess=null,U?V():X();break}}}};let U=!1;const G=o(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Z=()=>C.connect(G).connect(p.destination),X=()=>{C.disconnect(G),G.disconnect()};return Z(),d(I,(()=>{if($){X(),f.numberOfOutputs>0&&C.connect(P);for(let e=0,t=0;e<f.numberOfOutputs;e+=1){const i=M[e];for(let n=0;n<v[e];n+=1)P.connect(i,t+n,n);t+=v[e]}}U=!0}),(()=>{$&&(Z(),V()),U=!1}))})(Nr,fi,dn,$s,Cn,Gs,Rn,On,In,Br,Tr,qr,qs),Vr=((e,t,i,n,s)=>(r,o,a,l,h,u)=>{if(null!==a)try{const t=new a(r,l,u),n=new Map;let o=null;if(Object.defineProperties(t,{channelCount:{get:()=>u.channelCount,set:()=>{throw e()}},channelCountMode:{get:()=>"explicit",set:()=>{throw e()}},onprocessorerror:{get:()=>o,set:e=>{"function"==typeof o&&t.removeEventListener("processorerror",o),o="function"==typeof e?e:null,"function"==typeof o&&t.addEventListener("processorerror",o)}}}),t.addEventListener=(d=t.addEventListener,(...e)=>{if("processorerror"===e[0]){const t="function"==typeof e[1]?e[1]:"object"==typeof e[1]&&null!==e[1]&&"function"==typeof e[1].handleEvent?e[1].handleEvent:null;if(null!==t){const i=n.get(e[1]);void 0!==i?e[1]=i:(e[1]=i=>{"error"===i.type?(Object.defineProperties(i,{type:{value:"processorerror"}}),t(i)):t(new ErrorEvent(e[0],{...i}))},n.set(t,e[1]))}}return d.call(t,"error",e[1],e[2]),d.call(t,...e)}),t.removeEventListener=(c=t.removeEventListener,(...e)=>{if("processorerror"===e[0]){const t=n.get(e[1]);void 0!==t&&(n.delete(e[1]),e[1]=t)}return c.call(t,"error",e[1],e[2]),c.call(t,e[0],e[1],e[2])}),0!==u.numberOfOutputs){const e=i(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(e).connect(r.destination);return s(t,(()=>e.disconnect()),(()=>e.connect(r.destination)))}return t}catch(e){if(11===e.code)throw n();throw e}var c,d;if(void 0===h)throw n();return(e=>{const{port1:t}=new MessageChannel;try{t.postMessage(e)}finally{t.close()}})(u),t(r,o,h,u)})(dn,$r,Rn,In,qs),Hr=((e,t,i,n,s,r,o,a,l,h,u,c,d,p,m,g)=>(f,v,y)=>{const _=new WeakMap;let w=null;return{render(b,x,k){a(x,b);const T=_.get(x);return void 0!==T?Promise.resolve(T):(async(a,b,x)=>{let k=u(a),T=null;const S=mi(k,b),E=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(null===c){const e=E.reduce(((e,t)=>e+t),0),i=s(b,{channelCount:Math.max(1,e),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,e)}),r=[];for(let e=0;e<a.numberOfOutputs;e+=1)r.push(n(b,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:E[e]}));const h=o(b,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1});h.connect=t.bind(null,r),h.disconnect=l.bind(null,r),T=[i,r,h]}else S||(k=new c(b,f));if(_.set(b,null===T?k:T[2]),null!==T){if(null===w){if(void 0===y)throw new Error("Missing the processor constructor.");if(null===d)throw new Error("Missing the native OfflineAudioContext constructor.");const e=a.channelCount*a.numberOfInputs,t=void 0===y.parameterDescriptors?0:y.parameterDescriptors.length,i=e+t,l=async()=>{const l=new d(i,128*Math.ceil(a.context.length/128),b.sampleRate),h=[],u=[];for(let e=0;e<v.numberOfInputs;e+=1)h.push(o(l,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),u.push(s(l,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const c=await Promise.all(Array.from(a.parameters.values()).map((async e=>{const t=r(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:e.value});return await p(l,e,t.offset,x),t}))),f=n(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,e+t)});for(let e=0;e<v.numberOfInputs;e+=1){h[e].connect(u[e]);for(let t=0;t<v.channelCount;t+=1)u[e].connect(f,t,e*v.channelCount+t)}for(const[t,i]of c.entries())i.connect(f,0,e+t),i.start(0);return f.connect(l.destination),await Promise.all(h.map((e=>m(a,l,e,x)))),g(l)};w=en(a,0===i?null:await l(),b,v,E,y,h)}const e=await w,t=i(b,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[l,u,c]=T;null!==e&&(t.buffer=e,t.start(0)),t.connect(l);for(let e=0,t=0;e<a.numberOfOutputs;e+=1){const i=u[e];for(let n=0;n<E[e];n+=1)l.connect(i,t+n,n);t+=E[e]}return c}if(S)for(const[t,i]of a.parameters.entries())await e(b,i,k.parameters.get(t),x);else for(const[e,t]of a.parameters.entries())await p(b,t,k.parameters.get(e),x);return await m(a,b,k,x),k})(b,x,k)}}})(Ds,Nr,As,$s,Cn,Gs,Rn,Lr,Br,Tr,Ni,Cr,cs,Os,as,ir),Ur=(e=>t=>e.get(t))(Sr),Gr=(e=>(t,i)=>{e.set(t,i)})(Wr),Zr=kr?((e,t,i,n,s,r,o,a,l,h,u,c,d,p)=>class extends t{constructor(t,p,m){var g;const f=a(t),v=l(f),y=u({...Yi,...m});d(y);const _=Qt.get(f),w=null==_?void 0:_.get(p),b=v||"closed"!==f.state?f:null!==(g=o(f))&&void 0!==g?g:f,x=s(b,v?null:t.baseLatency,h,p,w,y);super(t,!0,x,v?n(p,y,w):null);const k=[];x.parameters.forEach(((e,t)=>{const n=i(this,v,e);k.push([t,n])})),this._nativeAudioWorkletNode=x,this._onprocessorerror=null,this._parameters=new Xi(k),v&&e(f,this);const{activeInputs:T}=r(this);c(x,T)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(e){const t="function"==typeof e?p(this,e):null;this._nativeAudioWorkletNode.onprocessorerror=t;const i=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==i&&i===t?e:i}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(zr,_s,Fs,Hr,Vr,ki,Ur,hs,ds,Cr,(e=>({...e,outputChannelCount:void 0!==e.outputChannelCount?e.outputChannelCount:1===e.numberOfInputs&&1===e.numberOfOutputs?[e.channelCount]:Array.from({length:e.numberOfOutputs},(()=>1))})),Gr,(e=>{const{port1:t,port2:i}=new MessageChannel;try{t.postMessage(e)}finally{t.close(),i.close()}}),Xn):void 0,Xr=((e,t)=>(i,n,s)=>{if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(i,n,s)}catch(t){if("SyntaxError"===t.name)throw e();throw t}})(In,cs),Yr=((e,t,i,n,s,r,o,a)=>{const l=[];return(h,u)=>i(h).render(h,u,l).then((()=>Promise.all(Array.from(n(u)).map((e=>i(e).render(e,u,l)))))).then((()=>s(u))).then((i=>("function"!=typeof i.copyFromChannel?(o(i),vi(i)):t(r,(()=>r(i)))||a(i),e.add(i),i)))})(xs,ts,os,jr,ir,gi,Es,Cs),Kr=((e,t,i,n,s)=>class extends e{constructor(e,i,s){let r;if("number"==typeof e&&void 0!==i&&void 0!==s)r={length:i,numberOfChannels:e,sampleRate:s};else{if("object"!=typeof e)throw new Error("The given parameters are not valid.");r=e}const{length:o,numberOfChannels:a,sampleRate:l}={...Fn,...r},h=n(a,o,l);t(vn,(()=>vn(h)))||h.addEventListener("statechange",(()=>{let e=0;const t=i=>{"running"===this._state&&(e>0?(h.removeEventListener("statechange",t),i.stopImmediatePropagation(),this._waitForThePromiseToSettle(i)):e+=1)};return t})()),super(h,a),this._length=o,this._nativeOfflineAudioContext=h,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(i()):(this._state="running",s(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,Ei(this)})))}_waitForThePromiseToSettle(e){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(e):setTimeout((()=>this._waitForThePromiseToSettle(e)))}})(Rr,ts,dn,Xr,Yr),Qr=((e,t)=>i=>{const n=e.get(i);return t(n)||t(i)})(Xt,fs),Jr=((e,t)=>i=>e.has(i)||t(i))(Ut,vs),eo=((e,t)=>i=>e.has(i)||t(i))(Zt,ys),to=((e,t)=>i=>{const n=e.get(i);return t(n)||t(i)})(Xt,ds);function io(e,t){if(!e)throw new Error(t)}function no(e,t,i=1/0){if(!(t<=e&&e<=i))throw new RangeError(`Value must be within [${t}, ${i}], got: ${e}`)}function so(e){e.isOffline||"running"===e.state||oo('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let ro=console;function oo(...e){ro.warn(...e)}function ao(e){return void 0===e}function lo(e){return!ao(e)}function ho(e){return"number"==typeof e}function uo(e){return"[object Object]"===Object.prototype.toString.call(e)&&e.constructor===Object}function co(e){return Array.isArray(e)}function po(e){return"string"==typeof e}function mo(e){return po(e)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(e)}const go="object"==typeof self?self:null,fo=go&&(go.hasOwnProperty("AudioContext")||go.hasOwnProperty("webkitAudioContext"));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function vo(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}function yo(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))}class _o{constructor(e,t,i){this._callback=e,this._type=t,this._updateInterval=i,this._createClock()}_createWorker(){const e=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),t=URL.createObjectURL(e),i=new Worker(t);i.onmessage=this._callback.bind(this),this._worker=i}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(e){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){this._updateInterval=Math.max(e,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*e,1))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function wo(e){return eo(e)}function bo(e){return Jr(e)}function xo(e){return to(e)}function ko(e){return Qr(e)}function To(e){return e instanceof AudioBuffer}function So(e,t){return"value"===e||wo(t)||bo(t)||To(t)}function Eo(e,...t){if(!t.length)return e;const i=t.shift();if(uo(e)&&uo(i))for(const t in i)So(t,i[t])?e[t]=i[t]:uo(i[t])?(e[t]||Object.assign(e,{[t]:{}}),Eo(e[t],i[t])):Object.assign(e,{[t]:i[t]});return Eo(e,...t)}function Co(e,t,i=[],n){const s={},r=Array.from(t);if(uo(r[0])&&n&&!Reflect.has(r[0],n)){Object.keys(r[0]).some((t=>Reflect.has(e,t)))||(Eo(s,{[n]:r[0]}),i.splice(i.indexOf(n),1),r.shift())}if(1===r.length&&uo(r[0]))Eo(s,r[0]);else for(let e=0;e<i.length;e++)lo(r[e])&&(s[i[e]]=r[e]);return Eo(e,s)}function Po(e,t){return ao(e)?t:e}function Mo(e,t){return t.forEach((t=>{Reflect.has(e,t)&&delete e[t]})),e}
/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class Ro{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||go&&this.toString()===go.TONE_DEBUG_CLASS)&&function(...e){ro.log(...e)}(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Ro.version="14.7.77";function Do(e,t){return e>t+1e-6}function Ao(e,t){return Do(e,t)||Io(e,t)}function Oo(e,t){return e+1e-6<t}function Io(e,t){return Math.abs(e-t)<1e-6}class Fo extends Ro{constructor(){super(),this.name="Timeline",this._timeline=[];const e=Co(Fo.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(io(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];io(Ao(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const e=this.length-this.memory;this._timeline.splice(0,e)}return this}remove(e){const t=this._timeline.indexOf(e);return-1!==t&&this._timeline.splice(t,1),this}get(e,t="time"){const i=this._search(e,t);return-1!==i?this._timeline[i]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const i=this._search(e,t);return i+1<this._timeline.length?this._timeline[i+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const i=this._search(e);return i-1>=0?this._timeline[i-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(Io(this._timeline[t].time,e)){for(let i=t;i>=0&&Io(this._timeline[i].time,e);i--)t=i;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else 1===this._timeline.length&&Ao(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(0===this._timeline.length)return-1;let i=0;const n=this._timeline.length;let s=n;if(n>0&&this._timeline[n-1][t]<=e)return n-1;for(;i<s;){let n=Math.floor(i+(s-i)/2);const r=this._timeline[n],o=this._timeline[n+1];if(Io(r[t],e)){for(let i=n;i<this._timeline.length;i++){if(!Io(this._timeline[i][t],e))break;n=i}return n}if(Oo(r[t],e)&&Do(o[t],e))return n;Do(r[t],e)?s=n:i=n+1}return-1}_iterate(e,t=0,i=this._timeline.length-1){this._timeline.slice(t,i+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const i=this._search(e);return-1!==i&&this._iterate(t,0,i),this}forEachAfter(e,t){const i=this._search(e);return this._iterate(t,i+1),this}forEachBetween(e,t,i){let n=this._search(e),s=this._search(t);return-1!==n&&-1!==s?(this._timeline[n].time!==e&&(n+=1),this._timeline[s].time===t&&(s-=1),this._iterate(i,n,s)):-1===n&&this._iterate(i,0,s),this}forEachFrom(e,t){let i=this._search(e);for(;i>=0&&this._timeline[i].time>=e;)i--;return this._iterate(t,i+1),this}forEachAtTime(e,t){const i=this._search(e);if(-1!==i&&Io(this._timeline[i].time,e)){let n=i;for(let t=i;t>=0&&Io(this._timeline[t].time,e);t--)n=t;this._iterate((e=>{t(e)}),n,i)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const jo=[];function zo(e){jo.push(e)}const No=[];function Lo(e){No.push(e)}class Bo extends Ro{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach((e=>{ao(this._events)&&(this._events={}),this._events.hasOwnProperty(e)||(this._events[e]=[]),this._events[e].push(t)})),this}once(e,t){const i=(...n)=>{t(...n),this.off(e,i)};return this.on(e,i),this}off(e,t){return e.split(/\W+/).forEach((i=>{if(ao(this._events)&&(this._events={}),this._events.hasOwnProperty(e))if(ao(t))this._events[e]=[];else{const i=this._events[e];for(let e=i.length-1;e>=0;e--)i[e]===t&&i.splice(e,1)}})),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const i=this._events[e].slice(0);for(let e=0,n=i.length;e<n;e++)i[e].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach((t=>{const i=Object.getOwnPropertyDescriptor(Bo.prototype,t);Object.defineProperty(e.prototype,t,i)}))}dispose(){return super.dispose(),this._events=void 0,this}}class Wo extends Bo{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class qo extends Wo{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Fo,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const e=Co(qo.getDefaults(),arguments,["context"]);e.context?this._context=e.context:this._context=function(e){return new Fr(e)}({latencyHint:e.latencyHint}),this._ticker=new _o(this.emit.bind(this,"tick"),e.clockSource,e.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(e.latencyHint),this.lookAhead=e.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var e;return this._initialized||(e=this,jo.forEach((t=>t(e))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,i){return this._context.createBuffer(e,t,i)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,i){return this._context.createPeriodicWave(e,t,i)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){io(ko(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(e)}createMediaElementSource(e){io(ko(this._context),"Not available if OfflineAudioContext");return this._context.createMediaElementSource(e)}createMediaStreamDestination(){io(ko(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){io(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){io(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){io(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){io(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return function(e,t,i){return io(lo(Zr),"This node only works in a secure context (https or localhost)"),new Zr(e,t,i)}(this.rawContext,e,t)}addAudioWorkletModule(e,t){return yo(this,void 0,void 0,(function*(){io(lo(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(t)||this._workletModules.set(t,this.rawContext.audioWorklet.addModule(e)),yield this._workletModules.get(t)}))}workletsAreReady(){return yo(this,void 0,void 0,(function*(){const e=[];this._workletModules.forEach((t=>e.push(t))),yield Promise.all(e)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get latencyHint(){return this._latencyHint}_setLatencyHint(e){let t=0;if(this._latencyHint=e,po(e))switch(e){case"interactive":t=.1;break;case"playback":t=.5;break;case"balanced":t=.25}this.lookAhead=t,this.updateInterval=t/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return ko(this._context)?this._context.resume():Promise.resolve()}close(){return yo(this,void 0,void 0,(function*(){var e;ko(this._context)&&(yield this._context.close()),this._initialized&&(e=this,No.forEach((t=>t(e))))}))}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),i=t.getChannelData(0);for(let t=0;t<i.length;t++)i[t]=e;const n=this._context.createBufferSource();return n.channelCount=1,n.channelCountMode="explicit",n.buffer=t,n.loop=!0,n.start(0),this._constants.set(e,n),n}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((e=>this._constants[e].disconnect())),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const i=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:i+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach((t=>{t.id===e&&this._timeouts.remove(t)})),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const i=++this._timeoutIds,n=()=>{const s=this.now();this._timeouts.add({callback:()=>{e(),n()},id:i,time:s+t})};return n(),i}}function $o(e,t){co(t)?t.forEach((t=>$o(e,t))):Object.defineProperty(e,t,{enumerable:!0,writable:!1})}function Vo(e,t){co(t)?t.forEach((t=>Vo(e,t))):Object.defineProperty(e,t,{writable:!0})}const Ho=()=>{};class Uo extends Ro{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Ho;const e=Co(Uo.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,e.url&&To(e.url)||e.url instanceof Uo?this.set(e.url):po(e.url)&&this.load(e.url).catch(e.onerror)}static getDefaults(){return{onerror:Ho,onload:Ho,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Yo().sampleRate}set(e){return e instanceof Uo?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return yo(this,void 0,void 0,(function*(){const t=Uo.load(e).then((e=>{this.set(e),this.onload(this)}));Uo.downloads.push(t);try{yield t}finally{const e=Uo.downloads.indexOf(t);Uo.downloads.splice(e,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=co(e)&&e[0].length>0,i=t?e.length:1,n=t?e[0].length:e.length,s=Yo(),r=s.createBuffer(i,n,s.sampleRate),o=t||1!==i?e:[e];for(let e=0;e<i;e++)r.copyToChannel(o[e],e);return this._buffer=r,this}toMono(e){if(ho(e))this.fromArray(this.toArray(e));else{let e=new Float32Array(this.length);const t=this.numberOfChannels;for(let i=0;i<t;i++){const t=this.toArray(i);for(let i=0;i<t.length;i++)e[i]+=t[i]}e=e.map((e=>e/t)),this.fromArray(e)}return this}toArray(e){if(ho(e))return this.getChannelData(e);if(1===this.numberOfChannels)return this.toArray(0);{const e=[];for(let t=0;t<this.numberOfChannels;t++)e[t]=this.getChannelData(t);return e}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){const i=Math.floor(e*this.sampleRate),n=Math.floor(t*this.sampleRate);io(i<n,"The start time must be less than the end time");const s=n-i,r=Yo().createBuffer(this.numberOfChannels,s,this.sampleRate);for(let e=0;e<this.numberOfChannels;e++)r.copyToChannel(this.getChannelData(e).subarray(i,n),e);return new Uo(r)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return(new Uo).fromArray(e)}static fromUrl(e){return yo(this,void 0,void 0,(function*(){const t=new Uo;return yield t.load(e)}))}static load(e){return yo(this,void 0,void 0,(function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const i=t[1].split("|");let n=i[0];for(const e of i)if(Uo.supportsType(e)){n=e;break}e=e.replace(t[0],n)}const i=""===Uo.baseUrl||Uo.baseUrl.endsWith("/")?Uo.baseUrl:Uo.baseUrl+"/",n=yield fetch(i+e);if(!n.ok)throw new Error(`could not load url: ${e}`);const s=yield n.arrayBuffer();return yield Yo().decodeAudioData(s)}))}static supportsType(e){const t=e.split("."),i=t[t.length-1];return""!==document.createElement("audio").canPlayType("audio/"+i)}static loaded(){return yo(this,void 0,void 0,(function*(){for(yield Promise.resolve();Uo.downloads.length;)yield Uo.downloads[0]}))}}Uo.baseUrl="",Uo.downloads=[];class Go extends qo{constructor(){var e,t,i;super({clockSource:"offline",context:xo(arguments[0])?arguments[0]:(e=arguments[0],t=arguments[1]*arguments[2],i=arguments[2],new Kr(e,t,i)),lookAhead:0,updateInterval:xo(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=xo(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return yo(this,void 0,void 0,(function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const i=Math.floor(this.sampleRate/128);e&&t%i==0&&(yield new Promise((e=>setTimeout(e,1))))}}))}render(e=!0){return yo(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new Uo(t)}))}close(){return Promise.resolve()}}const Zo=new class extends Wo{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,i){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,i){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e,t){return yo(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}};let Xo=Zo;function Yo(){var e;return Xo===Zo&&fo&&(e=new qo,Xo=ko(e)?new qo(e):xo(e)?new Go(e):e),Xo}if(go&&!go.TONE_SILENCE_LOGGING){const e=` * Tone.js ${"v"}14.7.77 * `;console.log(`%c${e}`,"background: #000; color: #fff")}function Ko(e){return Math.pow(2,e/12)}let Qo=440;function Jo(e){return Math.round(ea(e))}function ea(e){return 69+12*Math.log2(e/Qo)}function ta(e){return Qo*Math.pow(2,(e-69)/12)}class ia extends Ro{constructor(e,t,i){super(),this.defaultUnits="s",this._val=t,this._units=i,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const i=parseInt(e,10),n="."===t?1.5:1;return 1===i?this._beatsToUnits(this._getTimeSignature())*n:this._beatsToUnits(4/i)*n},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(3*Math.floor(t)))},regexp:/^(\d+)t$/i},tr:{method:(e,t,i)=>{let n=0;return e&&"0"!==e&&(n+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(n+=this._beatsToUnits(parseFloat(t))),i&&"0"!==i&&(n+=this._beatsToUnits(parseFloat(i)/4)),n},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof ia&&this.fromType(this._val),ao(this._val))return this._noArg();if(po(this._val)&&ao(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(uo(this._val)){let e=0;for(const t in this._val)if(lo(this._val[t])){const i=this._val[t];e+=new this.constructor(this.context,t).valueOf()*i}return e}if(lo(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}return po(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class na extends ia{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new na(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const i=new this.constructor(this.context,e).valueOf(),n=this.valueOf();return n+(Math.round(n/i)*i-n)*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let e=1;e<9;e++){const i=Math.pow(2,e);t.push(i+"n."),t.push(i+"n"),t.push(i+"t")}t.push("0");let i=t[0],n=new na(this.context,t[0]).toSeconds();return t.forEach((t=>{const s=new na(this.context,t).toSeconds();Math.abs(s-e)<Math.abs(n-e)&&(i=t,n=s)})),i}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const i=Math.floor(t/this._getTimeSignature());let n=t%1*4;t=Math.floor(t)%this._getTimeSignature();const s=n.toString();s.length>3&&(n=parseFloat(parseFloat(s).toFixed(3)));return[i,t,n].join(":")}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.round(t*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return Jo(this.toFrequency())}_now(){return this.context.now()}}class sa extends na{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Qo}static set A4(e){!function(e){Qo=e}(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return"midi"===this.defaultUnits?e:sa.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(e,t){const i=ra[e.toLowerCase()]+12*(parseInt(t,10)+1);return"midi"===this.defaultUnits?i:sa.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,i){let n=1;return e&&"0"!==e&&(n*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(n*=this._beatsToUnits(parseFloat(t))),i&&"0"!==i&&(n*=this._beatsToUnits(parseFloat(i)/4)),n}}})}transpose(e){return new sa(this.context,this.valueOf()*Ko(e))}harmonize(e){return e.map((e=>this.transpose(e)))}toMidi(){return Jo(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/sa.A4);let i=Math.round(12*t)+57;const n=Math.floor(i/12);n<0&&(i+=-12*n);return oa[i%12]+n.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(60*e/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return ta(e)}static ftom(e){return Jo(e)}}const ra={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},oa=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class aa extends na{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class la extends Ro{constructor(){super();const e=Co(la.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:Yo()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return new na(this.context,e).toSeconds()}toFrequency(e){return new sa(this.context,e).toFrequency()}toTicks(e){return new aa(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach((i=>{ao(e[i])&&delete t[i]})),t}get(){const e=function(e){return e.constructor.getDefaults()}(this);return Object.keys(e).forEach((t=>{if(Reflect.has(this,t)){const i=this[t];lo(i)&&lo(i.value)&&lo(i.setValueAtTime)?e[t]=i.value:i instanceof la?e[t]=i._getPartialProperties(e[t]):co(i)||ho(i)||po(i)||"boolean"==typeof i?e[t]=i:delete e[t]}})),e}set(e){return Object.keys(e).forEach((t=>{Reflect.has(this,t)&&lo(this[t])&&(this[t]&&lo(this[t].value)&&lo(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof la?this[t].set(e[t]):this[t]=e[t])})),this}}class ha extends Fo{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return null!==t?t.state:this._initial}setStateAtTime(e,t,i){return no(t,0),this.add(Object.assign({},i,{state:e,time:t})),this}getLastState(e,t){for(let i=this._search(t);i>=0;i--){const t=this._timeline[i];if(t.state===e)return t}}getNextState(e,t){const i=this._search(t);if(-1!==i)for(let t=i;t<this._timeline.length;t++){const i=this._timeline[t];if(i.state===e)return i}}}class ua extends la{constructor(){super(Co(ua.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const e=Co(ua.getDefaults(),arguments,["param","units","convert"]);for(io(lo(e.param)&&(wo(e.param)||e.param instanceof ua),"param must be an AudioParam");!wo(e.param);)e.param=e.param._param;this._swappable=!!lo(e.swappable)&&e.swappable,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Fo(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,lo(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(la.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return lo(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return lo(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return lo(this.maxValue)&&lo(this.minValue)&&no(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?(t=e,Math.pow(10,t/20)):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e;var t}_toType(e){return this.convert&&"decibels"===this.units?(t=e,Math.log(t)/Math.LN10*20):e;var t}setValueAtTime(e,t){const i=this.toSeconds(t),n=this._fromType(e);return io(isFinite(n)&&isFinite(i),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(n),this.log(this.units,"setValueAtTime",e,i),this._events.add({time:i,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,i),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),i=this._events.getAfter(t),n=this._events.get(t);let s=this._initialValue;if(null===n)s=this._initialValue;else if("setTargetAtTime"!==n.type||null!==i&&"setValueAtTime"!==i.type)if(null===i)s=n.value;else if("linearRampToValueAtTime"===i.type||"exponentialRampToValueAtTime"===i.type){let e=n.value;if("setTargetAtTime"===n.type){const t=this._events.getBefore(n.time);e=null===t?this._initialValue:t.value}s="linearRampToValueAtTime"===i.type?this._linearInterpolate(n.time,e,i.time,i.value,t):this._exponentialInterpolate(n.time,e,i.time,i.value,t)}else s=n.value;else{const e=this._events.getBefore(n.time);let i;i=null===e?this._initialValue:e.value,"setTargetAtTime"===n.type&&(s=this._exponentialApproach(n.time,i,n.value,n.constant,t))}return this._toType(s)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),0===this._fromType(t)&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const i=this._fromType(e),n=this.toSeconds(t);return io(isFinite(i)&&isFinite(n),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(i),this._events.add({time:n,type:"linearRampToValueAtTime",value:i}),this.log(this.units,"linearRampToValueAtTime",e,n),this._param.linearRampToValueAtTime(i,n),this}exponentialRampToValueAtTime(e,t){let i=this._fromType(e);i=Io(i,0)?this._minOutput:i,this._assertRange(i);const n=this.toSeconds(t);return io(isFinite(i)&&isFinite(n),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:n,type:"exponentialRampToValueAtTime",value:i}),this.log(this.units,"exponentialRampToValueAtTime",e,n),this._param.exponentialRampToValueAtTime(i,n),this}exponentialRampTo(e,t,i){return i=this.toSeconds(i),this.setRampPoint(i),this.exponentialRampToValueAtTime(e,i+this.toSeconds(t)),this}linearRampTo(e,t,i){return i=this.toSeconds(i),this.setRampPoint(i),this.linearRampToValueAtTime(e,i+this.toSeconds(t)),this}targetRampTo(e,t,i){return i=this.toSeconds(i),this.setRampPoint(i),this.exponentialApproachValueAtTime(e,i,t),this}exponentialApproachValueAtTime(e,t,i){t=this.toSeconds(t),i=this.toSeconds(i);const n=Math.log(i+1)/Math.log(200);return this.setTargetAtTime(e,t,n),this.cancelAndHoldAtTime(t+.9*i),this.linearRampToValueAtTime(e,t+i),this}setTargetAtTime(e,t,i){const n=this._fromType(e);io(isFinite(i)&&i>0,"timeConstant must be a number greater than 0");const s=this.toSeconds(t);return this._assertRange(n),io(isFinite(n)&&isFinite(s),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:i,time:s,type:"setTargetAtTime",value:n}),this.log(this.units,"setTargetAtTime",e,s,i),this._param.setTargetAtTime(n,s,i),this}setValueCurveAtTime(e,t,i,n=1){i=this.toSeconds(i),t=this.toSeconds(t);const s=this._fromType(e[0])*n;this.setValueAtTime(this._toType(s),t);const r=i/(e.length-1);for(let i=1;i<e.length;i++){const s=this._fromType(e[i])*n;this.linearRampToValueAtTime(this._toType(s),t+i*r)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return io(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),i=this._fromType(this.getValueAtTime(t));io(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+i);const n=this._events.get(t),s=this._events.getAfter(t);return n&&Io(n.time,t)?s?(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):s&&(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time),"linearRampToValueAtTime"===s.type?this.linearRampToValueAtTime(this._toType(i),t):"exponentialRampToValueAtTime"===s.type&&this.exponentialRampToValueAtTime(this._toType(i),t)),this._events.add({time:t,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,t),this}rampTo(e,t=.1,i){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(e,t,i):this.linearRampTo(e,t,i),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const i=this._events.get(t);if(i&&"setTargetAtTime"===i.type){const n=this._events.getAfter(i.time),s=n?n.time:t+2,r=(s-t)/10;for(let i=t;i<s;i+=r)e.linearRampToValueAtTime(this.getValueAtTime(i),i)}return this._events.forEachAfter(this.context.currentTime,(t=>{"cancelScheduledValues"===t.type?e.cancelScheduledValues(t.time):"setTargetAtTime"===t.type?e.setTargetAtTime(t.value,t.time,t.constant):e[t.type](t.value,t.time)})),this}setParam(e){io(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,i,n,s){return i+(t-i)*Math.exp(-(s-e)/n)}_linearInterpolate(e,t,i,n,s){return t+(s-e)/(i-e)*(n-t)}_exponentialInterpolate(e,t,i,n,s){return t*Math.pow(n/t,(s-e)/(i-e))}}class ca extends la{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return lo(this.input)?wo(this.input)||this.input instanceof ua?1:this.input.numberOfInputs:0}get numberOfOutputs(){return lo(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return lo(e)&&(e instanceof ca||bo(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach((t=>{t.channelCount=e.channelCount,t.channelCountMode=e.channelCountMode,t.channelInterpretation=e.channelInterpretation}))}_getChannelProperties(){const e=this._getInternalNodes();io(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,i=0){return pa(this,e,t,i),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return oo("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,i=0){return function(e,t,i=0,n=0){if(lo(t))for(;t instanceof ca;)t=t.input;for(;!bo(e);)lo(e.output)&&(e=e.output);wo(t)?e.disconnect(t,i):bo(t)?e.disconnect(t,i,n):e.disconnect()}(this,e,t,i),this}chain(...e){return da(this,...e),this}fan(...e){return e.forEach((e=>this.connect(e))),this}dispose(){return super.dispose(),lo(this.input)&&(this.input instanceof ca?this.input.dispose():bo(this.input)&&this.input.disconnect()),lo(this.output)&&(this.output instanceof ca?this.output.dispose():bo(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function da(...e){const t=e.shift();e.reduce(((e,t)=>(e instanceof ca?e.connect(t):bo(e)&&pa(e,t),t)),t)}function pa(e,t,i=0,n=0){for(io(lo(e),"Cannot connect from undefined node"),io(lo(t),"Cannot connect to undefined node"),(t instanceof ca||bo(t))&&io(t.numberOfInputs>0,"Cannot connect to node with no inputs"),io(e.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof ca||t instanceof ua;)lo(t.input)&&(t=t.input);for(;e instanceof ca;)lo(e.output)&&(e=e.output);wo(t)?e.connect(t,i):e.connect(t,i,n)}class ma extends ca{constructor(){super(Co(ma.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const e=Co(ma.getDefaults(),arguments,["gain","units"]);this.gain=new ua({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),$o(this,"gain")}static getDefaults(){return Object.assign(ca.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class ga extends ca{constructor(e){super(e),this.onended=Ho,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new ma({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(e){const t=this.toSeconds(e);return-1!==this._startTime&&t>=this._startTime&&(-1===this._stopTime||t<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(ca.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Ho})}_startGain(e,t=1){io(-1===this._startTime,"Source cannot be started more than once");const i=this.toSeconds(this._fadeIn);return this._startTime=e+i,this._startTime=Math.max(this._startTime,this.context.currentTime),i>0?(this._gainNode.gain.setValueAtTime(0,e),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(t,e+i):this._gainNode.gain.exponentialApproachValueAtTime(t,e,i)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){io(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.context.currentTime),t>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const e="exponential"===this._curve?2*t:0;this._stopSource(this.now()+e),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Ho&&(this.onended(this),this.onended=Ho,!this.context.isOffline)){const e=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),io(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class fa extends ga{constructor(){super(Co(fa.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const e=Co(fa.getDefaults(),arguments,["offset"]);pa(this._source,this._gainNode),this.offset=new ua({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(ga.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class va extends ca{constructor(){super(Co(va.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const e=Co(va.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new fa({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(ca.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,i=0){return ya(this,e,t,i),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,i){return this._param.exponentialRampTo(e,t,i),this}linearRampTo(e,t,i){return this._param.linearRampTo(e,t,i),this}targetRampTo(e,t,i){return this._param.targetRampTo(e,t,i),this}exponentialApproachValueAtTime(e,t,i){return this._param.exponentialApproachValueAtTime(e,t,i),this}setTargetAtTime(e,t,i){return this._param.setTargetAtTime(e,t,i),this}setValueCurveAtTime(e,t,i,n){return this._param.setValueCurveAtTime(e,t,i,n),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,i){return this._param.rampTo(e,t,i),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function ya(e,t,i,n){(t instanceof ua||wo(t)||t instanceof va&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof va&&(t.overridden=!0)),pa(e,t,i,n)}class _a extends ua{constructor(){super(Co(_a.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Fo(1/0),this._multiplier=1;const e=Co(_a.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ua.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,i){t=this.toSeconds(t),this.setRampPoint(t);const n=this._fromType(e),s=this._events.get(t),r=Math.round(Math.max(1/i,1));for(let e=0;e<=r;e++){const r=i*e+t,o=this._exponentialApproach(s.time,s.value,n,i,r);this.linearRampToValueAtTime(this._toType(o),r)}return this}setValueAtTime(e,t){const i=this.toSeconds(t);super.setValueAtTime(e,t);const n=this._events.get(i),s=this._events.previousEvent(n),r=this._getTicksUntilEvent(s,i);return n.ticks=Math.max(r,0),this}linearRampToValueAtTime(e,t){const i=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const n=this._events.get(i),s=this._events.previousEvent(n),r=this._getTicksUntilEvent(s,i);return n.ticks=Math.max(r,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const i=this._fromType(e),n=this._events.get(t),s=Math.round(Math.max(10*(t-n.time),1)),r=(t-n.time)/s;for(let e=0;e<=s;e++){const s=r*e+n.time,o=this._exponentialInterpolate(n.time,n.value,t,i,s);this.linearRampToValueAtTime(this._toType(o),s)}return this}_getTicksUntilEvent(e,t){if(null===e)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(ao(e.ticks)){const t=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(t,e.time)}const i=this._fromType(this.getValueAtTime(e.time));let n=this._fromType(this.getValueAtTime(t));const s=this._events.get(t);return s&&s.time===t&&"setValueAtTime"===s.type&&(n=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(i+n)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),i=this._events.get(t);return Math.max(this._getTicksUntilEvent(i,t),0)}getDurationOfTicks(e,t){const i=this.toSeconds(t),n=this.getTicksAtTime(t);return this.getTimeOfTick(n+e)-i}getTimeOfTick(e){const t=this._events.get(e,"ticks"),i=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&i&&"linearRampToValueAtTime"===i.type&&t.value!==i.value){const n=this._fromType(this.getValueAtTime(t.time)),s=(this._fromType(this.getValueAtTime(i.time))-n)/(i.time-t.time),r=Math.sqrt(Math.pow(n,2)-2*s*(t.ticks-e)),o=(-n+r)/s,a=(-n-r)/s;return(o>0?o:a)+t.time}return t?0===t.value?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const i=this.toSeconds(t),n=this.toSeconds(e),s=this.getTicksAtTime(i);return this.getTicksAtTime(i+n)-s}_fromType(e){return"bpm"===this.units&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return"bpm"===this.units&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class wa extends va{constructor(){super(Co(wa.getDefaults(),arguments,["value"])),this.name="TickSignal";const e=Co(wa.getDefaults(),arguments,["value"]);this.input=this._param=new _a({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(va.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class ba extends la{constructor(){super(Co(ba.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new ha,this._tickOffset=new Fo;const e=Co(ba.getDefaults(),arguments,["frequency"]);this.frequency=new wa({context:this.context,units:e.units,value:e.frequency}),$o(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},la.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const i=this.toSeconds(e);return"started"!==this._state.getValueAtTime(i)&&(this._state.setStateAtTime("started",i),lo(t)&&this.setTicksAtTime(t,i)),this}stop(e){const t=this.toSeconds(e);if("stopped"===this._state.getValueAtTime(t)){const e=this._state.get(t);e&&e.time>0&&(this._tickOffset.cancel(e.time),this._state.cancel(e.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this}pause(e){const t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&this._state.setStateAtTime("paused",t),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),i=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let s=i,r=0;return this._state.forEachBetween(i.time,t+this.sampleTime,(e=>{let t=s.time;const i=this._tickOffset.get(e.time);i&&i.time>=s.time&&(r=i.ticks,t=i.time),"started"===s.state&&"started"!==e.state&&(r+=this.frequency.getTicksAtTime(e.time)-this.frequency.getTicksAtTime(t)),s=e})),this._state.remove(n),r}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),i=this.frequency.timeToTicks(e,t);this.setTicksAtTime(i,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),i={state:"paused",time:e};this._state.add(i);let n=t,s=0;return this._state.forEachBetween(t.time,e+this.sampleTime,(e=>{let t=n.time;const i=this._tickOffset.get(e.time);i&&i.time>=n.time&&(s=i.seconds,t=i.time),"started"===n.state&&"started"!==e.state&&(s+=e.time-t),n=e})),this._state.remove(i),s}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const i=this._tickOffset.get(t),n=this._state.get(t),s=Math.max(i.time,n.time),r=this.frequency.getTicksAtTime(s)+e-i.ticks;return this.frequency.getTimeOfTick(r)}forEachTickBetween(e,t,i){let n=this._state.get(e);this._state.forEachBetween(e,t,(t=>{n&&"started"===n.state&&"started"!==t.state&&this.forEachTickBetween(Math.max(n.time,e),t.time-this.sampleTime,i),n=t}));let s=null;if(n&&"started"===n.state){const r=Math.max(n.time,e),o=this.frequency.getTicksAtTime(r),a=o-this.frequency.getTicksAtTime(n.time);let l=Math.ceil(a)-a;l=Io(l,1)?0:l;let h=this.frequency.getTimeOfTick(o+l);for(;h<t;){try{i(h,Math.round(this.getTicksAtTime(h)))}catch(e){s=e;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(s)throw s;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class xa extends la{constructor(){super(Co(xa.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=Ho,this._lastUpdate=0,this._state=new ha("stopped"),this._boundLoop=this._loop.bind(this);const e=Co(xa.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new ba({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,$o(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(la.getDefaults(),{callback:Ho,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){so(this.context);const i=this.toSeconds(e);return this.log("start",i),"started"!==this._state.getValueAtTime(i)&&(this._state.setStateAtTime("started",i),this._tickSource.start(i,t),i<this._lastUpdate&&this.emit("start",i,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const i=this.toSeconds(t),n=this.getTicksAtTime(i);return this._tickSource.getTimeOfTick(n+e,i)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,(e=>{switch(e.state){case"started":const t=this._tickSource.getTicksAtTime(e.time);this.emit("start",e.time,t);break;case"stopped":0!==e.time&&this.emit("stop",e.time);break;case"paused":this.emit("pause",e.time)}})),this._tickSource.forEachTickBetween(e,t,((e,t)=>{this.callback(e,t)})))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Bo.mixin(xa);class ka extends Ro{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=Co(ka.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach((t=>{this._loadingCount++;const i=e.urls[t];this.add(t,i,this._bufferLoaded.bind(this,e.onload),e.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:Ho,onload:Ho,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return io(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,0===this._loadingCount&&e&&e()}get loaded(){return Array.from(this._buffers).every((([e,t])=>t.loaded))}add(e,t,i=Ho,n=Ho){return po(t)?this._buffers.set(e.toString(),new Uo(this.baseUrl+t,i,n)):this._buffers.set(e.toString(),new Uo(t,i,n)),this}dispose(){return super.dispose(),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this}}class Ta extends sa{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return Jo(super._frequencyToUnits(e))}_ticksToUnits(e){return Jo(super._ticksToUnits(e))}_beatsToUnits(e){return Jo(super._beatsToUnits(e))}_secondsToUnits(e){return Jo(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return ta(this.toMidi())}transpose(e){return new Ta(this.context,this.toMidi()+e)}}function Sa(e,t){return new Ta(Yo(),e,t)}class Ea extends aa{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Ca extends la{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Fo,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}zo((e=>{e.draw=new Ca({context:e})})),Lo((e=>{e.draw.dispose()}));class Pa extends Ro{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){io(lo(e.time),"Events must have a time property"),io(lo(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new Ma(e.time,e.time+e.duration,e);for(null===this._root?this._root=t:this._root.insert(t),this._length++;null!==t;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(null!==this._root){const t=[];this._root.search(e.time,t);for(const i of t)if(i.event===e){this._removeNode(i),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,(e=>this.remove(e))),this}_setRoot(e){this._root=e,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(e,t){null!==e.parent?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(null===e.left&&null===e.right)this._replaceNodeInParent(e,null);else if(null===e.right)this._replaceNodeInParent(e,e.left);else if(null===e.left)this._replaceNodeInParent(e,e.right);else{let t,i=null;if(e.getBalance()>0)if(null===e.left.right)t=e.left,t.right=e.right,i=t;else{for(t=e.left.right;null!==t.right;)t=t.right;t.parent&&(t.parent.right=t.left,i=t.parent,t.left=e.left,t.right=e.right)}else if(null===e.right.left)t=e.right,t.left=e.left,i=t;else{for(t=e.right.left;null!==t.left;)t=t.left;t.parent&&(t.parent.left=t.right,i=t.parent,t.left=e.left,t.right=e.right)}null!==e.parent?e.isLeftChild()?e.parent.left=t:e.parent.right=t:this._setRoot(t),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const t=e.parent,i=e.isLeftChild(),n=e.right;n&&(e.right=n.left,n.left=e),null!==t?i?t.left=n:t.right=n:this._setRoot(n)}_rotateRight(e){const t=e.parent,i=e.isLeftChild(),n=e.left;n&&(e.left=n.right,n.right=e),null!==t?i?t.left=n:t.right=n:this._setRoot(n)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(null!==this._root){const t=[];if(this._root.search(e,t),t.length>0){let e=t[0];for(let i=1;i<t.length;i++)t[i].low>e.low&&(e=t[i]);return e.event}}return null}forEach(e){if(null!==this._root){const t=[];this._root.traverse((e=>t.push(e))),t.forEach((t=>{t.event&&e(t.event)}))}return this}forEachAtTime(e,t){if(null!==this._root){const i=[];this._root.search(e,i),i.forEach((e=>{e.event&&t(e.event)}))}return this}forEachFrom(e,t){if(null!==this._root){const i=[];this._root.searchAfter(e,i),i.forEach((e=>{e.event&&t(e.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((e=>e.dispose())),this._root=null,this}}class Ma{constructor(e,t,i){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=i,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?null===this.left?this.left=e:this.left.insert(e):null===this.right?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(null!==this.left&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),this.low>e||null!==this.right&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),null!==this.left&&this.left.searchAfter(e,t)),null!==this.right&&this.right.searchAfter(e,t)}traverse(e){e(this),null!==this.left&&this.left.traverse(e),null!==this.right&&this.right.traverse(e)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return null!==this.left&&null!==this.right?e=this.left.height-this.right.height:null!==this.left?e=this.left.height+1:null!==this.right&&(e=-(this.right.height+1)),e}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Ra extends ca{constructor(){super(Co(Ra.getDefaults(),arguments,["volume"])),this.name="Volume";const e=Co(Ra.getDefaults(),arguments,["volume"]);this.input=this.output=new ma({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,$o(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(ca.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Da extends ca{constructor(){super(Co(Da.getDefaults(),arguments)),this.name="Destination",this.input=new Ra({context:this.context}),this.output=new ma({context:this.context}),this.volume=this.input.volume;const e=Co(Da.getDefaults(),arguments);da(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(ca.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),da(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}zo((e=>{e.destination=new Da({context:e})})),Lo((e=>{e.destination.dispose()}));class Aa extends Ro{constructor(e){super(),this.name="TimelineValue",this._timeline=new Fo({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class Oa{constructor(e,t){this.id=Oa._eventId++;const i=Object.assign(Oa.getDefaults(),t);this.transport=e,this.callback=i.callback,this._once=i.once,this.time=i.time}static getDefaults(){return{callback:Ho,once:!1,time:0}}invoke(e){this.callback&&(this.callback(e),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}Oa._eventId=0;class Ia extends Oa{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const i=Object.assign(Ia.getDefaults(),t);this.duration=new Ea(e.context,i.duration).valueOf(),this._interval=new Ea(e.context,i.interval).valueOf(),this._nextTick=i.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Oa.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvents(e){const t=this.transport.getTicksAtTime(e);t>=this.time&&t>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Ea(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const t=this.transport.getTicksAtTime(e);t>this.time&&(this._nextTick=this.time+Math.ceil((t-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new Ea(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Ea(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class Fa extends la{constructor(){super(Co(Fa.getDefaults(),arguments)),this.name="Transport",this._loop=new Aa(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Fo,this._repeatedEvents=new Pa,this._syncedSignals=[],this._swingAmount=0;const e=Co(Fa.getDefaults(),arguments);this._ppq=e.ppq,this._clock=new xa({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),$o(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(la.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!=0&&t%(2*this._swingTicks)!=0){const i=t%(2*this._swingTicks)/(2*this._swingTicks),n=Math.sin(i*Math.PI)*this._swingAmount;e+=new Ea(this.context,2*this._swingTicks/3).toSeconds()*n}this._timeline.forEachAtTime(t,(t=>t.invoke(e)))}schedule(e,t){const i=new Oa(this,{callback:e,time:new aa(this.context,t).toTicks()});return this._addEvent(i,this._timeline)}scheduleRepeat(e,t,i,n=1/0){const s=new Ia(this,{callback:e,duration:new na(this.context,n).toTicks(),interval:new na(this.context,t).toTicks(),time:new aa(this.context,i).toTicks()});return this._addEvent(s,this._repeatedEvents)}scheduleOnce(e,t){const i=new Oa(this,{callback:e,once:!0,time:new aa(this.context,t).toTicks()});return this._addEvent(i,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,(e=>this.clear(e.id))),this._repeatedEvents.forEachFrom(t,(e=>this.clear(e.id))),this}_bindClockEvents(){this._clock.on("start",((e,t)=>{t=new Ea(this.context,t).toSeconds(),this.emit("start",e,t)})),this._clock.on("stop",(e=>{this.emit("stop",e)})),this._clock.on("pause",(e=>{this.emit("pause",e)}))}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){let i;return lo(t)&&(i=this.toTicks(t)),this._clock.start(e,i),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),"started"!==this._clock.getStateAtTime(e)?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){co(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new na(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new na(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new Ea(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new Ea(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),i=this._clock.frequency.timeToTicks(e,t);this.ticks=i}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if("started"===this.state){const i=this._clock.getTicksAtTime(t),n=t+this._clock.frequency.getDurationOfTicks(Math.ceil(i)-i,t);this.emit("stop",n),this._clock.setTicksAtTime(e,n),this.emit("start",n,this._clock.getSecondsAtTime(n))}else this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return Math.round(this._clock.getTicksAtTime(e))}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),"started"!==this.state)return 0;{const t=this.now(),i=e-this.getTicksAtTime(t)%e;return this._clock.nextTickTime(i,t)}}syncSignal(e,t){if(!t){const i=this.now();if(0!==e.getValueAtTime(i)){const n=1/(60/this.bpm.getValueAtTime(i)/this.PPQ);t=e.getValueAtTime(i)/n}else t=0}const i=new ma(t);return this.bpm.connect(i),i.connect(e._param),this._syncedSignals.push({initial:e.value,ratio:i,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const i=this._syncedSignals[t];i.signal===e&&(i.ratio.dispose(),i.signal.value=i.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Vo(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Bo.mixin(Fa),zo((e=>{e.transport=new Fa({context:e})})),Lo((e=>{e.transport.dispose()}));class ja extends ca{constructor(e){super(e),this.input=void 0,this._state=new ha("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Ho,this._syncedStop=Ho,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Ra({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,$o(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(ca.getDefaults(),{mute:!1,onstop:Ho,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,i){let n=ao(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(n=this._clampToCurrentTime(n),this._synced||"started"!==this._state.getValueAtTime(n))if(this.log("start",n),this._state.setStateAtTime("started",n),this._synced){const e=this._state.get(n);e&&(e.offset=this.toSeconds(Po(t,0)),e.duration=i?this.toSeconds(i):void 0);const s=this.context.transport.schedule((e=>{this._start(e,t,i)}),n);this._scheduled.push(s),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>n&&this._syncedStart(this.now(),this.context.transport.seconds)}else so(this.context),this._start(n,t,i);else io(Do(n,this._state.get(n).time),"Start time must be strictly greater than previous start time"),this._state.cancel(n),this._state.setStateAtTime("started",n),this.log("restart",n),this.restart(n,t,i);return this}stop(e){let t=ao(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),"started"===this._state.getValueAtTime(t)||lo(this._state.getNextState("started",t))){if(this.log("stop",t),this._synced){const e=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(e)}else this._stop(t);this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,i){return e=this.toSeconds(e),"started"===this._state.getValueAtTime(e)&&(this._state.cancel(e),this._restart(e,t,i)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(t>0){const i=this._state.get(t);if(i&&"started"===i.state&&i.time!==t){const n=t-this.toSeconds(i.time);let s;i.duration&&(s=this.toSeconds(i.duration)-n),this._start(e,this.toSeconds(i.offset)+n,s)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));"started"===this._state.getValueAtTime(t)&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((e=>this.context.transport.clear(e))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Ho,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class za extends ga{constructor(){super(Co(za.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const e=Co(za.getDefaults(),arguments,["url","onload"]);pa(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new ua({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new Uo(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(ga.getDefaults(),{url:new Uo,loop:!1,loopEnd:0,loopStart:0,onload:Ho,onerror:Ho,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,i,n=1){io(this.buffer.loaded,"buffer is either not set or not loaded");const s=this.toSeconds(e);this._startGain(s,n),t=this.loop?Po(t,this.loopStart):Po(t,0);let r=Math.max(this.toSeconds(t),0);if(this.loop){const e=this.toSeconds(this.loopEnd)||this.buffer.duration,t=this.toSeconds(this.loopStart),i=e-t;Ao(r,e)&&(r=(r-t)%i+t),Io(r,this.buffer.duration)&&(r=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Oo(r,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(s,r)),lo(i)){let e=this.toSeconds(i);e=Math.max(e,0),this.stop(s+e)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Na extends ja{constructor(){super(Co(Na.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const e=Co(Na.getDefaults(),arguments,["type"]);this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(ja.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(io(e in Ba,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,"started"===this.state)){const e=this.now();this._stop(e),this._start(e)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const t=Ba[this._type];this._source=new za({url:t,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(t.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const La={brown:null,pink:null,white:null},Ba={get brown(){if(!La.brown){const e=[];for(let t=0;t<2;t++){const i=new Float32Array(220500);e[t]=i;let n=0;for(let e=0;e<220500;e++){const t=2*Math.random()-1;i[e]=(n+.02*t)/1.02,n=i[e],i[e]*=3.5}}La.brown=(new Uo).fromArray(e)}return La.brown},get pink(){if(!La.pink){const e=[];for(let t=0;t<2;t++){const i=new Float32Array(220500);let n,s,r,o,a,l,h;e[t]=i,n=s=r=o=a=l=h=0;for(let e=0;e<220500;e++){const t=2*Math.random()-1;n=.99886*n+.0555179*t,s=.99332*s+.0750759*t,r=.969*r+.153852*t,o=.8665*o+.3104856*t,a=.55*a+.5329522*t,l=-.7616*l-.016898*t,i[e]=n+s+r+o+a+l+h+.5362*t,i[e]*=.11,h=.115926*t}}La.pink=(new Uo).fromArray(e)}return La.pink},get white(){if(!La.white){const e=[];for(let t=0;t<2;t++){const i=new Float32Array(220500);e[t]=i;for(let e=0;e<220500;e++)i[e]=2*Math.random()-1}La.white=(new Uo).fromArray(e)}return La.white}};function Wa(e,t){return yo(this,void 0,void 0,(function*(){const i=t/e.context.sampleRate,n=new Go(1,i,e.context.sampleRate);new e.constructor(Object.assign(e.get(),{frequency:2/i,detune:0,context:n})).toDestination().start(0);return(yield n.render()).getChannelData(0)}))}class qa extends ga{constructor(){super(Co(qa.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const e=Co(qa.getDefaults(),arguments,["frequency","type"]);pa(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new ua({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new ua({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),$o(this,["frequency","detune"])}static getDefaults(){return Object.assign(ga.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class $a extends ja{constructor(){super(Co($a.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const e=Co($a.getDefaults(),arguments,["frequency","type"]);this.frequency=new va({context:this.context,units:"frequency",value:e.frequency}),$o(this,"frequency"),this.detune=new va({context:this.context,units:"cents",value:e.detune}),$o(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&"custom"!==e.type&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(ja.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),i=new qa({context:this.context,onended:()=>this.onstop(this)});this._oscillator=i,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){return $a._periodicWaveCache.find((e=>{return e.phase===this._phase&&(t=e.partials,i=this._partials,t.length===i.length&&t.every(((e,t)=>i[t]===e)));var t,i}))}{const e=$a._periodicWaveCache.find((e=>e.type===this._type&&e.phase===this._phase));return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=-1!==["sine","square","sawtooth","triangle"].indexOf(e);if(0===this._phase&&t)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=e);else{const t=this._getCachedPeriodicWave();if(lo(t)){const{partials:e,wave:i}=t;this._wave=i,this._partials=e,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[t,i]=this._getRealImaginary(e,this._phase),n=this.context.createPeriodicWave(t,i);this._wave=n,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),$a._periodicWaveCache.push({imag:i,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:t,type:this._type,wave:this._wave}),$a._periodicWaveCache.length>100&&$a._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&"custom"!==this._type&&"custom"!==e?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){no(e,0);let t=this._type;const i=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(i&&(t=i[1]),"custom"!==this._type)this.type=0===e?t:t+e.toString();else{const t=new Float32Array(e);this._partials.forEach(((e,i)=>t[i]=e)),this._partials=Array.from(t),this.type=this._type}}_getRealImaginary(e,t){let i=2048;const n=new Float32Array(i),s=new Float32Array(i);let r=1;if("custom"===e){if(r=this._partials.length+1,this._partialCount=this._partials.length,i=r,0===this._partials.length)return[n,s]}else{const t=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);t?(r=parseInt(t[2],10)+1,this._partialCount=parseInt(t[2],10),e=t[1],r=Math.max(r,2),i=r):this._partialCount=0,this._partials=[]}for(let o=1;o<i;++o){const i=2/(o*Math.PI);let a;switch(e){case"sine":a=o<=r?1:0,this._partials[o-1]=a;break;case"square":a=1&o?2*i:0,this._partials[o-1]=a;break;case"sawtooth":a=i*(1&o?1:-1),this._partials[o-1]=a;break;case"triangle":a=1&o?i*i*2*(o-1>>1&1?-1:1):0,this._partials[o-1]=a;break;case"custom":a=this._partials[o-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}0!==a?(n[o]=-a*Math.sin(t*o),s[o]=a*Math.cos(t*o)):(n[o]=0,s[o]=0)}return[n,s]}_inverseFFT(e,t,i){let n=0;const s=e.length;for(let r=0;r<s;r++)n+=e[r]*Math.cos(r*i)+t[r]*Math.sin(r*i);return n}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let i=0;const n=2*Math.PI;for(let s=0;s<32;s++)i=Math.max(this._inverseFFT(e,t,s/32*n),i);return s=-this._inverseFFT(e,t,this._phase)/i,r=-1,o=1,Math.max(Math.min(s,o),r);var s,r,o}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(e=1024){return yo(this,void 0,void 0,(function*(){return Wa(this,e)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}$a._periodicWaveCache=[];class Va extends ca{constructor(){super(Object.assign(Co(Va.getDefaults(),arguments,["context"])))}connect(e,t=0,i=0){return ya(this,e,t,i),this}}class Ha extends Va{constructor(){super(Object.assign(Co(Ha.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const e=Co(Ha.getDefaults(),arguments,["mapping","length"]);co(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):"function"==typeof e.mapping&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(va.getDefaults(),{length:1024})}setMap(e,t=1024){const i=new Float32Array(t);for(let n=0,s=t;n<s;n++){const t=n/(s-1)*2-1;i[n]=e(t,n)}return this.curve=i,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){io(["none","2x","4x"].some((t=>t.includes(e))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class Ua extends Va{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Ha({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Ga extends va{constructor(){super(Object.assign(Co(Ga.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const e=Co(Ga.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new ma({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(va.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Za extends ja{constructor(){super(Co(Za.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new Ua({context:this.context}),this._modulationNode=new ma({context:this.context});const e=Co(Za.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new $a({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new $a({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Ga({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),$o(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign($a.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return yo(this,void 0,void 0,(function*(){return Wa(this,e)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Xa extends ja{constructor(){super(Co(Xa.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new ma({context:this.context,gain:0});const e=Co(Xa.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new $a({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new va({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new $a({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Ga({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Ga({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),$o(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign($a.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return yo(this,void 0,void 0,(function*(){return Wa(this,e)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Ya extends ja{constructor(){super(Co(Ya.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new ma({context:this.context,gain:0}),this._thresh=new Ha({context:this.context,mapping:e=>e<=0?-1:1});const e=Co(Ya.getDefaults(),arguments,["frequency","width"]);this.width=new va({context:this.context,units:"audioRange",value:e.width}),this._triangle=new $a({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),$o(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(ja.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(e=1024){return yo(this,void 0,void 0,(function*(){return Wa(this,e)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Ka extends ja{constructor(){super(Co(Ka.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const e=Co(Ka.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new va({context:this.context,units:"frequency",value:e.frequency}),this.detune=new va({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,$o(this,["frequency","detune"])}static getDefaults(){return Object.assign($a.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach((t=>t.start(e)))}_stop(e){e=this.toSeconds(e),this._forEach((t=>t.stop(e)))}_restart(e){this._forEach((t=>t.restart(e)))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach((t=>t.type=e))}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,i=e/(this._oscillators.length-1);this._forEach(((e,n)=>e.detune.value=t+i*n))}}get count(){return this._oscillators.length}set count(e){if(no(e,1),this._oscillators.length!==e){this._forEach((e=>e.dispose())),this._oscillators=[];for(let t=0;t<e;t++){const i=new $a({context:this.context,volume:-6-1.1*e,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:0===t?()=>this.onstop(this):Ho});"custom"===this.type&&(i.partials=this._partials),this.frequency.connect(i.frequency),this.detune.connect(i.detune),i.detune.overridden=!1,i.connect(this.output),this._oscillators[t]=i}this.spread=this._spread,"started"===this.state&&this._forEach((e=>e.start()))}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach(((e,t)=>e.phase=this._phase+t/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach((t=>t.baseType=e)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach((t=>t.partials=e)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach((t=>t.partialCount=e)),this._type=this._oscillators[0].type}asArray(e=1024){return yo(this,void 0,void 0,(function*(){return Wa(this,e)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((e=>e.dispose())),this}}class Qa extends ja{constructor(){super(Co(Qa.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Ga({context:this.context,value:2});const e=Co(Qa.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Ya({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new $a({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),$o(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(ja.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(e=1024){return yo(this,void 0,void 0,(function*(){return Wa(this,e)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const Ja={am:Za,fat:Ka,fm:Xa,oscillator:$a,pulse:Ya,pwm:Qa};class el extends ja{constructor(){super(Co(el.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const e=Co(el.getDefaults(),arguments,["frequency","type"]);this.frequency=new va({context:this.context,units:"frequency",value:e.frequency}),this.detune=new va({context:this.context,units:"cents",value:e.detune}),$o(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign($a.getDefaults(),Xa.getDefaults(),Za.getDefaults(),Ka.getDefaults(),Ya.getDefaults(),Qa.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some((e=>this._sourceType===e))&&(e=this._sourceType),e+this._oscillator.type}set type(e){"fm"===e.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):"am"===e.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):"fat"===e.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):"pwm"===e?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===e?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=Ja[e],i=this.now();if(this._oscillator){const e=this._oscillator;e.stop(i),this.context.setTimeout((()=>e.dispose()),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(i)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(t=this._oscillator.type),"fm"===e?this.type="fm"+t:"am"===e?this.type="am"+t:"fat"===e?this.type="fat"+t:"oscillator"===e?this.type=t:"pulse"===e?this.type="pulse":"pwm"===e&&(this.type="pwm")}_getOscType(e,t){return e instanceof Ja[t]}get baseType(){return this._oscillator.baseType}set baseType(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===e||"pwm"===e||(this._oscillator.baseType=e)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(e){this._getOscType(this._oscillator,"fat")&&ho(e)&&(this._oscillator.count=e)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(e){this._getOscType(this._oscillator,"fat")&&ho(e)&&(this._oscillator.spread=e)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&po(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(e=1024){return yo(this,void 0,void 0,(function*(){return Wa(this,e)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function tl(e,t=1/0){const i=new WeakMap;return function(n,s){Reflect.defineProperty(n,s,{configurable:!0,enumerable:!0,get:function(){return i.get(this)},set:function(n){no(n,e,t),i.set(this,n)}})}}function il(e,t=1/0){const i=new WeakMap;return function(n,s){Reflect.defineProperty(n,s,{configurable:!0,enumerable:!0,get:function(){return i.get(this)},set:function(n){no(this.toSeconds(n),e,t),i.set(this,n)}})}}class nl extends ja{constructor(){super(Co(nl.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const e=Co(nl.getDefaults(),arguments,["url","onload"]);this._buffer=new Uo({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(ja.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Ho,onerror:Ho,playbackRate:1,reverse:!1})}load(e){return yo(this,void 0,void 0,(function*(){return yield this._buffer.load(e),this._onload(),this}))}_onload(e=Ho){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,i){return super.start(e,t,i),this}_start(e,t,i){t=this._loop?Po(t,this._loopStart):Po(t,0);const n=this.toSeconds(t),s=i;i=Po(i,Math.max(this._buffer.duration-n,0));let r=this.toSeconds(i);r/=this._playbackRate,e=this.toSeconds(e);const o=new za({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(e+r),this._state.setStateAtTime("stopped",e+r,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&ao(s)?o.start(e,n):o.start(e,n,r-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach((e=>e.stop(t)))}restart(e,t,i){return super.restart(e,t,i),this}_restart(e,t,i){this._stop(e),this._start(e,t,i)}seek(e,t){const i=this.toSeconds(t);if("started"===this._state.getValueAtTime(i)){const t=this.toSeconds(e);this._stop(i),this._start(i,t)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&no(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach((t=>{t.loopStart=e}))}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&no(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach((t=>{t.loopEnd=e}))}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach((t=>{t.loop=e})),e)){const e=this._state.getNextState("stopped",this.now());e&&this._state.cancel(e.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),i=this._state.getNextState("stopped",t);i&&i.implicitEnd&&(this._state.cancel(i.time),this._activeSources.forEach((e=>e.cancelStop()))),this._activeSources.forEach((i=>{i.playbackRate.setValueAtTime(e,t)}))}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((e=>e.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}vo([il(0)],nl.prototype,"fadeIn",void 0),vo([il(0)],nl.prototype,"fadeOut",void 0);class sl extends Va{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new Ha({context:this.context,mapping:e=>2*Math.abs(e)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class rl extends ca{constructor(){super(Co(rl.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new va({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const e=Co(rl.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(ca.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(po(e))return e;{let i;for(i in ol)if(ol[i][t]===e)return i;return e}}_setCurve(e,t,i){if(po(i)&&Reflect.has(ol,i)){const n=ol[i];uo(n)?"_decayCurve"!==e&&(this[e]=n[t]):this[e]=n}else{if(!co(i)||"_decayCurve"===e)throw new Error("Envelope: invalid curve: "+i);this[e]=i}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._decayCurve}set decayCurve(e){io(["linear","exponential"].some((t=>t===e)),`Invalid envelope curve: ${e}`),this._decayCurve=e}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const n=this.toSeconds(this.decay),s=this.getValueAtTime(e);if(s>0){i=(1-s)/(1/i)}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if("linear"===this._attackCurve)this._sig.linearRampTo(t,i,e);else if("exponential"===this._attackCurve)this._sig.targetRampTo(t,i,e);else{this._sig.cancelAndHoldAtTime(e);let n=this._attackCurve;for(let e=1;e<n.length;e++)if(n[e-1]<=s&&s<=n[e]){n=this._attackCurve.slice(e),n[0]=s;break}this._sig.setValueCurveAtTime(n,e,i,t)}if(n&&this.sustain<1){const s=t*this.sustain,r=e+i;this.log("decay",r),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(s,n+r):this._sig.exponentialApproachValueAtTime(s,r,n)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const i=this.toSeconds(this.release);i<this.sampleTime?this._sig.setValueAtTime(0,e):"linear"===this._releaseCurve?this._sig.linearRampTo(0,i,e):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,i,e):(io(co(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,i,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,i=1){return t=this.toSeconds(t),this.triggerAttack(t,i),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,i=0){return ya(this,e,t,i),this}asArray(e=1024){return yo(this,void 0,void 0,(function*(){const t=e/this.context.sampleRate,i=new Go(1,t,this.context.sampleRate),n=this.toSeconds(this.attack)+this.toSeconds(this.decay),s=n+this.toSeconds(this.release),r=.1*s,o=s+r,a=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/o,decay:t*this.toSeconds(this.decay)/o,release:t*this.toSeconds(this.release)/o,context:i}));a._sig.toDestination(),a.triggerAttackRelease(t*(n+r)/o,0);return(yield i.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}vo([il(0)],rl.prototype,"attack",void 0),vo([il(0)],rl.prototype,"decay",void 0),vo([tl(0,1)],rl.prototype,"sustain",void 0),vo([il(0)],rl.prototype,"release",void 0);const ol=(()=>{const e=128;let t,i;const n=[];for(t=0;t<e;t++)n[t]=Math.sin(t/127*(Math.PI/2));const s=[];for(t=0;t<127;t++){i=t/127;const e=Math.sin(i*(2*Math.PI)*6.4-Math.PI/2)+1;s[t]=e/10+.83*i}s[127]=1;const r=[];for(t=0;t<e;t++)r[t]=Math.ceil(t/127*5)/5;const o=[];for(t=0;t<e;t++)i=t/127,o[t]=.5*(1-Math.cos(Math.PI*i));const a=[];for(t=0;t<e;t++){i=t/127;const e=4*Math.pow(i,3)+.2,n=Math.cos(e*Math.PI*2*i);a[t]=Math.abs(n*(1-i))}function l(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=1-e[i];return t}return{bounce:{In:l(a),Out:a},cosine:{In:n,Out:(h=n,h.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:s,Out:l(s)},sine:{In:o,Out:l(o)},step:{In:r,Out:l(r)}};var h})();class al extends ca{constructor(){super(Co(al.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const e=Co(al.getDefaults(),arguments);this._volume=this.output=new Ra({context:this.context,volume:e.volume}),this.volume=this._volume.volume,$o(this,"volume")}static getDefaults(){return Object.assign(ca.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const i=this["_original_"+e]=this[e];this[e]=(...e)=>{const n=e[t],s=this.context.transport.schedule((n=>{e[t]=n,i.apply(this,e)}),n);this._scheduledEvents.push(s)}}unsync(){return this._scheduledEvents.forEach((e=>this.context.transport.clear(e))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(e,t,i,n){const s=this.toSeconds(i),r=this.toSeconds(t);return this.triggerAttack(e,s,n),this.triggerRelease(s+r),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class ll extends al{constructor(){super(Co(ll.getDefaults(),arguments));const e=Co(ll.getDefaults(),arguments);this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(al.getDefaults(),{detune:0,onsilence:Ho,portamento:0})}triggerAttack(e,t,i=1){this.log("triggerAttack",e,t,i);const n=this.toSeconds(t);return this._triggerEnvelopeAttack(n,i),this.setNote(e,n),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const i=this.toSeconds(t),n=e instanceof sa?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(i)>.05){const e=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(n,e,i)}else this.frequency.setValueAtTime(n,i);return this}}vo([il(0)],ll.prototype,"portamento",void 0);class hl extends rl{constructor(){super(Co(hl.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new ma({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class ul extends ll{constructor(){super(Co(ul.getDefaults(),arguments)),this.name="Synth";const e=Co(ul.getDefaults(),arguments);this.oscillator=new el(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new hl(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),$o(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(ll.getDefaults(),{envelope:Object.assign(Mo(rl.getDefaults(),Object.keys(ca.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Mo(el.getDefaults(),[...Object.keys(ja.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),0===this.envelope.sustain){const t=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+t+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class cl extends ul{constructor(){super(Co(cl.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const e=Co(cl.getDefaults(),arguments);this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,$o(this,["oscillator","envelope"])}static getDefaults(){return Eo(ll.getDefaults(),ul.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const i=this.toSeconds(t),n=this.toFrequency(e instanceof sa?e.toFrequency():e),s=n*this.octaves;return this.oscillator.frequency.setValueAtTime(s,i),this.oscillator.frequency.exponentialRampToValueAtTime(n,i+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}vo([tl(0)],cl.prototype,"octaves",void 0),vo([il(0)],cl.prototype,"pitchDecay",void 0);const dl=new Set;function pl(e){dl.add(e)}function ml(e,t){const i=`registerProcessor("${e}", ${t})`;dl.add(i)}pl('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n');pl("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n");pl("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");ml("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class gl extends al{constructor(){super(Co(gl.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const e=Co(gl.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),t={};Object.keys(e.urls).forEach((i=>{const n=parseInt(i,10);if(io(mo(i)||ho(n)&&isFinite(n),`url key is neither a note or midi pitch: ${i}`),mo(i)){const n=new sa(this.context,i).toMidi();t[n]=e.urls[i]}else ho(n)&&isFinite(n)&&(t[n]=e.urls[n])})),this._buffers=new ka({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(al.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Ho,onerror:Ho,release:.1,urls:{}})}_findClosest(e){let t=0;for(;t<96;){if(this._buffers.has(e+t))return-t;if(this._buffers.has(e-t))return t;t++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,i=1){return this.log("triggerAttack",e,t,i),Array.isArray(e)||(e=[e]),e.forEach((e=>{const n=ea(new sa(this.context,e).toFrequency()),s=Math.round(n),r=n-s,o=this._findClosest(s),a=s-o,l=this._buffers.get(a),h=Ko(o+r),u=new za({url:l,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);u.start(t,0,l.duration/h,i),co(this._activeSources.get(s))||this._activeSources.set(s,[]),this._activeSources.get(s).push(u),u.onended=()=>{if(this._activeSources&&this._activeSources.has(s)){const e=this._activeSources.get(s),t=e.indexOf(u);-1!==t&&e.splice(t,1)}}})),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach((e=>{const i=new sa(this.context,e).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const e=this._activeSources.get(i);t=this.toSeconds(t),e.forEach((e=>{e.stop(t)})),this._activeSources.set(i,[])}})),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach((e=>{for(;e.length;){e.shift().stop(t)}})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,i,n=1){const s=this.toSeconds(i);return this.triggerAttack(e,s,n),co(t)?(io(co(e),"notes must be an array when duration is array"),e.forEach(((e,i)=>{const n=t[Math.min(i,t.length-1)];this.triggerRelease(e,s+this.toSeconds(n))}))):this.triggerRelease(e,s+this.toSeconds(t)),this}add(e,t,i){if(io(mo(e)||isFinite(e),`note must be a pitch or midi: ${e}`),mo(e)){const n=new sa(this.context,e).toMidi();this._buffers.add(n,t,i)}else this._buffers.add(e,t,i);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((e=>{e.forEach((e=>e.dispose()))})),this._activeSources.clear(),this}}vo([il(0)],gl.prototype,"attack",void 0),vo([il(0)],gl.prototype,"release",void 0);class fl extends ca{constructor(){super(Object.assign(Co(fl.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new sl({context:this.context}),this.a=new ma({context:this.context,gain:0}),this.b=new ma({context:this.context,gain:0}),this.output=new ma({context:this.context}),this._internalChannels=[this.a,this.b];const e=Co(fl.getDefaults(),arguments,["fade"]);this.fade=new va({context:this.context,units:"normalRange",value:e.fade}),$o(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",pa(this._split,this.a.gain,0),pa(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(ca.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class vl extends ca{constructor(e){super(e),this.name="Effect",this._dryWet=new fl({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new ma({context:this.context}),this.effectReturn=new ma({context:this.context}),this.input=new ma({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],$o(this,"wet")}static getDefaults(){return Object.assign(ca.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class yl extends ca{constructor(){super(Object.assign(Co(yl.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const e=Co(yl.getDefaults(),arguments,["pan"]);this.pan=new ua({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",$o(this,"pan")}static getDefaults(){return Object.assign(ca.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}ml("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class _l extends ca{constructor(){super(Co(_l.getDefaults(),arguments,["channels"])),this.name="Merge";const e=Co(_l.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(ca.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class wl extends vl{constructor(){super(Co(wl.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const e=Co(wl.getDefaults(),arguments,["decay"]);this._decay=e.decay,this._preDelay=e.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(vl.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){no(e=this.toSeconds(e),.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){no(e=this.toSeconds(e),0),this._preDelay=e,this.generate()}generate(){return yo(this,void 0,void 0,(function*(){const e=this.ready,t=new Go(2,this._decay+this._preDelay,this.context.sampleRate),i=new Na({context:t}),n=new Na({context:t}),s=new _l({context:t});i.connect(s,0,0),n.connect(s,0,1);const r=new ma({context:t}).toDestination();s.connect(r),i.start(0),n.start(0),r.gain.setValueAtTime(0,0),r.gain.setValueAtTime(1,this._preDelay),r.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const o=t.render();return this.ready=o.then(Ho),yield e,this._convolver.buffer=(yield o).get(),this}))}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class bl extends ca{constructor(){super(Co(bl.getDefaults(),arguments,["solo"])),this.name="Solo";const e=Co(bl.getDefaults(),arguments,["solo"]);this.input=this.output=new ma({context:this.context}),bl._allSolos.has(this.context)||bl._allSolos.set(this.context,new Set),bl._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(ca.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),bl._allSolos.get(this.context).forEach((e=>e._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){bl._soloed.has(this.context)||bl._soloed.set(this.context,new Set),bl._soloed.get(this.context).add(this)}_removeSolo(){bl._soloed.has(this.context)&&bl._soloed.get(this.context).delete(this)}_isSoloed(){return bl._soloed.has(this.context)&&bl._soloed.get(this.context).has(this)}_noSolos(){return!bl._soloed.has(this.context)||bl._soloed.has(this.context)&&0===bl._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),bl._allSolos.get(this.context).delete(this),this._removeSolo(),this}}bl._allSolos=new Map,bl._soloed=new Map;class xl extends ca{constructor(){super(Co(xl.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const e=Co(xl.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new yl({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Ra({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,$o(this,["pan","volume"])}static getDefaults(){return Object.assign(ca.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class kl extends ca{constructor(){super(Co(kl.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const e=Co(kl.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new bl({solo:e.solo,context:this.context}),this._panVol=this.output=new xl({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),$o(this,["pan","volume"])}static getDefaults(){return Object.assign(ca.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return kl.buses.has(e)||kl.buses.set(e,new ma({context:this.context})),kl.buses.get(e)}send(e,t=0){const i=this._getBus(e),n=new ma({context:this.context,units:"decibels",gain:t});return this.connect(n),n.connect(i),n}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}kl.buses=new Map;class Tl extends ca{constructor(){super(...arguments),this.name="Listener",this.positionX=new ua({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new ua({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new ua({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new ua({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new ua({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new ua({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new ua({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new ua({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new ua({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(ca.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}function Sl(e){var t,i;return(t=e,i="midi",new sa(Yo(),t,i)).toNote()}function El(e,t){return Math.random()*(t-e)+e}zo((e=>{e.listener=new Tl({context:e})})),Lo((e=>{e.listener.dispose()})),Yo().transport,Yo().destination,Yo().destination,Yo().listener,Yo().draw,Yo();const Cl={1:[8],2:[6,12],3:[1,7,15],4:[1,5,10,15],5:[1,4,8,12,16],6:[1,3,7,10,13,16],7:[1,3,6,9,11,13,16],8:[1,3,5,7,9,11,13,16],9:[1,3,5,7,9,11,13,15,16],10:[1,2,3,5,7,9,11,13,15,16],11:[1,2,3,5,7,9,11,13,14,15,16],12:[1,2,3,4,5,7,9,11,13,14,15,16],13:[1,2,3,4,5,7,9,11,12,13,14,15,16],14:[1,2,3,4,5,6,7,9,11,12,13,14,15,16],15:[1,2,3,4,5,6,7,9,10,11,12,13,14,15,16],16:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},Pl=[21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108];const Ml=[21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87];const Rl=(e,t,i,n)=>new(i||(i=Promise))(((s,r)=>{function o(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((e=>{e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}));class Dl extends ca{constructor(e){super(e),this.name="PianoComponent",this.input=void 0,this.output=new Ra({context:this.context}),this._enabled=!1,this.volume=this.output.volume,this._loaded=!1,this.volume.value=e.volume,this._enabled=e.enabled,this.samples=e.samples}get loaded(){return this._loaded}load(){return Rl(this,void 0,void 0,(function*(){if(!this._enabled)return Promise.resolve();yield this._internalLoad(),this._loaded=!0}))}}class Al extends Dl{constructor(e){super(e),this._urls={};var t,i;(t=e.minNote,i=e.maxNote,Ml.filter((e=>t<=e&&e<=i))).forEach((e=>this._urls[e]=`harmS${Sl(e).replace("#","s")}.[mp3|ogg]`))}triggerAttack(e,t,i){this._enabled&&function(e){return Ml[0]<=e&&e<=Ml[Ml.length-1]}(e)&&this._sampler.triggerAttack(Sa(e).toNote(),t,i*El(.5,1))}_internalLoad(){return new Promise((e=>{this._sampler=new gl({baseUrl:this.samples,onload:e,urls:this._urls}).connect(this.output)}))}}class Ol extends Dl{constructor(e){super(e),this._urls={};for(let t=e.minNote;t<=e.maxNote;t+=1)this._urls[t]=`rel${t-20}.[mp3|ogg]`}_internalLoad(){return new Promise((e=>{this._buffers=new ka(this._urls,e,this.samples)}))}start(e,t,i){if(this._enabled&&this._buffers.has(e)){new za({url:this._buffers.get(e),context:this.context}).connect(this.output).start(t,0,void 0,.015*i*El(.5,1))}}}class Il extends Dl{constructor(e){super(e),this._downTime=1/0,this._currentSound=null,this._downTime=1/0}_internalLoad(){return new Promise((e=>{this._buffers=new ka({down1:"pedalD1.mp3",down2:"pedalD2.mp3",up1:"pedalU1.mp3",up2:"pedalU2.mp3"},e,this.samples)}))}_squash(e){this._currentSound&&"stopped"!==this._currentSound.state&&this._currentSound.stop(e),this._currentSound=null}_playSample(e,t){this._enabled&&(this._currentSound=new za({url:this._buffers.get(`${t}${Math.random()>.5?1:2}`),context:this.context,curve:"exponential",fadeIn:.05,fadeOut:.1}).connect(this.output),this._currentSound.start(e,El(0,.01),void 0,.1*El(.5,1)))}down(e){this._squash(e),this._downTime=e,this._playSample(e,"down")}up(e){this._squash(e),this._downTime=1/0,this._playSample(e,"up")}isDown(e){return e>=this._downTime}}class Fl extends ca{constructor(e){super(e),this.name="PianoString",this._urls={},e.notes.forEach((t=>{return this._urls[t]=(i=t,n=e.velocity,`${Sl(i).replace("#","s")}v${n}.[mp3|ogg]`);var i,n})),this.samples=e.samples}load(){return new Promise((e=>{this._sampler=new gl({attack:0,baseUrl:this.samples,curve:"exponential",onload:e,release:.4,urls:this._urls,volume:3}),this.output=this._sampler}))}triggerAttack(e,t,i){this._sampler.triggerAttack(e,t,i)}triggerRelease(e,t){this._sampler.triggerRelease(e,t)}}class jl extends Dl{constructor(e){super(e);const t=(i=e.minNote,n=e.maxNote,Pl.filter((e=>i<=e&&e<=n)));var i,n;const s=Cl[e.velocities].slice();this._strings=s.map((i=>new Fl(Object.assign(e,{notes:t,velocity:i})))),this._activeNotes=new Map}scale(e,t,i,n,s){return(e-t)/(i-t)*(s-n)+n}triggerAttack(e,t,i){const n=this.scale(i,0,1,-.5,this._strings.length-.51),s=Math.max(Math.round(n),0);let r=1+n-s;1===this._strings.length&&(r=i);const o=this._strings[s];this._activeNotes.has(e)&&this.triggerRelease(e,t),this._activeNotes.set(e,o),o.triggerAttack(Sa(e).toNote(),t,r)}triggerRelease(e,t){this._activeNotes.has(e)&&(this._activeNotes.get(e).triggerRelease(Sa(e).toNote(),t),this._activeNotes.delete(e))}_internalLoad(){return Rl(this,void 0,void 0,(function*(){yield Promise.all(this._strings.map((e=>Rl(this,void 0,void 0,(function*(){yield e.load(),e.connect(this.output)})))))}))}}class zl extends ca{constructor(){super(Co(zl.getDefaults(),arguments)),this.name="Piano",this.input=void 0,this.output=new ma({context:this.context}),this._heldNotes=new Map,this._loaded=!1;const e=Co(zl.getDefaults(),arguments);e.url.endsWith("/")||(e.url+="/"),this.maxPolyphony=e.maxPolyphony,this._heldNotes=new Map,this._sustainedNotes=new Map,this._strings=new jl({...e,enabled:!0,samples:e.url,volume:e.volume.strings}).connect(this.output),this.strings=this._strings.volume,this._pedal=new Il({...e,enabled:e.pedal,samples:e.url,volume:e.volume.pedal}).connect(this.output),this.pedal=this._pedal.volume,this._keybed=new Ol({...e,enabled:e.release,samples:e.url,volume:e.volume.keybed}).connect(this.output),this.keybed=this._keybed.volume,this._harmonics=new Al({...e,enabled:e.release,samples:e.url,volume:e.volume.harmonics}).connect(this.output),this.harmonics=this._harmonics.volume}static getDefaults(){return Object.assign(ca.getDefaults(),{maxNote:108,minNote:21,pedal:!0,release:!1,url:"https://tambien.github.io/Piano/audio/",velocities:1,maxPolyphony:32,volume:{harmonics:0,keybed:0,pedal:0,strings:0}})}load(){return Rl(this,void 0,void 0,(function*(){yield Promise.all([this._strings.load(),this._pedal.load(),this._keybed.load(),this._harmonics.load()]),this._loaded=!0}))}get loaded(){return this._loaded}pedalDown({time:e=this.immediate()}={}){return this.loaded&&(e=this.toSeconds(e),this._pedal.isDown(e)||this._pedal.down(e)),this}pedalUp({time:e=this.immediate()}={}){if(this.loaded){const t=this.toSeconds(e);this._pedal.isDown(t)&&(this._pedal.up(t),this._sustainedNotes.forEach(((e,i)=>{this._heldNotes.has(i)||this._strings.triggerRelease(i,t)})),this._sustainedNotes.clear())}return this}keyDown({note:e,midi:t,time:i=this.immediate(),velocity:n=.8}){return this.loaded&&this.maxPolyphony>this._heldNotes.size+this._sustainedNotes.size?(i=this.toSeconds(i),po(e)&&(t=Math.round(Sa(e).toMidi())),this._heldNotes.has(t)||(this._heldNotes.set(t,{time:i,velocity:n}),this._strings.triggerAttack(t,i,n))):console.warn("samples not loaded"),this}keyUp({note:e,midi:t,time:i=this.immediate(),velocity:n=.8}){if(this.loaded&&(i=this.toSeconds(i),po(e)&&(t=Math.round(Sa(e).toMidi())),this._heldNotes.has(t))){const e=this._heldNotes.get(t);this._heldNotes.delete(t);let s=3/Math.max(i-e.time,.1)**.7*e.velocity*n;s=Math.max(s,.4),s=Math.min(s,4),this._pedal.isDown(i)?this._sustainedNotes.has(t)||this._sustainedNotes.set(t,i):(this._strings.triggerRelease(t,i),this._harmonics.triggerAttack(t,i,s)),this._keybed.start(t,i,n)}return this}stopAll(){return this.pedalUp(),this._heldNotes.forEach(((e,t)=>{this.keyUp({midi:t})})),this}}class Nl extends zl{constructor(...e){const t=Co(Nl.getDefaults(),e);super(t),this.options=t,this.reverb=new wl({wet:t.reverbWet}).toDestination(),this.connect(this.reverb)}get loadedVelocities(){return this._strings._strings.length}updateReverb(e){this.reverb.dispose(),this.reverb=new wl({wet:e}).toDestination(),this.connect(this.reverb)}updateVelocities(e){return this._strings.loaded?(this._strings.dispose(),this._strings=new jl({...this.options,velocities:e,enabled:!0,samples:this.options.url,volume:this.options.volume.strings}).connect(this.output),this.strings=this._strings.volume,this._strings.load()):Promise.reject({loadedVelocities:this.loadedVelocities})}updateVolumes({strings:e,harmonics:t,pedal:i,keybed:n}){this.strings.value=e,this.harmonics.value=t,this.pedal.value=i,this.keybed.value=n}}if("undefined"!=typeof document){const e=".notifications.svelte-1493hp.svelte-1493hp{display:flex;flex-direction:column;gap:0.5em;left:50%;min-width:400px;position:absolute;top:5vh;transform:translate(-50%);z-index:10}.notification.svelte-1493hp.svelte-1493hp{border-left-width:6px;border-radius:4px;box-shadow:0 1px 3px 0 rgba(0, 0, 0, 0.12), 0 1px 2px 0 rgba(0, 0, 0, 0.24);color:white;display:flex;justify-content:space-between}.notification.svelte-1493hp a{color:white;font-weight:bold}.notification.default.svelte-1493hp.svelte-1493hp{background:white;border:1px solid var(--primary-accent);color:black}.notification.default.svelte-1493hp header.svelte-1493hp{color:var(--primary-accent)}.notification.default.svelte-1493hp .close.svelte-1493hp{border-left-color:var(--primary-accent-semiopaque);color:var(--primary-accent)}.notification.success.svelte-1493hp.svelte-1493hp{background:#8bc34a;border:1px solid #6b923e}.notification.error.svelte-1493hp.svelte-1493hp{background:#ff4848;border:1px solid #eb0f0f}section.svelte-1493hp.svelte-1493hp{display:flex;flex-direction:column;padding:0.75em 0.5em;width:100%}header.svelte-1493hp.svelte-1493hp{font-size:1.25em;font-weight:bold;padding:0 0.25em 0.25em;margin-bottom:0.5em}p.svelte-1493hp.svelte-1493hp{margin:0;padding:0.25em}.close.svelte-1493hp.svelte-1493hp{align-items:center;border-left:1px solid rgba(0, 0, 0, 0.2);cursor:pointer;display:flex;font-weight:bold;padding:0 6px}button.svelte-1493hp.svelte-1493hp{background-color:var(--primary-accent);border-radius:0.25em;border:0.1em solid #ffffff;color:#ffffff;cursor:pointer;display:inline-block;margin:0;padding:0.35em 0.8em;transition:all 0.2s;margin-left:1em;margin-right:1em}button.svelte-1493hp.svelte-1493hp:hover{color:var(--primary-accent);border-color:var(--primary-accent);background-color:#ffffff}button.svelte-1493hp.svelte-1493hp:first-of-type{margin-top:1em}.modal-screen.svelte-1493hp.svelte-1493hp{background-color:rgba(0, 0, 0, 0.6);height:100vh;left:0;position:absolute;top:0;width:100vw;z-index:9}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function Ll(e,t,i){const n=e.slice();return n[3]=t[i],n}function Bl(e,t,i){const n=e.slice();return n[6]=t[i],n}function Wl(e){let t,i,n,s=e[0].some(Jl),r=[],o=new Map,a=s&&ql(),l=e[0];const y=e=>e[3].id;for(let t=0;t<l.length;t+=1){let i=Ll(e,l,t),n=y(i);o.set(n,r[t]=Ul(n,i))}return{c(){a&&a.c(),t=h(),i=u("div");for(let e=0;e<r.length;e+=1)r[e].c();this.h()},l(e){a&&a.l(e),t=c(e),i=d(e,"DIV",{class:!0});var n=p(i);for(let e=0;e<r.length;e+=1)r[e].l(n);n.forEach(m),this.h()},h(){g(i,"class","notifications svelte-1493hp")},m(e,s){a&&a.m(e,s),f(e,t,s),f(e,i,s);for(let e=0;e<r.length;e+=1)r[e].m(i,null);n=!0},p(e,n){1&n&&(s=e[0].some(Jl)),s?a?1&n&&v(a,1):(a=ql(),a.c(),v(a,1),a.m(t.parentNode,t)):a&&(w(),b(a,1,1,(()=>{a=null})),x()),1&n&&(l=e[0],w(),r=k(r,n,y,1,e,l,o,i,O,Ul,null,Ll),x())},i(e){if(!n){v(a);for(let e=0;e<l.length;e+=1)v(r[e]);n=!0}},o(e){b(a);for(let e=0;e<r.length;e+=1)b(r[e]);n=!1},d(e){a&&a.d(e),e&&m(t),e&&m(i);for(let e=0;e<r.length;e+=1)r[e].d()}}}function ql(e){let t,i,n;return{c(){t=u("div"),this.h()},l(e){t=d(e,"DIV",{class:!0}),p(t).forEach(m),this.h()},h(){g(t,"class","modal-screen svelte-1493hp")},m(e,i){f(e,t,i),n=!0},i(e){n||(y((()=>{i||(i=_(t,ye,{},!0)),i.run(1)})),n=!0)},o(e){i||(i=_(t,ye,{},!1)),i.run(0),n=!1},d(e){e&&m(t),e&&i&&i.end()}}}function $l(e){let t,i,n=e[3].title+"";return{c(){t=u("header"),i=P(n),this.h()},l(e){t=d(e,"HEADER",{class:!0});var s=p(t);i=M(s,n),s.forEach(m),this.h()},h(){g(t,"class","svelte-1493hp")},m(e,n){f(e,t,n),C(t,i)},p(e,t){1&t&&n!==(n=e[3].title+"")&&R(i,n)},d(e){e&&m(t)}}}function Vl(e){let t,i,n,s,r=e[6].label+"";function o(){return e[1](e[3],e[6])}return{c(){t=u("button"),i=P(r),this.h()},l(e){t=d(e,"BUTTON",{class:!0});var n=p(t);i=M(n,r),n.forEach(m),this.h()},h(){g(t,"class","svelte-1493hp")},m(e,r){f(e,t,r),C(t,i),n||(s=D(t,"click",o),n=!0)},p(t,n){e=t,1&n&&r!==(r=e[6].label+"")&&R(i,r)},d(e){e&&m(t),n=!1,s()}}}function Hl(e){let t,i,n,s;function r(){return e[2](e[3])}return{c(){t=u("div"),i=P("×"),this.h()},l(e){t=d(e,"DIV",{class:!0});var n=p(t);i=M(n,"×"),n.forEach(m),this.h()},h(){g(t,"class","close svelte-1493hp")},m(e,o){f(e,t,o),C(t,i),n||(s=D(t,"click",r),n=!0)},p(t,i){e=t},d(e){e&&m(t),n=!1,s()}}}function Ul(e,t){let i,n,s,r,o,a,l,v,w,b,x=t[3].message+"",k=t[3].title&&$l(t),T=t[3].actions||[],S=[];for(let e=0;e<T.length;e+=1)S[e]=Vl(Bl(t,T,e));let E=!1!==t[3].closable&&Hl(t);return{key:e,first:null,c(){i=u("div"),n=u("section"),k&&k.c(),s=h(),r=u("p"),o=h();for(let e=0;e<S.length;e+=1)S[e].c();a=h(),E&&E.c(),l=h(),this.h()},l(e){i=d(e,"DIV",{class:!0});var t=p(i);n=d(t,"SECTION",{class:!0});var h=p(n);k&&k.l(h),s=c(h),r=d(h,"P",{class:!0}),p(r).forEach(m),o=c(h);for(let e=0;e<S.length;e+=1)S[e].l(h);h.forEach(m),a=c(t),E&&E.l(t),l=c(t),t.forEach(m),this.h()},h(){g(r,"class","svelte-1493hp"),g(n,"class","svelte-1493hp"),g(i,"class",v="notification "+(t[3].type||"default")+" svelte-1493hp"),this.first=i},m(e,t){f(e,i,t),C(i,n),k&&k.m(n,null),C(n,s),C(n,r),r.innerHTML=x,C(n,o);for(let e=0;e<S.length;e+=1)S[e].m(n,null);C(i,a),E&&E.m(i,null),C(i,l),b=!0},p(e,o){if((t=e)[3].title?k?k.p(t,o):(k=$l(t),k.c(),k.m(n,s)):k&&(k.d(1),k=null),(!b||1&o)&&x!==(x=t[3].message+"")&&(r.innerHTML=x),1&o){let e;for(T=t[3].actions||[],e=0;e<T.length;e+=1){const i=Bl(t,T,e);S[e]?S[e].p(i,o):(S[e]=Vl(i),S[e].c(),S[e].m(n,null))}for(;e<S.length;e+=1)S[e].d(1);S.length=T.length}!1!==t[3].closable?E?E.p(t,o):(E=Hl(t),E.c(),E.m(i,l)):E&&(E.d(1),E=null),(!b||1&o&&v!==(v="notification "+(t[3].type||"default")+" svelte-1493hp"))&&g(i,"class",v)},i(e){b||(y((()=>{w||(w=_(i,_e,{y:-200,duration:t[3].timeout?1e3:400},!0)),w.run(1)})),b=!0)},o(e){w||(w=_(i,_e,{y:-200,duration:t[3].timeout?1e3:400},!1)),w.run(0),b=!1},d(e){e&&m(i),k&&k.d(),A(S,e),E&&E.d(),e&&w&&w.end()}}}function Gl(e){let t,i,n=e[0]&&Wl(e);return{c(){n&&n.c(),t=T()},l(e){n&&n.l(e),t=T()},m(e,s){n&&n.m(e,s),f(e,t,s),i=!0},p(e,[i]){e[0]?n?(n.p(e,i),1&i&&v(n,1)):(n=Wl(e),n.c(),v(n,1),n.m(t.parentNode,t)):n&&(w(),b(n,1,1,(()=>{n=null})),x())},i(e){i||(v(n),i=!0)},o(e){b(n),i=!1},d(e){n&&n.d(e),e&&m(t)}}}const Zl=Ce([]),Xl={};let Yl=0;const Kl=e=>{clearTimeout(Xl[e]),delete Xl[e],Zl.update((t=>t.filter((t=>t.id!==e))))},Ql=e=>{const t=Yl;Yl+=1,Zl.update((i=>[...i,{id:t,...e}])),e.timeout&&(Xl[t]=setTimeout((()=>Kl(t)),e.timeout))},Jl=e=>e.modal;function eh(e,t,i){let n;S(e,Zl,(e=>i(0,n=e))),E((()=>Object.values(Xl).forEach((e=>clearTimeout(e)))));return[n,(e,t)=>{Kl(e.id),t.fn()},e=>Kl(e.id)]}class th extends a{constructor(e){super(),l(this,e,eh,Gl,i,{})}}function ih(e,t,i){let n,s;S(e,et,(e=>i(6,n=e))),S(e,tt,(e=>i(7,s=e)));let r,{startNote:o}=t,{stopNote:a}=t,{toggleSustain:l}=t,{toggleSoft:h}=t;const u={NOTE_ON:144,NOTE_OFF:128,CONTROLLER:176,SUSTAIN:64,SOFT:67},c=({data:[e,t,i]})=>{if(t)switch(e){case u.CONTROLLER:switch(t){case u.SUSTAIN:l(!!parseInt(i,10),!0);break;case u.SOFT:h(!!parseInt(i,10),!0)}break;case u.NOTE_ON:0===i?a(t,!0):o(t,parseInt(parseFloat(i)/127*100,10),!0);break;case u.NOTE_OFF:a(t,!0)}},d=({port:e})=>{e instanceof MIDIInput&&("connected"!==e.state||n.includes(e)||(e.addEventListener("midimessage",c),et.update((t=>[...t,e]))),"disconnected"===e.state&&(e.removeEventListener("midimessage",c),et.update((t=>t.filter((t=>t!==e)))))),e instanceof MIDIOutput&&("connected"!==e.state||s.includes(e)||tt.update((t=>[...t,e])),"disconnected"===e.state&&tt.update((t=>t.filter((t=>t!==e)))))};return I((()=>(navigator.requestMIDIAccess&&navigator.requestMIDIAccess().then((e=>{r=e,F(et,n=[...r.inputs].filter((([,e])=>"connected"===e.state)).map((([,e])=>e)),n),F(tt,s=[...r.outputs].filter((([,e])=>"connected"===e.state)).map((([,e])=>e)),s),n.forEach((e=>{e.addEventListener("midimessage",c)})),r.addEventListener("statechange",d)})),()=>{r.removeEventListener("statechange",d),n.forEach((e=>{e.removeEventListener("midimessage",c)}))}))),e.$$set=e=>{"startNote"in e&&i(0,o=e.startNote),"stopNote"in e&&i(1,a=e.stopNote),"toggleSustain"in e&&i(2,l=e.toggleSustain),"toggleSoft"in e&&i(3,h=e.toggleSoft)},[o,a,l,h,(e,t,i)=>{s.forEach((n=>n.send([u[e],u[t]||t,at(parseInt(127*i,10),0,127)])))}]}class nh extends a{constructor(e){super(),l(this,e,ih,null,i,{startNote:0,stopNote:1,toggleSustain:2,toggleSoft:3,sendMidiMsg:4})}get sendMidiMsg(){return this.$$.ctx[4]}}function sh(e){let t,i,n={startNote:e[0],stopNote:e[1],toggleSustain:e[4],toggleSoft:e[5]};return t=new nh({props:n}),e[20](t),{c(){j(t.$$.fragment)},l(e){z(t.$$.fragment,e)},m(e,n){N(t,e,n),i=!0},p(e,i){t.$set({})},i(e){i||(v(t.$$.fragment,e),i=!0)},o(e){b(t.$$.fragment,e),i=!1},d(i){e[20](null),L(t,i)}}}function rh(e){let t,i,n=e[3].useWebMidi&&sh(e);return{c(){n&&n.c(),t=T()},l(e){n&&n.l(e),t=T()},m(e,s){n&&n.m(e,s),f(e,t,s),i=!0},p(e,i){e[3].useWebMidi?n?(n.p(e,i),8&i[0]&&v(n,1)):(n=sh(e),n.c(),v(n,1),n.m(t.parentNode,t)):n&&(w(),b(n,1,1,(()=>{n=null})),x())},i(e){i||(v(n),i=!0)},o(e){b(n),i=!1},d(e){n&&n.d(e),e&&m(t)}}}function oh(e,t,i){let n,s,r,o,a,l,h,u,c,d,p,m,g,f,v,y,_,w,b,x,k,T,E,C,P;S(e,Xe,(e=>i(12,n=e))),S(e,Ye,(e=>i(13,s=e))),S(e,Ze,(e=>i(14,r=e))),S(e,Ue,(e=>i(15,o=e))),S(e,Ge,(e=>i(16,a=e))),S(e,Ve,(e=>i(17,l=e))),S(e,je,(e=>i(18,h=e))),S(e,ze,(e=>i(19,u=e))),S(e,it,(e=>i(24,c=e))),S(e,st,(e=>i(25,d=e))),S(e,$e,(e=>i(26,p=e))),S(e,qe,(e=>i(27,m=e))),S(e,We,(e=>i(28,g=e))),S(e,Ne,(e=>i(29,f=e))),S(e,Je,(e=>i(30,v=e))),S(e,Qe,(e=>i(31,y=e))),S(e,Ke,(e=>i(32,_=e))),S(e,He,(e=>i(33,w=e))),S(e,Be,(e=>i(34,b=e))),S(e,Le,(e=>i(35,x=e))),S(e,rt,(e=>i(3,k=e)));const M=B(),R=new kt.Player,D=new Nl({url:"samples/",velocities:n,release:!0,pedal:!0,maxPolyphony:1/0,volume:{strings:r.strings,harmonics:r.harmonics,pedal:r.pedal,keybed:r.keybed},reverbWet:s}),A=D.load(),O=(e,t)=>{e?D.pedalDown():D.pedalUp(),t&&x?F(ze,u=e,u):t||x||T?.sendMidiMsg("CONTROLLER","SUSTAIN",e)},I=(e,t)=>{t&&b?F(je,h=e,h):t||b||T?.sendMidiMsg("CONTROLLER","SOFT",e)},j=(e=c)=>{if(R.tracks[0]&&i(6,R.tracks[0].enabled=a,R),R.setTempo((e=>{if(!E||!a)return 60;let t,i=0;for(;E[i][0]<=e&&([,t]=E[i],i+=1,!(i>=E.length)););return t})(e)*l),C&&o){const e=C.search(c,c);ze.set(e.includes(64)),je.set(e.includes(67))}else ze.set(!1),je.set(!1);P&&st.reset(P.search(c,c))},z=(e=(()=>{}))=>R.isPlaying()?(R.pause(),Promise.resolve(e()).then((()=>{j(c),R.play()}))):Promise.resolve(e()).then((()=>j(c))).catch((()=>{})),N=()=>{n!==D.loadedVelocities&&z((()=>{const e=D.updateVelocities(n);return M("loading",e),e.then((()=>F(Xe,n=D.loadedVelocities,n))).catch((({loadedVelocities:e})=>F(Xe,n=e,n))),e}))},L=(e,t,i)=>{st.add(e);let n=(w&&t||50)/100;[_,y,v].forEach((t=>{null!==t.velocityCurve&&e>=t.firstMidi&&e<=t.lastMidi&&([,n]=t.velocityCurve[parseInt(t.velocityCurve.length*n,10)])}));const s=Math.min(n*(f?1.5:1)*g*(e<66?m:p),1);s&&D.keyDown({midi:e,velocity:s*(h?.67:1)}),i||T?.sendMidiMsg("NOTE_ON",e,s)},q=(e,t)=>{st.delete(e),D.keyUp({midi:e}),t||T?.sendMidiMsg("NOTE_OFF",e,0)},$=()=>{it.reset(),R.stop(),st.reset(),je.reset(),ze.reset(),Ne.reset()},V=()=>{R.pause(),D.pedalUp(),d.forEach((e=>q(e))),u&&D.pedalDown()};return R.on("fileLoaded",(()=>{const e=e=>e.replace(/&#(\d+);/g,((e,t)=>String.fromCodePoint(t))).replace(/&#x([A-Za-z0-9]+);/g,((e,t)=>String.fromCodePoint(parseInt(t,16)))),[t,...i]=R.events;Ae.set(Object.fromEntries(t.filter((e=>"Text Event"===e.name)).map((t=>t.string.match(/^@([^:]*):[\t\s]*(.*)$/).slice(1,3).map(e))))),E=(e=>e.filter((e=>"Set Tempo"===e.name)).reduce(((e,{tick:t,data:i})=>(e.map((([,e])=>e)).includes(i)||e.push([t,i]),e)),[]))(t),C=(e=>{const t=new Se,i=e.filter((e=>"Controller Change"===e.name)),n=e=>{let n=!1;i.filter((({number:t})=>t===e)).forEach((({value:i,tick:s})=>{0===i?(n&&t.insert(n,s,e),n=!1):127===i&&(n||(n=s))}))};return n(67),n(64),t})(i[0]),P=(e=>{const t=new Se;return e.forEach((e=>{const i={};e.filter((e=>"Note on"===e.name)).forEach((({noteNumber:e,velocity:n,tick:s})=>{0===n?e in i&&(t.insert(i[e],s,e),delete i[e]):e in i||(i[e]=s)}))})),t})(i)})),R.on("playing",(({tick:e})=>{e<=R.totalTicks&&it.set(e)})),R.on("midiEvent",(({name:e,value:t,number:i,noteNumber:n,velocity:s,data:r})=>{"Note on"===e?0===s?q(n):L(n,s):"Controller Change"===e&&o?64===i?ze.set(!!t):67===i&&je.set(!!t):"Set Tempo"===e&&a&&R.setTempo(r*l)})),R.on("endOfFile",V),e.$$.update=()=>{524288&e.$$.dirty[0]&&O(u),262144&e.$$.dirty[0]&&I(h),131072&e.$$.dirty[0]&&z(),65536&e.$$.dirty[0]&&z(),32768&e.$$.dirty[0]&&z(),16384&e.$$.dirty[0]&&D.updateVolumes(r),8192&e.$$.dirty[0]&&D.updateReverb(s),4096&e.$$.dirty[0]&&(n>4&&n>D.loadedVelocities?Ql({modal:!0,title:"Please confirm your choice",message:"Increasing the sample count beyond four will consume large amounts of your system's memory, and could result in crashing the browser or even the entire system.  If you experience issues, please lower the count to four or lower.",closable:!1,actions:[{label:"okay",fn:N},{label:"cancel",fn:()=>F(Xe,n=D.loadedVelocities,n)}]}):N())},[L,q,T,k,O,I,R,A,z,$,V,()=>{c<0&&$(),z(),R.play()},n,s,r,o,a,l,h,u,function(e){W[e?"unshift":"push"]((()=>{T=e,i(2,T)}))}]}class ah extends a{constructor(e){super(),l(this,e,oh,rh,i,{midiSamplePlayer:6,pianoReady:7,updatePlayer:8,startNote:0,stopNote:1,resetPlayback:9,pausePlayback:10,startPlayback:11},null,[-1,-1])}get midiSamplePlayer(){return this.$$.ctx[6]}get pianoReady(){return this.$$.ctx[7]}get updatePlayer(){return this.$$.ctx[8]}get startNote(){return this.$$.ctx[0]}get stopNote(){return this.$$.ctx[1]}get resetPlayback(){return this.$$.ctx[9]}get pausePlayback(){return this.$$.ctx[10]}get startPlayback(){return this.$$.ctx[11]}}if("undefined"!=typeof document){const e="small{color:var(--light-grey);display:inline-block;text-align:right;margin-right:1ch}small:first-child{width:5ch}.place-holder{color:var(--light-grey)}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}if("undefined"!=typeof document){const e='.filtered-select.svelte-1jalys9.svelte-1jalys9{height:2.25em;position:relative;width:100%}.filtered-select.svelte-1jalys9.svelte-1jalys9::after{border:3px solid var(--primary-accent);border-right:0;border-top:0;border-radius:2px;content:" ";display:block;height:0.625em;margin-top:-0.4375em;pointer-events:none;position:absolute;right:1.125em;top:50%;transform:rotate(-45deg);transform-origin:center;width:0.625em}span.input.svelte-1jalys9.svelte-1jalys9{background:white;cursor:pointer;display:inline-block;height:100%;line-height:calc(2.25em - 10px);overflow:hidden;padding:5px 2.5em 5px 11px;text-overflow:ellipsis;white-space:nowrap;width:100%}div.dropdown.svelte-1jalys9.svelte-1jalys9{display:none;background:#fff;border:1px solid #999;position:relative;width:-webkit-max-content;width:-moz-max-content;width:max-content;z-index:7}div.dropdown.open.svelte-1jalys9.svelte-1jalys9{display:block}div.facets.svelte-1jalys9.svelte-1jalys9{text-align:right;padding:5px 15px;display:flex;align-items:flex-end;gap:15px}div.facets.svelte-1jalys9 ul.svelte-1jalys9{flex:1 0 auto;margin:0;text-align:left;padding:0}div.facets.svelte-1jalys9 li.svelte-1jalys9{display:inline-block;border-radius:6px;background-color:grey;color:white;padding:1px 8px;margin:0 4px;cursor:pointer}div.facets.svelte-1jalys9 li.active.svelte-1jalys9{background-color:var(--primary-accent)}ul.items.svelte-1jalys9.svelte-1jalys9{margin:0;max-height:calc(15 * (1rem + 10px) + 15px);min-width:100%;overflow-y:auto;padding:10px 0;position:relative;top:0px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:99}ul.items.svelte-1jalys9 li.svelte-1jalys9{color:#333;cursor:pointer;line-height:1;padding:5px 15px;white-space:nowrap;width:100%}ul.items.svelte-1jalys9 li.selected.svelte-1jalys9{background-color:var(--primary-accent);color:#fff}ul.items.svelte-1jalys9 li.selected.svelte-1jalys9 mark{color:#fff}ul.items.svelte-1jalys9 li.svelte-1jalys9 mark{background-color:unset;color:green;font-weight:700}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function lh(e,t,i){const n=e.slice();return n[41]=t[i],n[43]=i,n}function hh(e,t,i){const n=e.slice();return n[44]=t[i],n}function uh(e){let t,i=e[4],n=[];for(let t=0;t<i.length;t+=1)n[t]=ch(hh(e,i,t));return{c(){t=u("ul");for(let e=0;e<n.length;e+=1)n[e].c();this.h()},l(e){t=d(e,"UL",{class:!0});var i=p(t);for(let e=0;e<n.length;e+=1)n[e].l(i);i.forEach(m),this.h()},h(){g(t,"class","svelte-1jalys9")},m(e,i){f(e,t,i);for(let e=0;e<n.length;e+=1)n[e].m(t,null)},p(e,s){if(8592&s[0]){let r;for(i=e[4],r=0;r<i.length;r+=1){const o=hh(e,i,r);n[r]?n[r].p(o,s):(n[r]=ch(o),n[r].c(),n[r].m(t,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=i.length}},d(e){e&&m(t),A(n,e)}}}function ch(e){let t,i,n,s,r,o=e[44]+"";function a(){return e[27](e[44])}return{c(){t=u("li"),i=P(o),n=h(),this.h()},l(e){t=d(e,"LI",{class:!0});var s=p(t);i=M(s,o),n=c(s),s.forEach(m),this.h()},h(){g(t,"class","svelte-1jalys9"),q(t,"active",e[44]===e[7])},m(e,o){f(e,t,o),C(t,i),C(t,n),s||(r=D(t,"click",a),s=!0)},p(n,s){e=n,16&s[0]&&o!==(o=e[44]+"")&&R(i,o),144&s[0]&&q(t,"active",e[44]===e[7])},d(e){e&&m(t),s=!1,r()}}}function dh(e){let i,n;return{c(){i=u("li"),n=P("No results found"),this.h()},l(e){i=d(e,"LI",{class:!0});var t=p(i);n=M(t,"No results found"),t.forEach(m),this.h()},h(){g(i,"class","svelte-1jalys9")},m(e,t){f(e,i,t),C(i,n)},p:t,d(e){e&&m(i)}}}function ph(e){let t,i=e[3],n=[];for(let t=0;t<i.length;t+=1)n[t]=mh(lh(e,i,t));return{c(){for(let e=0;e<n.length;e+=1)n[e].c();t=T()},l(e){for(let t=0;t<n.length;t+=1)n[t].l(e);t=T()},m(e,i){for(let t=0;t<n.length;t+=1)n[t].m(e,i);f(e,t,i)},p(e,s){if(131146&s[0]){let r;for(i=e[3],r=0;r<i.length;r+=1){const o=lh(e,i,r);n[r]?n[r].p(o,s):(n[r]=mh(o),n[r].c(),n[r].m(t.parentNode,t))}for(;r<n.length;r+=1)n[r].d(1);n.length=i.length}},d(e){A(n,e),e&&m(t)}}}function mh(e){let t,i,n,r,o,a=e[1](e[41].markedUp||e[41].label)+"";function l(){return e[28](e[41])}function v(){return e[29](e[43])}return{c(){t=u("li"),i=new U,n=h(),this.h()},l(e){t=d(e,"LI",{class:!0});var s=p(t);i=G(s),n=c(s),s.forEach(m),this.h()},h(){i.a=n,g(t,"class","svelte-1jalys9"),q(t,"selected",e[43]===e[6])},m(e,s){f(e,t,s),i.m(a,t),C(t,n),r||(o=[D(t,"click",l),D(t,"pointerenter",v)],r=!0)},p(n,s){e=n,10&s[0]&&a!==(a=e[1](e[41].markedUp||e[41].label)+"")&&i.p(a),64&s[0]&&q(t,"selected",e[43]===e[6])},d(e){e&&m(t),r=!1,s(o)}}}function gh(e){let i,n,r,o,a,l,v,y,_,w,b,x,k,T=e[3]?.length+"",S=e[2].length+"",E=e[4]&&uh(e);function A(e,t){return e[3]?.length?ph:dh}let O=A(e),I=O(e);return{c(){i=u("div"),n=u("span"),r=h(),o=u("div"),a=u("div"),E&&E.c(),l=P("\n      Filtered: "),v=P(T),y=P(" / "),_=P(S),w=h(),b=u("ul"),I.c(),this.h()},l(e){i=d(e,"DIV",{class:!0});var t=p(i);n=d(t,"SPAN",{class:!0,spellcheck:!0,contenteditable:!0}),p(n).forEach(m),r=c(t),o=d(t,"DIV",{class:!0});var s=p(o);a=d(s,"DIV",{class:!0});var h=p(a);E&&E.l(h),l=M(h,"\n      Filtered: "),v=M(h,T),y=M(h," / "),_=M(h,S),h.forEach(m),w=c(s),b=d(s,"UL",{class:!0});var u=p(b);I.l(u),u.forEach(m),s.forEach(m),t.forEach(m),this.h()},h(){g(n,"class","input svelte-1jalys9"),g(n,"spellcheck","false"),g(n,"contenteditable","true"),g(a,"class","facets svelte-1jalys9"),g(b,"class","items svelte-1jalys9"),q(b,"open",e[5]),g(o,"class","dropdown svelte-1jalys9"),q(o,"open",e[5]),g(i,"class","filtered-select svelte-1jalys9")},m(t,s){f(t,i,s),C(i,n),n.innerHTML=e[0],e[25](n),C(i,r),C(i,o),C(o,a),E&&E.m(a,null),C(a,l),C(a,v),C(a,y),C(a,_),C(o,w),C(o,b),I.m(b,null),e[30](b),e[31](o),x||(k=[D(window,"click",e[23]),D(window,"keydown",$(e[24])),D(n,"input",e[12]),D(n,"focus",e[14]),D(n,"mousedown",V(e[16])),D(n,"keydown",$(e[26]))],x=!0)},p(e,t){1&t[0]&&(n.innerHTML=e[0]),e[4]?E?E.p(e,t):(E=uh(e),E.c(),E.m(a,l)):E&&(E.d(1),E=null),8&t[0]&&T!==(T=e[3]?.length+"")&&R(v,T),4&t[0]&&S!==(S=e[2].length+"")&&R(_,S),O===(O=A(e))&&I?I.p(e,t):(I.d(1),I=O(e),I&&(I.c(),I.m(b,null))),32&t[0]&&q(b,"open",e[5]),32&t[0]&&q(o,"open",e[5])},i:t,o:t,d(t){t&&m(i),e[25](null),E&&E.d(),I.d(),e[30](null),e[31](null),x=!1,s(k)}}}function fh(e,t,i){let n,s,r,o,a,l,{items:h=[]}=t,{selectedItem:u}=t,{labelFieldName:c}=t,{searchFieldName:d=c}=t,{facetFieldName:p}=t,{placeHolder:m="Select an item..."}=t,{postMarkup:g=(e=>e)}=t,f=[],v=!1,y=-1;const _={"ł":"l","ß":"ss","æ":"ae","ø":"o"},w=new RegExp(Object.keys(_).join("|"),"g"),b=new RegExp(Object.keys(_).filter((e=>_[e].length>1)).join("|"),"gi"),x=e=>e.toLowerCase().replace(/\s+/g," ").replace(w,(e=>_[e])).normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),k=(e,t)=>(e.toLowerCase().substring(0,t).match(b)||[]).length,T=(e,t)=>(e.toLowerCase().substring(0,t).match(b)||[]).reduce(((e,t)=>e+(_[t].length-t.length)),0),S=(e,t,i)=>{const n=[],s=[];let r=e;return i.forEach((i=>{let s=-1;for(;(s=t.indexOf(i,s+1))>-1;){const t=s-k(e,s-1),r=s+i.length-T(e,t+i.length-1);n.push([t,r])}})),n.sort(((e,t)=>e[0]-t[0])).forEach((([e,t])=>{const i=s[s.length-1];i&&i[1]>=e?i[1]=Math.max(i[1],t):s.push([e,t])})),s.sort(((e,t)=>t[0]-e[0])).forEach((([e,t])=>{r=`${r.substring(0,e)}<mark>${r.substring(e,t)}</mark>${r.substring(t)}`})),r},E=async e=>{i(6,y=at(e,0,n.length-1)),await H();const t=l.querySelector(".selected");if(t){const{top:e,bottom:i}=t.getBoundingClientRect(),{top:n,bottom:s}=l.getBoundingClientRect();i>s&&t.scrollIntoView(!1),e<n&&t.scrollIntoView()}},C=async()=>{if(i(5,v=!0),i(3,n=f),i(6,y=0),i(3,n=f),r&&i(3,n=f.filter((e=>e.item[p]===r))),!o.innerHTML)return;const e=x(o.innerHTML.replace(/<br>|[&/\\#,+()$~%.'":*?<>{}]|nbsp;/g," "));if(e){const t=e.split(" ").slice(0,8);i(3,n=n.filter((e=>t.every((t=>e.searchContent.includes(t))))).map((e=>({...e,markedUp:S(e.label,e.searchContent,t)}))))}},P=async e=>{i(7,r=e===r?void 0:e),C()},M=()=>{o&&i(8,o.innerHTML=u?g(c?u[c]:u):m,o)},R=async()=>{v||(i(5,v=!0),await H(),i(8,o.innerHTML="",o),i(3,n=r?f.filter((e=>e.item[p]===r)):f),E(h.indexOf(u)),o.focus())},D=()=>{i(5,v=!1),M(),o.blur()},A=(e=n[y])=>{i(18,u=e.item),D()};return e.$$set=e=>{"items"in e&&i(19,h=e.items),"selectedItem"in e&&i(18,u=e.selectedItem),"labelFieldName"in e&&i(20,c=e.labelFieldName),"searchFieldName"in e&&i(21,d=e.searchFieldName),"facetFieldName"in e&&i(22,p=e.facetFieldName),"placeHolder"in e&&i(0,m=e.placeHolder),"postMarkup"in e&&i(1,g=e.postMarkup)},e.$$.update=()=>{524288&e.$$.dirty[0]&&(i(2,f=h.map((e=>({searchContent:x(d?e[d]:e),label:c?e[c]:e,item:e})))),p&&i(4,s=[...new Set(h.map((e=>e[p])))])),262144&e.$$.dirty[0]&&M()},[m,g,f,n,s,v,y,r,o,a,l,E,C,P,R,D,()=>v?D():R(),A,u,h,c,d,p,({target:e})=>{!v||a.contains(e)||o.contains(e)||D()},({key:e})=>{v&&"Escape"===e&&D()},function(e){W[e?"unshift":"push"]((()=>{o=e,i(8,o)}))},({key:e})=>{switch(e){case"ArrowDown":R(),E(y+1);break;case"ArrowUp":R(),E(y-1);break;case"PageDown":R(),E(y+15);break;case"PageUp":R(),E(y-15);break;case"Escape":D();break;case"Enter":A(),D()}},e=>{P(e),o.focus()},e=>A(e),e=>i(6,y=e),function(e){W[e?"unshift":"push"]((()=>{l=e,i(10,l)}))},function(e){W[e?"unshift":"push"]((()=>{a=e,i(9,a)}))}]}class vh extends a{constructor(e){super(),l(this,e,fh,gh,i,{items:19,selectedItem:18,labelFieldName:20,searchFieldName:21,facetFieldName:22,placeHolder:0,postMarkup:1},null,[-1,-1])}}function yh(e){let t,i,n;function s(t){e[2](t)}let r={items:e[1],labelFieldName:"_label",searchFieldName:"_label",facetFieldName:"type",placeHolder:"<span class='place-holder'>Select a roll...</span>",postMarkup:_h};return void 0!==e[0]&&(r.selectedItem=e[0]),t=new vh({props:r}),W.push((()=>Z(t,"selectedItem",s))),{c(){j(t.$$.fragment)},l(e){z(t.$$.fragment,e)},m(e,i){N(t,e,i),n=!0},p(e,[n]){const s={};2&n&&(s.items=e[1]),!i&&1&n&&(i=!0,s.selectedItem=e[0],X((()=>i=!1))),t.$set(s)},i(e){n||(v(t.$$.fragment,e),n=!0)},o(e){b(t.$$.fragment,e),n=!1},d(e){L(t,e)}}}const _h=e=>e.replace(/^(?:[\S.]|<\/?mark>)+|\[[^\]]+\]$/g,"<small>$&</small>");function wh(e,t,i){let{rollListItems:n}=t,{currentRoll:s}=t;return e.$$set=e=>{"rollListItems"in e&&i(1,n=e.rollListItems),"currentRoll"in e&&i(0,s=e.currentRoll)},[s,n,function(e){s=e,i(0,s)}]}class bh extends a{constructor(e){super(),l(this,e,wh,yh,i,{rollListItems:1,currentRoll:0})}}if("undefined"!=typeof document){const e='dl.svelte-162wzvj{display:block;overflow:auto;padding:0.5em 1em}dt.svelte-162wzvj{font-family:"Barlow", sans-serif;font-size:0.9em;margin-top:1em;margin-bottom:0.2em;text-transform:uppercase;color:rgba(0, 0, 0, 0.6);display:inline-block;width:100%}dt.svelte-162wzvj::first-letter{font-size:1.3em}dt.svelte-162wzvj:not(.large)::after{content:":"}dd.svelte-162wzvj{font-family:"Barlow", sans-serif;display:inline;overflow-wrap:anywhere}dd.large.svelte-162wzvj{font-size:1.4em;display:block}dd.svelte-162wzvj:not(:has(a)){text-transform:capitalize}dd.svelte-162wzvj span{opacity:0.5}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function xh(e){let i,n,s,r,o,a,l,v,y,_,w,b,x,k,T,S,E,R,D,A,O,I,F,j,z,N,L,B,W,q,$=(e[0].title||kh)+"",V=(e[0].performer||kh)+"",H=(e[0].composer||kh)+"",Z=(e[0].label||kh)+"",X=(e[0].PURL||kh)+"",Y=(e[0].CALLNUM||kh)+"";return{c(){i=u("dl"),n=u("dt"),s=P("Title"),r=u("dd"),o=new U,a=h(),l=u("dt"),v=P("Performer"),y=u("dd"),_=new U,w=h(),b=u("dt"),x=P("Composer"),k=u("dd"),T=new U,S=h(),E=u("dt"),R=P("Label"),D=u("dd"),A=new U,O=h(),I=u("dt"),F=P("PURL"),j=u("dd"),z=u("a"),L=h(),B=u("dt"),W=P("Call No"),q=u("dd"),this.h()},l(e){i=d(e,"DL",{class:!0});var t=p(i);n=d(t,"DT",{class:!0});var h=p(n);s=M(h,"Title"),h.forEach(m),r=d(t,"DD",{class:!0});var u=p(r);o=G(u),a=c(u),u.forEach(m),l=d(t,"DT",{class:!0});var g=p(l);v=M(g,"Performer"),g.forEach(m),y=d(t,"DD",{class:!0});var f=p(y);_=G(f),w=c(f),f.forEach(m),b=d(t,"DT",{class:!0});var C=p(b);x=M(C,"Composer"),C.forEach(m),k=d(t,"DD",{class:!0});var P=p(k);T=G(P),S=c(P),P.forEach(m),E=d(t,"DT",{class:!0});var N=p(E);R=M(N,"Label"),N.forEach(m),D=d(t,"DD",{class:!0});var $=p(D);A=G($),O=c($),$.forEach(m),I=d(t,"DT",{class:!0});var V=p(I);F=M(V,"PURL"),V.forEach(m),j=d(t,"DD",{class:!0});var H=p(j);z=d(H,"A",{href:!0}),p(z).forEach(m),L=c(H),H.forEach(m),B=d(t,"DT",{class:!0});var U=p(B);W=M(U,"Call No"),U.forEach(m),q=d(t,"DD",{class:!0}),p(q).forEach(m),t.forEach(m),this.h()},h(){g(n,"class","svelte-162wzvj"),o.a=a,g(r,"class","large svelte-162wzvj"),g(l,"class","svelte-162wzvj"),_.a=w,g(y,"class","large svelte-162wzvj"),g(b,"class","svelte-162wzvj"),T.a=S,g(k,"class","large svelte-162wzvj"),g(E,"class","svelte-162wzvj"),A.a=O,g(D,"class","large svelte-162wzvj"),g(I,"class","svelte-162wzvj"),g(z,"href",N=e[0].PURL),g(j,"class","svelte-162wzvj"),g(B,"class","svelte-162wzvj"),g(q,"class","svelte-162wzvj"),g(i,"class","svelte-162wzvj")},m(e,t){f(e,i,t),C(i,n),C(n,s),C(i,r),o.m($,r),C(r,a),C(i,l),C(l,v),C(i,y),_.m(V,y),C(y,w),C(i,b),C(b,x),C(i,k),T.m(H,k),C(k,S),C(i,E),C(E,R),C(i,D),A.m(Z,D),C(D,O),C(i,I),C(I,F),C(i,j),C(j,z),z.innerHTML=X,C(j,L),C(i,B),C(B,W),C(i,q),q.innerHTML=Y},p(e,[t]){1&t&&$!==($=(e[0].title||kh)+"")&&o.p($),1&t&&V!==(V=(e[0].performer||kh)+"")&&_.p(V),1&t&&H!==(H=(e[0].composer||kh)+"")&&T.p(H),1&t&&Z!==(Z=(e[0].label||kh)+"")&&A.p(Z),1&t&&X!==(X=(e[0].PURL||kh)+"")&&(z.innerHTML=X),1&t&&N!==(N=e[0].PURL)&&g(z,"href",N),1&t&&Y!==(Y=(e[0].CALLNUM||kh)+"")&&(q.innerHTML=Y)},i:t,o:t,d(e){e&&m(i)}}}const kh="<span>Unavailable</span>";function Th(e,t,i){let{metadata:n}=t;return e.$$set=e=>{"metadata"in e&&i(0,n=e.metadata)},[n]}class Sh extends a{constructor(e){super(),l(this,e,Th,xh,i,{metadata:0})}}if("undefined"!=typeof document){const e='#roll-viewer.svelte-v2hjpe{position:relative;height:100%;width:100%}#roll-viewer.svelte-v2hjpe::before{background:linear-gradient(180deg, var(--primary-accent-semiopaque) calc(50% - 1px), var(--primary-accent) 50%, var(--primary-accent-semiopaque) calc(50% + 1px));content:"";display:block;height:var(--trackerbar-height);pointer-events:none;position:absolute;top:calc(50% - var(--trackerbar-height) / 2);width:calc(100% - var(--navigator-width));z-index:1}#roll-viewer.svelte-v2hjpe::after{background:linear-gradient(var(--background-angle), var(--background-darker) 0%, var(--background-color) 25%, var(--background-color) 75%, var(--background-darker) 100%);background-attachment:fixed;background-position:center;bottom:0;content:" ";left:0;mix-blend-mode:multiply;pointer-events:none;position:absolute;right:0;top:0}#roll-viewer.svelte-v2hjpe canvas{background:white !important}#roll-viewer.svelte-v2hjpe .openseadragon-canvas:focus{outline:none}#roll-viewer.svelte-v2hjpe .displayregion::after{content:attr(data-label);display:block;position:absolute;width:100%;font-size:16px;text-align:center;padding:8px 0;background:linear-gradient(180deg, transparent 0%, white 20%, white 80%, transparent 100%);top:calc(100% + 2px);transition:margin 0.5s ease}#roll-viewer.svelte-v2hjpe .displayregion.label-above::after{margin-top:-100%;top:0}.roll-loading.svelte-v2hjpe{background:rgba(0, 0, 0, 0.4);border-radius:4px;color:white;left:1em;padding:4px 8px;position:absolute;top:1em;z-index:1}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}var Eh="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var Ch=function(e,t,i){return e(i={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&i.path)}},i.exports),i.exports}((function(e){
//! openseadragon 3.0.0
//! Built on 2021-12-15
//! Git commit: v3.0.0-0-3eded36
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function t(e){return new t.Viewer(e)}var i,n,s,r;!function(e){e.version={versionStr:"3.0.0",major:parseInt("3",10),minor:parseInt("0",10),revision:parseInt("0",10)};var i,n={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},s=Object.prototype.toString,r=Object.prototype.hasOwnProperty;e.isFunction=function(t){return"function"===e.type(t)},e.isArray=Array.isArray||function(t){return"array"===e.type(t)},e.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},e.type=function(e){return null==e?String(e):n[s.call(e)]||"object"},e.isPlainObject=function(i){if(!i||"object"!==t.type(i)||i.nodeType||e.isWindow(i))return!1;if(i.constructor&&!r.call(i,"constructor")&&!r.call(i.constructor.prototype,"isPrototypeOf"))return!1;var n;for(var s in i)n=s;return void 0===n||r.call(i,n)},e.isEmptyObject=function(e){for(var t in e)return!1;return!0},e.freezeObject=function(t){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(e){return e},e.freezeObject(t)},e.supportsCanvas=(i=document.createElement("canvas"),!(!e.isFunction(i.getContext)||!i.getContext("2d"))),e.isCanvasTainted=function(e){var t=!1;try{e.getContext("2d").getImageData(0,0,1,1)}catch(e){t=!0}return t},e.supportsAddEventListener=!(!document.documentElement.addEventListener||!document.addEventListener),e.supportsRemoveEventListener=!(!document.documentElement.removeEventListener||!document.removeEventListener),e.supportsEventListenerOptions=function(){var t=0;if(e.supportsAddEventListener)try{var i={get capture(){return t++,!1},get once(){return t++,!1},get passive(){return t++,!1}};window.addEventListener("test",null,i),window.removeEventListener("test",null,i)}catch(e){t=0}return t>=3}(),e.getCurrentPixelDensityRatio=function(){if(e.supportsCanvas){var t=document.createElement("canvas").getContext("2d"),i=window.devicePixelRatio||1,n=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return Math.max(i,1)/n}return 1},e.pixelDensityRatio=e.getCurrentPixelDensityRatio()}(t),function(e){e.extend=function(){var e,i,n,s,r,o,a=arguments[0]||{},l=arguments.length,h=!1,u=1;for("boolean"==typeof a&&(h=a,a=arguments[1]||{},u=2),"object"==typeof a||t.isFunction(a)||(a={}),l===u&&(a=this,--u);u<l;u++)if(null!==(e=arguments[u])||void 0!==e)for(i in e)n=a[i],a!==(s=e[i])&&(h&&s&&(t.isPlainObject(s)||(r=t.isArray(s)))?(r?(r=!1,o=n&&t.isArray(n)?n:[]):o=n&&t.isPlainObject(n)?n:{},a[i]=t.extend(h,o,s)):void 0!==s&&(a[i]=s));return a};e.extend(e,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:function(){if("object"!=typeof navigator)return!1;var e=navigator.userAgent;return"string"==typeof e&&(-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")||-1!==e.indexOf("iPod"))}(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(e,t){return function(){var i=arguments;return void 0===i&&(i=[]),t.apply(e,i)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},_viewers:new Map,getViewer:function(t){return e._viewers.get(this.getElement(t))},getElement:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},getElementPosition:function(t){var i,n,s=new e.Point;for(n=r(t=e.getElement(t),i="fixed"===e.getElementStyle(t).position);n;)s.x+=t.offsetLeft,s.y+=t.offsetTop,i&&(s=s.plus(e.getPageScroll())),n=r(t=n,i="fixed"===e.getElementStyle(t).position);return s},getElementOffset:function(t){var i,n,s=(t=e.getElement(t))&&t.ownerDocument,r={top:0,left:0};return s?(i=s.documentElement,void 0!==t.getBoundingClientRect&&(r=t.getBoundingClientRect()),n=s===s.window?s:9===s.nodeType&&(s.defaultView||s.parentWindow),new e.Point(r.left+(n.pageXOffset||i.scrollLeft)-(i.clientLeft||0),r.top+(n.pageYOffset||i.scrollTop)-(i.clientTop||0))):new e.Point},getElementSize:function(t){return t=e.getElement(t),new e.Point(t.clientWidth,t.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(t){return(t=e.getElement(t)).currentStyle}:function(t){return t=e.getElement(t),window.getComputedStyle(t,"")},getCssPropertyWithVendorPrefix:function(t){var i={};return e.getCssPropertyWithVendorPrefix=function(t){if(void 0!==i[t])return i[t];var n=document.createElement("div").style,s=null;if(void 0!==n[t])s=t;else for(var r=["Webkit","Moz","MS","O","webkit","moz","ms","o"],o=e.capitalizeFirstLetter(t),a=0;a<r.length;a++){var l=r[a]+o;if(void 0!==n[l]){s=l;break}}return i[t]=s,s},e.getCssPropertyWithVendorPrefix(t)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},positiveModulo:function(e,t){var i=e%t;return i<0&&(i+=t),i},pointInElement:function(t,i){t=e.getElement(t);var n=e.getElementOffset(t),s=e.getElementSize(t);return i.x>=n.x&&i.x<n.x+s.x&&i.y<n.y+s.y&&i.y>=n.y},getMousePosition:function(t){if("number"==typeof t.pageX)e.getMousePosition=function(t){var i=new e.Point;return i.x=t.pageX,i.y=t.pageY,i};else{if("number"!=typeof t.clientX)throw new Error("Unknown event mouse position, no known technique.");e.getMousePosition=function(t){var i=new e.Point;return i.x=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i.y=t.clientY+document.body.scrollTop+document.documentElement.scrollTop,i}}return e.getMousePosition(t)},getPageScroll:function(){var t=document.documentElement||{},i=document.body||{};if("number"==typeof window.pageXOffset)e.getPageScroll=function(){return new e.Point(window.pageXOffset,window.pageYOffset)};else if(i.scrollLeft||i.scrollTop)e.getPageScroll=function(){return new e.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!t.scrollLeft&&!t.scrollTop)return new e.Point(0,0);e.getPageScroll=function(){return new e.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return e.getPageScroll()},setPageScroll:function(t){if(void 0!==window.scrollTo)e.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var i=e.getPageScroll();if(i.x===t.x&&i.y===t.y)return;document.body.scrollLeft=t.x,document.body.scrollTop=t.y;var n=e.getPageScroll();if(n.x!==i.x&&n.y!==i.y)return void(e.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y});if(document.documentElement.scrollLeft=t.x,document.documentElement.scrollTop=t.y,(n=e.getPageScroll()).x!==i.x&&n.y!==i.y)return void(e.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y});e.setPageScroll=function(e){}}e.setPageScroll(t)},getWindowSize:function(){var t=document.documentElement||{},i=document.body||{};if("number"==typeof window.innerWidth)e.getWindowSize=function(){return new e.Point(window.innerWidth,window.innerHeight)};else if(t.clientWidth||t.clientHeight)e.getWindowSize=function(){return new e.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!i.clientWidth&&!i.clientHeight)throw new Error("Unknown window size, no known technique.");e.getWindowSize=function(){return new e.Point(document.body.clientWidth,document.body.clientHeight)}}return e.getWindowSize()},makeCenteredNode:function(t){t=e.getElement(t);var i=[e.makeNeutralElement("div"),e.makeNeutralElement("div"),e.makeNeutralElement("div")];return e.extend(i[0].style,{display:"table",height:"100%",width:"100%"}),e.extend(i[1].style,{display:"table-row"}),e.extend(i[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),i[0].appendChild(i[1]),i[1].appendChild(i[2]),i[2].appendChild(t),i[0]},makeNeutralElement:function(e){var t=document.createElement(e),i=t.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",t},now:function(){return Date.now?e.now=Date.now:e.now=function(){return(new Date).getTime()},e.now()},makeTransparentImage:function(t){var i=e.makeNeutralElement("img");return i.src=t,i},setElementOpacity:function(t,i,n){var s;t=e.getElement(t),n&&!e.Browser.alpha&&(i=Math.round(i)),e.Browser.opacity?t.style.opacity=i<1?i:"":i<1?(s="alpha(opacity="+Math.round(100*i)+")",t.style.filter=s):t.style.filter=""},setElementTouchActionNone:function(t){void 0!==(t=e.getElement(t)).style.touchAction?t.style.touchAction="none":void 0!==t.style.msTouchAction&&(t.style.msTouchAction="none")},setElementPointerEvents:function(t,i){void 0!==(t=e.getElement(t)).style.pointerEvents&&(t.style.pointerEvents=i)},setElementPointerEventsNone:function(t){e.setElementPointerEvents(t,"none")},addClass:function(t,i){(t=e.getElement(t)).className?-1===(" "+t.className+" ").indexOf(" "+i+" ")&&(t.className+=" "+i):t.className=i},indexOf:function(e,t,i){return Array.prototype.indexOf?this.indexOf=function(e,t,i){return e.indexOf(t,i)}:this.indexOf=function(e,t,i){var n,s,r=i||0;if(!e)throw new TypeError;if(0===(s=e.length)||r>=s)return-1;for(r<0&&(r=s-Math.abs(r)),n=r;n<s;n++)if(e[n]===t)return n;return-1},this.indexOf(e,t,i)},removeClass:function(t,i){var n,s,r=[];for(n=(t=e.getElement(t)).className.split(/\s+/),s=0;s<n.length;s++)n[s]&&n[s]!==i&&r.push(n[s]);t.className=r.join(" ")},normalizeEventListenerOptions:function(t){return void 0!==t?"boolean"==typeof t?e.supportsEventListenerOptions?{capture:t}:t:e.supportsEventListenerOptions?t:void 0!==t.capture&&t.capture:!!e.supportsEventListenerOptions&&{capture:!1}},addEvent:function(){if(e.supportsAddEventListener)return function(t,i,n,s){s=e.normalizeEventListenerOptions(s),(t=e.getElement(t)).addEventListener(i,n,s)};if(document.documentElement.attachEvent&&document.attachEvent)return function(t,i,n){(t=e.getElement(t)).attachEvent("on"+i,n)};throw new Error("No known event model.")}(),removeEvent:function(){if(e.supportsRemoveEventListener)return function(t,i,n,s){s=e.normalizeEventListenerOptions(s),(t=e.getElement(t)).removeEventListener(i,n,s)};if(document.documentElement.detachEvent&&document.detachEvent)return function(t,i,n){(t=e.getElement(t)).detachEvent("on"+i,n)};throw new Error("No known event model.")}(),cancelEvent:function(e){e.preventDefault()},eventIsCanceled:function(e){return e.defaultPrevented},stopEvent:function(e){e.stopPropagation()},createCallback:function(e,t){var i,n=[];for(i=2;i<arguments.length;i++)n.push(arguments[i]);return function(){var i,s=n.concat([]);for(i=0;i<arguments.length;i++)s.push(arguments[i]);return t.apply(e,s)}},getUrlParameter:function(e){var t=s[e];return t||null},getUrlProtocol:function(e){var t=e.match(/^([a-z]+:)\/\//i);return null===t?window.location.protocol:t[1].toLowerCase()},createAjaxRequest:function(t){var i;try{i=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(e){i=!1}if(i)window.XMLHttpRequest?e.createAjaxRequest=function(e){return e?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:e.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");e.createAjaxRequest=function(){return new XMLHttpRequest}}return e.createAjaxRequest(t)},makeAjaxRequest:function(t,i,n){var s,r,o;e.isPlainObject(t)&&(i=t.success,n=t.error,s=t.withCredentials,r=t.headers,o=t.responseType||null,t=t.url);var a=e.getUrlProtocol(t),l=e.createAjaxRequest("file:"===a);if(!e.isFunction(i))throw new Error("makeAjaxRequest requires a success callback");l.onreadystatechange=function(){4===l.readyState&&(l.onreadystatechange=function(){},l.status>=200&&l.status<300||0===l.status&&"http:"!==a&&"https:"!==a?i(l):(e.console.log("AJAX request returned %d: %s",l.status,t),e.isFunction(n)&&n(l)))};try{if(l.open("GET",t,!0),o&&(l.responseType=o),r)for(var h in r)Object.prototype.hasOwnProperty.call(r,h)&&r[h]&&l.setRequestHeader(h,r[h]);s&&(l.withCredentials=!0),l.send(null)}catch(t){e.console.log("%s while making AJAX request: %s",t.name,t.message),l.onreadystatechange=function(){},e.isFunction(n)&&n(l,t)}return l},jsonp:function(t){var i,n=t.url,s=document.head||document.getElementsByTagName("head")[0]||document.documentElement,r=t.callbackName||"openseadragon"+e.now(),o=window[r],a="$1"+r+"$2",l=t.param||"callback",h=t.callback;n=n.replace(/(=)\?(&|$)|\?\?/i,a),n+=(/\?/.test(n)?"&":"?")+l+"="+r,window[r]=function(t){if(o)window[r]=o;else try{delete window[r]}catch(e){}h&&e.isFunction(h)&&h(t)},i=document.createElement("script"),void 0===t.async&&!1===t.async||(i.async="async"),t.scriptCharset&&(i.charset=t.scriptCharset),i.src=n,i.onload=i.onreadystatechange=function(e,t){(t||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,s&&i.parentNode&&s.removeChild(i),i=void 0)},s.insertBefore(i,s.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(t){if(window.DOMParser)e.parseXml=function(e){return(new DOMParser).parseFromString(e,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");e.parseXml=function(e){var t=null;return(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e),t}}return e.parseXml(t)},parseJSON:function(t){return e.parseJSON=window.JSON.parse,e.parseJSON(t)},imageFormatSupported:function(e){return!!n[(e=e||"").toLowerCase()]},setImageFormatsSupported:function(t){e.extend(n,t)}});var i=function(e){};e.console=window.console||{log:i,debug:i,info:i,warn:i,error:i,assert:i},e.Browser={vendor:e.BROWSERS.UNKNOWN,version:0,alpha:!0};var n={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},s={};function r(e,t){return t&&e!==document.body?document.body:e.offsetParent}!function(){var t=navigator.appVersion,i=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(i.substring(i.indexOf("MSIE")+5,i.indexOf(";",i.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(i.indexOf("Edge")>=0?(e.Browser.vendor=e.BROWSERS.EDGE,e.Browser.version=parseFloat(i.substring(i.indexOf("Edge")+5))):i.indexOf("Edg")>=0?(e.Browser.vendor=e.BROWSERS.CHROMEEDGE,e.Browser.version=parseFloat(i.substring(i.indexOf("Edg")+4))):i.indexOf("Firefox")>=0?(e.Browser.vendor=e.BROWSERS.FIREFOX,e.Browser.version=parseFloat(i.substring(i.indexOf("Firefox")+8))):i.indexOf("Safari")>=0?(e.Browser.vendor=i.indexOf("Chrome")>=0?e.BROWSERS.CHROME:e.BROWSERS.SAFARI,e.Browser.version=parseFloat(i.substring(i.substring(0,i.indexOf("Safari")).lastIndexOf("/")+1,i.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(i)&&(e.Browser.vendor=e.BROWSERS.IE,e.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":e.Browser.vendor=e.BROWSERS.OPERA,e.Browser.version=parseFloat(t)}var n,r,o,a=window.location.search.substring(1).split("&");for(o=0;o<a.length;o++)if((r=(n=a[o]).indexOf("="))>0){var l=n.substring(0,r),h=n.substring(r+1);try{s[l]=decodeURIComponent(h)}catch(t){e.console.error("Ignoring malformed URL parameter: %s=%s",l,h)}}e.Browser.alpha=!(e.Browser.vendor===e.BROWSERS.CHROME&&e.Browser.version<2),e.Browser.opacity=!0,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<11&&e.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon")}(),function(t){var i=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,n=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame;if(i&&n)e.requestAnimationFrame=function(){return i.apply(t,arguments)},e.cancelAnimationFrame=function(){return n.apply(t,arguments)};else{var s,r=[],o=[],a=0;e.requestAnimationFrame=function(t){return r.push([++a,t]),s||(s=setInterval((function(){if(r.length){var t=e.now(),i=o;for(o=r,r=i;o.length;)o.shift()[1](t)}else clearInterval(s),s=void 0}),20)),a},e.cancelAnimationFrame=function(e){var t,i;for(t=0,i=r.length;t<i;t+=1)if(r[t][0]===e)return void r.splice(t,1);for(t=0,i=o.length;t<i;t+=1)if(o[t][0]===e)return void o.splice(t,1)}}}(window)}(t),i=Eh,n=function(){return t},e.exports?e.exports=n():i.OpenSeadragon=n(),s=t,r={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""},document.exitFullscreen?(r.supportsFullScreen=!0,r.getFullScreenElement=function(){return document.fullscreenElement},r.requestFullScreen=function(e){return e.requestFullscreen()},r.exitFullScreen=function(){document.exitFullscreen()},r.fullScreenEventName="fullscreenchange",r.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(r.supportsFullScreen=!0,r.getFullScreenElement=function(){return document.msFullscreenElement},r.requestFullScreen=function(e){return e.msRequestFullscreen()},r.exitFullScreen=function(){document.msExitFullscreen()},r.fullScreenEventName="MSFullscreenChange",r.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(r.supportsFullScreen=!0,r.getFullScreenElement=function(){return document.webkitFullscreenElement},r.requestFullScreen=function(e){return e.webkitRequestFullscreen()},r.exitFullScreen=function(){document.webkitExitFullscreen()},r.fullScreenEventName="webkitfullscreenchange",r.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(r.supportsFullScreen=!0,r.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},r.requestFullScreen=function(e){return e.webkitRequestFullScreen()},r.exitFullScreen=function(){document.webkitCancelFullScreen()},r.fullScreenEventName="webkitfullscreenchange",r.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(r.supportsFullScreen=!0,r.getFullScreenElement=function(){return document.mozFullScreenElement},r.requestFullScreen=function(e){return e.mozRequestFullScreen()},r.exitFullScreen=function(){document.mozCancelFullScreen()},r.fullScreenEventName="mozfullscreenchange",r.fullScreenErrorEventName="mozfullscreenerror"),r.isFullScreen=function(){return null!==r.getFullScreenElement()},r.cancelFullScreen=function(){s.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),r.exitFullScreen()},s.extend(s,r),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(e,t,i,n){var s=this;n=n||1;var r=0,o=function(i){++r===n&&s.removeHandler(e,o),t(i)};this.addHandler(e,o,i)},addHandler:function(t,i,n){var s=this.events[t];s||(this.events[t]=s=[]),i&&e.isFunction(i)&&(s[s.length]={handler:i,userData:n||null})},removeHandler:function(t,i){var n,s=this.events[t],r=[];if(s&&e.isArray(s)){for(n=0;n<s.length;n++)s[n].handler!==i&&r.push(s[n]);this.events[t]=r}},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var t=this.events[e];return t&&t.length?(t=1===t.length?[t[0]]:Array.apply(null,t),function(e,i){var n,s=t.length;for(n=0;n<s;n++)t[n]&&(i.eventSource=e,i.userData=t[n].userData,t[n].handler(i))}):null},raiseEvent:function(e,t){var i=this.getHandler(e);i&&(t||(t={}),i(this,t))}}}(t),function(e){var t={};e.MouseTracker=function(i){var n=arguments;e.isPlainObject(i)||(i={element:n[0],clickTimeThreshold:n[1],clickDistThreshold:n[2]}),this.hash=Math.random(),this.element=e.getElement(i.element),this.clickTimeThreshold=i.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=i.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=i.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=i.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=i.userData||null,this.stopDelay=i.stopDelay||50,this.preProcessEventHandler=i.preProcessEventHandler||null,this.contextMenuHandler=i.contextMenuHandler||null,this.enterHandler=i.enterHandler||null,this.leaveHandler=i.leaveHandler||null,this.exitHandler=i.exitHandler||null,this.overHandler=i.overHandler||null,this.outHandler=i.outHandler||null,this.pressHandler=i.pressHandler||null,this.nonPrimaryPressHandler=i.nonPrimaryPressHandler||null,this.releaseHandler=i.releaseHandler||null,this.nonPrimaryReleaseHandler=i.nonPrimaryReleaseHandler||null,this.moveHandler=i.moveHandler||null,this.scrollHandler=i.scrollHandler||null,this.clickHandler=i.clickHandler||null,this.dblClickHandler=i.dblClickHandler||null,this.dragHandler=i.dragHandler||null,this.dragEndHandler=i.dragEndHandler||null,this.pinchHandler=i.pinchHandler||null,this.stopHandler=i.stopHandler||null,this.keyDownHandler=i.keyDownHandler||null,this.keyUpHandler=i.keyUpHandler||null,this.keyHandler=i.keyHandler||null,this.focusHandler=i.focusHandler||null,this.blurHandler=i.blurHandler||null;var s=this;t[this.hash]={click:function(e){b(s,e)},dblclick:function(e){x(s,e)},keydown:function(e){k(s,e)},keyup:function(e){T(s,e)},keypress:function(e){S(s,e)},focus:function(e){E(s,e)},blur:function(e){C(s,e)},contextmenu:function(e){P(s,e)},wheel:function(e){M(s,e)},mousewheel:function(e){R(s,e)},DOMMouseScroll:function(e){R(s,e)},MozMousePixelScroll:function(e){R(s,e)},losecapture:function(e){A(s,e)},mouseenter:function(e){W(s,e)},mouseleave:function(e){q(s,e)},mouseover:function(e){$(s,e)},mouseout:function(e){V(s,e)},mousedown:function(e){H(s,e)},mouseup:function(e){U(s,e)},mousemove:function(e){X(s,e)},touchstart:function(e){O(s,e)},touchend:function(e){I(s,e)},touchmove:function(e){F(s,e)},touchcancel:function(e){j(s,e)},gesturestart:function(e){z(s,e)},gesturechange:function(e){N(s,e)},gotpointercapture:function(e){L(s,e)},lostpointercapture:function(e){B(s,e)},pointerenter:function(e){W(s,e)},pointerleave:function(e){q(s,e)},pointerover:function(e){$(s,e)},pointerout:function(e){V(s,e)},pointerdown:function(e){H(s,e)},pointerup:function(e){U(s,e)},pointermove:function(e){X(s,e)},pointercancel:function(e){Q(s,e)},pointerupcaptured:function(e){G(s,e)},pointermovecaptured:function(e){Y(s,e)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,e.MouseTracker.havePointerEvents&&e.setElementPointerEvents(this.element,"auto"),this.exitHandler&&e.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),i.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){c(this),this.element=null,t[this.hash]=null,delete t[this.hash]},isTracking:function(){return t[this.hash].tracking},setTracking:function(i){return i?function(i){var n,s,r=t[i.hash];if(!r.tracking){for(s=0;s<e.MouseTracker.subscribeEvents.length;s++)n=e.MouseTracker.subscribeEvents[s],e.addEvent(i.element,n,r[n],n===e.MouseTracker.wheelEventName&&{passive:!1,capture:!1});u(i),r.tracking=!0}}(this):c(this),this},getActivePointersListByType:function(i){var n,s,r=t[this.hash],o=r.activePointersLists.length;for(n=0;n<o;n++)if(r.activePointersLists[n].type===i)return r.activePointersLists[n];return s=new e.MouseTracker.GesturePointList(i),r.activePointersLists.push(s),s},getActivePointerCount:function(){var e,i=t[this.hash],n=i.activePointersLists.length,s=0;for(e=0;e<n;e++)s+=i.activePointersLists[e].getLength();return s},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var i,n,s,r,o,a,l=function(){try{return window.self!==window.top}catch(e){return!0}}();function h(e){try{return e.addEventListener&&e.removeEventListener}catch(e){return!1}}function u(e){var i,n,s,r,o,a=t[e.hash],l=a.activePointersLists.length;for(i=0;i<l;i++)if((s=a.activePointersLists[i]).getLength()>0){for(o=[],r=s.asArray(),n=0;n<r.length;n++)o.push(r[n]);for(n=0;n<o.length;n++)ee(e,s,o[n])}for(i=0;i<l;i++)a.activePointersLists.pop();a.sentDragEvent=!1}function c(i){var n,s,r=t[i.hash];if(r.tracking){for(s=0;s<e.MouseTracker.subscribeEvents.length;s++)n=e.MouseTracker.subscribeEvents[s],e.removeEvent(i.element,n,r[n],!1);u(i),r.tracking=!1}}function d(e,i){var n=t[e.hash];if("pointerevent"===i)return{upName:"pointerup",upHandler:n.pointerupcaptured,moveName:"pointermove",moveHandler:n.pointermovecaptured};if("mouse"===i)return{upName:"pointerup",upHandler:n.pointerupcaptured,moveName:"pointermove",moveHandler:n.pointermovecaptured};if("touch"===i)return{upName:"touchend",upHandler:n.touchendcaptured,moveName:"touchmove",moveHandler:n.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function p(t,i){var n,s;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents){if(!(s=t.getActivePointersListByType(i.type).getById(i.id))||!s.captured)return;try{t.element.releasePointerCapture(i.id)}catch(e){}}else t.element.releaseCapture();else n=d(t,e.MouseTracker.havePointerEvents?"pointerevent":i.type),l&&h(window.top)&&e.removeEvent(window.top,n.upName,n.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,n.moveName,n.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,n.upName,n.upHandler,!0);ie(t,i,!1)}function m(t){return e.MouseTracker.havePointerEvents?t.pointerId:e.MouseTracker.mousePointerId}function g(t){return e.MouseTracker.havePointerEvents?t.pointerType||(e.Browser.vendor===e.BROWSERS.IE?"mouse":""):"mouse"}function f(t){return!e.MouseTracker.havePointerEvents||t.isPrimary}function v(t){return e.getMousePosition(t)}function y(e,t){return _(v(e),t)}function _(t,i){var n=e.getElementOffset(i);return t.minus(n)}function w(t,i){return new e.Point((t.x+i.x)/2,(t.y+i.y)/2)}function b(t,i){var n={originalEvent:i,eventType:"click",pointerType:"mouse",isEmulated:!1};te(t,n),n.preventDefault&&!n.defaultPrevented&&e.cancelEvent(i),n.stopPropagation&&e.stopEvent(i)}function x(t,i){var n={originalEvent:i,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};te(t,n),n.preventDefault&&!n.defaultPrevented&&e.cancelEvent(i),n.stopPropagation&&e.stopEvent(i)}function k(t,i){var n=null,s={originalEvent:i,eventType:"keydown",pointerType:"",isEmulated:!1};te(t,s),!t.keyDownHandler||s.preventGesture||s.defaultPrevented||(n={eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefault:s.preventDefault||s.defaultPrevented,userData:t.userData},t.keyDownHandler(n)),(n&&n.preventDefault||s.preventDefault&&!s.defaultPrevented)&&e.cancelEvent(i),s.stopPropagation&&e.stopEvent(i)}function T(t,i){var n=null,s={originalEvent:i,eventType:"keyup",pointerType:"",isEmulated:!1};te(t,s),!t.keyUpHandler||s.preventGesture||s.defaultPrevented||(n={eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefault:s.preventDefault||s.defaultPrevented,userData:t.userData},t.keyUpHandler(n)),(n&&n.preventDefault||s.preventDefault&&!s.defaultPrevented)&&e.cancelEvent(i),s.stopPropagation&&e.stopEvent(i)}function S(t,i){var n=null,s={originalEvent:i,eventType:"keypress",pointerType:"",isEmulated:!1};te(t,s),!t.keyHandler||s.preventGesture||s.defaultPrevented||(n={eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefault:s.preventDefault||s.defaultPrevented,userData:t.userData},t.keyHandler(n)),(n&&n.preventDefault||s.preventDefault&&!s.defaultPrevented)&&e.cancelEvent(i),s.stopPropagation&&e.stopEvent(i)}function E(e,t){var i={originalEvent:t,eventType:"focus",pointerType:"",isEmulated:!1};te(e,i),e.focusHandler&&!i.preventGesture&&e.focusHandler({eventSource:e,originalEvent:t,userData:e.userData})}function C(e,t){var i={originalEvent:t,eventType:"blur",pointerType:"",isEmulated:!1};te(e,i),e.blurHandler&&!i.preventGesture&&e.blurHandler({eventSource:e,originalEvent:t,userData:e.userData})}function P(t,i){var n=null,s={originalEvent:i,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};te(t,s),!t.contextMenuHandler||s.preventGesture||s.defaultPrevented||(n={eventSource:t,position:_(v(i),t.element),originalEvent:s.originalEvent,preventDefault:s.preventDefault||s.defaultPrevented,userData:t.userData},t.contextMenuHandler(n)),(n&&n.preventDefault||s.preventDefault&&!s.defaultPrevented)&&e.cancelEvent(i),s.stopPropagation&&e.stopEvent(i)}function M(e,t){D(e,t,t)}function R(t,i){var n={target:i.target||i.srcElement,type:"wheel",shiftKey:i.shiftKey||!1,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX?i.pageX:i.clientX,pageY:i.pageY?i.pageY:i.clientY,deltaMode:"MozMousePixelScroll"===i.type?0:1,deltaX:0,deltaZ:0};"mousewheel"===e.MouseTracker.wheelEventName?n.deltaY=-i.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:n.deltaY=i.detail,D(t,n,i)}function D(t,i,n){var s,r,o=null;s=i.deltaY<0?1:-1,te(t,r={originalEvent:i,eventType:"wheel",pointerType:"mouse",isEmulated:i!==n}),!t.scrollHandler||r.preventGesture||r.defaultPrevented||(o={eventSource:t,pointerType:"mouse",position:y(i,t.element),scroll:s,shift:i.shiftKey,isTouchEvent:!1,originalEvent:n,preventDefault:r.preventDefault||r.defaultPrevented,userData:t.userData},t.scrollHandler(o)),r.stopPropagation&&e.stopEvent(n),(o&&o.preventDefault||r.preventDefault&&!r.defaultPrevented)&&e.cancelEvent(n)}function A(t,i){var n={id:e.MouseTracker.mousePointerId,type:"mouse"},s={originalEvent:i,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};te(t,s),i.target===t.element&&ie(t,n,!1),s.stopPropagation&&e.stopEvent(i)}function O(t,i){var n,s,r,o=i.changedTouches.length,a=t.getActivePointersListByType("touch");n=e.now(),a.getLength()>i.touches.length-o&&e.console.warn("Tracked touch contact count doesn't match event.touches.length");var l={originalEvent:i,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(te(t,l),s=0;s<o;s++)ne(t,l,r={id:i.changedTouches[s].identifier,type:"touch",isPrimary:0===a.getLength(),currentPos:v(i.changedTouches[s]),currentTime:n}),re(t,l,r,0),ie(t,r,!0);l.preventDefault&&!l.defaultPrevented&&e.cancelEvent(i),l.stopPropagation&&e.stopEvent(i)}function I(t,i){var n,s,r,o=i.changedTouches.length;n=e.now();var a={originalEvent:i,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(te(t,a),s=0;s<o;s++)oe(t,a,r={id:i.changedTouches[s].identifier,type:"touch",currentPos:v(i.changedTouches[s]),currentTime:n},0),ie(t,r,!1),se(t,a,r);a.preventDefault&&!a.defaultPrevented&&e.cancelEvent(i),a.stopPropagation&&e.stopEvent(i)}function F(t,i){var n,s,r=i.changedTouches.length;n=e.now();var o={originalEvent:i,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(te(t,o),s=0;s<r;s++)ae(t,o,{id:i.changedTouches[s].identifier,type:"touch",currentPos:v(i.changedTouches[s]),currentTime:n});o.preventDefault&&!o.defaultPrevented&&e.cancelEvent(i),o.stopPropagation&&e.stopEvent(i)}function j(t,i){var n,s=i.changedTouches.length,r={originalEvent:i,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(te(t,r),n=0;n<s;n++)le(t,r,{id:i.changedTouches[n].identifier,type:"touch"});r.stopPropagation&&e.stopEvent(i)}function z(t,i){return e.eventIsCanceled(i)||i.preventDefault(),!1}function N(t,i){return e.eventIsCanceled(i)||i.preventDefault(),!1}function L(t,i){var n={originalEvent:i,eventType:"gotpointercapture",pointerType:g(i),isEmulated:!1};te(t,n),i.target===t.element&&ie(t,{id:i.pointerId,type:g(i)},!0),n.stopPropagation&&e.stopEvent(i)}function B(t,i){var n={originalEvent:i,eventType:"lostpointercapture",pointerType:g(i),isEmulated:!1};te(t,n),i.target===t.element&&ie(t,{id:i.pointerId,type:g(i)},!1),n.stopPropagation&&e.stopEvent(i)}function W(t,i){var n={id:m(i),type:g(i),isPrimary:f(i),currentPos:v(i),currentTime:e.now()},s={originalEvent:i,eventType:"pointerenter",pointerType:n.type,isEmulated:!1};te(t,s),ne(t,s,n)}function q(t,i){var n={id:m(i),type:g(i),isPrimary:f(i),currentPos:v(i),currentTime:e.now()},s={originalEvent:i,eventType:"pointerleave",pointerType:n.type,isEmulated:!1};te(t,s),se(t,s,n)}function $(t,i){var n={id:m(i),type:g(i),isPrimary:f(i),currentPos:v(i),currentTime:e.now()},s={originalEvent:i,eventType:"pointerover",pointerType:n.type,isEmulated:!1};te(t,s),function(e,t,i){var n,s;n=e.getActivePointersListByType(i.type),(s=n.getById(i.id))?i=s:(i.captured=!1,i.insideElementPressed=!1);e.overHandler&&e.overHandler({eventSource:e,pointerType:i.type,position:_(i.currentPos,e.element),buttons:n.buttons,pointers:e.getActivePointerCount(),insideElementPressed:i.insideElementPressed,buttonDownAny:0!==n.buttons,isTouchEvent:"touch"===i.type,originalEvent:t.originalEvent,userData:e.userData})}(t,s,n),s.preventDefault&&!s.defaultPrevented&&e.cancelEvent(i),s.stopPropagation&&e.stopEvent(i)}function V(t,i){var n={id:m(i),type:g(i),isPrimary:f(i),currentPos:v(i),currentTime:e.now()},s={originalEvent:i,eventType:"pointerout",pointerType:n.type,isEmulated:!1};te(t,s),function(e,t,i){var n,s;n=e.getActivePointersListByType(i.type),(s=n.getById(i.id))?i=s:(i.captured=!1,i.insideElementPressed=!1);e.outHandler&&e.outHandler({eventSource:e,pointerType:i.type,position:i.currentPos&&_(i.currentPos,e.element),buttons:n.buttons,pointers:e.getActivePointerCount(),insideElementPressed:i.insideElementPressed,buttonDownAny:0!==n.buttons,isTouchEvent:"touch"===i.type,originalEvent:t.originalEvent,userData:e.userData})}(t,s,n),s.preventDefault&&!s.defaultPrevented&&e.cancelEvent(i),s.stopPropagation&&e.stopEvent(i)}function H(t,i){var n={id:m(i),type:g(i),isPrimary:f(i),currentPos:v(i),currentTime:e.now()},s=e.MouseTracker.havePointerEvents&&"touch"===n.type&&e.Browser.vendor!==e.BROWSERS.IE,r={originalEvent:i,eventType:"pointerdown",pointerType:n.type,isEmulated:!1};te(t,r),re(t,r,n,i.button),r.preventDefault&&!r.defaultPrevented&&e.cancelEvent(i),r.stopPropagation&&e.stopEvent(i),r.shouldCapture&&(s?ie(t,n,!0):function(t,i){var n;if(e.MouseTracker.havePointerCapture)if(e.MouseTracker.havePointerEvents)try{t.element.setPointerCapture(i.id)}catch(t){return void e.console.warn("setPointerCapture() called on invalid pointer ID")}else t.element.setCapture(!0);else n=d(t,e.MouseTracker.havePointerEvents?"pointerevent":i.type),l&&h(window.top)&&e.addEvent(window.top,n.upName,n.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,n.upName,n.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,n.moveName,n.moveHandler,!0);ie(t,i,!0)}(t,n))}function U(e,t){Z(e,t)}function G(t,i){t.getActivePointersListByType(g(i)).getById(i.pointerId)&&Z(t,i),e.stopEvent(i)}function Z(t,i){var n,s={originalEvent:i,eventType:"pointerup",pointerType:(n={id:m(i),type:g(i),isPrimary:f(i),currentPos:v(i),currentTime:e.now()}).type,isEmulated:!1};te(t,s),oe(t,s,n,i.button),s.preventDefault&&!s.defaultPrevented&&e.cancelEvent(i),s.stopPropagation&&e.stopEvent(i),s.shouldReleaseCapture&&(i.target===t.element?p(t,n):ie(t,n,!1))}function X(e,t){K(e,t)}function Y(t,i){t.getActivePointersListByType(g(i)).getById(i.pointerId)&&K(t,i),e.stopEvent(i)}function K(t,i){var n={id:m(i),type:g(i),isPrimary:f(i),currentPos:v(i),currentTime:e.now()},s={originalEvent:i,eventType:"pointermove",pointerType:n.type,isEmulated:!1};te(t,s),ae(t,s,n),s.preventDefault&&!s.defaultPrevented&&e.cancelEvent(i),s.stopPropagation&&e.stopEvent(i)}function Q(t,i){var n={id:i.pointerId,type:g(i)},s={originalEvent:i,eventType:"pointercancel",pointerType:n.type,isEmulated:!1};te(t,s),le(t,s,n),s.stopPropagation&&e.stopEvent(i)}function J(e,t){return t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function ee(t,i,n){var s,r=i.getById(n.id);return r?(r.captured&&(e.console.warn("stopTrackingPointer() called on captured pointer"),p(t,r)),("mouse"===i.type||"pen"===i.type)&&i.contacts>0&&i.removeContact(),s=i.removeById(n.id)):s=i.getLength(),s}function te(t,i){i.eventSource=t,i.eventPhase=i.originalEvent&&void 0!==i.originalEvent.eventPhase?i.originalEvent.eventPhase:0,i.defaultPrevented=e.eventIsCanceled(i.originalEvent),i.shouldCapture=!1,i.shouldReleaseCapture=!1,i.userData=t.userData,function(e,t){switch(t.eventType){case"pointermove":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!1,t.preventGesture=!e.hasGestureHandlers,t.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!1,t.preventGesture=!1,t.stopPropagation=!1;break;case"pointerdown":case"pointerup":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!1,t.preventGesture=!e.hasGestureHandlers,t.stopPropagation=!1;break;case"wheel":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!1,t.preventGesture=!e.hasScrollHandler,t.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":t.isStoppable=!0,t.isCancelable=!1,t.preventDefault=!1,t.preventGesture=!1,t.stopPropagation=!1;break;case"click":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!!e.clickHandler,t.preventGesture=!1,t.stopPropagation=!1;break;case"dblclick":t.isStoppable=!0,t.isCancelable=!0,t.preventDefault=!!e.dblClickHandler,t.preventGesture=!1,t.stopPropagation=!1;break;case"focus":case"blur":case"pointerenter":case"pointerleave":default:t.isStoppable=!1,t.isCancelable=!1,t.preventDefault=!1,t.preventGesture=!1,t.stopPropagation=!1}}(t,i),t.preProcessEventHandler&&t.preProcessEventHandler(i)}function ie(t,i,n){var s=t.getActivePointersListByType(i.type),r=s.getById(i.id);r?n&&!r.captured?(r.captured=!0,s.captureCount++):!n&&r.captured&&(r.captured=!1,s.captureCount--,s.captureCount<0&&(s.captureCount=0,e.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):e.console.warn("updatePointerCaptured() called on untracked pointer")}function ne(e,t,i){var n,s=e.getActivePointersListByType(i.type);(n=s.getById(i.id))?(n.insideElement=!0,n.lastPos=n.currentPos,n.lastTime=n.currentTime,n.currentPos=i.currentPos,n.currentTime=i.currentTime,i=n):(i.captured=!1,i.insideElementPressed=!1,i.insideElement=!0,J(s,i)),e.enterHandler&&e.enterHandler({eventSource:e,pointerType:i.type,position:_(i.currentPos,e.element),buttons:s.buttons,pointers:e.getActivePointerCount(),insideElementPressed:i.insideElementPressed,buttonDownAny:0!==s.buttons,isTouchEvent:"touch"===i.type,originalEvent:t.originalEvent,userData:e.userData})}function se(e,t,i){var n,s,r=e.getActivePointersListByType(i.type);(n=r.getById(i.id))?(n.captured?(n.insideElement=!1,n.lastPos=n.currentPos,n.lastTime=n.currentTime,n.currentPos=i.currentPos,n.currentTime=i.currentTime):ee(e,r,n),i=n):(i.captured=!1,i.insideElementPressed=!1),(e.leaveHandler||e.exitHandler)&&(s={eventSource:e,pointerType:i.type,position:i.currentPos&&_(i.currentPos,e.element),buttons:r.buttons,pointers:e.getActivePointerCount(),insideElementPressed:i.insideElementPressed,buttonDownAny:0!==r.buttons,isTouchEvent:"touch"===i.type,originalEvent:t.originalEvent,userData:e.userData},e.leaveHandler&&e.leaveHandler(s),e.exitHandler&&e.exitHandler(s))}function re(i,n,s,r){var o,a=t[i.hash],l=i.getActivePointersListByType(s.type);return void 0!==n.originalEvent.buttons?l.buttons=n.originalEvent.buttons:0===r?l.buttons|=1:1===r?l.buttons|=4:2===r?l.buttons|=2:3===r?l.buttons|=8:4===r?l.buttons|=16:5===r&&(l.buttons|=32),0!==r?(n.shouldCapture=!1,n.shouldReleaseCapture=!1,void(!i.nonPrimaryPressHandler||n.preventGesture||n.defaultPrevented||(n.preventDefault=!0,i.nonPrimaryPressHandler({eventSource:i,pointerType:s.type,position:_(s.currentPos,i.element),button:r,buttons:l.buttons,isTouchEvent:"touch"===s.type,originalEvent:n.originalEvent,userData:i.userData})))):(o=l.getById(s.id))?(o.insideElementPressed=!0,o.insideElement=!0,o.originalTarget=n.originalEvent.target,o.contactPos=s.currentPos,o.contactTime=s.currentTime,o.lastPos=o.currentPos,o.lastTime=o.currentTime,o.currentPos=s.currentPos,o.currentTime=s.currentTime,s=o,l.addContact(),void(n.preventGesture||n.defaultPrevented?(n.shouldCapture=!1,n.shouldReleaseCapture=!1):(n.shouldCapture=!0,n.shouldReleaseCapture=!1,n.preventDefault=!0,(i.dragHandler||i.dragEndHandler||i.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(i,s),1===l.contacts?i.pressHandler&&!n.preventGesture&&i.pressHandler({eventSource:i,pointerType:s.type,position:_(s.contactPos,i.element),buttons:l.buttons,isTouchEvent:"touch"===s.type,originalEvent:n.originalEvent,userData:i.userData}):2===l.contacts&&i.pinchHandler&&"touch"===s.type&&(a.pinchGPoints=l.asArray(),a.lastPinchDist=a.currentPinchDist=a.pinchGPoints[0].currentPos.distanceTo(a.pinchGPoints[1].currentPos),a.lastPinchCenter=a.currentPinchCenter=w(a.pinchGPoints[0].currentPos,a.pinchGPoints[1].currentPos))))):(e.console.warn("pointerdown event on untracked pointer"),s.captured=!1,s.insideElementPressed=!0,s.insideElement=!0,s.originalTarget=n.originalEvent.target,void J(l,s))}function oe(i,n,s,r){var o,a,l,h,u=t[i.hash],c=i.getActivePointersListByType(s.type),d=!1;if(void 0!==n.originalEvent.buttons?c.buttons=n.originalEvent.buttons:0===r?c.buttons^=-2:1===r?c.buttons^=-5:2===r?c.buttons^=-3:3===r?c.buttons^=-9:4===r?c.buttons^=-17:5===r&&(c.buttons^=-33),n.shouldCapture=!1,0!==r)return n.shouldReleaseCapture=!1,void(!i.nonPrimaryReleaseHandler||n.preventGesture||n.defaultPrevented||(n.preventDefault=!0,i.nonPrimaryReleaseHandler({eventSource:i,pointerType:s.type,position:_(s.currentPos,i.element),button:r,buttons:c.buttons,isTouchEvent:"touch"===s.type,originalEvent:n.originalEvent,userData:i.userData})));(l=c.getById(s.id))?(c.removeContact(),l.captured&&(d=!0),l.lastPos=l.currentPos,l.lastTime=l.currentTime,l.currentPos=s.currentPos,l.currentTime=s.currentTime,l.insideElement||ee(i,c,l),o=l.currentPos,a=l.currentTime):(e.console.warn("updatePointerUp(): pointerup on untracked gPoint"),s.captured=!1,s.insideElementPressed=!1,s.insideElement=!0,J(c,s),l=s),n.preventGesture||n.defaultPrevented||(d?(n.shouldReleaseCapture=!0,n.preventDefault=!0,(i.dragHandler||i.dragEndHandler||i.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(i,l),0===c.contacts?(i.releaseHandler&&i.releaseHandler({eventSource:i,pointerType:l.type,position:_(o,i.element),buttons:c.buttons,insideElementPressed:l.insideElementPressed,insideElementReleased:l.insideElement,isTouchEvent:"touch"===l.type,originalEvent:n.originalEvent,userData:i.userData}),i.dragEndHandler&&u.sentDragEvent&&i.dragEndHandler({eventSource:i,pointerType:l.type,position:_(l.currentPos,i.element),speed:l.speed,direction:l.direction,shift:n.originalEvent.shiftKey,isTouchEvent:"touch"===l.type,originalEvent:n.originalEvent,userData:i.userData}),u.sentDragEvent=!1,(i.clickHandler||i.dblClickHandler)&&l.insideElement&&(h=a-l.contactTime<=i.clickTimeThreshold&&l.contactPos.distanceTo(o)<=i.clickDistThreshold,i.clickHandler&&i.clickHandler({eventSource:i,pointerType:l.type,position:_(l.currentPos,i.element),quick:h,shift:n.originalEvent.shiftKey,isTouchEvent:"touch"===l.type,originalEvent:n.originalEvent,originalTarget:l.originalTarget,userData:i.userData}),i.dblClickHandler&&h&&(c.clicks++,1===c.clicks?(u.lastClickPos=o,u.dblClickTimeOut=setTimeout((function(){c.clicks=0}),i.dblClickTimeThreshold)):2===c.clicks&&(clearTimeout(u.dblClickTimeOut),c.clicks=0,u.lastClickPos.distanceTo(o)<=i.dblClickDistThreshold&&i.dblClickHandler({eventSource:i,pointerType:l.type,position:_(l.currentPos,i.element),shift:n.originalEvent.shiftKey,isTouchEvent:"touch"===l.type,originalEvent:n.originalEvent,userData:i.userData}),u.lastClickPos=null)))):2===c.contacts&&i.pinchHandler&&"touch"===l.type&&(u.pinchGPoints=c.asArray(),u.lastPinchDist=u.currentPinchDist=u.pinchGPoints[0].currentPos.distanceTo(u.pinchGPoints[1].currentPos),u.lastPinchCenter=u.currentPinchCenter=w(u.pinchGPoints[0].currentPos,u.pinchGPoints[1].currentPos))):(n.shouldReleaseCapture=!1,i.releaseHandler&&(i.releaseHandler({eventSource:i,pointerType:l.type,position:_(o,i.element),buttons:c.buttons,insideElementPressed:l.insideElementPressed,insideElementReleased:l.insideElement,isTouchEvent:"touch"===l.type,originalEvent:n.originalEvent,userData:i.userData}),n.preventDefault=!0)))}function ae(e,i,n){var s,r,o,a=t[e.hash],l=e.getActivePointersListByType(n.type);void 0!==i.originalEvent.buttons&&(l.buttons=i.originalEvent.buttons),(s=l.getById(n.id))&&(s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=n.currentPos,s.currentTime=n.currentTime,i.shouldCapture=!1,i.shouldReleaseCapture=!1,e.stopHandler&&"mouse"===n.type&&(clearTimeout(e.stopTimeOut),e.stopTimeOut=setTimeout((function(){!function(e,t,i){e.stopHandler&&e.stopHandler({eventSource:e,pointerType:i,position:y(t,e.element),buttons:e.getActivePointersListByType(i).buttons,isTouchEvent:"touch"===i,originalEvent:t,userData:e.userData})}(e,i.originalEvent,n.type)}),e.stopDelay)),0===l.contacts?e.moveHandler&&e.moveHandler({eventSource:e,pointerType:n.type,position:_(n.currentPos,e.element),buttons:l.buttons,isTouchEvent:"touch"===n.type,originalEvent:i.originalEvent,userData:e.userData}):1===l.contacts?(e.moveHandler&&(s=l.asArray()[0],e.moveHandler({eventSource:e,pointerType:s.type,position:_(s.currentPos,e.element),buttons:l.buttons,isTouchEvent:"touch"===s.type,originalEvent:i.originalEvent,userData:e.userData})),!e.dragHandler||i.preventGesture||i.defaultPrevented||(o=(s=l.asArray()[0]).currentPos.minus(s.lastPos),e.dragHandler({eventSource:e,pointerType:s.type,position:_(s.currentPos,e.element),buttons:l.buttons,delta:o,speed:s.speed,direction:s.direction,shift:i.originalEvent.shiftKey,isTouchEvent:"touch"===s.type,originalEvent:i.originalEvent,userData:e.userData}),i.preventDefault=!0,a.sentDragEvent=!0)):2===l.contacts&&(e.moveHandler&&(r=l.asArray(),e.moveHandler({eventSource:e,pointerType:r[0].type,position:_(w(r[0].currentPos,r[1].currentPos),e.element),buttons:l.buttons,isTouchEvent:"touch"===r[0].type,originalEvent:i.originalEvent,userData:e.userData})),!e.pinchHandler||"touch"!==n.type||i.preventGesture||i.defaultPrevented||(o=a.pinchGPoints[0].currentPos.distanceTo(a.pinchGPoints[1].currentPos))!==a.currentPinchDist&&(a.lastPinchDist=a.currentPinchDist,a.currentPinchDist=o,a.lastPinchCenter=a.currentPinchCenter,a.currentPinchCenter=w(a.pinchGPoints[0].currentPos,a.pinchGPoints[1].currentPos),e.pinchHandler({eventSource:e,pointerType:"touch",gesturePoints:a.pinchGPoints,lastCenter:_(a.lastPinchCenter,e.element),center:_(a.currentPinchCenter,e.element),lastDistance:a.lastPinchDist,distance:a.currentPinchDist,shift:i.originalEvent.shiftKey,originalEvent:i.originalEvent,userData:e.userData}),i.preventDefault=!0)))}function le(e,t,i){var n,s=e.getActivePointersListByType(i.type);(n=s.getById(i.id))&&ee(e,s,n)}e.MouseTracker.gesturePointVelocityTracker=(i=[],n=0,s=0,r=function(e,t){return e.hash.toString()+t.type+t.id.toString()},o=function(){var t,n,r,o,a,l,h=i.length,u=e.now();for(o=u-s,s=u,t=0;t<h;t++)(r=(n=i[t]).gPoint).direction=Math.atan2(r.currentPos.y-n.lastPos.y,r.currentPos.x-n.lastPos.x),a=n.lastPos.distanceTo(r.currentPos),n.lastPos=r.currentPos,l=1e3*a/(o+1),r.speed=.75*l+.25*r.speed},{addPoint:function(t,a){var l=r(t,a);i.push({guid:l,gPoint:a,lastPos:a.currentPos}),1===i.length&&(s=e.now(),n=window.setInterval(o,50))},removePoint:function(e,t){var s,o=r(e,t),a=i.length;for(s=0;s<a;s++)if(i[s].guid===o){i.splice(s,1),0==--a&&window.clearInterval(n);break}}}),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",e.MouseTracker.wheelEventName],"DOMMouseScroll"===e.MouseTracker.wheelEventName&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.havePointerCapture=(a=document.createElement("div"),e.isFunction(a.setPointerCapture)&&e.isFunction(a.releasePointerCapture)),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(e.MouseTracker.havePointerEvents=!1,e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.havePointerCapture=function(){var t=document.createElement("div");return e.isFunction(t.setCapture)&&e.isFunction(t.releaseCapture)}(),e.MouseTracker.havePointerCapture&&e.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),e.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].id===e){this._gPoints.splice(t,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].id===e)return this._gPoints[t];return null},getPrimary:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].isPrimary)return this._gPoints[t];return null},addContact:function(){++this.contacts,this.contacts>1&&("mouse"===this.type||"pen"===this.type)&&(e.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(e.console.warn("GesturePointList.removeContact() Implausible contacts value"),this.contacts=0)}}}(t),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(t,i,n){var s=t.parentNode;"number"==typeof i&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer=void 0===i.attachToViewer||i.attachToViewer,this.autoFade=void 0===i.autoFade||i.autoFade,this.element=t,this.anchor=i.anchor,this.container=n,this.anchor===e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof i.top?i.top+"px":i.top,this.wrapper.style.left="number"==typeof i.left?i.left+"px":i.left,this.wrapper.style.height="number"==typeof i.height?i.height+"px":i.height,this.wrapper.style.width="number"==typeof i.width?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor===e.ControlAnchor.TOP_RIGHT||this.anchor===e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):s.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==e.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!==this.wrapper.style.display},setVisible:function(t){this.wrapper.style.display=t?this.anchor===e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(t){this.element[e.SIGNAL]&&e.Browser.vendor===e.BROWSERS.IE?e.setElementOpacity(this.element,t,!0):e.setElementOpacity(this.wrapper,t,!0)}}}(t),function(e){function t(e,t){var i,n=e.controls;for(i=n.length-1;i>=0;i--)if(n[i].element===t)return i;return-1}e.ControlDock=function(t){var i,n,s=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(1e6*Math.random()),container:e.makeNeutralElement("div"),controls:[]},t),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),n=0;n<s.length;n++)i=s[n],this.controls[i]=e.makeNeutralElement("div"),this.controls[i].style.position="absolute",i.match("left")&&(this.controls[i].style.left="0px"),i.match("right")&&(this.controls[i].style.right="0px"),i.match("top")&&(this.controls[i].style.top="0px"),i.match("bottom")&&(this.controls[i].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(i,n){var s=null;if(!(t(this,i=e.getElement(i))>=0)){switch(n.anchor){case e.ControlAnchor.TOP_RIGHT:s=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:s=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:s=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:s=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:s=this.container,i.style.margin="0px",i.style.padding="0px";break;default:case e.ControlAnchor.NONE:s=this.container,i.style.margin="0px",i.style.padding="0px"}this.controls.push(new e.Control(i,n,s)),i.style.display="inline-block"}},removeControl:function(i){var n=t(this,i=e.getElement(i));return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;e>=0;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;t>=0;t--)this.controls[t].setVisible(e);return this}}}(t),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(t),function(e){var t={},i=1;function n(t){return t=e.getElement(t),new e.Point(0===t.clientWidth?1:t.clientWidth,0===t.clientHeight?1:t.clientHeight)}function s(t,i){if(i instanceof e.Overlay)return i;var n=null;if(i.element)n=e.getElement(i.element);else{var s=i.id?i.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());(n=e.getElement(i.id))||((n=document.createElement("a")).href="#/overlay/"+s),n.id=s,e.addClass(n,i.className?i.className:"openseadragon-overlay")}var r=i.location,o=i.width,a=i.height;if(!r){var l=i.x,h=i.y;if(void 0!==i.px){var u=t.viewport.imageToViewportRectangle(new e.Rect(i.px,i.py,o||0,a||0));l=u.x,h=u.y,o=void 0!==o?u.width:void 0,a=void 0!==a?u.height:void 0}r=new e.Point(l,h)}var c=i.placement;return c&&"string"===e.type(c)&&(c=e.Placement[i.placement.toUpperCase()]),new e.Overlay({element:n,location:r,placement:c,onDraw:i.onDraw,checkResize:i.checkResize,width:o,height:a,rotationMode:i.rotationMode})}function r(e,t){var i;for(i=e.length-1;i>=0;i--)if(e[i].element===t)return i;return-1}function o(t,i){return e.requestAnimationFrame((function(){i(t)}))}function a(t){e.requestAnimationFrame((function(){!function(t){var i,n;if(t.controlsShouldFade){for(i=1-(e.now()-t.controlsFadeBeginTime)/t.controlsFadeLength,i=Math.min(1,i),i=Math.max(0,i),n=t.controls.length-1;n>=0;n--)t.controls[n].autoFade&&t.controls[n].setOpacity(i);i>0&&a(t)}}(t)}))}function l(t){t.autoHideControls&&(t.controlsShouldFade=!0,t.controlsFadeBeginTime=e.now()+t.controlsFadeDelay,window.setTimeout((function(){a(t)}),t.controlsFadeDelay))}function h(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;t>=0;t--)e.controls[t].setOpacity(1)}function u(){h(this)}function c(){l(this)}function d(e){var t={tracker:e.eventSource,position:e.position,originalEvent:e.originalEvent,preventDefault:e.preventDefault};this.raiseEvent("canvas-contextmenu",t),e.preventDefault=t.preventDefault}function p(t){var i={originalEvent:t.originalEvent,preventDefaultAction:!1,preventVerticalPan:t.preventVerticalPan,preventHorizontalPan:t.preventHorizontalPan};if(this.raiseEvent("canvas-key",i),i.preventDefaultAction||t.ctrl||t.alt||t.meta)t.preventDefault=!1;else switch(t.keyCode){case 38:i.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 40:i.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 37:i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 39:i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),t.preventDefault=!0;break;default:t.preventDefault=!1}}function m(t){var i={originalEvent:t.originalEvent,preventDefaultAction:!1,preventVerticalPan:t.preventVerticalPan,preventHorizontalPan:t.preventHorizontalPan};if(this.raiseEvent("canvas-key",i),i.preventDefaultAction||t.ctrl||t.alt||t.meta)t.preventDefault=!1;else switch(t.keyCode){case 43:case 61:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),t.preventDefault=!0;break;case 45:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),t.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),t.preventDefault=!0;break;case 119:case 87:i.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 115:case 83:i.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 97:i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 100:i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),t.preventDefault=!0;break;case 114:this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),t.preventDefault=!0;break;case 82:this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),t.preventDefault=!0;break;case 102:this.viewport.toggleFlip(),t.preventDefault=!0;break;case 106:this.goToPreviousPage();break;case 107:this.goToNextPage();break;default:t.preventDefault=!1}}function g(e){var t;document.activeElement===this.canvas||this.canvas.focus(),this.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var i={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,originalTarget:e.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",i),!i.preventDefaultAction&&this.viewport&&e.quick&&(t=this.gestureSettingsByDeviceType(e.pointerType)).clickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function f(e){var t,i={tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",i),!i.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function v(e){var t,i={tracker:e.eventSource,pointerType:e.pointerType,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",i),(t=this.gestureSettingsByDeviceType(e.pointerType)).dragToPan&&!i.preventDefaultAction&&this.viewport){if(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.flipped&&(e.delta.x=-e.delta.x),this.constrainDuringPan){var n=this.viewport.deltaPointsFromPixels(e.delta.negate());this.viewport.centerSpringX.target.value+=n.x,this.viewport.centerSpringY.target.value+=n.y;var s=this.viewport.getBounds(),r=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=n.x,this.viewport.centerSpringY.target.value-=n.y,s.x!==r.x&&(e.delta.x=0),s.y!==r.y&&(e.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),t.flickEnabled&&!this.constrainDuringPan)}}function y(t){var i={tracker:t.eventSource,pointerType:t.pointerType,position:t.position,speed:t.speed,direction:t.direction,shift:t.shift,originalEvent:t.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",i),!i.preventDefaultAction&&this.viewport){var n=this.gestureSettingsByDeviceType(t.pointerType);if(n.flickEnabled&&t.speed>=n.flickMinSpeed){var s=0;this.panHorizontal&&(s=n.flickMomentum*t.speed*Math.cos(t.direction));var r=0;this.panVertical&&(r=n.flickMomentum*t.speed*Math.sin(t.direction));var o=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),a=this.viewport.pointFromPixel(new e.Point(o.x-s,o.y-r));this.viewport.panTo(a,!1)}this.viewport.applyConstraints()}}function _(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function w(e){this.raiseEvent("canvas-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function b(e){this.raiseEvent("canvas-press",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function x(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function k(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function T(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function S(e){var t,i,n,s={tracker:e.eventSource,pointerType:e.pointerType,gesturePoints:e.gesturePoints,lastCenter:e.lastCenter,center:e.center,lastDistance:e.lastDistance,distance:e.distance,shift:e.shift,originalEvent:e.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};if(this.raiseEvent("canvas-pinch",s),this.viewport&&(!(t=this.gestureSettingsByDeviceType(e.pointerType)).pinchToZoom||s.preventDefaultPanAction&&s.preventDefaultZoomAction||(i=this.viewport.pointFromPixel(e.center,!0),s.preventDefaultZoomAction||this.viewport.zoomBy(e.distance/e.lastDistance,i,!0),t.zoomToRefPoint&&!s.preventDefaultPanAction&&(n=this.viewport.pointFromPixel(e.lastCenter,!0).minus(i),this.panHorizontal||(n.x=0),this.panVertical||(n.y=0),this.viewport.panBy(n,!0)),this.viewport.applyConstraints()),t.pinchRotate&&!s.preventDefaultRotateAction)){var r=Math.atan2(e.gesturePoints[0].currentPos.y-e.gesturePoints[1].currentPos.y,e.gesturePoints[0].currentPos.x-e.gesturePoints[1].currentPos.x),o=Math.atan2(e.gesturePoints[0].lastPos.y-e.gesturePoints[1].lastPos.y,e.gesturePoints[0].lastPos.x-e.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(r-o)*(180/Math.PI))}}function E(t){var i,n,s,r;(r=e.now())-this._lastScrollTime>this.minScrollDeltaTime?(this._lastScrollTime=r,i={tracker:t.eventSource,position:t.position,scroll:t.scroll,shift:t.shift,originalEvent:t.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",i),!i.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(t.position.x=this.viewport.getContainerSize().x-t.position.x),(n=this.gestureSettingsByDeviceType(t.pointerType)).scrollToZoom&&(s=Math.pow(this.zoomPerScroll,t.scroll),this.viewport.zoomBy(s,n.zoomToRefPoint?this.viewport.pointFromPixel(t.position,!0):null),this.viewport.applyConstraints())),t.preventDefault=i.preventDefault):t.preventDefault=!0}function C(e){t[this.hash].mouseInside=!0,h(this),this.raiseEvent("container-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function P(e){e.pointers<1&&(t[this.hash].mouseInside=!1,t[this.hash].animating||l(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function M(e){!function(e){if(e._opening||!t[e.hash])return;if(e.autoResize){var i=n(e.container),s=t[e.hash].prevContainerSize;if(!i.equals(s)){var r=e.viewport;if(e.preserveImageSizeOnResize){var o=s.x/i.x,a=r.getZoom()*o,u=r.getCenter();r.resize(i,!1),r.zoomTo(a,null,!0),r.panTo(u,!0)}else{var c=r.getBounds();r.resize(i,!0),r.fitBoundsWithConstraints(c,!0)}t[e.hash].prevContainerSize=i,t[e.hash].forceRedraw=!0}}var d=e.viewport.update(),p=e.world.update()||d;d&&e.raiseEvent("viewport-change");e.referenceStrip&&(p=e.referenceStrip.update(e.viewport)||p);!t[e.hash].animating&&p&&(e.raiseEvent("animation-start"),h(e));(p||t[e.hash].forceRedraw||e.world.needsDraw())&&(!function(e){e.imageLoader.clear(),e.drawer.clear(),e.world.draw(),e.raiseEvent("update-viewport",{})}(e),e._drawOverlays(),e.navigator&&e.navigator.update(e.viewport),t[e.hash].forceRedraw=!1,p&&e.raiseEvent("animation"));t[e.hash].animating&&!p&&(e.raiseEvent("animation-finish"),t[e.hash].mouseInside||l(e));t[e.hash].animating=p}(e),e.isOpen()?e._updateRequestId=o(e,M):e._updateRequestId=!1}function R(e,t){return e?e+t:t}function D(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=this.zoomPerSecond,t[this.hash].zooming=!0,I(this)}function A(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=1/this.zoomPerSecond,t[this.hash].zooming=!0,I(this)}function O(){t[this.hash].zooming=!1}function I(t){e.requestAnimationFrame(e.delegate(t,F))}function F(){var i,n,s;t[this.hash].zooming&&this.viewport&&(n=(i=e.now())-t[this.hash].lastZoomTime,s=Math.pow(t[this.hash].zoomFactor,n/1e3),this.viewport.zoomBy(s),this.viewport.applyConstraints(),t[this.hash].lastZoomTime=i,I(this))}function j(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function z(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function N(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function L(){this.viewport&&this.viewport.goHome()}function B(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function W(){if(this.viewport){var t=this.viewport.getRotation();t=this.viewport.flipped?e.positiveModulo(t+this.rotationIncrement,360):e.positiveModulo(t-this.rotationIncrement,360),this.viewport.setRotation(t)}}function q(){if(this.viewport){var t=this.viewport.getRotation();t=this.viewport.flipped?e.positiveModulo(t-this.rotationIncrement,360):e.positiveModulo(t+this.rotationIncrement,360),this.viewport.setRotation(t)}}function $(){this.viewport.toggleFlip()}e.Viewer=function(s){var r,a,h=arguments,u=this;if(e.isPlainObject(s)||(s={id:h[0],xmlPath:h.length>1?h[1]:void 0,prefixUrl:h.length>2?h[2]:void 0,controls:h.length>3?h[3]:void 0,overlays:h.length>4?h[4]:void 0}),s.config&&(e.extend(!0,s,s.config),delete s.config),e.extend(!0,this,{id:s.id,hash:s.hash||i++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,s),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==t[this.hash]&&e.console.warn("Hash "+this.hash+" has already been used."),t[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",(function(t){var i=e.getString("Errors.OpenFailed",t.eventSource,t.message);u._showMessage(i)})),e.ControlDock.call(this,s),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(a=this.canvas.style).width="100%",a.height="100%",a.overflow="hidden",a.position="absolute",a.top="0px",a.left="0px",e.setElementTouchActionNone(this.canvas),""!==s.tabIndex&&(this.canvas.tabIndex=void 0===s.tabIndex?0:s.tabIndex),this.container.className="openseadragon-container",function(e){e.width="100%",e.height="100%",e.position="relative",e.overflow="hidden",e.left="0px",e.top="0px",e.textAlign="left"}(this.container.style),e.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:e.delegate(this,d),keyDownHandler:e.delegate(this,p),keyHandler:e.delegate(this,m),clickHandler:e.delegate(this,g),dblClickHandler:e.delegate(this,f),dragHandler:e.delegate(this,v),dragEndHandler:e.delegate(this,y),enterHandler:e.delegate(this,_),leaveHandler:e.delegate(this,w),pressHandler:e.delegate(this,b),releaseHandler:e.delegate(this,x),nonPrimaryPressHandler:e.delegate(this,k),nonPrimaryReleaseHandler:e.delegate(this,T),scrollHandler:e.delegate(this,E),pinchHandler:e.delegate(this,S)}),this.outerTracker=new e.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,C),leaveHandler:e.delegate(this,P)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),t[this.hash].prevContainerSize=n(this.container),this.world=new e.World({viewer:this}),this.world.addHandler("add-item",(function(e){u.source=u.world.getItemAt(0).source,t[u.hash].forceRedraw=!0,u._updateRequestId||(u._updateRequestId=o(u,M))})),this.world.addHandler("remove-item",(function(e){u.world.getItemCount()?u.source=u.world.getItemAt(0).source:u.source=null,t[u.hash].forceRedraw=!0})),this.world.addHandler("metrics-change",(function(e){u.viewport&&u.viewport._setContentBounds(u.world.getHomeBounds(),u.world.getContentFactor())})),this.world.addHandler("item-index-change",(function(e){u.source=u.world.getItemAt(0).source})),this.viewport=new e.Viewport({containerSize:t[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:s.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(r=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(r,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(r=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(r,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new e.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),r=0;r<this.customControls.length;r++)this.addControl(this.customControls[r].id,{anchor:this.customControls[r].anchor});e.requestAnimationFrame((function(){l(u)})),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),e._viewers.set(this.element,this)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(t){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(t)},openTileSource:function(t){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(t)},open:function(t,i){var n=this;if(this.close(),!t)return this;if(this.sequenceMode&&e.isArray(t))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===i||isNaN(i)||(this.initialPage=i),this.tileSources=t,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(e.isArray(t)||(t=[t]),!t.length)return this;this._opening=!0;for(var r,o=t.length,a=0,l=0,h=function(){if(a+l===o)if(a){!n._firstOpen&&n.preserveViewport||(n.viewport.goHome(!0),n.viewport.update()),n._firstOpen=!1;var e=t[0];if(e.tileSource&&(e=e.tileSource),n.overlays&&!n.preserveOverlays)for(var i=0;i<n.overlays.length;i++)n.currentOverlays[i]=s(n,n.overlays[i]);n._drawOverlays(),n._opening=!1,n.raiseEvent("open",{source:e})}else n._opening=!1,n.raiseEvent("open-failed",r)},u=function(t){e.isPlainObject(t)&&t.tileSource||(t={tileSource:t}),void 0!==t.index&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete t.index),void 0===t.collectionImmediately&&(t.collectionImmediately=!0);var i=t.success;t.success=function(e){if(a++,t.tileSource.overlays)for(var s=0;s<t.tileSource.overlays.length;s++)n.addOverlay(t.tileSource.overlays[s]);i&&i(e),h()};var s=t.error;t.error=function(e){l++,r||(r=e),s&&s(e),h()},n.addTiledImage(t)},c=0;c<t.length;c++)u(t[c]);return this},close:function(){return t[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),t[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(t[this.hash]){if(this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),t[this.navigator.hash]=null,delete t[this.navigator.hash],this.navigator=null),this.removeAllHandlers(),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),t[this.hash]=null,delete t[this.hash],this.canvas=null,this.container=null,e._viewers.delete(this.element),this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.outerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){var e,t=this.controls.length;for(e=0;e<this.controls.length;e++)t=t&&this.controls[e].isVisible();return t},setControlsEnabled:function(e){return e?h(this):l(this),this.raiseEvent("controls-enabled",{enabled:e}),this},setDebugMode:function(e){for(var t=0;t<this.world.getItemCount();t++)this.world.getItemAt(t).debugMode=e;this.debugMode=e,this.forceRedraw()},isFullPage:function(){return t[this.hash].fullPage},setFullPage:function(i){var n,s,r=document.body,o=r.style,a=document.documentElement.style,l=this;if(i===this.isFullPage())return this;var h={fullPage:i,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",h),h.preventDefaultAction)return this;if(i){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=o.margin,this.docMargin=a.margin,o.margin="0",a.margin="0",this.bodyPadding=o.padding,this.docPadding=a.padding,o.padding="0",a.padding="0",this.bodyWidth=o.width,this.docWidth=a.width,o.width="100%",a.width="100%",this.bodyHeight=o.height,this.docHeight=a.height,o.height="100%",a.height="100%",this.bodyDisplay=o.display,o.display="block",this.previousBody=[],t[this.hash].prevElementParent=this.element.parentNode,t[this.hash].prevNextSibling=this.element.nextSibling,t[this.hash].prevElementWidth=this.element.style.width,t[this.hash].prevElementHeight=this.element.style.height,n=r.childNodes.length,s=0;s<n;s++)this.previousBody.push(r.childNodes[0]),r.removeChild(r.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,r.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),r.appendChild(this.element),this.element.style.height=e.getWindowSize().y+"px",this.element.style.width=e.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),t[this.hash].fullPage=!0,e.delegate(this,C)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,o.margin=this.bodyMargin,a.margin=this.docMargin,o.padding=this.bodyPadding,a.padding=this.docPadding,o.width=this.bodyWidth,a.width=this.docWidth,o.height=this.bodyHeight,a.height=this.docHeight,o.display=this.bodyDisplay,r.removeChild(this.element),n=this.previousBody.length,s=0;s<n;s++)r.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),t[this.hash].prevElementParent.insertBefore(this.element,t[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(r.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=t[this.hash].prevElementWidth,this.element.style.height=t[this.hash].prevElementHeight;var u=0,c=function(){e.setPageScroll(l.pageScroll);var t=e.getPageScroll();++u<10&&(t.x!==l.pageScroll.x||t.y!==l.pageScroll.y)&&e.requestAnimationFrame(c)};e.requestAnimationFrame(c),t[this.hash].fullPage=!1,e.delegate(this,P)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:i}),this},setFullScreen:function(t){var i=this;if(!e.supportsFullScreen)return this.setFullPage(t);if(e.isFullScreen()===t)return this;var n={fullScreen:t,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",n),n.preventDefaultAction)return this;if(t){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var s=function(){var t=e.isFullScreen();t||(e.removeEvent(document,e.fullScreenEventName,s),e.removeEvent(document,e.fullScreenErrorEventName,s),i.setFullPage(!1),i.isFullPage()&&(i.element.style.width=i.fullPageStyleWidth,i.element.style.height=i.fullPageStyleHeight)),i.navigator&&i.viewport&&setTimeout((function(){i.navigator.update(i.viewport)})),i.raiseEvent("full-screen",{fullScreen:t})};e.addEvent(document,e.fullScreenEventName,s),e.addEvent(document,e.fullScreenErrorEventName,s),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return"hidden"!==this.container.style.visibility},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addTiledImage:function(t){e.console.assert(t,"[Viewer.addTiledImage] options is required"),e.console.assert(t.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!t.replace||t.index>-1&&t.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var i=this;t.replace&&(t.replaceItem=i.world.getItemAt(t.index)),this._hideMessage(),void 0===t.placeholderFillStyle&&(t.placeholderFillStyle=this.placeholderFillStyle),void 0===t.opacity&&(t.opacity=this.opacity),void 0===t.preload&&(t.preload=this.preload),void 0===t.compositeOperation&&(t.compositeOperation=this.compositeOperation),void 0===t.crossOriginPolicy&&(t.crossOriginPolicy=void 0!==t.tileSource.crossOriginPolicy?t.tileSource.crossOriginPolicy:this.crossOriginPolicy),void 0===t.ajaxWithCredentials&&(t.ajaxWithCredentials=this.ajaxWithCredentials),void 0===t.loadTilesWithAjax&&(t.loadTilesWithAjax=this.loadTilesWithAjax),void 0===t.ajaxHeaders||null===t.ajaxHeaders?t.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(t.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(t.ajaxHeaders=e.extend({},this.ajaxHeaders,t.ajaxHeaders));var n={options:t};function s(e){for(var s=0;s<i._loadQueue.length;s++)if(i._loadQueue[s]===n){i._loadQueue.splice(s,1);break}0===i._loadQueue.length&&r(n),i.raiseEvent("add-item-failed",e),t.error&&t.error(e)}function r(e){i.collectionMode&&(i.world.arrange({immediately:e.options.collectionImmediately,rows:i.collectionRows,columns:i.collectionColumns,layout:i.collectionLayout,tileSize:i.collectionTileSize,tileMargin:i.collectionTileMargin}),i.world.setAutoRefigureSizes(!0))}function o(){for(var t,n,s;i._loadQueue.length&&(t=i._loadQueue[0]).tileSource;){if(i._loadQueue.splice(0,1),t.options.replace){var o=i.world.getIndexOfItem(t.options.replaceItem);-1!==o&&(t.options.index=o),i.world.removeItem(t.options.replaceItem)}n=new e.TiledImage({viewer:i,source:t.tileSource,viewport:i.viewport,drawer:i.drawer,tileCache:i.tileCache,imageLoader:i.imageLoader,x:t.options.x,y:t.options.y,width:t.options.width,height:t.options.height,fitBounds:t.options.fitBounds,fitBoundsPlacement:t.options.fitBoundsPlacement,clip:t.options.clip,placeholderFillStyle:t.options.placeholderFillStyle,opacity:t.options.opacity,preload:t.options.preload,degrees:t.options.degrees,flipped:t.options.flipped,compositeOperation:t.options.compositeOperation,springStiffness:i.springStiffness,animationTime:i.animationTime,minZoomImageRatio:i.minZoomImageRatio,wrapHorizontal:i.wrapHorizontal,wrapVertical:i.wrapVertical,immediateRender:i.immediateRender,blendTime:i.blendTime,alwaysBlend:i.alwaysBlend,minPixelRatio:i.minPixelRatio,smoothTileEdgesMinZoom:i.smoothTileEdgesMinZoom,iOSDevice:i.iOSDevice,crossOriginPolicy:t.options.crossOriginPolicy,ajaxWithCredentials:t.options.ajaxWithCredentials,loadTilesWithAjax:t.options.loadTilesWithAjax,ajaxHeaders:t.options.ajaxHeaders,debugMode:i.debugMode}),i.collectionMode&&i.world.setAutoRefigureSizes(!1),i.navigator&&(s=e.extend({},t.options,{replace:!1,originalTiledImage:n,tileSource:t.tileSource}),i.navigator.addTiledImage(s)),i.world.addItem(n,{index:t.options.index}),0===i._loadQueue.length&&r(t),1!==i.world.getItemCount()||i.preserveViewport||i.viewport.goHome(!0),t.options.success&&t.options.success({item:n})}}e.isArray(t.tileSource)?setTimeout((function(){s({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:t.tileSource,options:t})})):(this._loadQueue.push(n),function(t,i,n,s,r){var o=t;if("string"===e.type(i))if(i.match(/^\s*<.*>\s*$/))i=e.parseXml(i);else if(i.match(/^\s*[{[].*[}\]]\s*$/))try{var a=e.parseJSON(i);i=a}catch(e){}function l(e,t){e.ready?s(e):(e.addHandler("ready",(function(){s(e)})),e.addHandler("open-failed",(function(e){r({message:e.message,source:t})})))}setTimeout((function(){if("string"===e.type(i))(i=new e.TileSource({url:i,crossOriginPolicy:void 0!==n.crossOriginPolicy?n.crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,ajaxHeaders:n.ajaxHeaders?n.ajaxHeaders:t.ajaxHeaders,useCanvas:t.useCanvas,success:function(e){s(e.tileSource)}})).addHandler("open-failed",(function(e){r(e)}));else if(e.isPlainObject(i)||i.nodeType)if(void 0!==i.crossOriginPolicy||void 0===n.crossOriginPolicy&&void 0===t.crossOriginPolicy||(i.crossOriginPolicy=void 0!==n.crossOriginPolicy?n.crossOriginPolicy:t.crossOriginPolicy),void 0===i.ajaxWithCredentials&&(i.ajaxWithCredentials=t.ajaxWithCredentials),void 0===i.useCanvas&&(i.useCanvas=t.useCanvas),e.isFunction(i.getTileUrl)){var a=new e.TileSource(i);a.getTileUrl=i.getTileUrl,s(a)}else{var h=e.TileSource.determineType(o,i);if(!h)return void r({message:"Unable to load TileSource",source:i});var u=h.prototype.configure.apply(o,[i]);l(new h(u),i)}else l(i,i)}))}(this,t.tileSource,t,(function(e){n.tileSource=e,o()}),(function(e){e.options=t,s(e),o()})))},addSimpleImage:function(t){e.console.assert(t,"[Viewer.addSimpleImage] options is required"),e.console.assert(t.url,"[Viewer.addSimpleImage] options.url is required");var i=e.extend({},t,{tileSource:{type:"image",url:t.url}});delete i.url,this.addTiledImage(i)},addLayer:function(t){var i=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var n=e.extend({},t,{success:function(e){i.raiseEvent("add-layer",{options:t,drawer:e.item})},error:function(e){i.raiseEvent("add-layer-failed",e)}});return this.addTiledImage(n),this},getLayerAtLevel:function(t){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(t)},getLevelOfLayer:function(t){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(t)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(t,i){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(t,i)},removeLayer:function(t){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(t)},forceRedraw:function(){return t[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var t=e.delegate(this,u),i=e.delegate(this,c),n=e.delegate(this,this.goToNextPage),s=e.delegate(this,this.goToPreviousPage),r=this.navImages,o=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(o=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:R(this.prefixUrl,r.previous.REST),srcGroup:R(this.prefixUrl,r.previous.GROUP),srcHover:R(this.prefixUrl,r.previous.HOVER),srcDown:R(this.prefixUrl,r.previous.DOWN),onRelease:s,onFocus:t,onBlur:i}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:R(this.prefixUrl,r.next.REST),srcGroup:R(this.prefixUrl,r.next.GROUP),srcHover:R(this.prefixUrl,r.next.HOVER),srcDown:R(this.prefixUrl,r.next.DOWN),onRelease:n,onFocus:t,onBlur:i}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),o&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var t=e.delegate(this,D),i=e.delegate(this,O),n=e.delegate(this,j),s=e.delegate(this,A),r=e.delegate(this,z),o=e.delegate(this,L),a=e.delegate(this,B),l=e.delegate(this,W),h=e.delegate(this,q),d=e.delegate(this,$),p=e.delegate(this,u),m=e.delegate(this,c),g=this.navImages,f=[],v=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(v=!1),this.showZoomControl&&(f.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:R(this.prefixUrl,g.zoomIn.REST),srcGroup:R(this.prefixUrl,g.zoomIn.GROUP),srcHover:R(this.prefixUrl,g.zoomIn.HOVER),srcDown:R(this.prefixUrl,g.zoomIn.DOWN),onPress:t,onRelease:i,onClick:n,onEnter:t,onExit:i,onFocus:p,onBlur:m})),f.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:R(this.prefixUrl,g.zoomOut.REST),srcGroup:R(this.prefixUrl,g.zoomOut.GROUP),srcHover:R(this.prefixUrl,g.zoomOut.HOVER),srcDown:R(this.prefixUrl,g.zoomOut.DOWN),onPress:s,onRelease:i,onClick:r,onEnter:s,onExit:i,onFocus:p,onBlur:m}))),this.showHomeControl&&f.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:R(this.prefixUrl,g.home.REST),srcGroup:R(this.prefixUrl,g.home.GROUP),srcHover:R(this.prefixUrl,g.home.HOVER),srcDown:R(this.prefixUrl,g.home.DOWN),onRelease:o,onFocus:p,onBlur:m})),this.showFullPageControl&&f.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:R(this.prefixUrl,g.fullpage.REST),srcGroup:R(this.prefixUrl,g.fullpage.GROUP),srcHover:R(this.prefixUrl,g.fullpage.HOVER),srcDown:R(this.prefixUrl,g.fullpage.DOWN),onRelease:a,onFocus:p,onBlur:m})),this.showRotationControl&&(f.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:R(this.prefixUrl,g.rotateleft.REST),srcGroup:R(this.prefixUrl,g.rotateleft.GROUP),srcHover:R(this.prefixUrl,g.rotateleft.HOVER),srcDown:R(this.prefixUrl,g.rotateleft.DOWN),onRelease:l,onFocus:p,onBlur:m})),f.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:R(this.prefixUrl,g.rotateright.REST),srcGroup:R(this.prefixUrl,g.rotateright.GROUP),srcHover:R(this.prefixUrl,g.rotateright.HOVER),srcDown:R(this.prefixUrl,g.rotateright.DOWN),onRelease:h,onFocus:p,onBlur:m}))),this.showFlipControl&&f.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:R(this.prefixUrl,g.flip.REST),srcGroup:R(this.prefixUrl,g.flip.GROUP),srcHover:R(this.prefixUrl,g.flip.HOVER),srcDown:R(this.prefixUrl,g.flip.DOWN),onRelease:d,onFocus:p,onBlur:m})),v?(this.buttonGroup=new e.ButtonGroup({buttons:f,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",e.delegate(this,N)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT})):this.customButtons=f),this},currentPage:function(){return this._sequenceIndex},goToPage:function(e){return this.tileSources&&e>=0&&e<this.tileSources.length&&(this._sequenceIndex=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e),this.raiseEvent("page",{page:e})),this},addOverlay:function(t,i,n,o){var a;if(a=e.isPlainObject(t)?t:{element:t,location:i,placement:n,onDraw:o},t=e.getElement(a.element),r(this.currentOverlays,t)>=0)return this;var l=s(this,a);return this.currentOverlays.push(l),l.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:t,location:a.location,placement:a.placement}),this},updateOverlay:function(i,n,s){var o;return i=e.getElement(i),(o=r(this.currentOverlays,i))>=0&&(this.currentOverlays[o].update(n,s),t[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:i,location:n,placement:s})),this},removeOverlay:function(i){var n;return i=e.getElement(i),(n=r(this.currentOverlays,i))>=0&&(this.currentOverlays[n].destroy(),this.currentOverlays.splice(n,1),t[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:i})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return t[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(t){var i;return t=e.getElement(t),(i=r(this.currentOverlays,t))>=0?this.currentOverlays[i]:null},_updateSequenceButtons:function(e){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==e?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(e>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(t){this._hideMessage();var i=e.makeNeutralElement("div");i.appendChild(document.createTextNode(t)),this.messageDiv=e.makeCenteredNode(i),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){switch(e){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var e,t=this.currentOverlays.length;for(e=0;e<t;e++)this.currentOverlays[e].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),e.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){e.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var t=e.pixelDensityRatio,i=e.getCurrentPixelDensityRatio();t!==i&&(e.pixelDensityRatio=i,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var e=this._sequenceIndex-1;this.navPrevNextWrap&&e<0&&(e+=this.tileSources.length),this.goToPage(e)},goToNextPage:function(){var e=this._sequenceIndex+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)}})}(t),function(e){function t(e){var t={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};if(this.viewer.raiseEvent("navigator-click",t),!t.preventDefaultAction&&e.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var i=this.viewport.pointFromPixel(e.position);this.panVertical?this.panHorizontal||(i.x=this.viewer.viewport.getCenter(!0).x):i.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(i),this.viewer.viewport.applyConstraints()}}function i(e){var t={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",t),!t.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.flipped&&(e.delta.x=-e.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function s(e){var t={tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent,preventDefault:e.preventDefault};this.viewer.raiseEvent("navigator-scroll",t),e.preventDefault=t.preventDefault}function r(e,t){o(e,"rotate("+t+"deg)")}function o(e,t){e.style.webkitTransform=t,e.style.mozTransform=t,e.style.msTransform=t,e.style.oTransform=t,e.style.transform=t}e.Navigator=function(o){var a,l,h,u,c=o.viewer,d=this;function p(e){r(d.displayRegionContainer,e),r(d.displayRegion,-e),d.viewport.setRotation(e)}(o.id?(this.element=document.getElementById(o.id),o.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(o.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),o.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:o.autoFade},o.position&&("BOTTOM_RIGHT"===o.position?o.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"===o.position?o.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"===o.position?o.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"===o.position?o.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"===o.position&&(o.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,o.controlOptions.top=o.top,o.controlOptions.left=o.left,o.controlOptions.height=o.height,o.controlOptions.width=o.width))),this.element.id=o.id,this.element.className+=" navigator",(o=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},o,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:o.autoResize,minZoomImageRatio:1,background:o.background,opacity:o.opacity,borderColor:o.borderColor,displayRegionColor:o.displayRegionColor})).minPixelRatio=this.minPixelRatio=c.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),o.controlOptions.anchor!==e.ControlAnchor.NONE&&(h=this.element.style,u=this.borderWidth,h.margin="0px",h.border=u+"px solid "+o.borderColor,h.padding="0px",h.background=o.background,h.opacity=o.opacity,h.overflow="hidden"),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,t){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.overflow="hidden",e.border=t+"px solid "+o.displayRegionColor,e.margin="0px",e.padding="0px",e.background="transparent",e.float="left",e.cssFloat="left",e.styleFloat="left",e.zIndex=999999999,e.cursor="default"}(this.displayRegion.style,this.borderWidth),e.setElementPointerEventsNone(this.displayRegion),e.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",e.setElementPointerEventsNone(this.displayRegionContainer),e.setElementTouchActionNone(this.displayRegionContainer),c.addControl(this.element,o.controlOptions),this._resizeWithViewer=o.controlOptions.anchor!==e.ControlAnchor.ABSOLUTE&&o.controlOptions.anchor!==e.ControlAnchor.NONE,o.width&&o.height?(this.setWidth(o.width),this.setHeight(o.height)):this._resizeWithViewer&&(a=e.getElementSize(c.element),this.element.style.height=Math.round(a.y*o.sizeRatio)+"px",this.element.style.width=Math.round(a.x*o.sizeRatio)+"px",this.oldViewerSize=a,l=e.getElementSize(this.element),this.elementArea=l.x*l.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[o]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),o.navigatorRotate)&&(p(o.viewer.viewport?o.viewer.viewport.getRotation():o.viewer.degrees||0),o.viewer.addHandler("rotate",(function(e){p(e.degrees)})));this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:e.delegate(this,i),clickHandler:e.delegate(this,t),releaseHandler:e.delegate(this,n),scrollHandler:e.delegate(this,s),preProcessEventHandler:function(e){"wheel"===e.eventType&&(e.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",e.setElementPointerEventsNone(this.canvas),e.setElementPointerEventsNone(this.container),this.addHandler("reset-size",(function(){d.viewport&&d.viewport.goHome(!0)})),c.world.addHandler("item-index-change",(function(e){window.setTimeout((function(){var t=d.world.getItemAt(e.previousIndex);d.world.setItemIndex(t,e.newIndex)}),1)})),c.world.addHandler("remove-item",(function(e){var t=e.item,i=d._getMatchingItem(t);i&&d.world.removeItem(i)})),this.update(c.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var t=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);t.equals(this.oldContainerSize)||(this.viewport.resize(t,!0),this.viewport.goHome(!0),this.oldContainerSize=t,this.drawer.clear(),this.world.draw())}},setWidth:function(e){this.width=e,this.element.style.width="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setHeight:function(e){this.height=e,this.element.style.height="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setFlip:function(e){return this.viewport.setFlip(e),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(e){o(this.displayRegion,e),o(this.canvas,e),o(this.element,e)},update:function(t){var i,n,s,r,o,a;if(i=e.getElementSize(this.viewer.element),this._resizeWithViewer&&i.x&&i.y&&!i.equals(this.oldViewerSize)&&(this.oldViewerSize=i,this.maintainSizeRatio||!this.elementArea?(n=i.x*this.sizeRatio,s=i.y*this.sizeRatio):(n=Math.sqrt(this.elementArea*(i.x/i.y)),s=this.elementArea/n),this.element.style.width=Math.round(n)+"px",this.element.style.height=Math.round(s)+"px",this.elementArea||(this.elementArea=n*s),this.updateSize()),t&&this.viewport){r=t.getBoundsNoRotate(!0),o=this.viewport.pixelFromPointNoRotate(r.getTopLeft(),!1),a=this.viewport.pixelFromPointNoRotate(r.getBottomRight(),!1).minus(this.totalBorderWidths);var l=this.displayRegion.style;l.display=this.world.getItemCount()?"block":"none",l.top=Math.round(o.y)+"px",l.left=Math.round(o.x)+"px";var h=Math.abs(o.x-a.x),u=Math.abs(o.y-a.y);l.width=Math.round(Math.max(h,0))+"px",l.height=Math.round(Math.max(u,0))+"px"}},addTiledImage:function(t){var i=this,n=t.originalTiledImage;delete t.original;var s=e.extend({},t,{success:function(e){var t=e.item;function s(){i._matchBounds(t,n)}t._originalForNavigator=n,i._matchBounds(t,n,!0),i._matchOpacity(t,n),i._matchCompositeOperation(t,n),n.addHandler("bounds-change",s),n.addHandler("clip-change",s),n.addHandler("opacity-change",(function(){i._matchOpacity(t,n)})),n.addHandler("composite-operation-change",(function(){i._matchCompositeOperation(t,n)}))}});return e.Viewer.prototype.addTiledImage.apply(this,[s])},destroy:function(){return e.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(e){for(var t,i=this.world.getItemCount(),n=0;n<i;n++)if((t=this.world.getItemAt(n))._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,i){var n=t.getBoundsNoRotate();e.setPosition(n.getTopLeft(),i),e.setWidth(n.width,i),e.setRotation(t.getRotation(),i),e.setClip(t.getClip()),e.setFlip(t.getFlip())},_matchOpacity:function(e,t){e.setOpacity(t.opacity)},_matchCompositeOperation:function(e,t){e.setCompositeOperation(t.compositeOperation)}})}(t),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(i){var n,s=i.split("."),r=null,o=arguments,a=t;for(n=0;n<s.length-1;n++)a=a[s[n]]||{};return"string"!=typeof(r=a[s[n]])&&(e.console.log("Untranslated source string:",i),r=""),r.replace(/\{\d+\}/g,(function(e){var t=parseInt(e.match(/\d+/),10)+1;return t<o.length?o[t]:""}))},setString:function(e,i){var n,s=e.split("."),r=t;for(n=0;n<s.length-1;n++)r[s[n]]||(r[s[n]]={}),r=r[s[n]];r[s[n]]=i}})}(t),function(e){e.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},squaredDistanceTo:function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,i){var n,s;if(i=i||new e.Point(0,0),t%90==0){switch(e.positiveModulo(t,360)){case 0:n=1,s=0;break;case 90:n=0,s=1;break;case 180:n=-1,s=0;break;case 270:n=0,s=-1}}else{var r=t*Math.PI/180;n=Math.cos(r),s=Math.sin(r)}var o=n*(this.x-i.x)-s*(this.y-i.y)+i.x,a=s*(this.x-i.x)+n*(this.y-i.y)+i.y;return new e.Point(o,a)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(t),function(e){e.TileSource=function(t,i,n,s,r,o){var a,l,h=this,u=arguments;if(a=e.isPlainObject(t)?t:{width:u[0],height:u[1],tileSize:u[2],tileOverlap:u[3],minLevel:u[4],maxLevel:u[5]},e.EventSource.call(this),e.extend(!0,this,a),!this.success)for(l=0;l<arguments.length;l++)if(e.isFunction(arguments[l])){this.success=arguments[l];break}this.success&&this.addHandler("ready",(function(e){h.success(e)})),"string"===e.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=a.width&&a.height?a.width/a.height:1,this.dimensions=new e.Point(a.width,a.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=a.tileOverlap?a.tileOverlap:0,this.minLevel=a.minLevel?a.minLevel:0,this.maxLevel=void 0!==a.maxLevel&&null!==a.maxLevel?a.maxLevel:a.width&&a.height?Math.ceil(Math.log(Math.max(a.width,a.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(t){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth?this._tileWidth:this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight?this._tileHeight:this.getTileSize(e)},setMaxLevel:function(e){this.maxLevel=e,this._memoizeLevelScale()},getLevelScale:function(e){return this._memoizeLevelScale(),this.getLevelScale(e)},_memoizeLevelScale:function(){var e,t={};for(e=0;e<=this.maxLevel;e++)t[e]=1/Math.pow(2,this.maxLevel-e);this.getLevelScale=function(e){return t[e]}},getNumTiles:function(t){var i=this.getLevelScale(t),n=Math.ceil(i*this.dimensions.x/this.getTileWidth(t)),s=Math.ceil(i*this.dimensions.y/this.getTileHeight(t));return new e.Point(n,s)},getPixelRatio:function(t){var i=this.dimensions.times(this.getLevelScale(t)),n=1/i.x*e.pixelDensityRatio,s=1/i.y*e.pixelDensityRatio;return new e.Point(n,s)},getClosestLevel:function(){var e,t;for(e=this.minLevel+1;e<=this.maxLevel&&!((t=this.getNumTiles(e)).x>1||t.y>1);e++);return e-1},getTileAtPoint:function(t,i){var n=i.x>=0&&i.x<=1&&i.y>=0&&i.y<=1/this.aspectRatio;e.console.assert(n,"[TileSource.getTileAtPoint] must be called with a valid point.");var s=this.dimensions.x*this.getLevelScale(t),r=i.x*s,o=i.y*s,a=Math.floor(r/this.getTileWidth(t)),l=Math.floor(o/this.getTileHeight(t));i.x>=1&&(a=this.getNumTiles(t).x-1);return i.y>=1/this.aspectRatio-1e-15&&(l=this.getNumTiles(t).y-1),new e.Point(a,l)},getTileBounds:function(t,i,n,s){var r=this.dimensions.times(this.getLevelScale(t)),o=this.getTileWidth(t),a=this.getTileHeight(t),l=0===i?0:o*i-this.tileOverlap,h=0===n?0:a*n-this.tileOverlap,u=o+(0===i?1:2)*this.tileOverlap,c=a+(0===n?1:2)*this.tileOverlap,d=1/r.x;return u=Math.min(u,r.x-l),c=Math.min(c,r.y-h),s?new e.Rect(0,0,u,c):new e.Rect(l*d,h*d,u*d,c*d)},getImageInfo:function(t){var i,n,s,r,o,a,l,h=this;t&&(l=(a=(o=t.split("/"))[o.length-1]).lastIndexOf("."))>-1&&(o[o.length-1]=a.slice(0,l)),n=function(i){"string"==typeof i&&(i=e.parseXml(i));var n=e.TileSource.determineType(h,i,t);n?(void 0===(r=n.prototype.configure.apply(h,[i,t])).ajaxWithCredentials&&(r.ajaxWithCredentials=h.ajaxWithCredentials),s=new n(r),h.ready=!0,h.raiseEvent("ready",{tileSource:s})):h.raiseEvent("open-failed",{message:"Unable to load TileSource",source:t})},t.match(/\.js$/)?(i=t.split("/").pop().replace(".js",""),e.jsonp({url:t,async:!1,callbackName:i,callback:n})):e.makeAjaxRequest({url:t,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(t){var i=function(t){var i,n,s=t.responseText,r=t.status;if(!t)throw new Error(e.getString("Errors.Security"));if(200!==t.status&&0!==t.status)throw i=404===(r=t.status)?"Not Found":t.statusText,new Error(e.getString("Errors.Status",r,i));if(s.match(/\s*<.*/))try{n=t.responseXML&&t.responseXML.documentElement?t.responseXML:e.parseXml(s)}catch(e){n=t.responseText}else if(s.match(/\s*[{[].*/))try{n=e.parseJSON(s)}catch(e){n=s}else n=s;return n}(t);n(i)},error:function(e,i){var n;try{n="HTTP "+e.status+" attempting to load TileSource"}catch(e){n=(void 0!==i&&i.toString?i.toString():"Unknown error")+" attempting to load TileSource"}h.raiseEvent("open-failed",{message:n,source:t})}})},supports:function(e,t){return!1},configure:function(e,t){throw new Error("Method not implemented.")},getTileUrl:function(e,t,i){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(e,t,i){return{}},tileExists:function(e,t,i){var n=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&t>=0&&i>=0&&t<n.x&&i<n.y}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype),e.TileSource.determineType=function(i,n,s){var r;for(r in t)if(r.match(/.+TileSource$/)&&e.isFunction(t[r])&&e.isFunction(t[r].prototype.supports)&&t[r].prototype.supports.call(i,n,s))return t[r];return e.console.error("No TileSource was able to open %s %s",s,n),null}}(t),function(e){function t(t,i){var n,s,r=i.Image,o=r.Url,a=r.Format,l=r.Size,h=r.DisplayRect||[],u=parseInt(l.Width,10),c=parseInt(l.Height,10),d=parseInt(r.TileSize,10),p=parseInt(r.Overlap,10),m=[];for(s=0;s<h.length;s++)n=h[s].Rect,m.push(new e.DisplayRect(parseInt(n.X,10),parseInt(n.Y,10),parseInt(n.Width,10),parseInt(n.Height,10),parseInt(n.MinLevel,10),parseInt(n.MaxLevel,10)));return e.extend(!0,{width:u,height:c,tileSize:d,tileOverlap:p,minLevel:null,maxLevel:null,tilesUrl:o,fileFormat:a,displayRects:m},i)}e.DziTileSource=function(t,i,n,s,r,o,a,l,h){var u,c,d,p;if(p=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=p.tilesUrl,this.fileFormat=p.fileFormat,this.displayRects=p.displayRects,this.displayRects)for(u=this.displayRects.length-1;u>=0;u--)for(d=(c=this.displayRects[u]).minLevel;d<=c.maxLevel;d++)this._levelRects[d]||(this._levelRects[d]=[]),this._levelRects[d].push(c);e.TileSource.apply(this,[p])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){var i;return e.Image?i=e.Image.xmlns:e.documentElement&&("Image"!==e.documentElement.localName&&"Image"!==e.documentElement.tagName||(i=e.documentElement.namespaceURI)),-1!==(i=(i||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==i.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(i,n){var s;return s=e.isPlainObject(i)?t(this,i):function(i,n){if(!n||!n.documentElement)throw new Error(e.getString("Errors.Xml"));var s,r,o,a,l,h=n.documentElement,u=h.localName||h.tagName,c=n.documentElement.namespaceURI,d=null,p=[];if("Image"===u)try{if(void 0===(a=h.getElementsByTagName("Size")[0])&&(a=h.getElementsByTagNameNS(c,"Size")[0]),d={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:h.getAttribute("Url"),Format:h.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(h.getAttribute("Overlap"),10),TileSize:parseInt(h.getAttribute("TileSize"),10),Size:{Height:parseInt(a.getAttribute("Height"),10),Width:parseInt(a.getAttribute("Width"),10)}}},!e.imageFormatSupported(d.Image.Format))throw new Error(e.getString("Errors.ImageFormat",d.Image.Format.toUpperCase()));for(void 0===(s=h.getElementsByTagName("DisplayRect"))&&(s=h.getElementsByTagNameNS(c,"DisplayRect")[0]),l=0;l<s.length;l++)void 0===(o=(r=s[l]).getElementsByTagName("Rect")[0])&&(o=r.getElementsByTagNameNS(c,"Rect")[0]),p.push({Rect:{X:parseInt(o.getAttribute("X"),10),Y:parseInt(o.getAttribute("Y"),10),Width:parseInt(o.getAttribute("Width"),10),Height:parseInt(o.getAttribute("Height"),10),MinLevel:parseInt(r.getAttribute("MinLevel"),10),MaxLevel:parseInt(r.getAttribute("MaxLevel"),10)}});return p.length&&(d.Image.DisplayRect=p),t(i,d)}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.Dzi"))}else{if("Collection"===u)throw new Error(e.getString("Errors.Dzc"));if("Error"===u){var m=h.getElementsByTagName("Message")[0].firstChild.nodeValue;throw new Error(m)}}throw new Error(e.getString("Errors.Dzi"))}(this,i),n&&!s.tilesUrl&&(s.tilesUrl=n.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),-1!==n.search(/\.(dzi|xml|js)\?/)?s.queryParams=n.match(/\?.*/):s.queryParams=""),s},getTileUrl:function(e,t,i){return[this.tilesUrl,e,"/",t,"_",i,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,t,i){var n,s,r,o,a,l,h,u=this._levelRects[e];if(this.minLevel&&e<this.minLevel||this.maxLevel&&e>this.maxLevel)return!1;if(!u||!u.length)return!0;for(h=u.length-1;h>=0;h--)if(!(e<(n=u[h]).minLevel||e>n.maxLevel)&&(s=this.getLevelScale(e),r=n.x*s,o=n.y*s,a=r+n.width*s,l=o+n.height*s,r=Math.floor(r/this._tileWidth),o=Math.floor(o/this._tileWidth),a=Math.ceil(a/this._tileWidth),l=Math.ceil(l/this._tileWidth),r<=t&&t<a&&o<=i&&i<l))return!0;return!1}})}(t),function(e){function i(e){var t=Array.isArray(e.profile)?e.profile[0]:e.profile,i=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(t),n=!1;return 2===e.version&&e.profile.length>1&&e.profile[1].supports&&(n=-1!==e.profile[1].supports.indexOf("sizeByW")),3===e.version&&e.extraFeatures&&(n=-1!==e.extraFeatures.indexOf("sizeByWh")),!i||n}function n(e){for(var t=[],i=0;i<e.sizes.length;i++)t.push({url:e["@id"]+"/full/"+e.sizes[i].width+","+(3===e.version?e.sizes[i].height:"")+"/0/default."+e.tileFormat,width:e.sizes[i].width,height:e.sizes[i].height});return t.sort((function(e,t){return e.width-t.width}))}function s(t,i,n){var r,o;if(3===t.nodeType&&n)(o=t.nodeValue.trim()).match(/^\d*$/)&&(o=Number(o)),i[n]?(e.isArray(i[n])||(i[n]=[i[n]]),i[n].push(o)):i[n]=o;else if(1===t.nodeType)for(r=0;r<t.childNodes.length;r++)s(t.childNodes[r],i,t.nodeName)}e.IIIFTileSource=function(t){if(e.extend(!0,this,t),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(t.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=t.version,this.tile_width&&this.tile_height)t.tileWidth=this.tile_width,t.tileHeight=this.tile_height;else if(this.tile_width)t.tileSize=this.tile_width;else if(this.tile_height)t.tileSize=this.tile_height;else if(this.tiles)if(1===this.tiles.length)t.tileWidth=this.tiles[0].width,t.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var s=0;s<this.tiles.length;s++)for(var r=0;r<this.tiles[s].scaleFactors.length;r++){var o=this.tiles[s].scaleFactors[r];this.scale_factors.push(o),t.tileSizePerScaleFactor[o]={width:this.tiles[s].width,height:this.tiles[s].height||this.tiles[s].width}}}else if(i(t)){for(var a=Math.min(this.height,this.width),l=[256,512,1024],h=[],u=0;u<l.length;u++)l[u]<=a&&h.push(l[u]);h.length>0?t.tileSize=Math.max.apply(null,h):t.tileSize=a}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,t.levels=n(this),e.extend(!0,t,{width:t.levels[t.levels.length-1].width,height:t.levels[t.levels.length-1].height,tileSize:Math.max(t.height,t.width),tileOverlap:0,minLevel:0,maxLevel:t.levels.length-1}),this.levels=t.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!t.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var c=Math.max.apply(null,this.scale_factors);t.maxLevel=Math.round(Math.log(c)*Math.LOG2E)}else t.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));e.TileSource.apply(this,[t])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return!(!e.protocol||"http://iiif.io/api/image"!==e.protocol)||(!(!e["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"!==e["@context"]&&"http://iiif.io/api/image/1/context.json"!==e["@context"])||(!(!e.profile||0!==e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html"))||(!!(e.identifier&&e.width&&e.height)||!(!e.documentElement||"info"!==e.documentElement.tagName||"http://library.stanford.edu/iiif/image-api/ns/"!==e.documentElement.namespaceURI))))},configure:function(i,n){if(e.isPlainObject(i)){if(i["@context"]){var r=i["@context"];if(Array.isArray(r))for(var o=0;o<r.length;o++)if("string"==typeof r[o]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(r[o])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===r[o])){r=r[o];break}switch(r){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":i.version=1;break;case"http://iiif.io/api/image/2/context.json":i.version=2;break;case"http://iiif.io/api/image/3/context.json":i.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}else i["@context"]="http://iiif.io/api/image/1.0/context.json",i["@id"]=n.replace("/info.json",""),i.version=1;if(!i["@id"]&&i.id&&(i["@id"]=i.id),i.preferredFormats)for(var a=0;a<i.preferredFormats.length;a++)if(t.imageFormatSupported(i.preferredFormats[a])){i.tileFormat=i.preferredFormats[a];break}return i}var l=function(t){if(!t||!t.documentElement)throw new Error(e.getString("Errors.Xml"));var i=t.documentElement,n=i.tagName,r=null;if("info"===n)try{return s(i,r={}),r}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}(i);return l["@context"]="http://iiif.io/api/image/1.0/context.json",l["@id"]=n.replace("/info.xml",""),l.version=1,l},getTileWidth:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,t);var i=Math.pow(2,this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].width:this._tileWidth},getTileHeight:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,t);var i=Math.pow(2,this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].height:this._tileHeight},getLevelScale:function(t){if(this.emulateLegacyImagePyramid){var i=NaN;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(i=this.levels[t].width/this.levels[this.maxLevel].width),i}return e.TileSource.prototype.getLevelScale.call(this,t)},getNumTiles:function(t){return this.emulateLegacyImagePyramid?this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0):e.TileSource.prototype.getNumTiles.call(this,t)},getTileAtPoint:function(t,i){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,t,i)},getTileUrl:function(e,t,i){if(this.emulateLegacyImagePyramid){var n=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n}var s,r,o,a,l,h,u,c,d,p,m,g,f,v=Math.pow(.5,this.maxLevel-e),y=Math.ceil(this.width*v),_=Math.ceil(this.height*v);return s=this.getTileWidth(e),r=this.getTileHeight(e),o=Math.ceil(s/v),a=Math.ceil(r/v),f=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,y<s&&_<r?(p=2===this.version&&y===this.width?"full":3===this.version&&y===this.width&&_===this.height?"max":3===this.version?y+","+_:y+",",l="full"):(h=t*o,u=i*a,c=Math.min(o,this.width-h),d=Math.min(a,this.height-u),l=0===t&&0===i&&c===this.width&&d===this.height?"full":[h,u,c,d].join(","),m=Math.ceil(c*v),g=Math.ceil(d*v),p=2===this.version&&m===this.width?"full":3===this.version&&m===this.width&&g===this.height?"max":3===this.version?m+","+g:m+","),[this["@id"],l,p,"0",f].join("/")},__testonly__:{canBeTiled:i,constructLevels:n}})}(t),function(e){e.OsmTileSource=function(t,i,n,s,r){var o;(o=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]}).width&&o.height||(o.width=65572864,o.height=65572864),o.tileSize||(o.tileSize=256,o.tileOverlap=0),o.tilesUrl||(o.tilesUrl="http://tile.openstreetmap.org/"),o.minLevel=8,e.TileSource.apply(this,[o])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"openstreetmaps"===e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){return this.tilesUrl+(e-8)+"/"+t+"/"+i+".png"}})}(t),function(e){e.TmsTileSource=function(t,i,n,s,r){var o;o=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var a,l=256*Math.ceil(o.width/256),h=256*Math.ceil(o.height/256);a=l>h?l/256:h/256,o.maxLevel=Math.ceil(Math.log(a)/Math.log(2))-1,o.tileSize=256,o.width=l,o.height=h,e.TileSource.apply(this,[o])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"tiledmapservice"===e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){var n=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(n-i)+".png"}})}(t),function(e){e.ZoomifyTileSource=function(e){void 0===e.tileSize&&(e.tileSize=256),void 0===e.fileFormat&&(e.fileFormat="jpg",this.fileFormat=e.fileFormat);var i={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(i.x,10)>e.tileSize||parseInt(i.y,10)>e.tileSize;)i.x=Math.floor(i.x/2),i.y=Math.floor(i.y/2),e.imageSizes.push({x:i.x,y:i.y}),e.gridSize.push(this._getGridSize(i.x,i.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,t.TileSource.apply(this,[e])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(e,t,i){return{x:Math.ceil(e/i),y:Math.ceil(t/i)}},_calculateAbsoluteTileNumber:function(e,t,i){for(var n=0,s={},r=0;r<e;r++)n+=(s=this.gridSize[r]).x*s.y;return n+=(s=this.gridSize[e]).x*i+t},supports:function(e,t){return e.type&&"zoomifytileservice"===e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){var n,s=this._calculateAbsoluteTileNumber(e,t,i);return n=Math.floor(s/256),this.tilesUrl+"TileGroup"+n+"/"+e+"-"+t+"-"+i+"."+this.fileFormat}})}(t),function(e){function t(e,t){return t.levels}e.LegacyTileSource=function(t){var i,n,s;e.isArray(t)&&(i={type:"legacy-image-pyramid",levels:t}),i.levels=function(t){var i,n,s=[];for(n=0;n<t.length;n++)(i=t[n]).height&&i.width&&i.url?s.push({url:i.url,width:Number(i.width),height:Number(i.height)}):e.console.error("Unsupported image format: %s",i.url?i.url:"<no URL>");return s.sort((function(e,t){return e.height-t.height}))}(i.levels),i.levels.length>0?(n=i.levels[i.levels.length-1].width,s=i.levels[i.levels.length-1].height):(n=0,s=0,e.console.error("No supported image formats found")),e.extend(!0,i,{width:n,height:s,tileSize:Math.max(s,n),tileOverlap:0,minLevel:0,maxLevel:i.levels.length>0?i.levels.length-1:0}),e.TileSource.apply(this,[i]),this.levels=i.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"legacy-image-pyramid"===e.type||e.documentElement&&"legacy-image-pyramid"===e.documentElement.getAttribute("type")},configure:function(i,n){return e.isPlainObject(i)?t(this,i):function(i,n){if(!n||!n.documentElement)throw new Error(e.getString("Errors.Xml"));var s,r,o=n.documentElement,a=o.tagName,l=null,h=[];if("image"===a)try{for(l={type:o.getAttribute("type"),levels:[]},h=o.getElementsByTagName("level"),r=0;r<h.length;r++)s=h[r],l.levels.push({url:s.getAttribute("url"),width:parseInt(s.getAttribute("width"),10),height:parseInt(s.getAttribute("height"),10)});return t(i,l)}catch(e){throw e instanceof Error?e:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"===a)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"===a)throw new Error("Error: "+n)}throw new Error("Unknown element "+a)}(this,i)},getLevelScale:function(e){var t=NaN;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e,t,i){var n=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n}})}(t),function(e){e.ImageTileSource=function(t){t=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},t),e.TileSource.apply(this,[t])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"image"===e.type},configure:function(e,t){return e},getImageInfo:function(t){var i=this._image=new Image,n=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),e.addEvent(i,"load",(function(){n.width=i.naturalWidth,n.height=i.naturalHeight,n.aspectRatio=n.width/n.height,n.dimensions=new e.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})})),e.addEvent(i,"error",(function(){n.raiseEvent("open-failed",{message:"Error loading image at "+t,source:t})})),i.src=t},getLevelScale:function(e){var t=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e,t,i){var n=null;return e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n},getContext2D:function(e,t,i){var n=null;return e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].context2D),n},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var t=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,t;var i=this._image.naturalWidth,n=this._image.naturalHeight,s=document.createElement("canvas"),r=s.getContext("2d");if(s.width=i,s.height=n,r.drawImage(this._image,0,0,i,n),t[0].context2D=r,delete this._image,e.isCanvasTainted(s))return t;for(;i>=2&&n>=2;){i=Math.floor(i/2),n=Math.floor(n/2);var o=document.createElement("canvas"),a=o.getContext("2d");o.width=i,o.height=n,a.drawImage(s,0,0,i,n),t.splice(0,0,{context2D:a,width:i,height:n}),s=o,r=a}return t},_freeupCanvasMemory:function(){for(var e=0;e<this.levels.length;e++)this.levels[e].context2D.canvas.height=0,this.levels[e].context2D.canvas.width=0}})}(t),function(e){e.TileSourceCollection=function(t,i,n,s){e.console.error("TileSourceCollection is deprecated; use World instead")}}(t),function(e){function t(i){e.requestAnimationFrame((function(){!function(i){var n;i.shouldFade&&(n=1-(e.now()-i.fadeBeginTime)/i.fadeLength,n=Math.min(1,n),n=Math.max(0,n),i.imgGroup&&e.setElementOpacity(i.imgGroup,n,!0),n>0&&t(i))}(i)}))}function i(t,i){t.element.disabled||(i>=e.ButtonState.GROUP&&t.currentState===e.ButtonState.REST&&(!function(t){t.shouldFade=!1,t.imgGroup&&e.setElementOpacity(t.imgGroup,1,!0)}(t),t.currentState=e.ButtonState.GROUP),i>=e.ButtonState.HOVER&&t.currentState===e.ButtonState.GROUP&&(t.imgHover&&(t.imgHover.style.visibility=""),t.currentState=e.ButtonState.HOVER),i>=e.ButtonState.DOWN&&t.currentState===e.ButtonState.HOVER&&(t.imgDown&&(t.imgDown.style.visibility=""),t.currentState=e.ButtonState.DOWN))}function n(i,n){i.element.disabled||(n<=e.ButtonState.HOVER&&i.currentState===e.ButtonState.DOWN&&(i.imgDown&&(i.imgDown.style.visibility="hidden"),i.currentState=e.ButtonState.HOVER),n<=e.ButtonState.GROUP&&i.currentState===e.ButtonState.HOVER&&(i.imgHover&&(i.imgHover.style.visibility="hidden"),i.currentState=e.ButtonState.GROUP),n<=e.ButtonState.REST&&i.currentState===e.ButtonState.GROUP&&(!function(i){i.shouldFade=!0,i.fadeBeginTime=e.now()+i.fadeDelay,window.setTimeout((function(){t(i)}),i.fadeDelay)}(i),i.currentState=e.ButtonState.REST))}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(t){var s=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},t),this.element=t.element||e.makeNeutralElement("div"),t.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,e.setElementPointerEventsNone(this.imgRest),e.setElementPointerEventsNone(this.imgGroup),e.setElementPointerEventsNone(this.imgHover),e.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor===e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(t){t.insideElementPressed?(i(s,e.ButtonState.DOWN),s.raiseEvent("enter",{originalEvent:t.originalEvent})):t.buttonDownAny||i(s,e.ButtonState.HOVER)},focusHandler:function(e){s.tracker.enterHandler(e),s.raiseEvent("focus",{originalEvent:e.originalEvent})},leaveHandler:function(t){n(s,e.ButtonState.GROUP),t.insideElementPressed&&s.raiseEvent("exit",{originalEvent:t.originalEvent})},blurHandler:function(e){s.tracker.leaveHandler(e),s.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(t){i(s,e.ButtonState.DOWN),s.raiseEvent("press",{originalEvent:t.originalEvent})},releaseHandler:function(t){t.insideElementPressed&&t.insideElementReleased?(n(s,e.ButtonState.HOVER),s.raiseEvent("release",{originalEvent:t.originalEvent})):t.insideElementPressed?n(s,e.ButtonState.GROUP):i(s,e.ButtonState.HOVER)},clickHandler:function(e){e.quick&&s.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){13===e.keyCode?(s.raiseEvent("click",{originalEvent:e.originalEvent}),s.raiseEvent("release",{originalEvent:e.originalEvent}),e.preventDefault=!0):e.preventDefault=!1}}),n(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){i(this,e.ButtonState.GROUP)},notifyGroupExit:function(){n(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}})}(t),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var i,n=this.buttons.concat([]),s=this;if(this.element=t.element||e.makeNeutralElement("div"),!t.group)for(this.element.style.display="inline-block",i=0;i<n.length;i++)this.element.appendChild(n[i].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){var t;for(t=0;t<s.buttons.length;t++)s.buttons[t].notifyGroupEnter()},leaveHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<s.buttons.length;t++)s.buttons[t].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var e=this.buttons.pop();this.element.removeChild(e.element),e.destroy()}this.tracker.destroy(),this.element=null}}}(t),function(e){e.Rect=function(t,i,n,s,r){var o,a;this.x="number"==typeof t?t:0,this.y="number"==typeof i?i:0,this.width="number"==typeof n?n:0,this.height="number"==typeof s?s:0,this.degrees="number"==typeof r?r:0,this.degrees=e.positiveModulo(this.degrees,360),this.degrees>=270?(o=this.getTopRight(),this.x=o.x,this.y=o.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=270):this.degrees>=180?(o=this.getBottomRight(),this.x=o.x,this.y=o.y,this.degrees-=180):this.degrees>=90&&(o=this.getBottomLeft(),this.x=o.x,this.y=o.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=90)},e.Rect.fromSummits=function(t,i,n){var s=t.distanceTo(i),r=t.distanceTo(n),o=i.minus(t),a=Math.atan(o.y/o.x);return o.x<0?a+=Math.PI:o.y<0&&(a+=2*Math.PI),new e.Rect(t.x,t.y,s,r,a/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.degrees===t.degrees},times:function(t){return new e.Rect(this.x*t,this.y*t,this.width*t,this.height*t,this.degrees)},translate:function(t){return new e.Rect(this.x+t.x,this.y+t.y,this.width,this.height,this.degrees)},union:function(t){var i=this.getBoundingBox(),n=t.getBoundingBox(),s=Math.min(i.x,n.x),r=Math.min(i.y,n.y),o=Math.max(i.x+i.width,n.x+n.width),a=Math.max(i.y+i.height,n.y+n.height);return new e.Rect(s,r,o-s,a-r)},intersection:function(t){var i=1e-10,n=[],s=this.getTopLeft();t.containsPoint(s,i)&&n.push(s);var r=this.getTopRight();t.containsPoint(r,i)&&n.push(r);var o=this.getBottomLeft();t.containsPoint(o,i)&&n.push(o);var a=this.getBottomRight();t.containsPoint(a,i)&&n.push(a);var l=t.getTopLeft();this.containsPoint(l,i)&&n.push(l);var h=t.getTopRight();this.containsPoint(h,i)&&n.push(h);var u=t.getBottomLeft();this.containsPoint(u,i)&&n.push(u);var c=t.getBottomRight();this.containsPoint(c,i)&&n.push(c);for(var d=this._getSegments(),p=t._getSegments(),m=0;m<d.length;m++)for(var g=d[m],f=0;f<p.length;f++){var v=p[f],y=_(g[0],g[1],v[0],v[1]);y&&n.push(y)}function _(t,n,s,r){var o=n.minus(t),a=r.minus(s),l=-a.x*o.y+o.x*a.y;if(0===l)return null;var h=(o.x*(t.y-s.y)-o.y*(t.x-s.x))/l,u=(a.x*(t.y-s.y)-a.y*(t.x-s.x))/l;return-1e-10<=h&&h<=1-i&&-1e-10<=u&&u<=1-i?new e.Point(t.x+u*o.x,t.y+u*o.y):null}if(0===n.length)return null;for(var w=n[0].x,b=n[0].x,x=n[0].y,k=n[0].y,T=1;T<n.length;T++){var S=n[T];S.x<w&&(w=S.x),S.x>b&&(b=S.x),S.y<x&&(x=S.y),S.y>k&&(k=S.y)}return new e.Rect(w,x,b-w,k-x)},_getSegments:function(){var e=this.getTopLeft(),t=this.getTopRight(),i=this.getBottomLeft(),n=this.getBottomRight();return[[e,t],[t,n],[n,i],[i,e]]},rotate:function(t,i){if(0===(t=e.positiveModulo(t,360)))return this.clone();i=i||this.getCenter();var n=this.getTopLeft().rotate(t,i),s=this.getTopRight().rotate(t,i).minus(n);s=s.apply((function(e){return Math.abs(e)<1e-15?0:e}));var r=Math.atan(s.y/s.x);return s.x<0?r+=Math.PI:s.y<0&&(r+=2*Math.PI),new e.Rect(n.x,n.y,this.width,this.height,r/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var t=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),s=this.getBottomRight(),r=Math.min(t.x,i.x,n.x,s.x),o=Math.max(t.x,i.x,n.x,s.x),a=Math.min(t.y,i.y,n.y,s.y),l=Math.max(t.y,i.y,n.y,s.y);return new e.Rect(r,a,o-r,l-a)},getIntegerBoundingBox:function(){var t=this.getBoundingBox(),i=Math.floor(t.x),n=Math.floor(t.y),s=Math.ceil(t.width+t.x-i),r=Math.ceil(t.height+t.y-n);return new e.Rect(i,n,s,r)},containsPoint:function(e,t){t=t||0;var i=this.getTopLeft(),n=this.getTopRight(),s=this.getBottomLeft(),r=n.minus(i),o=s.minus(i);return(e.x-i.x)*r.x+(e.y-i.y)*r.y>=-t&&(e.x-n.x)*r.x+(e.y-n.y)*r.y<=t&&(e.x-i.x)*o.x+(e.y-i.y)*o.y>=-t&&(e.x-s.x)*o.x+(e.y-s.y)*o.y<=t},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(t),function(e){var t={};function i(e){var t;e.quick&&(t="horizontal"===this.scroll?Math.floor(e.position.x/this.panelWidth):Math.floor(e.position.y/this.panelHeight),this.viewer.goToPage(t));this.element.focus()}function n(t){if(this.dragging=!0,this.element){var i=Number(this.element.style.marginLeft.replace("px","")),n=Number(this.element.style.marginTop.replace("px","")),s=Number(this.element.style.width.replace("px","")),o=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);"horizontal"===this.scroll?-t.delta.x>0?i>-(s-a.x)&&(this.element.style.marginLeft=i+2*t.delta.x+"px",r(this,a.x,i+2*t.delta.x)):-t.delta.x<0&&i<0&&(this.element.style.marginLeft=i+2*t.delta.x+"px",r(this,a.x,i+2*t.delta.x)):-t.delta.y>0?n>-(o-a.y)&&(this.element.style.marginTop=n+2*t.delta.y+"px",r(this,a.y,n+2*t.delta.y)):-t.delta.y<0&&n<0&&(this.element.style.marginTop=n+2*t.delta.y+"px",r(this,a.y,n+2*t.delta.y))}}function s(t){if(this.element){var i=Number(this.element.style.marginLeft.replace("px","")),n=Number(this.element.style.marginTop.replace("px","")),s=Number(this.element.style.width.replace("px","")),o=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);"horizontal"===this.scroll?t.scroll>0?i>-(s-a.x)&&(this.element.style.marginLeft=i-60*t.scroll+"px",r(this,a.x,i-60*t.scroll)):t.scroll<0&&i<0&&(this.element.style.marginLeft=i-60*t.scroll+"px",r(this,a.x,i-60*t.scroll)):t.scroll<0?n>a.y-o&&(this.element.style.marginTop=n+60*t.scroll+"px",r(this,a.y,n+60*t.scroll)):t.scroll>0&&n<0&&(this.element.style.marginTop=n+60*t.scroll+"px",r(this,a.y,n+60*t.scroll)),t.preventDefault=!0}}function r(t,i,n){var s,r,o,a,l,h;for(s="horizontal"===t.scroll?t.panelWidth:t.panelHeight,r=Math.ceil(i/s)+5,l=r=(r=(o=Math.ceil((Math.abs(n)+i)/s)+1)-r)<0?0:r;l<o&&l<t.panels.length;l++)if(!(h=t.panels[l]).activePanel){var u,c=t.viewer.tileSources[l];u=c.referenceStripThumbnailUrl?{type:"image",url:c.referenceStripThumbnailUrl}:c,a=new e.Viewer({id:h.id,tileSources:[u],element:h,navigatorSizeRatio:t.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:t.viewer.loadTilesWithAjax,ajaxHeaders:t.viewer.ajaxHeaders,useCanvas:t.useCanvas}),e.setElementPointerEventsNone(a.canvas),e.setElementPointerEventsNone(a.container),a.innerTracker.setTracking(!1),a.outerTracker.setTracking(!1),t.miniViewers[h.id]=a,h.activePanel=!0}}function o(e){var t=e.eventSource.element;"horizontal"===this.scroll?t.style.marginBottom="0px":t.style.marginLeft="0px"}function a(t){var i=t.eventSource.element;"horizontal"===this.scroll?i.style.marginBottom="-"+e.getElementSize(i).y/2+"px":i.style.marginLeft="-"+e.getElementSize(i).x/2+"px"}function l(e){if(e.ctrl||e.alt||e.meta)e.preventDefault=!1;else switch(e.keyCode){case 38:s.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 40:case 37:s.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 39:s.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;default:e.preventDefault=!1}}function h(e){if(e.ctrl||e.alt||e.meta)e.preventDefault=!1;else switch(e.keyCode){case 61:s.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 45:s.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 48:case 119:case 87:s.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;case 115:case 83:case 97:s.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),e.preventDefault=!0;break;case 100:s.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),e.preventDefault=!0;break;default:e.preventDefault=!1}}e.ReferenceStrip=function(u){var c,d,p,m=u.viewer,g=e.getElementSize(m.element);for(u.id||(u.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=u.id,this.element.className="referencestrip"),u=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},u,{element:this.element}),e.extend(this,u),t[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,(d=this.element.style).marginTop="0px",d.marginRight="0px",d.marginBottom="0px",d.marginLeft="0px",d.left="0px",d.bottom="0px",d.border="0px",d.background="#000",d.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=m,this.tracker=new e.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:e.delegate(this,i),dragHandler:e.delegate(this,n),scrollHandler:e.delegate(this,s),enterHandler:e.delegate(this,o),leaveHandler:e.delegate(this,a),keyDownHandler:e.delegate(this,l),keyHandler:e.delegate(this,h),preProcessEventHandler:function(e){"wheel"===e.eventType&&(e.preventDefault=!0)}}),u.width&&u.height?(this.element.style.width=u.width+"px",this.element.style.height=u.height+"px",m.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):"horizontal"===u.scroll?(this.element.style.width=g.x*u.sizeRatio*m.tileSources.length+12*m.tileSources.length+"px",this.element.style.height=g.y*u.sizeRatio+"px",m.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=g.y*u.sizeRatio*m.tileSources.length+12*m.tileSources.length+"px",this.element.style.width=g.x*u.sizeRatio+"px",m.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=g.x*this.sizeRatio+8,this.panelHeight=g.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},p=0;p<m.tileSources.length;p++)(c=e.makeNeutralElement("div")).id=this.element.id+"-"+p,c.style.width=this.panelWidth+"px",c.style.height=this.panelHeight+"px",c.style.display="inline",c.style.float="left",c.style.cssFloat="left",c.style.styleFloat="left",c.style.padding="2px",e.setElementTouchActionNone(c),e.setElementPointerEventsNone(c),this.element.appendChild(c),c.activePanel=!1,this.panels.push(c);r(this,"vertical"===this.scroll?g.y:g.x,0),this.setFocus(0)},e.ReferenceStrip.prototype={setFocus:function(t){var i,n=this.element.querySelector("#"+this.element.id+"-"+t),s=e.getElementSize(this.viewer.canvas),a=Number(this.element.style.width.replace("px","")),l=Number(this.element.style.height.replace("px","")),h=-Number(this.element.style.marginLeft.replace("px","")),u=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==n&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=n,this.currentSelected.style.background="#999","horizontal"===this.scroll?(i=Number(t)*(this.panelWidth+3))>h+s.x-this.panelWidth?(i=Math.min(i,a-s.x),this.element.style.marginLeft=-i+"px",r(this,s.x,-i)):i<h&&(i=Math.max(0,i-s.x/2),this.element.style.marginLeft=-i+"px",r(this,s.x,-i)):(i=Number(t)*(this.panelHeight+3))>u+s.y-this.panelHeight?(i=Math.min(i,l-s.y),this.element.style.marginTop=-i+"px",r(this,s.y,-i)):i<u&&(i=Math.max(0,i-s.y/2),this.element.style.marginTop=-i+"px",r(this,s.y,-i)),this.currentPage=t,o.call(this,{eventSource:this.tracker}))},update:function(){return!!t[this.id].animating&&(e.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var e in this.miniViewers)this.miniViewers[e].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}}}(t),function(e){e.DisplayRect=function(t,i,n,s,r,o){e.Rect.apply(this,[t,i,n,s]),this.minLevel=r,this.maxLevel=o},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(t),function(e){e.Spring=function(t){var i=arguments;"object"!=typeof t&&(t={initial:i.length&&"number"==typeof i[0]?i[0]:void 0,springStiffness:i.length>1?i[1].springStiffness:5,animationTime:i.length>1?i[1].animationTime:1.5}),e.console.assert("number"==typeof t.springStiffness&&0!==t.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert("number"==typeof t.animationTime&&t.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),t.exponential&&(this._exponential=!0,delete t.exponential),e.extend(!0,this,t),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=t,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=t,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(t){this.start.value+=t,this.target.value+=t,this._exponential&&(e.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(t){this._exponential=t,this._exponential&&(e.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var t,i;this.current.time=e.now(),this._exponential?(t=this.start._logValue,i=this.target._logValue):(t=this.start.value,i=this.target.value);var n,s,r=this.current.time>=this.target.time?i:t+(i-t)*(n=this.springStiffness,s=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(n*-s))/(1-Math.exp(-n))),o=this.current.value;return this._exponential?this.current.value=Math.exp(r):this.current.value=r,o!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(t),function(e){function t(t){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},t),this.image=null}t.prototype={errorMsg:null,start:function(){var t=this,i=this.abort;this.image=new Image,this.image.onload=function(){t.finish(!0)},this.image.onabort=this.image.onerror=function(){t.errorMsg="Image load aborted",t.finish(!1)},this.jobId=window.setTimeout((function(){t.errorMsg="Image load exceeded timeout ("+t.timeout+" ms)",t.finish(!1)}),this.timeout),this.loadWithAjax?(this.request=e.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(e){var i;try{i=new window.Blob([e.response])}catch(t){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===t.name&&n){var s=new n;s.append(e.response),i=s.getBlob()}}0===i.size&&(t.errorMsg="Empty image response.",t.finish(!1));var r=(window.URL||window.webkitURL).createObjectURL(i);t.image.src=r},error:function(e){t.errorMsg="Image load aborted - XHR error",t.finish(!1)}}),this.abort=function(){t.request.abort(),"function"==typeof i&&i()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(e){this.image.onload=this.image.onerror=this.image.onabort=null,e||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(t){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},t)},e.ImageLoader.prototype={addJob:function(e){var i=this,n=new t({src:e.src,loadWithAjax:e.loadWithAjax,ajaxHeaders:e.loadWithAjax?e.ajaxHeaders:null,crossOriginPolicy:e.crossOriginPolicy,ajaxWithCredentials:e.ajaxWithCredentials,callback:function(t){!function(e,t,i){e.jobsInProgress--,(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&e.jobQueue.length>0&&(e.jobQueue.shift().start(),e.jobsInProgress++);i(t.image,t.errorMsg,t.request)}(i,t,e.callback)},abort:e.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(n.start(),this.jobsInProgress++):this.jobQueue.push(n)},clear:function(){for(var e=0;e<this.jobQueue.length;e++){var t=this.jobQueue[e];"function"==typeof t.abort&&t.abort()}this.jobQueue=[]}}}(t),function(e){e.Tile=function(e,t,i,n,s,r,o,a,l,h){this.level=e,this.x=t,this.y=i,this.bounds=n,this.sourceBounds=h,this.exists=s,this.url=r,this.context2D=o,this.loadWithAjax=a,this.ajaxHeaders=l,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(t){this.cacheImageRecord?this.loaded?(this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!==t&&t.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),e.setElementOpacity(this.element,this.opacity)):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(t,i,n,s){var r,o,a,l=this.position.times(e.pixelDensityRatio),h=this.size.times(e.pixelDensityRatio);this.context2D||this.cacheImageRecord?(r=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&r?(t.save(),t.globalAlpha=this.opacity,"number"==typeof n&&1!==n&&(l=l.times(n),h=h.times(n)),s instanceof e.Point&&(l=l.plus(s)),1===t.globalAlpha&&this._hasTransparencyChannel()&&t.clearRect(l.x,l.y,h.x,h.y),i({context:t,tile:this,rendered:r}),this.sourceBounds?(o=Math.min(this.sourceBounds.width,r.canvas.width),a=Math.min(this.sourceBounds.height,r.canvas.height)):(o=r.canvas.width,a=r.canvas.height),t.translate(l.x+h.x/2,0),this.flipped&&t.scale(-1,1),t.drawImage(r.canvas,0,0,o,a,-h.x/2,l.y,h.x,h.y),t.restore()):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var t;if(this.cacheImageRecord)t=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;t=this.context2D}return t.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(t,i,n){var s=Math.max(1,Math.ceil((n.x-i.x)/2)),r=Math.max(1,Math.ceil((n.y-i.y)/2));return new e.Point(s,r).minus(this.position.times(e.pixelDensityRatio).times(t||1).apply((function(e){return e%1})))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(t),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(t,i,n){var s;s=e.isPlainObject(t)?t:{element:t,location:i,placement:n},this.element=s.element,this.style=s.element.style,this._init(s)},e.Overlay.prototype={_init:function(t){this.location=t.location,this.placement=void 0===t.placement?e.Placement.TOP_LEFT:t.placement,this.onDraw=t.onDraw,this.checkResize=void 0===t.checkResize||t.checkResize,this.width=void 0===t.width?null:t.width,this.height=void 0===t.height?null:t.height,this.rotationMode=t.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(t,i){var n=e.Placement.properties[this.placement];n&&(n.isHorizontallyCentered?t.x-=i.x/2:n.isRight&&(t.x-=i.x),n.isVerticallyCentered?t.y-=i.y/2:n.isBottom&&(t.y-=i.y))},destroy:function(){var t=this.element,i=this.style;t.parentNode&&(t.parentNode.removeChild(t),t.prevElementParent&&(i.display="none",document.body.appendChild(t))),this.onDraw=null,i.top="",i.left="",i.position="",null!==this.width&&(i.width=""),null!==this.height&&(i.height="");var n=e.getCssPropertyWithVendorPrefix("transformOrigin"),s=e.getCssPropertyWithVendorPrefix("transform");n&&s&&(i[n]="",i[s]="")},drawHTML:function(t,i){var n=this.element;n.parentNode!==t&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,t.appendChild(n),this.style.position="absolute",this.size=e.getElementSize(n));var s=this._getOverlayPositionAndSize(i),r=s.position,o=this.size=s.size,a=s.rotate;if(this.onDraw)this.onDraw(r,o,this.element);else{var l=this.style;l.left=r.x+"px",l.top=r.y+"px",null!==this.width&&(l.width=o.x+"px"),null!==this.height&&(l.height=o.y+"px");var h=e.getCssPropertyWithVendorPrefix("transformOrigin"),u=e.getCssPropertyWithVendorPrefix("transform");h&&u&&(a?(l[h]=this._getTransformOrigin(),l[u]="rotate("+a+"deg)"):(l[h]="",l[u]="")),l.display="block"}},_getOverlayPositionAndSize:function(t){var i=t.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(t);this.adjust(i,n);var s=0;if(t.degrees&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var r=new e.Rect(i.x,i.y,n.x,n.y),o=this._getBoundingBox(r,t.degrees);i=o.getTopLeft(),n=o.getSize()}else s=t.degrees;return{position:i,size:n,rotate:s}},_getSizeInPixels:function(t){var i=this.size.x,n=this.size.y;if(null!==this.width||null!==this.height){var s=t.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);null!==this.width&&(i=s.x),null!==this.height&&(n=s.y)}if(this.checkResize&&(null===this.width||null===this.height)){var r=this.size=e.getElementSize(this.element);null===this.width&&(i=r.x),null===this.height&&(n=r.y)}return new e.Point(i,n)},_getBoundingBox:function(e,t){var i=this._getPlacementPoint(e);return e.rotate(t,i).getBoundingBox()},_getPlacementPoint:function(t){var i=new e.Point(t.x,t.y),n=e.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?i.x+=t.width/2:n.isRight&&(i.x+=t.width),n.isVerticallyCentered?i.y+=t.height/2:n.isBottom&&(i.y+=t.height)),i},_getTransformOrigin:function(){var t="",i=e.Placement.properties[this.placement];return i?(i.isLeft?t="left":i.isRight&&(t="right"),i.isTop?t+=" top":i.isBottom&&(t+=" bottom"),t):t},update:function(t,i){var n=e.isPlainObject(t)?t:{location:t,placement:i};this._init({location:n.location||this.location,placement:void 0!==n.placement?n.placement:this.placement,onDraw:n.onDraw||this.onDraw,checkResize:n.checkResize||this.checkResize,width:void 0!==n.width?n.width:this.width,height:void 0!==n.height?n.height:this.height,rotationMode:n.rotationMode||this.rotationMode})},getBounds:function(t){e.console.assert(t,"A viewport must now be passed to Overlay.getBounds.");var i=this.width,n=this.height;if(null===i||null===n){var s=t.deltaPointsFromPixelsNoRotate(this.size,!0);null===i&&(i=s.x),null===n&&(n=s.y)}var r=this.location.clone();return this.adjust(r,new e.Point(i,n)),this._adjustBoundsForRotation(t,new e.Rect(r.x,r.y,i,n))},_adjustBoundsForRotation:function(t,i){if(!t||0===t.degrees||this.rotationMode===e.OverlayRotationMode.EXACT)return i;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return i;var n=this._getOverlayPositionAndSize(t);return t.viewerElementToViewportRectangle(new e.Rect(n.position.x,n.position.y,n.size.x,n.size.y))}return i.rotate(-t.degrees,this._getPlacementPoint(i))}}}(t),function(e){e.Drawer=function(t){e.console.assert(t.viewer,"[Drawer] options.viewer is required");var i=arguments;if(e.isPlainObject(t)||(t={source:i[0],viewport:i[1],element:i[2]}),e.console.assert(t.viewport,"[Drawer] options.viewport is required"),e.console.assert(t.element,"[Drawer] options.element is required"),t.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=t.viewer,this.viewport=t.viewport,this.debugGridColor="string"==typeof t.debugGridColor?[t.debugGridColor]:t.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,t.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=e.getElement(t.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var n=this._calculateCanvasSize();this.canvas.width=n.x,this.canvas.height=n.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),e.setElementPointerEventsNone(this.canvas),e.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(t,i,n,s){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(t,i,n,s),this},updateOverlay:function(t,i,n){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(t,i,n),this},removeOverlay:function(t){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(t),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(t){var i=this.viewport.pixelFromPointNoRotate(t,!0);return new e.Point(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio)},clipWithPolygons:function(e,t){if(this.useCanvas){var i=this._getContext(t);i.beginPath(),e.forEach((function(e){e.forEach((function(e,t){i[0===t?"moveTo":"lineTo"](e.x,e.y)}))})),i.clip()}},setOpacity:function(t){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var i=this.viewer.world,n=0;n<i.getItemCount();n++)i.getItemAt(n).setOpacity(t);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var t=this.viewer.world,i=0,n=0;n<t.getItemCount();n++){var s=t.getItemAt(n).getOpacity();s>i&&(i=s)}return i},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var e=this._calculateCanvasSize();if((this.canvas.width!==e.x||this.canvas.height!==e.y)&&(this.canvas.width=e.x,this.canvas.height=e.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas)){var t=this._calculateSketchCanvasSize();this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(e,t){if(this.useCanvas){var i=this._getContext(e);if(t)i.clearRect(t.x,t.y,t.width,t.height);else{var n=i.canvas;i.clearRect(0,0,n.width,n.height)}}},viewportToDrawerRectangle:function(t){var i=this.viewport.pixelFromPointNoRotate(t.getTopLeft(),!0),n=this.viewport.deltaPixelsFromPointsNoRotate(t.getSize(),!0);return new e.Rect(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio,n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio)},drawTile:function(t,i,n,s,r){if(e.console.assert(t,"[Drawer.drawTile] tile is required"),e.console.assert(i,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var o=this._getContext(n);s=s||1,t.drawCanvas(o,i,s,r)}else t.drawHTML(this.canvas)},_getContext:function(e){var t=this.context;if(e){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var i=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=i.x,this.sketchCanvas.height=i.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var n=this;this.viewer.addHandler("rotate",(function e(){if(0!==n.viewport.getRotation()){n.viewer.removeHandler("rotate",e);var t=n._calculateSketchCanvasSize();n.sketchCanvas.width=t.x,n.sketchCanvas.height=t.y}}))}this._updateImageSmoothingEnabled(this.sketchContext)}t=this.sketchContext}return t},saveContext:function(e){this.useCanvas&&this._getContext(e).save()},restoreContext:function(e){this.useCanvas&&this._getContext(e).restore()},setClip:function(e,t){if(this.useCanvas){var i=this._getContext(t);i.beginPath(),i.rect(e.x,e.y,e.width,e.height),i.clip()}},drawRectangle:function(e,t,i){if(this.useCanvas){var n=this._getContext(i);n.save(),n.fillStyle=t,n.fillRect(e.x,e.y,e.width,e.height),n.restore()}},blendSketch:function(t,i,n,s){var r=t;if(e.isPlainObject(r)||(r={opacity:t,scale:i,translate:n,compositeOperation:s}),this.useCanvas&&this.sketchCanvas){t=r.opacity,s=r.compositeOperation;var o=r.bounds;if(this.context.save(),this.context.globalAlpha=t,s&&(this.context.globalCompositeOperation=s),o)o.x<0&&(o.width+=o.x,o.x=0),o.x+o.width>this.canvas.width&&(o.width=this.canvas.width-o.x),o.y<0&&(o.height+=o.y,o.y=0),o.y+o.height>this.canvas.height&&(o.height=this.canvas.height-o.y),this.context.drawImage(this.sketchCanvas,o.x,o.y,o.width,o.height,o.x,o.y,o.width,o.height);else{i=r.scale||1;var a=(n=r.translate)instanceof e.Point?n:new e.Point(0,0),l=0,h=0;if(n){var u=this.sketchCanvas.width-this.canvas.width,c=this.sketchCanvas.height-this.canvas.height;l=Math.round(u/2),h=Math.round(c/2)}this.context.drawImage(this.sketchCanvas,a.x-l*i,a.y-h*i,(this.canvas.width+2*l)*i,(this.canvas.height+2*h)*i,-l,-h,this.canvas.width+2*l,this.canvas.height+2*h)}this.context.restore()}},drawDebugInfo:function(t,i,n,s){if(this.useCanvas){var r=this.viewer.world.getIndexOfItem(s)%this.debugGridColor.length,o=this.context;o.save(),o.lineWidth=2*e.pixelDensityRatio,o.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",o.strokeStyle=this.debugGridColor[r],o.fillStyle=this.debugGridColor[r],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),s.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:s.getRotation(!0),point:s.viewport.pixelFromPointNoRotate(s._getRotationPoint(!0),!0)}),0===s.viewport.degrees&&s.getRotation(!0)%360==0&&s._drawer.viewer.viewport.getFlip()&&s._drawer._flip(),o.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio);var a=(t.position.x+t.size.x/2)*e.pixelDensityRatio,l=(t.position.y+t.size.y/2)*e.pixelDensityRatio;o.translate(a,l),o.rotate(Math.PI/180*-this.viewport.degrees),o.translate(-a,-l),0===t.x&&0===t.y&&(o.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),o.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),o.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),o.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),o.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),o.fillText("Order: "+n+" of "+i,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),o.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),o.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),s.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===s.viewport.degrees&&s.getRotation(!0)%360==0&&s._drawer.viewer.viewport.getFlip()&&s._drawer._flip(),o.restore()}},debugRect:function(t){if(this.useCanvas){var i=this.context;i.save(),i.lineWidth=2*e.pixelDensityRatio,i.strokeStyle=this.debugGridColor[0],i.fillStyle=this.debugGridColor[0],i.strokeRect(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio,t.width*e.pixelDensityRatio,t.height*e.pixelDensityRatio),i.restore()}},setImageSmoothingEnabled:function(e){this.useCanvas&&(this._imageSmoothingEnabled=e,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(e){e.msImageSmoothingEnabled=this._imageSmoothingEnabled,e.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(t){var i=this._getContext(t).canvas;return new e.Point(i.width,i.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(t){var i=t.point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(t.useSketch);n.save(),n.translate(i.x,i.y),this.viewer.viewport.flipped?(n.rotate(Math.PI/180*-t.degrees),n.scale(-1,1)):n.rotate(Math.PI/180*t.degrees),n.translate(-i.x,-i.y)},_flip:function(t){var i=(t=t||{}).point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(t.useSketch);n.translate(i.x,0),n.scale(-1,1),n.translate(-i.x,0)},_restoreRotationChanges:function(e){this._getContext(e).restore()},_calculateCanvasSize:function(){var t=e.pixelDensityRatio,i=this.viewport.getContainerSize();return{x:Math.round(i.x*t),y:Math.round(i.y*t)}},_calculateSketchCanvasSize:function(){var e=this._calculateCanvasSize();if(0===this.viewport.getRotation())return e;var t=Math.ceil(Math.sqrt(e.x*e.x+e.y*e.y));return{x:t,y:t}}}}(t),function(e){e.Viewport=function(t){var i=arguments;i.length&&i[0]instanceof e.Point&&(t={containerSize:i[0],contentSize:i[1],config:i[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t.margins||{}),delete t.margins,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer},t),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){return e.console.assert(t,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(t instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(t.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(t.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,t.y/t.x),t.x),this},setHomeBounds:function(t,i){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(t,i)},_setContentBounds:function(t,i){e.console.assert(t,"[Viewport._setContentBounds] bounds is required"),e.console.assert(t instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(t.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(t.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=t.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=t.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?e>=1?e:1:e>=1?1:e)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var t=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new e.Rect(t.x-i/2,t.y-n/2,i,n)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(t){e.console.assert("object"===e.type(t),"[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation())},getBoundsNoRotate:function(t){var i=this.getCenter(t),n=1/this.getZoom(t),s=n/this.getAspectRatio();return new e.Rect(i.x-n/2,i.y-s/2,n,s)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var t=this.getBoundsNoRotate(e),i=this._containerInnerSize.x*this.getZoom(e);return t.x-=this._margins.left/i,t.y-=this._margins.top/i,t.width+=(this._margins.left+this._margins.right)/i,t.height+=(this._margins.top+this._margins.bottom)/i,t},getCenter:function(t){var i,n,s,r,o,a,l=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),h=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?l:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),r=(s=1/(n=this.getZoom()))/this.getAspectRatio(),o=new e.Rect(l.x-s/2,l.y-r/2,s,r),a=this._pixelFromPoint(this.zoomPoint,o).minus(i).divide(this._containerInnerSize.x*n),h.plus(a)):h},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(t){var i=new e.Rect(t.x,t.y,t.width,t.height);if(this.wrapHorizontal);else{var n=this.visibilityRatio*i.width,s=i.x+i.width,r=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,o=this._contentBoundsNoRotate.x-s+n,a=r-i.x-n;n>this._contentBoundsNoRotate.width?i.x+=(o+a)/2:a<0?i.x+=a:o>0&&(i.x+=o)}if(this.wrapVertical);else{var l=this.visibilityRatio*i.height,h=i.y+i.height,u=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,c=this._contentBoundsNoRotate.y-h+l,d=u-i.y-l;l>this._contentBoundsNoRotate.height?i.y+=(c+d)/2:d<0?i.y+=d:c>0&&(i.y+=c)}return i},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var t=this.getZoom(),i=this._applyZoomConstraints(t);t!==i&&this.zoomTo(i,this.zoomPoint,e);var n=this.getBoundsNoRotate(),s=this._applyBoundaryConstraints(n);return this._raiseConstraintsEvent(e),(n.x!==s.x||n.y!==s.y||e)&&this.fitBounds(s.rotate(-this.getRotation()),e),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(t,i){var n=(i=i||{}).immediately||!1,s=i.constraints||!1,r=this.getAspectRatio(),o=t.getCenter(),a=new e.Rect(t.x,t.y,t.width,t.height,t.degrees+this.getRotation()).getBoundingBox();a.getAspectRatio()>=r?a.height=a.width/r:a.width=a.height*r,a.x=o.x-a.width/2,a.y=o.y-a.height/2;var l=1/a.width;if(s){var h=a.getAspectRatio(),u=this._applyZoomConstraints(l);l!==u&&(l=u,a.width=1/l,a.x=o.x-a.width/2,a.height=a.width/h,a.y=o.y-a.height/2),o=(a=this._applyBoundaryConstraints(a)).getCenter(),this._raiseConstraintsEvent(n)}if(n)return this.panTo(o,!0),this.zoomTo(l,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var c=this.getBounds(),d=this.getZoom();if(0===d||Math.abs(l/d-1)<1e-8)return this.zoomTo(l,!0),this.panTo(o,n);var p=(a=a.rotate(-this.getRotation())).getTopLeft().times(l).minus(c.getTopLeft().times(d)).divide(l-d);return this.zoomTo(l,p,n)},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(t){var i=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,t)},fitHorizontally:function(t){var i=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,t)},getConstrainedBounds:function(e){var t;return t=this.getBounds(e),this._applyBoundaryConstraints(t)},panBy:function(t,i){var n=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(t),i)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(e,t,i){return this.zoomTo(this.zoomSpring.target.value*e,t,i)},zoomTo:function(t,i,n){var s=this;return this.zoomPoint=i instanceof e.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,n?this._adjustCenterSpringsForZoomPoint((function(){s.zoomSpring.resetTo(t)})):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:i,immediately:n}),this},setRotation:function(t){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=e.positiveModulo(t,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:t}),this):this},getRotation:function(){return this.degrees},resize:function(e,t){var i,n=this.getBoundsNoRotate(),s=n;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),t&&(i=e.x/this.containerSize.x,s.width=n.width*i,s.height=s.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:t}),this.fitBounds(s,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e=this;this._adjustCenterSpringsForZoomPoint((function(){e.zoomSpring.update()})),this.centerSpringX.update(),this.centerSpringY.update();var t=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,t},_adjustCenterSpringsForZoomPoint:function(e){if(this.zoomPoint){var t=this.pixelFromPoint(this.zoomPoint,!0);e();var i=this.pixelFromPoint(this.zoomPoint,!0).minus(t),n=this.deltaPointsFromPixels(i,!0);this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else e()},deltaPixelsFromPointsNoRotate:function(e,t){return e.times(this._containerInnerSize.x*this.getZoom(t))},deltaPixelsFromPoints:function(e,t){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()),t)},deltaPointsFromPixelsNoRotate:function(e,t){return e.divide(this._containerInnerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return this.deltaPointsFromPixelsNoRotate(e,t).rotate(-this.getRotation())},pixelFromPointNoRotate:function(e,t){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(t))},pixelFromPoint:function(e,t){return this._pixelFromPoint(e,this.getBoundsNoRotate(t))},_pixelFromPointNoRotate:function(t,i){return t.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,t){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(),this.getCenter(!0)),t)},pointFromPixelNoRotate:function(t,i){var n=this.getBoundsNoRotate(i);return t.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/n.width).plus(n.getTopLeft())},pointFromPixel:function(e,t){return this.pointFromPixelNoRotate(e,t).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(t,i){var n=this._contentBoundsNoRotate.width;return new e.Point(t*this._contentSizeNoRotate.x/n,i*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(t,i){if(t instanceof e.Point)return this.viewportToImageCoordinates(t.x,t.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===n){return this.viewer.world.getItemAt(0).viewportToImageCoordinates(t,i,!0)}}return this._viewportToImageDelta(t-this._contentBoundsNoRotate.x,i-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(t,i){var n=this._contentBoundsNoRotate.width;return new e.Point(t/this._contentSizeNoRotate.x*n,i/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(t,i){if(t instanceof e.Point)return this.imageToViewportCoordinates(t.x,t.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===n){return this.viewer.world.getItemAt(0).imageToViewportCoordinates(t,i,!0)}}var s=this._imageToViewportDelta(t,i);return s.x+=this._contentBoundsNoRotate.x,s.y+=this._contentBoundsNoRotate.y,s},imageToViewportRectangle:function(t,i,n,s){var r=t;if(r instanceof e.Rect||(r=new e.Rect(t,i,n,s)),this.viewer){var o=this.viewer.world.getItemCount();if(o>1)e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===o){return this.viewer.world.getItemAt(0).imageToViewportRectangle(t,i,n,s,!0)}}var a=this.imageToViewportCoordinates(r.x,r.y),l=this._imageToViewportDelta(r.width,r.height);return new e.Rect(a.x,a.y,l.x,l.y,r.degrees)},viewportToImageRectangle:function(t,i,n,s){var r=t;if(r instanceof e.Rect||(r=new e.Rect(t,i,n,s)),this.viewer){var o=this.viewer.world.getItemCount();if(o>1)e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===o){return this.viewer.world.getItemAt(0).viewportToImageRectangle(t,i,n,s,!0)}}var a=this.viewportToImageCoordinates(r.x,r.y),l=this._viewportToImageDelta(r.width,r.height);return new e.Rect(a.x,a.y,l.x,l.y,r.degrees)},viewerElementToImageCoordinates:function(e){var t=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var i=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(i)},imageToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(t){return e.Rect.fromSummits(this.pointFromPixel(t.getTopLeft(),!0),this.pointFromPixel(t.getTopRight(),!0),this.pointFromPixel(t.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(t){return e.Rect.fromSummits(this.pixelFromPoint(t.getTopLeft(),!0),this.pixelFromPoint(t.getTopRight(),!0),this.pixelFromPoint(t.getBottomLeft(),!0))},windowToViewportCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var i=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(i)},viewportToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===i){return this.viewer.world.getItemAt(0).viewportToImageZoom(t)}}var n=this._contentSizeNoRotate.x;return t*(this._containerInnerSize.x/n*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===i){return this.viewer.world.getItemAt(0).imageToViewportZoom(t)}}return t*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(e){return this.flipped===e||(this.flipped=e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:e})),this}}}(t),function(e){function i(e,t,i,s,r,o,a,h,u){var c=a.getBoundingBox().getTopLeft(),d=a.getBoundingBox().getBottomRight();e.viewer&&e.viewer.raiseEvent("update-level",{tiledImage:e,havedrawn:t,level:s,opacity:r,visibility:o,drawArea:a,topleft:c,bottomright:d,currenttime:h,best:u}),l(e.coverage,s),l(e.loadingCoverage,s);var p=e._getCornerTiles(s,c,d),m=p.topLeft,g=p.bottomRight,f=e.source.getNumTiles(s),v=e.viewport.pixelFromPoint(e.viewport.getCenter());e.getFlip()&&(g.x+=1,e.wrapHorizontal||(g.x=Math.min(g.x,f.x-1)));for(var y=m.x;y<=g.x;y++)for(var _=m.y;_<=g.y;_++){var w;if(e.getFlip()){var b=(f.x+y%f.x)%f.x;w=y+f.x-b-b-1}else w=y;null!==a.intersection(e.getTileBounds(s,w,_))&&(u=n(e,i,t,w,_,s,r,o,v,f,h,u))}return u}function n(t,i,n,r,l,h,u,c,d,p,m,g){var f=function(t,i,n,s,r,o,a,l,h,u){var c,d,p,m,g,f,v,y,_;o[n]||(o[n]={});o[n][t]||(o[n][t]={});o[n][t][i]&&!o[n][t][i].flipped==!s.flipped||(c=(l.x+t%l.x)%l.x,d=(l.y+i%l.y)%l.y,p=s.getTileBounds(n,t,i),m=r.getTileBounds(n,c,d,!0),g=r.tileExists(n,c,d),f=r.getTileUrl(n,c,d),s.loadTilesWithAjax?(v=r.getTileAjaxHeaders(n,c,d),e.isPlainObject(s.ajaxHeaders)&&(v=e.extend({},s.ajaxHeaders,v))):v=null,y=r.getContext2D?r.getContext2D(n,c,d):void 0,_=new e.Tile(n,t,i,p,g,f,y,s.loadTilesWithAjax,v,m),s.getFlip()?0===c&&(_.isRightMost=!0):c===l.x-1&&(_.isRightMost=!0),d===l.y-1&&(_.isBottomMost=!0),_.flipped=s.flipped,o[n][t][i]=_);return(_=o[n][t][i]).lastTouchTime=a,_}(r,l,h,t,t.source,t.tilesMatrix,m,p,t._worldWidthCurrent,t._worldHeightCurrent),v=n;t.viewer&&t.viewer.raiseEvent("update-tile",{tiledImage:t,tile:f}),a(t.coverage,h,r,l,!1);var y=f.loaded||f.loading||o(t.loadingCoverage,h,r,l);if(a(t.loadingCoverage,h,r,l,y),!f.exists)return g;if(i&&!v&&(o(t.coverage,h,r,l)?a(t.coverage,h,r,l,!0):v=!0),!v)return g;if(function(t,i,n,s,r,o){var a=t.bounds.getTopLeft();a.x*=o._scaleSpring.current.value,a.y*=o._scaleSpring.current.value,a.x+=o._xSpring.current.value,a.y+=o._ySpring.current.value;var l=t.bounds.getSize();l.x*=o._scaleSpring.current.value,l.y*=o._scaleSpring.current.value;var h=n.pixelFromPointNoRotate(a,!0),u=n.pixelFromPointNoRotate(a,!1),c=n.deltaPixelsFromPointsNoRotate(l,!0),d=n.deltaPixelsFromPointsNoRotate(l,!1),p=u.plus(d.divide(2)),m=s.squaredDistanceTo(p);i||(c=c.plus(new e.Point(1,1)));t.isRightMost&&o.wrapHorizontal&&(c.x+=.75);t.isBottomMost&&o.wrapVertical&&(c.y+=.75);t.position=h,t.size=c,t.squaredDistance=m,t.visibility=r}(f,t.source.tileOverlap,t.viewport,d,c,t),!f.loaded)if(f.context2D)s(t,f);else{var _=t._tileCache.getImageRecord(f.cacheKey);if(_)s(t,f,_.getImage())}f.loaded?function(e,t,i,n,s,r,o){var l,h,u=1e3*e.blendTime;t.blendStart||(t.blendStart=o);l=o-t.blendStart,h=u?Math.min(1,l/u):1,e.alwaysBlend&&(h*=r);if(t.opacity=h,e.lastDrawn.push(t),1===h)a(e.coverage,s,i,n,!0),e._hasOpaqueTile=!0;else if(l<u)return!0;return!1}(t,f,r,l,h,u,m)&&(t._needsDraw=!0):f.loading?t._tilesLoading++:y||(g=function(e,t){if(!e)return t;if(t.visibility>e.visibility)return t;if(t.visibility===e.visibility&&t.squaredDistance<e.squaredDistance)return t;return e}(g,f));return g}function s(e,t,i,n,s){var r=0;function o(){return r++,a}function a(){0===--r&&(t.loading=!1,t.loaded=!0,t.context2D||e._tileCache.cacheTile({image:i,tile:t,cutoff:n,tiledImage:e}),e._needsDraw=!0)}e.viewer.raiseEvent("tile-loaded",{tile:t,tiledImage:e,tileRequest:s,image:i,getCompletionCallback:o}),o()()}function r(e,t,i,n){var s,r,o,a;if(!e[t])return!1;if(void 0===i||void 0===n){for(o in s=e[t])if(Object.prototype.hasOwnProperty.call(s,o))for(a in r=s[o])if(Object.prototype.hasOwnProperty.call(r,a)&&!r[a])return!1;return!0}return void 0===e[t][i]||void 0===e[t][i][n]||!0===e[t][i][n]}function o(e,t,i,n){return void 0===i||void 0===n?r(e,t+1):r(e,t+1,2*i,2*n)&&r(e,t+1,2*i,2*n+1)&&r(e,t+1,2*i+1,2*n)&&r(e,t+1,2*i+1,2*n+1)}function a(t,i,n,s,r){t[i]?(t[i][n]||(t[i][n]={}),t[i][n][s]=r):e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",i)}function l(e,t){e[t]={}}e.TiledImage=function(i){var n=this;e.console.assert(i.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(i.drawer,"[TiledImage] options.drawer is required"),e.console.assert(i.viewer,"[TiledImage] options.viewer is required"),e.console.assert(i.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(i.source,"[TiledImage] options.source is required"),e.console.assert(!i.clip||i.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=i.tileCache,delete i.tileCache,this._drawer=i.drawer,delete i.drawer,this._imageLoader=i.imageLoader,delete i.imageLoader,i.clip instanceof e.Rect&&(this._clip=i.clip.clone()),delete i.clip;var s=i.x||0;delete i.x;var r=i.y||0;delete i.y,this.normHeight=i.source.dimensions.y/i.source.dimensions.x,this.contentAspectX=i.source.dimensions.x/i.source.dimensions.y;var o=1;i.width?(o=i.width,delete i.width,i.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete i.height)):i.height&&(o=i.height/this.normHeight,delete i.height);var a=i.fitBounds;delete i.fitBounds;var l=i.fitBoundsPlacement||t.Placement.CENTER;delete i.fitBoundsPlacement;var h=i.degrees||0;delete i.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation},i),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:s,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:o,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:h,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),a&&this.fitBounds(a,l,!0),this._drawingHandler=function(t){n.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:n},t))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(e){e!==this._fullyLoaded&&(this._fullyLoaded=e,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var e=this._xSpring.update(),t=this._ySpring.update(),i=this._scaleSpring.update(),n=this._degreesSpring.update();return!!(e||t||i||n)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(this.getRotation(e),this._getRotationPoint(e))},getBoundsNoRotate:function(t){return t?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(t){var i=this.getBoundsNoRotate(t);if(this._clip){var n=(t?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,s=this._clip.times(n);i=new e.Rect(i.x+s.x,i.y+s.y,s.width,s.height)}return i.rotate(this.getRotation(t),this._getRotationPoint(t))},getTileBounds:function(e,t,i){var n=this.source.getNumTiles(e),s=(n.x+t%n.x)%n.x,r=(n.y+i%n.y)%n.y,o=this.source.getTileBounds(e,s,r);return this.getFlip()&&(o.x=1-o.x-o.width),o.x+=(t-s)/n.x,o.y+=this._worldHeightCurrent/this._worldWidthCurrent*((i-r)/n.y),o},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var t=this.imageToWindowCoordinates(new e.Point(0,0)),i=this.imageToWindowCoordinates(this.getContentSize());return new e.Point(i.x-t.x,i.y-t.y)},_viewportToImageDelta:function(t,i,n){var s=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t*(this.source.dimensions.x/s),i*(this.source.dimensions.y*this.contentAspectX/s))},viewportToImageCoordinates:function(t,i,n){var s;return t instanceof e.Point?(n=i,s=t):s=new e.Point(t,i),s=s.rotate(-this.getRotation(n),this._getRotationPoint(n)),n?this._viewportToImageDelta(s.x-this._xSpring.current.value,s.y-this._ySpring.current.value):this._viewportToImageDelta(s.x-this._xSpring.target.value,s.y-this._ySpring.target.value)},_imageToViewportDelta:function(t,i,n){var s=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t/this.source.dimensions.x*s,i/this.source.dimensions.y/this.contentAspectX*s)},imageToViewportCoordinates:function(t,i,n){t instanceof e.Point&&(n=i,i=t.y,t=t.x);var s=this._imageToViewportDelta(t,i);return n?(s.x+=this._xSpring.current.value,s.y+=this._ySpring.current.value):(s.x+=this._xSpring.target.value,s.y+=this._ySpring.target.value),s.rotate(this.getRotation(n),this._getRotationPoint(n))},imageToViewportRectangle:function(t,i,n,s,r){var o=t;o instanceof e.Rect?r=i:o=new e.Rect(t,i,n,s);var a=this.imageToViewportCoordinates(o.getTopLeft(),r),l=this._imageToViewportDelta(o.width,o.height,r);return new e.Rect(a.x,a.y,l.x,l.y,o.degrees+this.getRotation(r))},viewportToImageRectangle:function(t,i,n,s,r){var o=t;t instanceof e.Rect?r=i:o=new e.Rect(t,i,n,s);var a=this.viewportToImageCoordinates(o.getTopLeft(),r),l=this._viewportToImageDelta(o.width,o.height,r);return new e.Rect(a.x,a.y,l.x,l.y,o.degrees-this.getRotation(r))},viewerElementToImageCoordinates:function(e){var t=this.viewport.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.viewport.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){var i=e.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(i)},imageToWindowCoordinates:function(e){return this.imageToViewerElementCoordinates(e).plus(t.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(t){var i=this._scaleSpring.current.value;return t=t.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((t.x-this._xSpring.current.value)/i,(t.y-this._ySpring.current.value)/i,t.width/i,t.height/i,t.degrees)},viewportToImageZoom:function(e){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*e},imageToViewportZoom:function(e){return e/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(e,t){var i=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(t){if(i&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y),this._needsDraw=!0}else{if(i)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y),this._needsDraw=!0}i||this._raiseBoundsChange()},setWidth:function(e,t){this._setScale(e,t)},setHeight:function(e,t){this._setScale(e/this.normHeight,t)},setCroppingPolygons:function(t){var i=function(t){return t.map((function(t){try{if(function(t){return t instanceof e.Point||"number"==typeof t.x&&"number"==typeof t.y}(t))return{x:t.x,y:t.y};throw new Error}catch(e){throw new Error("A Provided cropping polygon point is not supported")}}))};try{if(!e.isArray(t))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=t.map((function(e){return i(e)}))}catch(t){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(t),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(t,i,n){i=i||e.Placement.CENTER;var s=e.Placement.properties[i],r=this.contentAspectX,o=0,a=0,l=1,h=1;if(this._clip&&(r=this._clip.getAspectRatio(),l=this._clip.width/this.source.dimensions.x,h=this._clip.height/this.source.dimensions.y,t.getAspectRatio()>r?(o=this._clip.x/this._clip.height*t.height,a=this._clip.y/this._clip.height*t.height):(o=this._clip.x/this._clip.width*t.width,a=this._clip.y/this._clip.width*t.width)),t.getAspectRatio()>r){var u=t.height/h,c=0;s.isHorizontallyCentered?c=(t.width-t.height*r)/2:s.isRight&&(c=t.width-t.height*r),this.setPosition(new e.Point(t.x-o+c,t.y-a),n),this.setHeight(u,n)}else{var d=t.width/l,p=0;s.isVerticallyCentered?p=(t.height-t.width/r)/2:s.isBottom&&(p=t.height-t.width/r),this.setPosition(new e.Point(t.x-o,t.y-a+p),n),this.setWidth(d,n)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(t){e.console.assert(!t||t instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),t instanceof e.Rect?this._clip=t.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(e){this.flipped=!!e,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(e){e!==this.opacity&&(this.opacity=e,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(e){this._preload=!!e,this._needsDraw=!0},getRotation:function(e){return e?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(e,t){this._degreesSpring.target.value===e&&this._degreesSpring.isAtTargetValue()||(t?this._degreesSpring.resetTo(e):this._degreesSpring.springTo(e),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(e){return this.getBoundsNoRotate(e).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(e){e!==this.compositeOperation&&(this.compositeOperation=e,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(e,t){var i=this._scaleSpring.target.value===e;if(t){if(i&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e),this._updateForScale(),this._needsDraw=!0}else{if(i)return;this._scaleSpring.springTo(e),this._updateForScale(),this._needsDraw=!0}i||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var e=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),t=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,i=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(t/this.minPixelRatio)/Math.log(2))));return i=Math.max(i,this.source.minLevel||0),{lowestLevel:e=Math.min(e,i),highestLevel:i}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){this.lastDrawn.pop().beingDrawn=!1}var t=this.viewport,n=this._viewportToTiledImageRectangle(t.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var o=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(n=n.intersection(o)))return}for(var a=this._getLevelsInterval(),l=a.lowestLevel,h=a.highestLevel,u=null,c=!1,d=e.now(),p=h;p>=l;p--){var m=!1,g=t.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(p),!0).x*this._scaleSpring.current.value;if(p===l||!c&&g>=this.minPixelRatio)m=!0,c=!0;else if(!c)continue;var f=t.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(p),!1).x*this._scaleSpring.current.value,v=t.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,y=this.immediateRender?1:v;if(u=i(this,c,m,p,Math.min(1,(g-.5)/.5),y/Math.abs(y-f),n,d,u),r(this.coverage,p))break}!function(t,i){if(0===t.opacity||0===i.length&&!t.placeholderFillStyle)return;var n,s,r,o=i[0];o&&(n=t.opacity<1||t.compositeOperation&&"source-over"!==t.compositeOperation||!t._isBottomItem()&&o._hasTransparencyChannel());var a,l=t.viewport.getZoom(!0),h=t.viewportToImageZoom(l);i.length>1&&h>t.smoothTileEdgesMinZoom&&!t.iOSDevice&&t.getRotation(!0)%360==0&&e.supportsCanvas&&(n=!0,s=o.getScaleForEdgeSmoothing(),r=o.getTranslationForEdgeSmoothing(s,t._drawer.getCanvasSize(!1),t._drawer.getCanvasSize(!0)));n&&(s||(a=t.viewport.viewportToViewerElementRectangle(t.getClippedBounds(!0)).getIntegerBoundingBox(),t._drawer.viewer.viewport.getFlip()&&(0===t.viewport.degrees&&t.getRotation(!0)%360==0||(a.x=t._drawer.viewer.container.clientWidth-(a.x+a.width))),a=a.times(e.pixelDensityRatio)),t._drawer._clear(!0,a));s||(0!==t.viewport.degrees&&t._drawer._offsetForRotation({degrees:t.viewport.degrees,useSketch:n}),t.getRotation(!0)%360!=0&&t._drawer._offsetForRotation({degrees:t.getRotation(!0),point:t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0),!0),useSketch:n}),0===t.viewport.degrees&&t.getRotation(!0)%360==0&&t._drawer.viewer.viewport.getFlip()&&t._drawer._flip());var u=!1;if(t._clip){t._drawer.saveContext(n);var c=t.imageToViewportRectangle(t._clip,!0);c=c.rotate(-t.getRotation(!0),t._getRotationPoint(!0));var d=t._drawer.viewportToDrawerRectangle(c);s&&(d=d.times(s)),r&&(d=d.translate(r)),t._drawer.setClip(d,n),u=!0}if(t._croppingPolygons){t._drawer.saveContext(n);try{var p=t._croppingPolygons.map((function(e){return e.map((function(e){var i=t.imageToViewportCoordinates(e.x,e.y,!0).rotate(-t.getRotation(!0),t._getRotationPoint(!0)),n=t._drawer.viewportCoordToDrawerCoord(i);return s&&(n=n.times(s)),n}))}));t._drawer.clipWithPolygons(p,n)}catch(t){e.console.error(t)}u=!0}if(t.placeholderFillStyle&&!1===t._hasOpaqueTile){var m=t._drawer.viewportToDrawerRectangle(t.getBounds(!0));s&&(m=m.times(s)),r&&(m=m.translate(r));var g=null;g="function"==typeof t.placeholderFillStyle?t.placeholderFillStyle(t,t._drawer.context):t.placeholderFillStyle,t._drawer.drawRectangle(m,g,n)}for(var f=i.length-1;f>=0;f--)o=i[f],t._drawer.drawTile(o,t._drawingHandler,n,s,r),o.beingDrawn=!0,t.viewer&&t.viewer.raiseEvent("tile-drawn",{tiledImage:t,tile:o});u&&t._drawer.restoreContext(n);s||(t.getRotation(!0)%360!=0&&t._drawer._restoreRotationChanges(n),0!==t.viewport.degrees&&t._drawer._restoreRotationChanges(n));n&&(s&&(0!==t.viewport.degrees&&t._drawer._offsetForRotation({degrees:t.viewport.degrees,useSketch:!1}),t.getRotation(!0)%360!=0&&t._drawer._offsetForRotation({degrees:t.getRotation(!0),point:t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0),!0),useSketch:!1})),t._drawer.blendSketch({opacity:t.opacity,scale:s,translate:r,compositeOperation:t.compositeOperation,bounds:a}),s&&(t.getRotation(!0)%360!=0&&t._drawer._restoreRotationChanges(!1),0!==t.viewport.degrees&&t._drawer._restoreRotationChanges(!1)));s||0===t.viewport.degrees&&t.getRotation(!0)%360==0&&t._drawer.viewer.viewport.getFlip()&&t._drawer._flip();!function(t,i){if(t.debugMode)for(var n=i.length-1;n>=0;n--){var s=i[n];try{t._drawer.drawDebugInfo(s,i.length,n,t)}catch(t){e.console.error(t)}}}(t,i)}(this,this.lastDrawn),u&&!u.context2D?(!function(t,i,n){i.loading=!0,t._imageLoader.addJob({src:i.url,loadWithAjax:i.loadWithAjax,ajaxHeaders:i.ajaxHeaders,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,callback:function(r,o,a){!function(t,i,n,r,o,a){if(!r)return e.console.log("Tile %s failed to load: %s - error: %s",i,i.url,o),t.viewer.raiseEvent("tile-load-failed",{tile:i,tiledImage:t,time:n,message:o,tileRequest:a}),i.loading=!1,void(i.exists=!1);if(n<t.lastResetTime)return e.console.log("Ignoring tile %s loaded before reset: %s",i,i.url),void(i.loading=!1);var l=function(){var e=t.source.getClosestLevel();s(t,i,r,e,a)};t._midDraw?window.setTimeout(l,1):l()}(t,i,n,r,o,a)},abort:function(){i.loading=!1}})}(this,u,d),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(t,i,n){var s,r,o,a;this.wrapHorizontal?(s=e.positiveModulo(i.x,1),r=e.positiveModulo(n.x,1)):(s=Math.max(0,i.x),r=Math.min(1,n.x));var l=1/this.source.aspectRatio;this.wrapVertical?(o=e.positiveModulo(i.y,l),a=e.positiveModulo(n.y,l)):(o=Math.max(0,i.y),a=Math.min(l,n.y));var h=this.source.getTileAtPoint(t,new e.Point(s,o)),u=this.source.getTileAtPoint(t,new e.Point(r,a)),c=this.source.getNumTiles(t);return this.wrapHorizontal&&(h.x+=c.x*Math.floor(i.x),u.x+=c.x*Math.floor(n.x)),this.wrapVertical&&(h.y+=c.y*Math.floor(i.y/l),u.y+=c.y*Math.floor(n.y/l)),{topLeft:h,bottomRight:u}}})}(t),function(e){var t=function(t){e.console.assert(t,"[TileCache.cacheTile] options is required"),e.console.assert(t.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(t.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=t.tile,this.tiledImage=t.tiledImage},i=function(t){e.console.assert(t,"[ImageRecord] options is required"),e.console.assert(t.image,"[ImageRecord] options.image is required"),this._image=t.image,this._tiles=[]};i.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var e=document.createElement("canvas");e.width=this._image.width,e.height=this._image.height,this._renderedContext=e.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(t){e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=t},addTile:function(t){e.console.assert(t,"[ImageRecord.addTile] tile is required"),this._tiles.push(t)},removeTile:function(t){for(var i=0;i<this._tiles.length;i++)if(this._tiles[i]===t)return void this._tiles.splice(i,1);e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",t)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(t){t=t||{},this._maxImageCacheCount=t.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(n){e.console.assert(n,"[TileCache.cacheTile] options is required"),e.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(n.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var s=n.cutoff||0,r=this._tilesLoaded.length,o=this._imagesLoaded[n.tile.cacheKey];if(o||(e.console.assert(n.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),o=this._imagesLoaded[n.tile.cacheKey]=new i({image:n.image}),this._imagesLoadedCount++),o.addTile(n.tile),n.tile.cacheImageRecord=o,this._imagesLoadedCount>this._maxImageCacheCount){for(var a,l,h,u,c,d,p=null,m=-1,g=null,f=this._tilesLoaded.length-1;f>=0;f--)(a=(d=this._tilesLoaded[f]).tile).level<=s||a.beingDrawn||(p?(u=a.lastTouchTime,l=p.lastTouchTime,c=a.level,h=p.level,(u<l||u===l&&c>h)&&(p=a,m=f,g=d)):(p=a,m=f,g=d));p&&m>=0&&(this._unloadTile(g),r=m)}this._tilesLoaded[r]=new t({tile:n.tile,tiledImage:n.tiledImage})},clearTilesFor:function(t){var i;e.console.assert(t,"[TileCache.clearTilesFor] tiledImage is required");for(var n=0;n<this._tilesLoaded.length;++n)(i=this._tilesLoaded[n]).tiledImage===t&&(this._unloadTile(i),this._tilesLoaded.splice(n,1),n--)},getImageRecord:function(t){return e.console.assert(t,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[t]},_unloadTile:function(t){e.console.assert(t,"[TileCache._unloadTile] tileRecord is required");var i=t.tile,n=t.tiledImage;i.unload(),i.cacheImageRecord=null;var s=this._imagesLoaded[i.cacheKey];s.removeTile(i),s.getTileCount()||(s.destroy(),delete this._imagesLoaded[i.cacheKey],this._imagesLoadedCount--),n.viewer.raiseEvent("tile-unloaded",{tile:i,tiledImage:n})}}}(t),function(e){e.World=function(t){var i=this;e.console.assert(t.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=t.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(e){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(t,i){if(e.console.assert(t,"[World.addItem] item is required"),e.console.assert(t instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(i=i||{}).index){var n=Math.max(0,Math.min(this._items.length,i.index));this._items.splice(n,0,t)}else this._items.push(t);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,t.addHandler("bounds-change",this._delegatedFigureSizes),t.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:t})},getItemAt:function(t){return e.console.assert(void 0!==t,"[World.getItemAt] index is required"),this._items[t]},getIndexOfItem:function(t){return e.console.assert(t,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,t)},getItemCount:function(){return this._items.length},setItemIndex:function(t,i){e.console.assert(t,"[World.setItemIndex] item is required"),e.console.assert(void 0!==i,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(t);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i!==n&&-1!==n&&(this._items.splice(n,1),this._items.splice(i,0,t),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:t,previousIndex:n,newIndex:i}))},removeItem:function(t){e.console.assert(t,"[World.removeItem] item is required");var i=e.indexOf(this._items,t);-1!==i&&(t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(t))},removeAll:function(){var e,t;for(this.viewer._cancelPendingImages(),t=0;t<this._items.length;t++)(e=this._items[t]).removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy();var i=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,t=0;t<i.length;t++)e=i[t],this._raiseRemoveItem(e)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(){for(var e=!1,t=0;t<this._items.length;t++)e=this._items[t].update()||e;return e},draw:function(){for(var e=0;e<this._items.length;e++)this._items[e].draw();this._needsDraw=!1},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){this._autoRefigureSizes=e,e&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(t){var i,n=(t=t||{}).immediately||!1,s=t.layout||e.DEFAULT_SETTINGS.collectionLayout,r=t.rows||e.DEFAULT_SETTINGS.collectionRows,o=t.columns||e.DEFAULT_SETTINGS.collectionColumns,a=t.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,l=a+(t.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin);i=!t.rows&&o?o:Math.ceil(this._items.length/r);var h,u,c,d,p,m=0,g=0;this.setAutoRefigureSizes(!1);for(var f=0;f<this._items.length;f++)f&&f%i==0&&("horizontal"===s?(g+=l,m=0):(m+=l,g=0)),d=(c=(u=(h=this._items[f]).getBounds()).width>u.height?a:a*(u.width/u.height))*(u.height/u.width),p=new e.Point(m+(a-c)/2,g+(a-d)/2),h.setPosition(p,n),h.setWidth(c,n),"horizontal"===s?m+=l:g+=l;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var t=this._homeBounds?this._homeBounds.clone():null,i=this._contentSize?this._contentSize.clone():null,n=this._contentFactor||0;if(this._items.length){var s=this._items[0],r=s.getBounds();this._contentFactor=s.getContentSize().x/r.width;for(var o=s.getClippedBounds().getBoundingBox(),a=o.x,l=o.y,h=o.x+o.width,u=o.y+o.height,c=1;c<this._items.length;c++)r=(s=this._items[c]).getBounds(),this._contentFactor=Math.max(this._contentFactor,s.getContentSize().x/r.width),o=s.getClippedBounds().getBoundingBox(),a=Math.min(a,o.x),l=Math.min(l,o.y),h=Math.max(h,o.x+o.width),u=Math.max(u,o.y+o.height);this._homeBounds=new e.Rect(a,l,h-a,u-l),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;this._contentFactor===n&&this._homeBounds.equals(t)&&this._contentSize.equals(i)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})}(t)}));if("undefined"!=typeof document){const e="button.svelte-1bi0voj{background:none;border:none;color:grey;cursor:pointer;margin:0;padding:0;transition:all 0.2s}button.svelte-1bi0voj:not(:disabled):hover{color:black}button.svelte-1bi0voj:disabled{cursor:default;opacity:0.5}button.overlay.svelte-1bi0voj{color:#ffffff;padding:0.35em 0.8em}button.overlay.svelte-1bi0voj:focus,button.overlay.svelte-1bi0voj:active{outline:0}button.overlay.svelte-1bi0voj:hover{color:white;outline:1px solid white}button.overlay.svelte-1bi0voj:active{color:grey}button.overlay.svelte-1bi0voj:disabled{color:grey;cursor:not-allowed}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function Ph(e){let i,n=[{height:e[1]},{width:e[0]},e[3],e[4],e[2],e[6]],s={};for(let e=0;e<n.length;e+=1)s=Y(s,n[e]);return{c(){i=K("svg"),this.h()},l(e){i=Q(e,"svg",{height:!0,width:!0}),p(i).forEach(m),this.h()},h(){J(i,s)},m(t,n){f(t,i,n),i.innerHTML=e[5]},p(e,[t]){J(i,s=ee(n,[2&t&&{height:e[1]},1&t&&{width:e[0]},e[3],e[4],4&t&&e[2],64&t&&e[6]]))},i:t,o:t,d(e){e&&m(i)}}}function Mh(e,t,i){let{name:n}=t,{width:s="1rem"}=t,{height:r="1rem"}=t,{customAttribs:o={}}=t;const a={cog:{svg:'\n        <path\n            d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"\n          />\n        <circle cx="12" cy="12" r="3" />\n      ',attribs:{"stroke-width":1.5}},sliders:{svg:'\n        <circle cx="14" cy="6" r="2" />\n        <line x1="4" y1="6" x2="12" y2="6" />\n        <line x1="16" y1="6" x2="20" y2="6" />\n        <circle cx="8" cy="12" r="2" />\n        <line x1="4" y1="12" x2="6" y2="12" />\n        <line x1="10" y1="12" x2="20" y2="12" />\n        <circle cx="17" cy="18" r="2" />\n        <line x1="4" y1="18" x2="15" y2="18" />\n        <line x1="19" y1="18" x2="20" y2="18" />\n      ',attribs:{"stroke-width":1.5}},"arrow-down":{svg:'\n        <line x1="12" y1="5" x2="12" y2="19" />\n        <line x1="16" y1="15" x2="12" y2="19" />\n        <line x1="8" y1="15" x2="12" y2="19" />\n      '},"arrow-up":{svg:'\n        <line x1="12" y1="5" x2="12" y2="19" />\n        <line x1="16" y1="9" x2="12" y2="5" />\n        <line x1="8" y1="9" x2="12" y2="5" />\n      '},"arrow-left":{svg:'\n        <line x1="5" y1="12" x2="19" y2="12" />\n        <line x1="5" y1="12" x2="9" y2="16" />\n        <line x1="5" y1="12" x2="9" y2="8" />\n      '},"arrow-right":{svg:'\n        <line x1="5" y1="12" x2="19" y2="12" />\n        <line x1="15" y1="16" x2="19" y2="12" />\n        <line x1="15" y1="8" x2="19" y2="12" />\n      '},"fit-width":{svg:'\n        <path d="M1 4v16"/>\n        <path d="M23 4v16"/>\n        <path style="stroke-width:1.5" d="M5.8 12h12.4"/>\n        <path style="stroke-width:1.5" d="m8.5 8-4 4 4 4m7-8 4 4-4 4"/>\n      '},edit:{svg:'\n        <path d="M9 7h-3a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-3" />\n        <path d="M9 15h3l8.5 -8.5a1.5 1.5 0 0 0 -3 -3l-8.5 8.5v3" />\n        <line x1="16" y1="5" x2="19" y2="8" />\n      '},minus:{svg:'<line x1="5" y1="12" x2="19" y2="12" />'},plus:{svg:'\n        <line x1="12" y1="5" x2="12" y2="19" />\n        <line x1="5" y1="12" x2="19" y2="12" />\n      '},cross:{svg:'\n        <line x1="18" y1="6" x2="6" y2="18" />\n        <line x1="6" y1="6" x2="18" y2="18" />\n      '},reset:{svg:'<path d="m 10.953,20.006141 a 8,8 0 1 1 4,-0.5 m 5,0.5 h -5 v -5" />'},piano:{svg:'\n        <rect x="2" y="7" width="20" height="12" rx="2" />\n        <line\n          x1="7"\n          y1="9"\n          x2="7"\n          y2="13.5"\n          style="stroke-width:2.5;stroke-linecap:square"\n        />\n        <line\n          x1="12"\n          y1="9"\n          x2="12"\n          y2="13.5"\n          style="stroke-width:2.5;stroke-linecap:square"\n        />\n        <line\n          x1="17"\n          y1="9"\n          x2="17"\n          y2="13.5"\n          style="stroke-width:2.5;stroke-linecap:square"\n        />\n      '},"piano-out":{svg:'\n        <path d="M11 19h-6a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v4" />\n        <rect x="14" y="14" width="7" height="5" rx="1" />\n        <line x1="7" y1="9" x2="11" y2="13" />\n        <path d="M7 12v-3h3" />\n      '},"piano-in":{svg:'\n        <path d="M11 19h-6a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v4" />\n        <rect x="14" y="14" width="7" height="5" rx="1" />\n        <line x1="7" y1="9" x2="11" y2="13" />\n        <path d="M8 13h3v-3" />\n      '},"piano-down":{svg:'\n        <rect x="2" y="3" width="20" height="12" rx="2" />\n        <line x1="7" y1="5" x2="7" y2="9.5" style="stroke-width:2.5;stroke-linecap:square" />\n        <line x1="12" y1="5" x2="12" y2="9.5" style="stroke-width:2.5;stroke-linecap:square" />\n        <line x1="17" y1="5" x2="17" y2="9.5" style="stroke-width:2.5;stroke-linecap:square" />\n        <path d="m 10,19.000041 2,2 2,-2" />\n      '},"piano-up":{svg:'\n        <rect x="2" y="3" width="20" height="12" rx="2" />\n        <line x1="7" y1="5" x2="7" y2="9.5" style="stroke-width:2.5;stroke-linecap:square" />\n        <line x1="12" y1="5" x2="12" y2="9.5" style="stroke-width:2.5;stroke-linecap:square" />\n        <line x1="17" y1="5" x2="17" y2="9.5" style="stroke-width:2.5;stroke-linecap:square" />\n        <path d="M10 21l2 -2l2 2" />\n      '},midi:{svg:'\n        <path aria-label="M" text-data="M" d="m 0,0 h 233 c 19.6,0 31,16.9 31,37 V 266 H 199 V 67 H 161 V 266 H 102 V 67 H 65 V 266 H 0 Z" />\n        <rect aria-label="I" text-data="I" x="296" y="0" width="65" height="266" />\n        <path aria-label="D" text-data="D" d="m 392,0 h 193 c 19.6,0 31,16.9 31,37 v 196 c 0,24.9 -10.4,33 -33,33 H 392 V 97 h 66 v 104 h 93 V 60 H 392 Z" />\n        <rect aria-label="I" text-data="I" x="646" y="0" width="66" height="266" />\n      ',attribs:{viewBox:"0 0 712 266",fill:"currentColor"}}},{attribs:l,svg:h}=a[n];return e.$$set=e=>{i(6,t=Y(Y({},t),te(e))),"name"in e&&i(7,n=e.name),"width"in e&&i(0,s=e.width),"height"in e&&i(1,r=e.height),"customAttribs"in e&&i(2,o=e.customAttribs)},t=te(t),[s,r,o,{viewBox:"0 0 24 24","stroke-width":2,stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},l,h,t,n]}class Rh extends a{constructor(e){super(),l(this,e,Mh,Ph,i,{name:7,width:0,height:1,customAttribs:2})}}function Dh(e,t){var i=e.getBoundingClientRect();return{width:i.width/1,height:i.height/1,top:i.top/1,right:i.right/1,bottom:i.bottom/1,left:i.left/1,x:i.left/1,y:i.top/1}}function Ah(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Oh(e){var t=Ah(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function Ih(e){return e instanceof Ah(e).Element||e instanceof Element}function Fh(e){return e instanceof Ah(e).HTMLElement||e instanceof HTMLElement}function jh(e){return e?(e.nodeName||"").toLowerCase():null}function zh(e){return((Ih(e)?e.ownerDocument:e.document)||window.document).documentElement}function Nh(e){return Ah(e).getComputedStyle(e)}function Lh(e){var t=Nh(e),i=t.overflow,n=t.overflowX,s=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+s+n)}function Bh(e,t,i){void 0===i&&(i=!1);var n=Fh(t);Fh(t)&&function(e){var t=e.getBoundingClientRect(),i=t.width/e.offsetWidth||1,n=t.height/e.offsetHeight||1}(t);var s,r=zh(t),o=Dh(e),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!i)&&(("body"!==jh(t)||Lh(r))&&(a=(s=t)!==Ah(s)&&Fh(s)?function(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}(s):Oh(s)),Fh(t)?((l=Dh(t)).x+=t.clientLeft,l.y+=t.clientTop):r&&(l.x=function(e){return Dh(zh(e)).left+Oh(e).scrollLeft}(r))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function Wh(e){var t=Dh(e),i=e.offsetWidth,n=e.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-n)<=1&&(n=t.height),{x:e.offsetLeft,y:e.offsetTop,width:i,height:n}}function qh(e){return"html"===jh(e)?e:e.assignedSlot||e.parentNode||(t=e,"undefined"!=typeof ShadowRoot&&(t instanceof Ah(t).ShadowRoot||t instanceof ShadowRoot)?e.host:null)||zh(e);var t}function $h(e){return["html","body","#document"].indexOf(jh(e))>=0?e.ownerDocument.body:Fh(e)&&Lh(e)?e:$h(qh(e))}function Vh(e,t){var i;void 0===t&&(t=[]);var n=$h(e),s=n===(null==(i=e.ownerDocument)?void 0:i.body),r=Ah(n),o=s?[r].concat(r.visualViewport||[],Lh(n)?n:[]):n,a=t.concat(o);return s?a:a.concat(Vh(qh(o)))}function Hh(e){return["table","td","th"].indexOf(jh(e))>=0}function Uh(e){return Fh(e)&&"fixed"!==Nh(e).position?e.offsetParent:null}function Gh(e){for(var t=Ah(e),i=Uh(e);i&&Hh(i)&&"static"===Nh(i).position;)i=Uh(i);return i&&("html"===jh(i)||"body"===jh(i)&&"static"===Nh(i).position)?t:i||function(e){var t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&Fh(e)&&"fixed"===Nh(e).position)return null;for(var i=qh(e);Fh(i)&&["html","body"].indexOf(jh(i))<0;){var n=Nh(i);if("none"!==n.transform||"none"!==n.perspective||"paint"===n.contain||-1!==["transform","perspective"].indexOf(n.willChange)||t&&"filter"===n.willChange||t&&n.filter&&"none"!==n.filter)return i;i=i.parentNode}return null}(e)||t}var Zh=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function Xh(e){var t=new Map,i=new Set,n=[];function s(e){i.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!i.has(e)){var n=t.get(e);n&&s(n)}})),n.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){i.has(e.name)||s(e)})),n}function Yh(e){var t;return function(){return t||(t=new Promise((function(i){Promise.resolve().then((function(){t=void 0,i(e())}))}))),t}}function Kh(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return[].concat(i).reduce((function(e,t){return e.replace(/%s/,t)}),e)}var Qh='Popper: modifier "%s" provided an invalid %s property, expected %s but got %s',Jh=["name","enabled","phase","fn","effect","requires","options"];function eu(e){return e.split("-")[0]}var tu=Math.round;function iu(e){return e.split("-")[1]}var nu="Popper: Invalid reference or popper argument provided. They must be either a DOM element or virtual element.",su={placement:"bottom",modifiers:[],strategy:"absolute"};function ru(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function ou(e){void 0===e&&(e={});var t=e,i=t.defaultModifiers,n=void 0===i?[]:i,s=t.defaultOptions,r=void 0===s?su:s;return function(e,t,i){void 0===i&&(i=r);var s={placement:"bottom",orderedModifiers:[],options:Object.assign({},su,r),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},o=[],a=!1,l={state:s,setOptions:function(i){var a="function"==typeof i?i(s.options):i;h(),s.options=Object.assign({},r,s.options,a),s.scrollParents={reference:Ih(e)?Vh(e):e.contextElement?Vh(e.contextElement):[],popper:Vh(t)};var u=function(e){var t=Xh(e);return Zh.reduce((function(e,i){return e.concat(t.filter((function(e){return e.phase===i})))}),[])}(function(e){var t=e.reduce((function(e,t){var i=e[t.name];return e[t.name]=i?Object.assign({},i,t,{options:Object.assign({},i.options,t.options),data:Object.assign({},i.data,t.data)}):t,e}),{});return Object.keys(t).map((function(e){return t[e]}))}([].concat(n,s.options.modifiers)));(s.orderedModifiers=u.filter((function(e){return e.enabled})),function(e){e.forEach((function(t){[].concat(Object.keys(t),Jh).filter((function(e,t,i){return i.indexOf(e)===t})).forEach((function(i){switch(i){case"name":"string"!=typeof t.name&&console.error(Kh(Qh,String(t.name),'"name"','"string"','"'+String(t.name)+'"'));break;case"enabled":"boolean"!=typeof t.enabled&&console.error(Kh(Qh,t.name,'"enabled"','"boolean"','"'+String(t.enabled)+'"'));break;case"phase":Zh.indexOf(t.phase)<0&&console.error(Kh(Qh,t.name,'"phase"',"either "+Zh.join(", "),'"'+String(t.phase)+'"'));break;case"fn":"function"!=typeof t.fn&&console.error(Kh(Qh,t.name,'"fn"','"function"','"'+String(t.fn)+'"'));break;case"effect":null!=t.effect&&"function"!=typeof t.effect&&console.error(Kh(Qh,t.name,'"effect"','"function"','"'+String(t.fn)+'"'));break;case"requires":null==t.requires||Array.isArray(t.requires)||console.error(Kh(Qh,t.name,'"requires"','"array"','"'+String(t.requires)+'"'));break;case"requiresIfExists":Array.isArray(t.requiresIfExists)||console.error(Kh(Qh,t.name,'"requiresIfExists"','"array"','"'+String(t.requiresIfExists)+'"'));break;case"options":case"data":break;default:console.error('PopperJS: an invalid property has been provided to the "'+t.name+'" modifier, valid properties are '+Jh.map((function(e){return'"'+e+'"'})).join(", ")+'; but "'+i+'" was provided.')}t.requires&&t.requires.forEach((function(i){null==e.find((function(e){return e.name===i}))&&console.error(Kh('Popper: modifier "%s" requires "%s", but "%s" modifier is not available',String(t.name),i,i))}))}))}))}(function(e,t){var i=new Set;return e.filter((function(e){var n=t(e);if(!i.has(n))return i.add(n),!0}))}([].concat(u,s.options.modifiers),(function(e){return e.name}))),"auto"===eu(s.options.placement))&&(s.orderedModifiers.find((function(e){return"flip"===e.name}))||console.error(['Popper: "auto" placements require the "flip" modifier be',"present and enabled to work."].join(" ")));var c=Nh(t);return[c.marginTop,c.marginRight,c.marginBottom,c.marginLeft].some((function(e){return parseFloat(e)}))&&console.warn(['Popper: CSS "margin" styles cannot be used to apply padding',"between the popper and its reference element or boundary.","To replicate margin, use the `offset` modifier, as well as","the `padding` option in the `preventOverflow` and `flip`","modifiers."].join(" ")),s.orderedModifiers.forEach((function(e){var t=e.name,i=e.options,n=void 0===i?{}:i,r=e.effect;if("function"==typeof r){var a=r({state:s,name:t,instance:l,options:n}),h=function(){};o.push(a||h)}})),l.update()},forceUpdate:function(){if(!a){var e=s.elements,t=e.reference,i=e.popper;if(ru(t,i)){s.rects={reference:Bh(t,Gh(i),"fixed"===s.options.strategy),popper:Wh(i)},s.reset=!1,s.placement=s.options.placement,s.orderedModifiers.forEach((function(e){return s.modifiersData[e.name]=Object.assign({},e.data)}));for(var n=0,r=0;r<s.orderedModifiers.length;r++){if((n+=1)>100){console.error("Popper: An infinite loop in the modifiers cycle has been detected! The cycle has been interrupted to prevent a browser crash.");break}if(!0!==s.reset){var o=s.orderedModifiers[r],h=o.fn,u=o.options,c=void 0===u?{}:u,d=o.name;"function"==typeof h&&(s=h({state:s,options:c,name:d,instance:l})||s)}else s.reset=!1,r=-1}}else console.error(nu)}},update:Yh((function(){return new Promise((function(e){l.forceUpdate(),e(s)}))})),destroy:function(){h(),a=!0}};if(!ru(e,t))return console.error(nu),l;function h(){o.forEach((function(e){return e()})),o=[]}return l.setOptions(i).then((function(e){!a&&i.onFirstUpdate&&i.onFirstUpdate(e)})),l}}var au={passive:!0};var lu={top:"auto",right:"auto",bottom:"auto",left:"auto"};function hu(e){var t,i=e.popper,n=e.popperRect,s=e.placement,r=e.variation,o=e.offsets,a=e.position,l=e.gpuAcceleration,h=e.adaptive,u=e.roundOffsets,c=!0===u?function(e){var t=e.x,i=e.y,n=window.devicePixelRatio||1;return{x:tu(tu(t*n)/n)||0,y:tu(tu(i*n)/n)||0}}(o):"function"==typeof u?u(o):o,d=c.x,p=void 0===d?0:d,m=c.y,g=void 0===m?0:m,f=o.hasOwnProperty("x"),v=o.hasOwnProperty("y"),y="left",_="top",w=window;if(h){var b=Gh(i),x="clientHeight",k="clientWidth";b===Ah(i)&&"static"!==Nh(b=zh(i)).position&&"absolute"===a&&(x="scrollHeight",k="scrollWidth"),b=b,"top"!==s&&("left"!==s&&"right"!==s||"end"!==r)||(_="bottom",g-=b[x]-n.height,g*=l?1:-1),"left"!==s&&("top"!==s&&"bottom"!==s||"end"!==r)||(y="right",p-=b[k]-n.width,p*=l?1:-1)}var T,S=Object.assign({position:a},h&&lu);return l?Object.assign({},S,((T={})[_]=v?"0":"",T[y]=f?"0":"",T.transform=(w.devicePixelRatio||1)<=1?"translate("+p+"px, "+g+"px)":"translate3d("+p+"px, "+g+"px, 0)",T)):Object.assign({},S,((t={})[_]=v?g+"px":"",t[y]=f?p+"px":"",t.transform="",t))}var uu=ou({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,i=e.instance,n=e.options,s=n.scroll,r=void 0===s||s,o=n.resize,a=void 0===o||o,l=Ah(t.elements.popper),h=[].concat(t.scrollParents.reference,t.scrollParents.popper);return r&&h.forEach((function(e){e.addEventListener("scroll",i.update,au)})),a&&l.addEventListener("resize",i.update,au),function(){r&&h.forEach((function(e){e.removeEventListener("scroll",i.update,au)})),a&&l.removeEventListener("resize",i.update,au)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,i=e.name;t.modifiersData[i]=function(e){var t,i=e.reference,n=e.element,s=e.placement,r=s?eu(s):null,o=s?iu(s):null,a=i.x+i.width/2-n.width/2,l=i.y+i.height/2-n.height/2;switch(r){case"top":t={x:a,y:i.y-n.height};break;case"bottom":t={x:a,y:i.y+i.height};break;case"right":t={x:i.x+i.width,y:l};break;case"left":t={x:i.x-n.width,y:l};break;default:t={x:i.x,y:i.y}}var h=r?function(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}(r):null;if(null!=h){var u="y"===h?"height":"width";switch(o){case"start":t[h]=t[h]-(i[u]/2-n[u]/2);break;case"end":t[h]=t[h]+(i[u]/2-n[u]/2)}}return t}({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,i=e.options,n=i.gpuAcceleration,s=void 0===n||n,r=i.adaptive,o=void 0===r||r,a=i.roundOffsets,l=void 0===a||a,h=Nh(t.elements.popper).transitionProperty||"";o&&["transform","top","right","bottom","left"].some((function(e){return h.indexOf(e)>=0}))&&console.warn(["Popper: Detected CSS transitions on at least one of the following",'CSS properties: "transform", "top", "right", "bottom", "left".',"\n\n",'Disable the "computeStyles" modifier\'s `adaptive` option to allow',"for smooth transitions, or remove these properties from the CSS","transition declaration on the popper element if only transitioning","opacity or background-color for example.","\n\n","We recommend using the popper element as a wrapper around an inner","element that can have any CSS property transitioned for animations."].join(" "));var u={placement:eu(t.placement),variation:iu(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:s};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,hu(Object.assign({},u,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,hu(Object.assign({},u,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var i=t.styles[e]||{},n=t.attributes[e]||{},s=t.elements[e];Fh(s)&&jh(s)&&(Object.assign(s.style,i),Object.keys(n).forEach((function(e){var t=n[e];!1===t?s.removeAttribute(e):s.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach((function(e){var n=t.elements[e],s=t.attributes[e]||{},r=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:i[e]).reduce((function(e,t){return e[t]="",e}),{});Fh(n)&&jh(n)&&(Object.assign(n.style,r),Object.keys(s).forEach((function(e){n.removeAttribute(e)})))}))}},requires:["computeStyles"]}]});if("undefined"!=typeof document){const e='div.svelte-z8iin8{z-index:11}span.svelte-z8iin8{-webkit-animation:svelte-z8iin8-tooltip 0.2s ease-out;animation:svelte-z8iin8-tooltip 0.2s ease-out;background-color:rgba(51, 51, 51, 0.9);border-radius:3px;color:#fff;display:inline-block;line-height:1.2;max-width:250px;min-width:70px;padding:7px;position:relative;text-align:center;transform:translate(0, -5px);white-space:pre-line;width:-webkit-max-content;width:-moz-max-content;width:max-content}span.svelte-z8iin8::after{border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid rgba(51, 51, 51, 0.9);top:100%;content:" ";font-size:0;left:50%;line-height:0;position:absolute;width:0}@-webkit-keyframes svelte-z8iin8-tooltip{from{opacity:0;transform:translate(0, 0)}to{opacity:1;transform:translate(0, -5px)}}@keyframes svelte-z8iin8-tooltip{from{opacity:0;transform:translate(0, 0)}to{opacity:1;transform:translate(0, -5px)}}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function cu(e){let i,n,s;return{c(){i=u("div"),n=u("span"),s=P(e[1]),this.h()},l(t){i=d(t,"DIV",{class:!0});var r=p(i);n=d(r,"SPAN",{class:!0});var o=p(n);s=M(o,e[1]),o.forEach(m),r.forEach(m),this.h()},h(){g(n,"class","svelte-z8iin8"),g(i,"class","svelte-z8iin8")},m(t,r){f(t,i,r),C(i,n),C(n,s),e[2](i)},p(e,[t]){2&t&&R(s,e[1])},i:t,o:t,d(t){t&&m(i),e[2](null)}}}function du(e,t,i){let{text:n}=t,{element:s}=t;return e.$$set=e=>{"text"in e&&i(1,n=e.text),"element"in e&&i(0,s=e.element)},[s,n,function(e){W[e?"unshift":"push"]((()=>{s=e,i(0,s)}))}]}class pu extends a{constructor(e){super(),l(this,e,du,cu,i,{text:1,element:0})}get text(){return this.$$.ctx[1]}set text(e){this.$$set({text:e}),ie()}get element(){return this.$$.ctx[0]}set element(e){this.$$set({element:e}),ie()}}const mu=(e,t)=>{if(!t)return{};let i,n;const s=()=>{n=new pu({target:document.body,props:{text:t}}),i=uu(e,n.element,{placement:"top"})},r=()=>{i?.destroy(),i=null,n?.$destroy()};return e.addEventListener("mouseenter",s),e.addEventListener("mouseleave",r),{destroy(){r(),e.removeEventListener("mouseenter",s),e.removeEventListener("mouseleave",r)}}};function gu(e){let t,i,n,o,a,l,h;return i=new Rh({props:{name:e[5],height:e[1],width:e[2],"aria-hidden":"true",focusable:"false"}}),{c(){t=u("button"),j(i.$$.fragment),this.h()},l(e){t=d(e,"BUTTON",{class:!0,"aria-label":!0});var n=p(t);z(i.$$.fragment,n),n.forEach(m),this.h()},h(){g(t,"class",n=ne(e[7].class)+" svelte-1bi0voj"),g(t,"aria-label",e[6]),t.disabled=e[4]},m(n,s){f(n,t,s),N(i,t,null),e[10](t),a=!0,l||(h=[se(o=mu.call(null,t,e[3])),D(t,"click",e[8]),D(t,"mousedown",e[9])],l=!0)},p(e,[s]){const l={};32&s&&(l.name=e[5]),2&s&&(l.height=e[1]),4&s&&(l.width=e[2]),i.$set(l),(!a||128&s&&n!==(n=ne(e[7].class)+" svelte-1bi0voj"))&&g(t,"class",n),(!a||64&s)&&g(t,"aria-label",e[6]),(!a||16&s)&&(t.disabled=e[4]),o&&r(o.update)&&8&s&&o.update.call(null,e[3])},i(e){a||(v(i.$$.fragment,e),a=!0)},o(e){b(i.$$.fragment,e),a=!1},d(n){n&&m(t),L(i),e[10](null),l=!1,s(h)}}}function fu(e,t,i){let{height:n=20}=t,{width:s=20}=t,{tooltip:r}=t,{disabled:o=!1}=t,{iconName:a}=t,{label:l}=t,{ref:h}=t;return e.$$set=e=>{i(7,t=Y(Y({},t),te(e))),"height"in e&&i(1,n=e.height),"width"in e&&i(2,s=e.width),"tooltip"in e&&i(3,r=e.tooltip),"disabled"in e&&i(4,o=e.disabled),"iconName"in e&&i(5,a=e.iconName),"label"in e&&i(6,l=e.label),"ref"in e&&i(0,h=e.ref)},t=te(t),[h,n,s,r,o,a,l,t,function(t){re.call(this,e,t)},function(t){re.call(this,e,t)},function(e){W[e?"unshift":"push"]((()=>{h=e,i(0,h)}))}]}class vu extends a{constructor(e){super(),l(this,e,fu,gu,i,{height:1,width:2,tooltip:3,disabled:4,iconName:5,label:6,ref:0})}}function yu(e){let t,i,n,s,o,a,l,w,x,k,T,S,E,P,M,R,A,O;return i=new vu({props:{class:"overlay",disabled:e[5]>=e[0],iconName:"plus",label:"Zoom In",height:"24",width:"24"}}),i.$on("mousedown",(function(){r(e[8](e[11]))&&e[8](e[11]).apply(this,arguments)})),s=new vu({props:{class:"overlay",disabled:e[5]<=e[1],iconName:"minus",label:"Zoom Out",height:"24",width:"24"}}),s.$on("mousedown",(function(){r(e[8](e[12]))&&e[8](e[12]).apply(this,arguments)})),a=new vu({props:{class:"overlay",disabled:1===e[5],iconName:"fit-width",label:"Zoom to Roll Width",height:"24",width:"24"}}),a.$on("click",e[13]),w=new vu({props:{class:"overlay",disabled:!1,iconName:"arrow-up",label:"Pan Up",height:"24",width:"24"}}),w.$on("mousedown",(function(){r(e[8](e[14]))&&e[8](e[14]).apply(this,arguments)})),k=new vu({props:{class:"overlay",disabled:!1,iconName:"arrow-down",label:"Pan Down",height:"24",width:"24"}}),k.$on("mousedown",(function(){r(e[8](e[15]))&&e[8](e[15]).apply(this,arguments)})),S=new vu({props:{class:"overlay",disabled:!1,iconName:"arrow-left",label:"Pan Left",height:"24",width:"24"}}),S.$on("mousedown",(function(){r(e[8](e[16]))&&e[8](e[16]).apply(this,arguments)})),P=new vu({props:{class:"overlay",disabled:!1,iconName:"arrow-right",label:"Pan Right",height:"24",width:"24"}}),P.$on("mousedown",(function(){r(e[8](e[17]))&&e[8](e[17]).apply(this,arguments)})),{c(){t=u("div"),j(i.$$.fragment),n=h(),j(s.$$.fragment),o=h(),j(a.$$.fragment),l=h(),j(w.$$.fragment),x=h(),j(k.$$.fragment),T=h(),j(S.$$.fragment),E=h(),j(P.$$.fragment),this.h()},l(e){t=d(e,"DIV",{class:!0});var r=p(t);z(i.$$.fragment,r),n=c(r),z(s.$$.fragment,r),o=c(r),z(a.$$.fragment,r),l=c(r),z(w.$$.fragment,r),x=c(r),z(k.$$.fragment,r),T=c(r),z(S.$$.fragment,r),E=c(r),z(P.$$.fragment,r),r.forEach(m),this.h()},h(){g(t,"class","overlay-buttons top-center")},m(r,h){f(r,t,h),N(i,t,null),C(t,n),N(s,t,null),C(t,o),N(a,t,null),C(t,l),N(w,t,null),C(t,x),N(k,t,null),C(t,T),N(S,t,null),C(t,E),N(P,t,null),R=!0,A||(O=D(window,"mouseup",e[10]),A=!0)},p(t,[n]){e=t;const r={};33&n&&(r.disabled=e[5]>=e[0]),i.$set(r);const o={};34&n&&(o.disabled=e[5]<=e[1]),s.$set(o);const l={};32&n&&(l.disabled=1===e[5]),a.$set(l)},i(e){R||(v(i.$$.fragment,e),v(s.$$.fragment,e),v(a.$$.fragment,e),v(w.$$.fragment,e),v(k.$$.fragment,e),v(S.$$.fragment,e),v(P.$$.fragment,e),y((()=>{M||(M=_(t,ye,{},!0)),M.run(1)})),R=!0)},o(e){b(i.$$.fragment,e),b(s.$$.fragment,e),b(a.$$.fragment,e),b(w.$$.fragment,e),b(k.$$.fragment,e),b(S.$$.fragment,e),b(P.$$.fragment,e),M||(M=_(t,ye,{},!1)),M.run(0),R=!1},d(e){e&&m(t),L(i),L(s),L(a),L(w),L(k),L(S),L(P),e&&M&&M.end(),A=!1,O()}}}function _u(e,t,i){let n,{openSeadragon:s}=t,{maxZoomLevel:r}=t,{minZoomLevel:o}=t,{updateTickByViewportIncrement:a}=t,{panHorizontal:l}=t;const{viewport:h}=s;let u=h.getZoom();const c=()=>{const e=h.getBounds(),t=new Ch.Point(.5,e.y+e.height/2);h.panTo(t)},d=()=>i(5,u=h.getZoom());I((()=>(s.addHandler("zoom",d),()=>{s.removeHandler("zoom",d),n?.clear()})));return e.$$set=e=>{"openSeadragon"in e&&i(9,s=e.openSeadragon),"maxZoomLevel"in e&&i(0,r=e.maxZoomLevel),"minZoomLevel"in e&&i(1,o=e.minZoomLevel),"updateTickByViewportIncrement"in e&&i(2,a=e.updateTickByViewportIncrement),"panHorizontal"in e&&i(3,l=e.panHorizontal)},[r,o,a,l,n,u,h,c,(e,t=!0)=>{n?.clear(),t&&e(),i(4,n=ht(e))},s,()=>n?.clear(),()=>h.zoomTo(Math.min(1.1*h.getZoom(),r)),()=>h.zoomTo(Math.max(.9*h.getZoom(),o)),()=>{h.zoomTo(1),c()},()=>a(!0),()=>a(!1),()=>l(!0),()=>l(!1)]}class wu extends a{constructor(e){super(),l(this,e,_u,yu,i,{openSeadragon:9,maxZoomLevel:0,minZoomLevel:1,updateTickByViewportIncrement:2,panHorizontal:3})}}if("undefined"!=typeof document){const e="div.svelte-hnmgot.svelte-hnmgot{background-color:rgba(255, 255, 255, 0.5);color:black;font-size:12px;height:28px;transition:width 0.5s ease, transform 0.5s ease;position:absolute;left:1em;top:1em;z-index:1;display:flex;border:1px solid black;border-bottom:0;border-right:0;transform-origin:top left}div.svelte-hnmgot.svelte-hnmgot::before{background:rgba(255, 255, 255, 0.5);content:attr(data-label);display:block;padding:1px 4px;position:absolute;right:1px;top:calc(100% + 4px)}div.vertical.svelte-hnmgot.svelte-hnmgot{transform:rotate(-90deg) translate(-100%)}div.vertical.svelte-hnmgot.svelte-hnmgot::before{right:0;top:0;transform:rotate(-270deg) translate(100%)}div.vertical.svelte-hnmgot span.svelte-hnmgot::before{transform:rotate(-270deg)}span.svelte-hnmgot.svelte-hnmgot{background-repeat:no-repeat;border-radius:0;flex:1 0 auto;position:relative}span.svelte-hnmgot.svelte-hnmgot::before{bottom:-2px;content:attr(data-label);display:none;position:absolute}.us.svelte-hnmgot span.svelte-hnmgot{background-image:linear-gradient(black, black);background-position:100% top;background-size:1px 16px}.us.svelte-hnmgot span.svelte-hnmgot:last-child{background-size:1px 100%}.us.svelte-hnmgot span.svelte-hnmgot:nth-child(even)::before{display:block;right:1px}.us.halves.svelte-hnmgot span.svelte-hnmgot{background-image:linear-gradient(black, black), linear-gradient(black, black);background-position:50% top, 100% top;background-size:1px 12px, 1px 22px}.us.halves.svelte-hnmgot span.svelte-hnmgot:last-child{background-size:1px 12px, 1px 100%}.us.halves.svelte-hnmgot span.svelte-hnmgot::before{display:block;right:4px}.us.quarters.svelte-hnmgot span.svelte-hnmgot{background-image:linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black);background-position:25% top, 50% top, 75% top, 100% top;background-size:1px 12px, 1px 16px, 1px 12px, 1px 22px}.us.quarters.svelte-hnmgot span.svelte-hnmgot:last-child{background-size:1px 12px, 1px 16px, 1px 12px, 1px 100%}.us.quarters.svelte-hnmgot span.svelte-hnmgot::before{display:block;right:4px}.us.eighths.svelte-hnmgot span.svelte-hnmgot{background-image:linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black);background-position:12.5% top, 25% top, 37.5% top, 50% top, 62.5% top, 75% top, 87.5% top, 100% top;background-size:1px 8px, 1px 12px, 1px 8px, 1px 16px, 1px 8px, 1px 12px, 1px 8px, 1px 22px}.us.eighths.svelte-hnmgot span.svelte-hnmgot:last-child{background-size:1px 8px, 1px 12px, 1px 8px, 1px 16px, 1px 8px, 1px 12px, 1px 8px, 1px 100%}.us.eighths.svelte-hnmgot span.svelte-hnmgot::before{display:block;right:4px}.us.sixteenths.svelte-hnmgot span.svelte-hnmgot{background-image:linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black);background-position:6.25% top, 12.5% top, 18.75% top, 25% top, 31.25% top, 37.5% top, 43.75% top, 50% top, 56.25% top, 62.5% top, 68.75% top, 75% top, 81.25% top, 87.5% top, 93.75% top, 100% top;background-size:1px 4px, 1px 8px, 1px 4px, 1px 12px, 1px 4px, 1px 8px, 1px 4px, 1px 16px, 1px 4px, 1px 8px, 1px 4px, 1px 12px, 1px 4px, 1px 8px, 1px 4px, 1px 22px}.us.sixteenths.svelte-hnmgot span.svelte-hnmgot:last-child{background-size:1px 4px, 1px 8px, 1px 4px, 1px 12px, 1px 4px, 1px 8px, 1px 4px, 1px 16px, 1px 4px, 1px 8px, 1px 4px, 1px 12px, 1px 4px, 1px 8px, 1px 4px, 1px 100%}.us.sixteenths.svelte-hnmgot span.svelte-hnmgot::before{display:block;right:4px}button.svelte-hnmgot.svelte-hnmgot{background:rgba(255, 255, 255, 0.5);border-radius:4px;border:none;cursor:pointer;position:absolute;top:calc(100% + 4px)}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}const bu=(e,t=!1)=>{const{style:i}=e;let{top:n,left:s,width:r,height:o}=e.parentElement.getBoundingClientRect(),{left:a,top:l}=e.getBoundingClientRect(),h=!1;a-=s,l-=n,i.position="absolute",i.top=`${l}px`,i.left=`${a}px`,i.cursor="move",i.userSelect="none";const u=n=>{if(a+=n?.movementX||0,l+=n?.movementY||0,t){const{height:t,width:i}=e.getBoundingClientRect();a=at(a,0,r-i),l=at(l,0,o-t)}i.left=`${a}px`,i.top=`${l}px`},c=()=>{window.document.body.style.cursor="move",h=!0},d=()=>{window.document.body.style.cursor="unset",h=!1},p=e=>{h&&u(e)},m=new ResizeObserver((()=>{({top:n,left:s,width:r,height:o}=e.parentElement.getBoundingClientRect()),u()}));return m.observe(e.parentElement),e.addEventListener("mousedown",c),window.addEventListener("mousemove",p),window.addEventListener("mouseup",d),document.documentElement.addEventListener("mouseleave",d),{destroy(){m.disconnect(),e.removeEventListener("mousedown",c),window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",d),document.documentElement.removeEventListener("mouseleave",d)}}};function xu(e,t,i){const n=e.slice();return n[7]=t[i],n[9]=i,n}function ku(e){let t,i;return{c(){t=u("span"),this.h()},l(e){t=d(e,"SPAN",{"data-label":!0,class:!0}),p(t).forEach(m),this.h()},h(){g(t,"data-label",i=e[9]+1),g(t,"class","svelte-hnmgot")},m(e,i){f(e,t,i)},d(e){e&&m(t)}}}function Tu(e){let t,i,n,r,o,a,l,v,w=Array(e[0]),b=[];for(let t=0;t<w.length;t+=1)b[t]=ku(xu(e,w,t));return{c(){t=u("div");for(let e=0;e<b.length;e+=1)b[e].c();i=h(),n=u("button"),r=P("⟳"),this.h()},l(e){t=d(e,"DIV",{class:!0,"data-label":!0});var s=p(t);for(let e=0;e<b.length;e+=1)b[e].l(s);i=c(s),n=d(s,"BUTTON",{class:!0});var o=p(n);r=M(o,"⟳"),o.forEach(m),s.forEach(m),this.h()},h(){g(n,"class","svelte-hnmgot"),g(t,"class","us svelte-hnmgot"),g(t,"data-label","inches"),q(t,"vertical",e[2]),q(t,"halves",e[0]<9),q(t,"quarters",e[0]<5),q(t,"eighths",e[0]<3),q(t,"sixteenths",1===e[0])},m(s,o){f(s,t,o);for(let e=0;e<b.length;e+=1)b[e].m(t,null);C(t,i),C(t,n),C(n,r),e[5](t),a=!0,l||(v=[D(n,"click",e[4]),se(bu.call(null,t,!0))],l=!0)},p(e,[n]){if(1&n){const n=w.length;let s;for(w=Array(e[0]),s=n;s<w.length;s+=1){const n=xu(e,w,s);b[s]||(b[s]=ku(n),b[s].c(),b[s].m(t,i))}for(s=w.length;s<n;s+=1)b[s].d(1);b.length=w.length}4&n&&q(t,"vertical",e[2]),1&n&&q(t,"halves",e[0]<9),1&n&&q(t,"quarters",e[0]<5),1&n&&q(t,"eighths",e[0]<3),1&n&&q(t,"sixteenths",1===e[0])},i(e){a||(y((()=>{o||(o=_(t,ye,{},!0)),o.run(1)})),a=!0)},o(e){o||(o=_(t,ye,{},!1)),o.run(0),a=!1},d(i){i&&m(t),A(b,i),e[5](null),i&&o&&o.end(),l=!1,s(v)}}}function Su(e,t,i){let n,s,{ppi:r}=t,o=!1;return e.$$set=e=>{"ppi"in e&&i(3,r=e.ppi)},e.$$.update=()=>{8&e.$$.dirty&&(()=>{for(i(0,n=1);r*n<100&&n<12;)i(0,n+=1)})(),11&e.$$.dirty&&s&&i(1,s.style.width=r*n+"px",s)},[n,s,o,r,()=>i(2,o=!o),function(e){W[e?"unshift":"push"]((()=>{s=e,i(1,s),i(3,r),i(0,n)}))}]}class Eu extends a{constructor(e){super(),l(this,e,Su,Tu,i,{ppi:3})}}function Cu(e){let t,i;return t=new Eu({props:{ppi:e[7]}}),{c(){j(t.$$.fragment)},l(e){z(t.$$.fragment,e)},m(e,n){N(t,e,n),i=!0},p(e,i){const n={};128&i[0]&&(n.ppi=e[7]),t.$set(n)},i(e){i||(v(t.$$.fragment,e),i=!0)},o(e){b(t.$$.fragment,e),i=!1},d(e){L(t,e)}}}function Pu(e){let i,n,s,r;return{c(){i=u("span"),n=P("Downloading roll image..."),this.h()},l(e){i=d(e,"SPAN",{class:!0});var t=p(i);n=M(t,"Downloading roll image..."),t.forEach(m),this.h()},h(){g(i,"class","roll-loading svelte-v2hjpe")},m(e,t){f(e,i,t),C(i,n),r=!0},p:t,i(e){r||(y((()=>{s||(s=_(i,ye,{},!0)),s.run(1)})),r=!0)},o(e){s||(s=_(i,ye,{},!1)),s.run(0),r=!1},d(e){e&&m(i),e&&s&&s.end()}}}function Mu(e){let t,i;return t=new wu({props:{openSeadragon:e[2],minZoomLevel:Du,maxZoomLevel:Au,updateTickByViewportIncrement:e[0],panHorizontal:e[1]}}),{c(){j(t.$$.fragment)},l(e){z(t.$$.fragment,e)},m(e,n){N(t,e,n),i=!0},p(e,i){const n={};4&i[0]&&(n.openSeadragon=e[2]),t.$set(n)},i(e){i||(v(t.$$.fragment,e),i=!0)},o(e){b(t.$$.fragment,e),i=!1},d(e){L(t,e)}}}function Ru(e){let t,i,n,r,o,a,l,y;const _=[Pu,Cu],k=[];function T(e,t){return e[4]?1:0}i=T(e),n=k[i]=_[i](e);let S=e[5]&&Mu(e);return{c(){t=u("div"),n.c(),r=h(),S&&S.c(),this.h()},l(e){t=d(e,"DIV",{id:!0,style:!0,class:!0});var i=p(t);n.l(i),r=c(i),S&&S.l(i),i.forEach(m),this.h()},h(){g(t,"id","roll-viewer"),g(t,"style",o=`--trackerbar-height: ${e[6]}px;`),g(t,"class","svelte-v2hjpe"),q(t,"active-note-details",e[8].activeNoteDetails),q(t,"highlight-enabled-holes",e[8].highlightEnabledHoles),q(t,"show-note-velocities",e[8].showNoteVelocities),q(t,"use-roll-pedaling",e[9]),q(t,"play-expressions",e[10])},m(n,s){f(n,t,s),k[i].m(t,null),C(t,r),S&&S.m(t,null),a=!0,l||(y=[D(t,"mouseenter",e[18]),D(t,"mouseleave",e[19]),D(t,"wheel",V(e[20]),!0)],l=!0)},p(e,s){let l=i;i=T(e),i===l?k[i].p(e,s):(w(),b(k[l],1,1,(()=>{k[l]=null})),x(),n=k[i],n?n.p(e,s):(n=k[i]=_[i](e),n.c()),v(n,1),n.m(t,r)),e[5]?S?(S.p(e,s),32&s[0]&&v(S,1)):(S=Mu(e),S.c(),v(S,1),S.m(t,null)):S&&(w(),b(S,1,1,(()=>{S=null})),x()),(!a||64&s[0]&&o!==(o=`--trackerbar-height: ${e[6]}px;`))&&g(t,"style",o),256&s[0]&&q(t,"active-note-details",e[8].activeNoteDetails),256&s[0]&&q(t,"highlight-enabled-holes",e[8].highlightEnabledHoles),256&s[0]&&q(t,"show-note-velocities",e[8].showNoteVelocities),512&s[0]&&q(t,"use-roll-pedaling",e[9]),1024&s[0]&&q(t,"play-expressions",e[10])},i(e){a||(v(n),v(S),a=!0)},o(e){b(n),b(S),a=!1},d(e){e&&m(t),k[i].d(),S&&S.d(),l=!1,s(y)}}}const Du=.1,Au=4;function Ou(e,t,i){let n,s,r,o,a,l,h,u;S(e,Ae,(e=>i(15,s=e))),S(e,Fe,(e=>i(16,r=e))),S(e,it,(e=>i(17,o=e))),S(e,nt,(e=>i(33,a=e))),S(e,rt,(e=>i(8,l=e))),S(e,Ue,(e=>i(9,h=e))),S(e,He,(e=>i(10,u=e)));let c,d,p,m,g,f,v,y,_,w,b,x,k,T,E,{imageUrl:C}=t,{holeData:P}=t,{holesByTickInterval:M}=t,{skipToTick:R}=t,D=[],A=[];const O=e=>{const{x:t,startY:i,w:n,h:r,m:o,v:a,color:l,type:h}=e,u=document.createElement("mark"),c=((e,t="welte-red")=>{const{bassNotesBegin:i,trebleNotesEnd:n,ctrlMap:s}=ot[t];return e>=i&&e<=n?lt(e):s&&s[e]?s[e]:`mid_${e}`})(o,s.ROLL_TYPE);u.dataset.holeLabel=c,"note"===h&&(u.dataset.noteVelocity=a||64),u.style.setProperty("--highlight-color",`hsl(${l})`),u.classList.add(h),u.addEventListener("mouseout",(()=>{D.map((([e])=>e)).includes(e)||d.viewer.removeOverlay(g)}));const p=d.viewportToImageRectangle(d.getBounds()),m=parseFloat(t+n/2-p.x)/parseFloat(p.width);u.classList.toggle("flag-left",m>.8);const f=d.imageToViewportRectangle(t-4,i-4,n+11,r+12);return d.viewer.addOverlay(u,f),u},F=e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","g");return t.setAttribute("width",y),t.setAttribute("height",v),t.setAttribute("viewBox",`0 0 ${y} ${v}`),t.setAttribute("style","pointer-events: none;"),t.appendChild(i),e.forEach((e=>{const{x:t,startY:n,w:s,h:r,color:o,type:a}=e,l=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("x",t-10),l.setAttribute("y",n-10),l.setAttribute("width",s+20),l.setAttribute("height",r+20),l.setAttribute("rx",10),l.setAttribute("ry",10),l.addEventListener("mouseover",(()=>{D.map((([e])=>e)).includes(e)||(d.viewer.removeOverlay(g),g=O(e))})),l.setAttribute("fill",`hsla(${o}, 0.8)`),l.setAttribute("class",a),i.appendChild(l)})),t},j=()=>{if(void 0===T)return;const{y:e,height:t}=d.viewportToImageRectangle(d.getBounds()),i=e+t,n=T.search(e,i);A=A.filter((e=>!!n.includes(e)||(d.viewer.removeOverlay(e),!1))),n.forEach((e=>{A.includes(e)||(A.push(e),d.viewer.addOverlay(e,E))}))},z=e=>{if(!c)return;const t=p+(r?e:-e),i=d.imageToViewportCoordinates(0,t);d.centerSpringY.springTo(i.y),x.dataset.label=(100*a).toFixed(1),x.classList.toggle("label-above",r?a>.5:a<.5),j()},N=(e=!0)=>{const t=d.getBounds(),i=d.viewportToImageRectangle(t),n=e?-i.height/200:i.height/200,s=i.y+i.height/2;R(r?at(s+n-p,-p,v-p):at(p-s-n,p-v,p))},L=e=>{if(clearInterval(b),e){const{centerSpringY:e}=d;e.animationTime=1.2,b=setInterval((()=>{e.animationTime=Math.max(e.animationTime-.1,0),e.animationTime<=0&&clearInterval(b)}),100)}const t=d.getCenter(!1),i=d.viewportToImageCoordinates(t);R(r?at(i.y-p,-p,v-p):at(p-i.y,p-v,p))};I((()=>{i(2,c=Ch({id:"roll-viewer",showNavigationControl:!1,panHorizontal:!0,visibilityRatio:1,defaultZoomLevel:1,minZoomLevel:Du,maxZoomLevel:Au,constrainDuringPan:!0,preserveImageSizeOnResize:!0,gestureSettingsMouse:{clickToZoom:!1,scrollToZoom:!1},showNavigator:!0,navigatorAutoFade:!1,navigatorPosition:"ABSOLUTE",navigatorTop:"0px",navigatorLeft:"calc(100% - var(--navigator-width))",navigatorHeight:"100%",navigatorWidth:"var(--navigator-width)",navigatorDisplayRegionColor:"transparent",animationTime:0}));const{navigator:e}=c;i(3,({viewport:d}=c),d),({displayRegion:x}=e),i(3,d.zoomSpring.animationTime=1.2,d),i(3,d.centerSpringX.animationTime=1.2,d),i(3,d.centerSpringY.animationTime=0,d),e.panHorizontal=!1,e.element.style.border="none",e.element.parentElement.style.backgroundColor="#666",Object.assign(x.style,{display:"block",border:"none",overflow:"visible",left:"0",width:"100%",backgroundColor:"rgba(255 255 255 / .6)",boxShadow:"0 0 4px var(--primary-accent)"}),e.update=t=>{const{viewport:i,displayRegion:{style:n},totalBorderWidths:s}=e;if(t&&i){const e=d.getBoundsNoRotate(!0),t=i.pixelFromPointNoRotate(e.getTopLeft(),!1),r=i.pixelFromPointNoRotate(e.getBottomRight(),!1).minus(s);n.top=`${Math.round(t.y)}px`,n.height=`${Math.abs(t.y-r.y)}px`}},c.addHandler("open",(()=>{d.viewer.world.getItemAt(0).addOnceHandler("fully-loaded-change",(()=>i(4,m=!0)))})),c.addOnceHandler("update-viewport",(()=>{(()=>{if(!P)return;E=d.imageToViewportRectangle(0,0,y,v),T=new Se;const e=r?n:p;for(let t=r?p:n;t<=e;t+=1e3){const i=Math.min(t+1e3,e),n=P.filter((({startY:e})=>e>=t&&e<i));if(n.length){const e=Math.max(...n.map((({endY:e})=>e))),i=F(n);T.insert(t,e,i)}}})(),z(0)})),c.addHandler("zoom",(({zoom:e})=>{const t=d.viewportToImageZoom(e);i(6,w=Math.max(1,_*t)),i(7,k=300*t),j()})),d.viewer.addHandler("canvas-key",(e=>{e.preventDefaultAction=!0})),c.addHandler("canvas-drag",(t=>{t.preventDefaultAction=!0;const n=new Ch.Point(d.centerSpringX.target.value,d.centerSpringY.target.value),s=e.viewport.imageToViewportCoordinates(new Ch.Point(0,v)),r=d.deltaPointsFromPixels(t.delta.negate());i(3,d.centerSpringX.target.value+=r.x,d),d.getBounds().x!==d.getConstrainedBounds().x&&(r.x=0);const o=n.plus(r);d.centerSpringX.springTo(o.x),d.centerSpringY.springTo(at(o.y,0,s.y)),L(!0)})),c.addHandler("navigator-click",(t=>{if(t.preventDefaultAction=!0,!t.quick)return;const i=e.viewport.pointFromPixel(t.position);d.centerSpringY.springTo(i.y),L(!0)})),c.addHandler("navigator-drag",(t=>{t.preventDefaultAction=!0;const i=new Ch.Point(0,d.centerSpringY.target.value).plus(e.viewport.deltaPointsFromPixels(t.delta)),n=e.viewport.imageToViewportCoordinates(new Ch.Point(0,v));d.centerSpringY.springTo(at(i.y,0,n.y)),L(!1)})),e.innerTracker.releaseHandler=()=>{},c.open(C)}));return e.$$set=e=>{"imageUrl"in e&&i(11,C=e.imageUrl),"holeData"in e&&i(12,P=e.holeData),"holesByTickInterval"in e&&i(13,M=e.holesByTickInterval),"skipToTick"in e&&i(14,R=e.skipToTick)},e.$$.update=()=>{131072&e.$$.dirty[0]&&z(o),131072&e.$$.dirty[0]&&(e=>{if(!c)return;const t=M.search(e,e);D=D.filter((([e,i])=>!!t.includes(e)||(d.viewer.removeOverlay(i),!1))),t.forEach((e=>{if(D.map((([e])=>e)).includes(e))return;const t=O(e);t.classList.add("active"),D.push([e,t])}))})(o),32768&e.$$.dirty[0]&&(v=parseInt(s.IMAGE_LENGTH,10)),32768&e.$$.dirty[0]&&(y=parseInt(s.IMAGE_WIDTH,10)),32768&e.$$.dirty[0]&&(_=parseInt(s.AVG_HOLE_WIDTH,10)),98304&e.$$.dirty[0]&&(p=r?parseInt(s.FIRST_HOLE,10):parseInt(s.IMAGE_LENGTH,10)-parseInt(s.FIRST_HOLE,10)),98304&e.$$.dirty[0]&&(n=r?parseInt(s.LAST_HOLE,10):parseInt(s.IMAGE_LENGTH,10)-parseInt(s.LAST_HOLE,10))},[N,(e=!0)=>{d.panBy(d.deltaPointsFromPixels(new Ch.Point(e?-40:40,0))),d.applyConstraints()},c,d,m,f,w,k,l,h,u,C,P,M,R,s,r,o,()=>i(5,f=!0),()=>i(5,f=!1),e=>{if(e.ctrlKey)return N(e.deltaY<0),void e.stopPropagation();d.zoomTo(at(d.getZoom()*(e.deltaY>0?.9:1.1),Du,Au))}]}class Iu extends a{constructor(e){super(),l(this,e,Ou,Ru,i,{imageUrl:11,holeData:12,holesByTickInterval:13,skipToTick:14,updateTickByViewportIncrement:0,panHorizontal:1},null,[-1,-1])}get updateTickByViewportIncrement(){return this.$$.ctx[0]}get panHorizontal(){return this.$$.ctx[1]}}if("undefined"!=typeof document){const e='#keyboard.svelte-1lm3ox6.svelte-1lm3ox6.svelte-1lm3ox6{display:flow-root;margin:1vh 1vw;aspect-ratio:10/1;z-index:3;position:relative}#keyboard.svelte-1lm3ox6:hover .overlay-buttons{opacity:1}@supports not (aspect-ratio: 10/1){#keyboard.svelte-1lm3ox6.svelte-1lm3ox6.svelte-1lm3ox6{padding-top:10%}div#keys.svelte-1lm3ox6.svelte-1lm3ox6.svelte-1lm3ox6{top:0}}div#keys.svelte-1lm3ox6.svelte-1lm3ox6.svelte-1lm3ox6{position:absolute;display:flex;padding:0;height:100%;width:100%}div#keys.svelte-1lm3ox6.svelte-1lm3ox6.svelte-1lm3ox6::before{background-color:var(--primary-accent);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAICAYAAADeM14FAAAAfUlEQVQYVyXMoQ3AIBBG4f92qEIiLkyAqmQBBmAChmgXqOwO1GHOMQEOhWQBJqhqQu2XvEelFL7vG601hBBA3ntWSuG6LjjnQDFGft8XtVZYa0HGGB5jYN/3haS15m3bcBzHD713Timt/jxPkIhwzhlzTsQY/+nzPGsoIvgAaMAzN5CzOpMAAAAASUVORK5CYII=);content:"";position:absolute;top:0;height:2%;left:0;right:0;box-shadow:0 1px 1px rgba(0, 0, 0, 0.7), 1px 0 1px rgba(0, 0, 0, 0.7), -1px 0 1px rgba(0, 0, 0, 0.7);z-index:1}div#keys.svelte-1lm3ox6 div.svelte-1lm3ox6.svelte-1lm3ox6{position:relative;flex:1 0 auto}div#keys.svelte-1lm3ox6 div.svelte-1lm3ox6 .svelte-1lm3ox6:first-child{background:linear-gradient(-30deg, #f5f5f5, #fff);border-radius:0 0 4% 4%;border:1px solid #ccc;box-shadow:inset 0 1px 0 #fff, inset 0 -1px 0 #fff, inset 1px 0 0 #fff, inset -1px 0 0 #fff, 0 4px 3px rgba(0, 0, 0, 0.7);display:block;height:100%}div#keys.svelte-1lm3ox6 div.svelte-1lm3ox6 :first-child.depressed{box-shadow:0 2px 2px rgba(0, 0, 0, 0.4);height:98%;position:relative;top:2px}div#keys.svelte-1lm3ox6 div.svelte-1lm3ox6 :first-child.depressed:before{background:rgba(0, 0, 0, 0.1);content:"";bottom:0;position:absolute;left:0;top:0;width:10%}div#keys.svelte-1lm3ox6 div.svelte-1lm3ox6 :first-child.depressed:after{background:rgba(0, 0, 0, 0.1);content:"";bottom:0;position:absolute;right:0;top:0;width:10%}div#keys.svelte-1lm3ox6 div.svelte-1lm3ox6 :first-child.depressed{background:#b5e2ff}div#keys.svelte-1lm3ox6 div.svelte-1lm3ox6 .svelte-1lm3ox6:nth-child(2){background:linear-gradient(-20deg, #333, #000, #333);border-color:#666 #222 #111 #555;border-radius:0 0 3% 3%;border-style:solid;border-width:1px 2px 7px;box-shadow:inset 0 -1px 2px rgba(255, 255, 255, 0.4), 0 2px 3px rgba(0, 0, 0, 0.4);height:56%;left:100%;position:absolute;top:2%;width:50%;z-index:1;transform:translateX(-50%)}div#keys.svelte-1lm3ox6 div.svelte-1lm3ox6 :nth-child(2).depressed{background:#b5e2ff;border-bottom-width:2px;box-shadow:inset 0 -1px 1px rgba(255, 255, 255, 0.4), 0 1px 0 rgba(0, 0, 0, 0.8), 0 2px 2px rgba(0, 0, 0, 0.4), 0 -1px 0 #000;height:57%}div.pedal.svelte-1lm3ox6.svelte-1lm3ox6.svelte-1lm3ox6{filter:drop-shadow(0px 8px 3px black) saturate(0.4);margin:0 4%;transform:rotate3d(1, 0, 0, 30deg);transform-origin:top;transition:all 0.1s ease;left:38%;position:relative;margin-top:-25px;cursor:pointer;width:3%;display:inline-block}div.pedal.depressed.svelte-1lm3ox6.svelte-1lm3ox6.svelte-1lm3ox6{filter:drop-shadow(0px 4px 2px black) saturate(0.6);transform:rotate3d(0, 0, 0, 0)}div.pedal.svelte-1lm3ox6 svg.svelte-1lm3ox6.svelte-1lm3ox6{width:100%}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}if("undefined"!=typeof document){const e="div.svelte-8m4lb4{left:1em;top:0;transform:translateY(-100%);border-radius:4px 4px 0 0;padding:0;opacity:0;transition:all 0.3s ease}div.svelte-8m4lb4:hover{opacity:1}div.outside.svelte-8m4lb4{bottom:0;left:0;top:unset;opacity:1;border-radius:0 4px 4px 0}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function Fu(e){let t,i;return t=new vu({props:{class:"overlay",iconName:e[1].overlayKeyboard?"piano-out":"piano-in",label:"Overlay Piano Keyboard on Roll Image",height:"24",width:"24"}}),t.$on("click",e[3]),{c(){j(t.$$.fragment)},l(e){z(t.$$.fragment,e)},m(e,n){N(t,e,n),i=!0},p(e,i){const n={};2&i&&(n.iconName=e[1].overlayKeyboard?"piano-out":"piano-in"),t.$set(n)},i(e){i||(v(t.$$.fragment,e),i=!0)},o(e){b(t.$$.fragment,e),i=!1},d(e){L(t,e)}}}function ju(e){let t,i,n,s,r;i=new vu({props:{class:"overlay",iconName:e[1].showKeyboard?"piano-down":"piano-up",label:"Show/Hide Piano Keyboard",height:"24",width:"24"}}),i.$on("click",e[2]);let o=!e[0]&&Fu(e);return{c(){t=u("div"),j(i.$$.fragment),n=h(),o&&o.c(),this.h()},l(e){t=d(e,"DIV",{class:!0});var s=p(t);z(i.$$.fragment,s),n=c(s),o&&o.l(s),s.forEach(m),this.h()},h(){g(t,"class","overlay-buttons svelte-8m4lb4"),q(t,"outside",e[0])},m(e,s){f(e,t,s),N(i,t,null),C(t,n),o&&o.m(t,null),r=!0},p(e,[n]){const s={};2&n&&(s.iconName=e[1].showKeyboard?"piano-down":"piano-up"),i.$set(s),e[0]?o&&(w(),b(o,1,1,(()=>{o=null})),x()):o?(o.p(e,n),1&n&&v(o,1)):(o=Fu(e),o.c(),v(o,1),o.m(t,null)),1&n&&q(t,"outside",e[0])},i(e){r||(v(i.$$.fragment,e),v(o),e&&y((()=>{s||(s=_(t,ye,{},!0)),s.run(1)})),r=!0)},o(e){b(i.$$.fragment,e),b(o),e&&(s||(s=_(t,ye,{},!1)),s.run(0)),r=!1},d(e){e&&m(t),L(i),o&&o.d(),e&&s&&s.end()}}}function zu(e,t,i){let n;S(e,rt,(e=>i(1,n=e)));let{outside:s=!1}=t;return e.$$set=e=>{"outside"in e&&i(0,s=e.outside)},[s,n,()=>F(rt,n.showKeyboard=!n.showKeyboard,n),()=>F(rt,n.overlayKeyboard=!n.overlayKeyboard,n)]}class Nu extends a{constructor(e){super(),l(this,e,zu,ju,i,{outside:0})}}function Lu(e,t,i){const n=e.slice();return n[25]=t[i],n}function Bu(e,t,i){const n=e.slice();return n[28]=t[i].title,n[29]=t[i].note,n}function Wu(e){let t;return{c(){t=u("span"),this.h()},l(e){t=d(e,"SPAN",{title:!0,"data-key":!0,class:!0}),p(t).forEach(m),this.h()},h(){g(t,"title",e[28]),g(t,"data-key",e[29]),g(t,"class","svelte-1lm3ox6"),q(t,"depressed",e[4].has(e[29])||e[3].has(e[29]))},m(e,i){f(e,t,i)},p(e,i){152&i[0]&&q(t,"depressed",e[4].has(e[29])||e[3].has(e[29]))},d(e){e&&m(t)}}}function qu(e){let t,i,n=e[25],s=[];for(let t=0;t<n.length;t+=1)s[t]=Wu(Bu(e,n,t));return{c(){t=u("div");for(let e=0;e<s.length;e+=1)s[e].c();i=h(),this.h()},l(e){t=d(e,"DIV",{class:!0});var n=p(t);for(let e=0;e<s.length;e+=1)s[e].l(n);i=c(n),n.forEach(m),this.h()},h(){g(t,"class","svelte-1lm3ox6")},m(e,n){f(e,t,n);for(let e=0;e<s.length;e+=1)s[e].m(t,null);C(t,i)},p(e,r){if(152&r[0]){let o;for(n=e[25],o=0;o<n.length;o+=1){const a=Bu(e,n,o);s[o]?s[o].p(a,r):(s[o]=Wu(a),s[o].c(),s[o].m(t,i))}for(;o<s.length;o+=1)s[o].d(1);s.length=n.length}},d(e){e&&m(t),A(s,e)}}}function $u(e){let t,i,n,r,o,a,l,y,_,w,x,k,T,S,E,P,M,R,O,I,F,B,W,$=e[7],H=[];for(let t=0;t<$.length;t+=1)H[t]=qu(Lu(e,$,t));return r=new Nu({}),{c(){t=u("div"),i=u("div");for(let e=0;e<H.length;e+=1)H[e].c();n=h(),j(r.$$.fragment),o=h(),a=K("svg"),l=K("symbol"),y=K("path"),_=K("path"),w=K("path"),x=K("path"),k=K("path"),T=h(),S=u("div"),E=K("svg"),P=K("use"),M=h(),R=u("div"),O=K("svg"),I=K("use"),this.h()},l(e){t=d(e,"DIV",{id:!0,class:!0});var s=p(t);i=d(s,"DIV",{id:!0,class:!0});var h=p(i);for(let e=0;e<H.length;e+=1)H[e].l(h);h.forEach(m),n=c(s),z(r.$$.fragment,s),s.forEach(m),o=c(e),a=Q(e,"svg",{style:!0});var u=p(a);l=Q(u,"symbol",{id:!0,viewBox:!0});var g=p(l);y=Q(g,"path",{d:!0,style:!0}),p(y).forEach(m),_=Q(g,"path",{d:!0,style:!0}),p(_).forEach(m),w=Q(g,"path",{d:!0,style:!0}),p(w).forEach(m),x=Q(g,"path",{d:!0,style:!0}),p(x).forEach(m),k=Q(g,"path",{d:!0,style:!0}),p(k).forEach(m),g.forEach(m),u.forEach(m),T=c(e),S=d(e,"DIV",{class:!0});var f=p(S);E=Q(f,"svg",{xmlns:!0,width:!0,height:!0,class:!0});var v=p(E);P=Q(v,"use",{href:!0,class:!0}),p(P).forEach(m),v.forEach(m),f.forEach(m),M=c(e),R=d(e,"DIV",{class:!0});var b=p(R);O=Q(b,"svg",{xmlns:!0,width:!0,height:!0,class:!0});var C=p(O);I=Q(C,"use",{href:!0,class:!0}),p(I).forEach(m),C.forEach(m),b.forEach(m),this.h()},h(){g(i,"id","keys"),g(i,"class","svelte-1lm3ox6"),g(t,"id","keyboard"),g(t,"class","svelte-1lm3ox6"),g(y,"d","M10 0v5.7c0 .9.3 2.2 1 3.5.7 1.4 1.4 3.3 1.4 4.3 0 1.3-1.9 2.8-6.2 2.8-4.4 0-6.2-1.5-6.2-2.8 0-1 .6-2.9 1.4-4.3a28.2 14.1 0 0 0 1-3.5V0z"),oe(y,"fill","#996a01"),g(_,"d","m10.5 9-.7-1.7c-.2-.7-.2-1.3-.2-1.8V0h-7v5.5c0 .5 0 1.1-.2 1.8L1.7 9a43 21.5 0 0 0-1.3 4.3c0 1.3 1.7 2.9 5.6 2.9 4.1 0 5.8-1.6 5.8-3 0-1-.5-2.8-1.3-4.2"),oe(_,"fill","#eed072"),g(w,"d","M9.1 0v5.2a8 8 0 0 0 .8 4c.7 1.5 1 3.3 1 4.3 0 .8-.9 2.4-4.7 2.4-3.8 0-4.8-1.6-4.8-2.4 0-1 .4-2.8 1.1-4.2.7-1.6.7-3 .7-4V0z"),oe(w,"fill","#d7a735"),g(x,"d","M10.5 13.5v-.6c0-.6-.4-.4-.5 0-.2.3-1 1.9-3.8 1.9s-3.7-1.6-4-2c0-.3-.3-.5-.4 0v.7c0 .7.8 2.2 4.4 2.2 3.4 0 4.3-1.5 4.3-2.2"),oe(x,"fill","#eed072"),g(k,"d","M6.1 15.2c.5 0 1.3 0 1.7-.2.5 0 1 0 .6.2a3.1 1.6 0 0 1-2.3.4c-.9 0-1.8-.2-2.2-.4-.4-.3 0-.3.6-.2l1.6.2"),oe(k,"fill","#fff"),g(l,"id","pedal"),g(l,"viewBox","0 0 12.4 16.3"),oe(a,"display","none"),g(P,"href","#pedal"),g(P,"class","svelte-1lm3ox6"),g(E,"xmlns","http://www.w3.org/2000/svg"),g(E,"width","46.9"),g(E,"height","61.6"),g(E,"class","svelte-1lm3ox6"),g(S,"class","pedal svelte-1lm3ox6"),q(S,"depressed",e[5]),g(I,"href","#pedal"),g(I,"class","svelte-1lm3ox6"),g(O,"xmlns","http://www.w3.org/2000/svg"),g(O,"width","46.9"),g(O,"height","61.6"),g(O,"class","svelte-1lm3ox6"),g(R,"class","pedal svelte-1lm3ox6"),q(R,"depressed",e[6])},m(s,h){f(s,t,h),C(t,i);for(let e=0;e<H.length;e+=1)H[e].m(i,null);C(t,n),N(r,t,null),f(s,o,h),f(s,a,h),C(a,l),C(l,y),C(l,_),C(l,w),C(l,x),C(l,k),f(s,T,h),f(s,S,h),C(S,E),C(E,P),f(s,M,h),f(s,R,h),C(R,O),C(O,I),F=!0,B||(W=[D(window,"mouseup",e[10]),D(i,"mousedown",V(e[11])),D(i,"mouseup",V(e[12])),D(i,"mousemove",V(e[13])),D(S,"mousedown",e[14]),D(S,"mouseup",e[15]),D(S,"mouseout",e[16]),D(S,"blur",e[17]),D(R,"mousedown",e[18]),D(R,"mouseup",e[19]),D(R,"mouseout",e[20]),D(R,"blur",e[21])],B=!0)},p(e,t){if(152&t[0]){let n;for($=e[7],n=0;n<$.length;n+=1){const s=Lu(e,$,n);H[n]?H[n].p(s,t):(H[n]=qu(s),H[n].c(),H[n].m(i,null))}for(;n<H.length;n+=1)H[n].d(1);H.length=$.length}32&t[0]&&q(S,"depressed",e[5]),64&t[0]&&q(R,"depressed",e[6])},i(e){F||(v(r.$$.fragment,e),F=!0)},o(e){b(r.$$.fragment,e),F=!1},d(e){e&&m(t),A(H,e),L(r),e&&m(o),e&&m(a),e&&m(T),e&&m(S),e&&m(M),e&&m(R),B=!1,s(W)}}}function Vu(e,t,i){let n,s,r;S(e,st,(e=>i(4,n=e))),S(e,je,(e=>i(5,s=e))),S(e,ze,(e=>i(6,r=e)));let{keyCount:o=88}=t,{startNote:a}=t,{stopNote:l}=t;const h=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],u=[];let c=1,d=0;for(;c<=o;)for(let e=0;e<h.length;e+=1){const t=h[e];if("C"===t&&(d+=1),c>o)break;t.endsWith("#")?u[u.length-1].push({note:c+20,title:`${t}${d}`}):u.push([{note:c+20,title:`${t}${d}`}]),c+=1}let p=!1,m=new Set;const g=()=>{m.forEach((e=>l(e))),i(3,m=new Set)};return e.$$set=e=>{"keyCount"in e&&i(9,o=e.keyCount),"startNote"in e&&i(0,a=e.startNote),"stopNote"in e&&i(1,l=e.stopNote)},[a,l,p,m,n,s,r,u,g,o,()=>{g(),i(2,p=!1)},({target:e})=>{const t=parseInt(e.dataset.key,10);i(2,p=!0),i(3,m=m.add(t)),a(t)},({target:e})=>{const t=parseInt(e.dataset.key,10);m.delete(t),i(3,m),l(t)},({target:e})=>{if(p){const t=parseInt(e.dataset.key,10);t&&!m.has(t)&&(g(),i(3,m=m.add(t)),a(t))}},()=>F(je,s=!0,s),()=>F(je,s=!1,s),()=>F(je,s=!1,s),()=>F(je,s=!1,s),()=>F(ze,r=!0,r),()=>F(ze,r=!1,r),()=>F(ze,r=!1,r),()=>F(ze,r=!1,r)]}class Hu extends a{constructor(e){super(),l(this,e,Vu,$u,i,{keyCount:9,startNote:0,stopNote:1},null,[-1,-1])}}const Uu={volume:{min:0,max:4,delta:.1,augmentedDelta:.4,precision:2},bassVolume:{min:0,max:4,delta:.1,augmentedDelta:.4,precision:2},trebleVolume:{min:0,max:4,delta:.1,augmentedDelta:.4,precision:2},tempo:{min:.1,max:3,delta:.05,augmentedDelta:.1,precision:2}},Gu={volume:We,bassVolume:qe,trebleVolume:$e,tempo:Ve},Zu={SOFT:{code:"KeyB",key:"b"},SUSTAIN:{code:"Space",key:"＿"},ACCENT:{code:"KeyN",key:"n"},VOLUME_UP:{code:"KeyO",key:"o"},VOLUME_DOWN:{code:"KeyI",key:"i"},BASS_VOLUME_UP:{code:"Digit4",key:"4"},BASS_VOLUME_DOWN:{code:"KeyE",key:"e"},TREBLE_VOLUME_UP:{code:"Digit0",key:"0"},TREBLE_VOLUME_DOWN:{code:"KeyP",key:"p"},TEMPO_UP:{code:"KeyT",key:"t"},TEMPO_DOWN:{code:"KeyR",key:"r"},LEFT_HAND_AUGMENT:{code:"KeyW",key:"w"},RIGHT_HAND_AUGMENT:{code:"BracketLeft",key:"["},PLAY_PAUSE:{code:"Digit7",key:"7"},REWIND:{code:"Backspace",key:"⌫"},FORWARD:{code:"Digit8",key:"8"},BACKWARD:{code:"Digit6",key:"6"},PAN_UP:{code:"ArrowUp",key:"↑"},PAN_DOWN:{code:"ArrowDown",key:"↓"},PAN_LEFT:{code:"ArrowLeft",key:"←"},PAN_RIGHT:{code:"ArrowRight",key:"→"}},Xu={SOFT:{description:"Soft Pedal",help:"Hold to apply the soft pedal"},SUSTAIN:{description:"Sustain Pedal",help:"Hold to apply the sustain pedal"},ACCENT:{description:"Accent Button",help:"Notes struck while this is held with be 50% louder"},VOLUME_UP:{description:"Volume Up",help:"Increase the main volume"},VOLUME_DOWN:{description:"Volume Down",help:"Decrease the main volume"},BASS_VOLUME_UP:{description:"Bass Volume Up",help:"Increase the bass volume"},BASS_VOLUME_DOWN:{description:"Bass Volume Down",help:"Decrease the bass volume"},TREBLE_VOLUME_UP:{description:"Treble Volume Up",help:"Increase the treble volume"},TREBLE_VOLUME_DOWN:{description:"Treble Volume Down",help:"Decrease the treble volume"},TEMPO_UP:{description:"Tempo Up",help:"Increase the tempo"},TEMPO_DOWN:{description:"Tempo Down",help:"Decrease the tempo"},LEFT_HAND_AUGMENT:{description:"Left-hand Augment",help:"Hold this key to use the “augmented” increments when using Tempo or Bass Volume keys"},RIGHT_HAND_AUGMENT:{description:"Right-hand Augment",help:"Hold this key to use the “augmented” increments when using Volume or Treble Volume keys"},PLAY_PAUSE:{description:"Play/Pause",help:"Play or pause the roll playback"},REWIND:{description:"Rewind Roll",help:"Rewind the roll to the beginning"},FORWARD:{description:"Scrub Forwards",help:"Advance the roll (hold to accelerate)"},BACKWARD:{description:"Scrub Backwards",help:"Back up (hold to accelerate)"},PAN_UP:{description:"Pan Upwards",help:"Pan the roll upwards (hold to accelerate)"},PAN_DOWN:{description:"Pan Downwards",help:"Pan the roll downwards (hold to accelerate)"},PAN_LEFT:{description:"Pan Left",help:"Pan the roll leftwards (hold to accelerate)"},PAN_RIGHT:{description:"Pan Right",help:"Pan the roll rightwards (hold to accelerate)"}},Yu=["Escape","CapsLock"],Ku={Space:"＿",Backspace:"⌫",Delete:"⌦",NumpadEnter:"⏎",Enter:"⏎",ArrowUp:"↑",ArrowDown:"↓",ArrowLeft:"←",ArrowRight:"→",ControlLeft:"L_Ctrl",ControlRight:"R_Ctrl",ShiftLeft:"L_Shift",ShiftRight:"R_Shift",AltLeft:"L_Alt",AltRight:"R_Alt",MetaLeft:"L_Meta",MetaRight:"R_Meta",OSLeft:"L ⌘",OSRight:"R ⌘"},Qu={VOLUME_DELTA:{control:"volume",deltaType:"delta",description:"Volume Increment",help:"Amount to increase/decrease volume by when using the Volume Up/Down keys"},VOLUME_AUGMENTED_DELTA:{control:"volume",deltaType:"augmentedDelta",description:"Volume Increment (Augmented)",help:"Amount to increase/decrease volume by when holding the left-hand augment key and using the Volume Up/Down keys"},TREBLE_VOLUME_DELTA:{control:"trebleVolume",deltaType:"delta",description:"Treble Volume Increment",help:"Amount to increase/decrease treble volume by when using the Treble Volume Up/Down keys"},TREBLE_VOLUME_AUGMENTED_DELTA:{control:"trebleVolume",deltaType:"augmentedDelta",description:"Treble Volume Increment (Augmented)",help:"Amount to increase/decrease treble volume by when holding the left-hand augment key and using the Treble Volume Up/Down keys"},BASS_VOLUME_DELTA:{control:"bassVolume",deltaType:"delta",description:"Bass Volume Increment",help:"Amount to increase/decrease bass volume by when using the Bass Volume Up/Down keys"},BASS_VOLUME_AUGMENTED_DELTA:{control:"bassVolume",deltaType:"augmentedDelta",description:"Bass Volume Increment (Augmented)",help:"Amount to increase/decrease bass volume by when holding the left-hand augment key and using the Bass Volume Up/Down keys"},TEMPO_DELTA:{control:"tempo",deltaType:"delta",description:"Tempo Increment",help:"Amount to increase/decrease tempo by when using the Tempo Up/Down keys"},TEMPO_AUGMENTED_DELTA:{control:"tempo",deltaType:"augmentedDelta",description:"Tempo Increment (Augmented)",help:"Amount to increase/decrease tempo by when holding the right-hand augment key and using the Tempo Up/Down keys"}};function Ju(e){let i,n;return{c:t,l:t,m(t,s){i||(n=[D(window,"keydown",e[8]),D(window,"keyup",e[9])],i=!0)},p:t,i:t,o:t,d(e){i=!1,s(n)}}}const ec=Re("keyMap",JSON.parse(JSON.stringify(Zu))),tc=Re("controlConfig",{...Uu});function ic(e,i,n){let s,r,a,l,h,u,c=t,d=t;S(e,Ne,(e=>n(12,s=e))),S(e,ze,(e=>n(13,r=e))),S(e,je,(e=>n(14,a=e))),S(e,Fe,(e=>n(15,l=e))),S(e,tc,(e=>n(16,h=e))),S(e,ec,(e=>n(1,u=e))),e.$$.on_destroy.push((()=>c())),e.$$.on_destroy.push((()=>d()));let p,{playPauseApp:m}=i,{stopApp:g}=i,{updateTickByViewportIncrement:f}=i,{panHorizontal:v}=i,y=!1,_=!1;const w=["tempo","bassVolume"],b=["trebleVolume","volume"],x=(e,t)=>{const{min:i,max:n,delta:s,augmentedDelta:r,precision:a}=h[e],l=Gu[e];let u=w.includes(e)&&y||b.includes(e)&&_?r:s;u*=t?1:-1,l.set(((e,t)=>{const i=10**(t||0);return Math.round(e*i)/i})(at(o(l)+u,i,n),a))},k=(...e)=>x(...e,!0),T=(...e)=>x(...e,!1),E=(e,t=!0)=>{p||(t&&e(),n(0,p=ht(e)))},C={SOFT:()=>F(je,a=!0,a),SUSTAIN:()=>F(ze,r=!0,r),ACCENT:()=>F(Ne,s=!0,s),VOLUME_UP:()=>k("volume"),VOLUME_DOWN:()=>T("volume"),BASS_VOLUME_UP:()=>k("bassVolume"),BASS_VOLUME_DOWN:()=>T("bassVolume"),TREBLE_VOLUME_UP:()=>k("trebleVolume"),TREBLE_VOLUME_DOWN:()=>T("trebleVolume"),TEMPO_UP:()=>k("tempo"),TEMPO_DOWN:()=>T("tempo"),LEFT_HAND_AUGMENT:()=>y=!0,RIGHT_HAND_AUGMENT:()=>_=!0,PLAY_PAUSE:m,REWIND:g,FORWARD:()=>E((()=>f(!l))),BACKWARD:()=>E((()=>f(l))),PAN_UP:()=>E((()=>f(!0))),PAN_DOWN:()=>E((()=>f(!1))),PAN_LEFT:()=>E((()=>v(!0))),PAN_RIGHT:()=>E((()=>v(!1)))},P={SOFT:()=>F(je,a=!1,a),SUSTAIN:()=>F(ze,r=!1,r),ACCENT:()=>F(Ne,s=!1,s),LEFT_HAND_AUGMENT:()=>y=!1,RIGHT_HAND_AUGMENT:()=>_=!1};return e.$$set=e=>{"playPauseApp"in e&&n(4,m=e.playPauseApp),"stopApp"in e&&n(5,g=e.stopApp),"updateTickByViewportIncrement"in e&&n(6,f=e.updateTickByViewportIncrement),"panHorizontal"in e&&n(7,v=e.panHorizontal)},[p,u,C,P,m,g,f,v,e=>{const t=Object.keys(u).find((t=>u[t].code===e.code));t&&(e.ctrlKey||e.shiftKey||e.preventDefault(),F(ec,u[t].active=!0,u),C[t]?.(e))},({code:e})=>{const t=Object.keys(u).find((t=>u[t].code===e));t&&(p?.clear(),n(0,p=void 0),F(ec,u[t].active=!1,u),P[t]?.())}]}class nc extends a{constructor(e){super(),l(this,e,ic,Ju,i,{playPauseApp:4,stopApp:5,updateTickByViewportIncrement:6,panHorizontal:7})}}if("undefined"!=typeof document){const e=".shortcut-editor.svelte-qlqndb.svelte-qlqndb{background-color:var(--background-color);border-radius:4px;box-shadow:0 3px 6px rgba(0, 0, 0, 0.3);display:flex;flex-direction:column;left:50%;max-height:80%;padding:1em;position:absolute;top:42%;transform:translate(-50%, -50%);width:min(600px, 100vw);z-index:10}.shortcut-editor.svelte-qlqndb .panel-switcher{border-bottom:1px solid rgba(0, 0, 0, 0.4)}.shortcut-editor.svelte-qlqndb .panel-switcher label{background-color:var(--primary-accent);border-bottom:0;border-radius:0.25em 0.25em 0 0;border-width:1px;color:white;opacity:0.8;padding-bottom:4px}.shortcut-editor.svelte-qlqndb .panel-switcher label:last-child{margin-right:4px}.shortcut-editor.svelte-qlqndb .panel-switcher input:checked + label{background-color:var(--background-color);color:black;transform:translateY(2px)}header.svelte-qlqndb.svelte-qlqndb{display:flex;font-size:1.4em;font-weight:bold;justify-content:space-between;margin-bottom:0.5em;text-decoration:underline}footer.svelte-qlqndb.svelte-qlqndb{display:flex}footer.svelte-qlqndb p.svelte-qlqndb{flex:1;margin:1em 0 0}p.svelte-qlqndb.svelte-qlqndb{margin-bottom:1em}.panels.svelte-qlqndb.svelte-qlqndb{display:flex;overflow:hidden;padding-top:4px;position:relative}dl.svelte-qlqndb.svelte-qlqndb{display:grid;flex:none;gap:0 0.25em;grid-auto-rows:-webkit-min-content;grid-auto-rows:min-content;grid-template-columns:auto auto;justify-content:space-between;padding:0 4px;width:100%}dl.svelte-qlqndb.svelte-qlqndb:not(:first-child){margin-left:-100%}dd, dt{display:flex;align-items:center;margin:2px 0}hr{border-color:rgba(255, 255, 255, 0.8);border-width:0 0 1px 0;grid-column:1/3;width:80%}hr.section{border-color:rgba(0, 0, 0, 0.4);margin:2em 0 4px -4px;width:calc(100% + 8px)}p.error-message.svelte-qlqndb.svelte-qlqndb{color:red}p.reset.svelte-qlqndb.svelte-qlqndb{display:flex;align-items:center;justify-content:flex-end}dl.svelte-qlqndb.svelte-qlqndb,p.reset.svelte-qlqndb.svelte-qlqndb{opacity:0;pointer-events:none;transition:opacity 0.4s ease}dl.shown.svelte-qlqndb.svelte-qlqndb,p.reset.shown.svelte-qlqndb.svelte-qlqndb{opacity:1;pointer-events:all;overflow-y:auto}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}if("undefined"!=typeof document){const e="div.svelte-1b99zz3.svelte-1b99zz3{text-align:right;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}input.svelte-1b99zz3.svelte-1b99zz3{display:none}label.svelte-1b99zz3.svelte-1b99zz3{display:inline-block;padding:0.2em 0.2em 0;border:2px solid rgba(0, 0, 0, 0.4);border-radius:0.25em;transition:all 0.2s;opacity:0.4;cursor:pointer}label.svelte-1b99zz3.svelte-1b99zz3:hover{background-color:unset;color:unset}input.svelte-1b99zz3:checked+label.svelte-1b99zz3{color:white;background-color:var(--primary-accent);cursor:unset;opacity:1}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function sc(e,t,i){const n=e.slice();return n[5]=t[i][0],n[6]=t[i][1],n}function rc(e){let t,i;return t=new Rh({props:{name:e[6].icon,height:"24",width:"24"}}),{c(){j(t.$$.fragment)},l(e){z(t.$$.fragment,e)},m(e,n){N(t,e,n),i=!0},p(e,i){const n={};2&i&&(n.name=e[6].icon),t.$set(n)},i(e){i||(v(t.$$.fragment,e),i=!0)},o(e){b(t.$$.fragment,e),i=!1},d(e){L(t,e)}}}function oc(e){let t,i=e[6].text+"";return{c(){t=P(i)},l(e){t=M(e,i)},m(e,i){f(e,t,i)},p(e,n){2&n&&i!==(i=e[6].text+"")&&R(t,i)},d(e){e&&m(t)}}}function ac(e){let t,i,n,s,r,o,a,l,y,_,k,T,S=e[6].icon&&rc(e),E=e[6].text&&oc(e);return{c(){t=u("input"),r=h(),o=u("label"),S&&S.c(),a=h(),E&&E.c(),l=h(),this.h()},l(e){t=d(e,"INPUT",{type:!0,name:!0,id:!0,class:!0}),r=c(e),o=d(e,"LABEL",{for:!0,class:!0});var i=p(o);S&&S.l(i),a=c(i),E&&E.l(i),l=c(i),i.forEach(m),this.h()},h(){g(t,"type","radio"),g(t,"name",i=Math.random().toString(16).slice(2)),t.__value=n=e[5],t.value=t.__value,g(t,"id",s=e[5]),g(t,"class","svelte-1b99zz3"),e[4][0].push(t),g(o,"for",y=e[5]),g(o,"class","svelte-1b99zz3")},m(i,n){f(i,t,n),t.checked=t.__value===e[0],f(i,r,n),f(i,o,n),S&&S.m(o,null),C(o,a),E&&E.m(o,null),C(o,l),_=!0,k||(T=D(t,"change",e[3]),k=!0)},p(e,i){(!_||2&i&&n!==(n=e[5]))&&(t.__value=n,t.value=t.__value),(!_||2&i&&s!==(s=e[5]))&&g(t,"id",s),1&i&&(t.checked=t.__value===e[0]),e[6].icon?S?(S.p(e,i),2&i&&v(S,1)):(S=rc(e),S.c(),v(S,1),S.m(o,a)):S&&(w(),b(S,1,1,(()=>{S=null})),x()),e[6].text?E?E.p(e,i):(E=oc(e),E.c(),E.m(o,l)):E&&(E.d(1),E=null),(!_||2&i&&y!==(y=e[5]))&&g(o,"for",y)},i(e){_||(v(S),_=!0)},o(e){b(S),_=!1},d(i){i&&m(t),e[4][0].splice(e[4][0].indexOf(t),1),i&&m(r),i&&m(o),S&&S.d(),E&&E.d(),k=!1,T()}}}function lc(e){let t,i,n,s=Object.entries(e[1]),r=[];for(let t=0;t<s.length;t+=1)r[t]=ac(sc(e,s,t));const o=e=>b(r[e],1,1,(()=>{r[e]=null}));return{c(){t=u("div");for(let e=0;e<r.length;e+=1)r[e].c();this.h()},l(e){t=d(e,"DIV",{class:!0});var i=p(t);for(let e=0;e<r.length;e+=1)r[e].l(i);i.forEach(m),this.h()},h(){g(t,"class",i=ne(e[2].class)+" svelte-1b99zz3")},m(e,i){f(e,t,i);for(let e=0;e<r.length;e+=1)r[e].m(t,null);n=!0},p(e,[a]){if(3&a){let i;for(s=Object.entries(e[1]),i=0;i<s.length;i+=1){const n=sc(e,s,i);r[i]?(r[i].p(n,a),v(r[i],1)):(r[i]=ac(n),r[i].c(),v(r[i],1),r[i].m(t,null))}for(w(),i=s.length;i<r.length;i+=1)o(i);x()}(!n||4&a&&i!==(i=ne(e[2].class)+" svelte-1b99zz3"))&&g(t,"class",i)},i(e){if(!n){for(let e=0;e<s.length;e+=1)v(r[e]);n=!0}},o(e){r=r.filter(Boolean);for(let e=0;e<r.length;e+=1)b(r[e]);n=!1},d(e){e&&m(t),A(r,e)}}}function hc(e,t,i){let{panels:n}=t,{selectedPanel:s}=t;return e.$$set=e=>{i(2,t=Y(Y({},t),te(e))),"panels"in e&&i(1,n=e.panels),"selectedPanel"in e&&i(0,s=e.selectedPanel)},t=te(t),[s,n,t,function(){s=this.__value,i(0,s)},[[]]]}class uc extends a{constructor(e){super(),l(this,e,hc,lc,i,{panels:1,selectedPanel:0})}}if("undefined"!=typeof document){const e="dd.svelte-1wmdu7e.svelte-1wmdu7e{justify-content:flex-end}dd.svelte-1wmdu7e span.svelte-1wmdu7e{color:grey}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function cc(e){let t,i,n=e[0].key+"";return{c(){t=u("kbd"),i=P(n)},l(e){t=d(e,"KBD",{});var s=p(t);i=M(s,n),s.forEach(m)},m(e,n){f(e,t,n),C(t,i)},p(e,t){1&t&&n!==(n=e[0].key+"")&&R(i,n)},d(e){e&&m(t)}}}function dc(e){let i,n;return{c(){i=u("span"),n=P("Choose a new keystroke..."),this.h()},l(e){i=d(e,"SPAN",{class:!0});var t=p(i);n=M(t,"Choose a new keystroke..."),t.forEach(m),this.h()},h(){g(i,"class","svelte-1wmdu7e")},m(e,t){f(e,i,t),C(i,n)},p:t,d(e){e&&m(i)}}}function pc(e){let t,i;return t=new vu({props:{iconName:"reset",label:"Reset Keystroke to Default",height:"20",width:"20",tooltip:e[0].isChanged?"Reset to Default":void 0,disabled:!e[0].isChanged}}),t.$on("click",e[5]),{c(){j(t.$$.fragment)},l(e){z(t.$$.fragment,e)},m(e,n){N(t,e,n),i=!0},p(e,i){const n={};1&i&&(n.tooltip=e[0].isChanged?"Reset to Default":void 0),1&i&&(n.disabled=!e[0].isChanged),t.$set(n)},i(e){i||(v(t.$$.fragment,e),i=!0)},o(e){b(t.$$.fragment,e),i=!1},d(e){L(t,e)}}}function mc(e){let n,o,a,l,y,_,k,T,S,E,A,O,I=e[1].description+"",F=e[0].isChanged;function B(e,t){return e[2]?dc:cc}let q=B(e),$=q(e);function H(t){e[8](t)}let U={iconName:"edit",label:"Edit Keystroke",height:"20",width:"20",tooltip:"Edit"};void 0!==e[3]&&(U.ref=e[3]),k=new vu({props:U}),W.push((()=>Z(k,"ref",H))),k.$on("click",e[9]);let G=pc(e);return{c(){n=u("dt"),o=P(I),l=h(),y=u("dd"),$.c(),_=h(),j(k.$$.fragment),S=h(),G.c(),this.h()},l(e){n=d(e,"DT",{});var t=p(n);o=M(t,I),t.forEach(m),l=c(e),y=d(e,"DD",{class:!0});var i=p(y);$.l(i),_=c(i),z(k.$$.fragment,i),S=c(i),G.l(i),i.forEach(m),this.h()},h(){g(y,"class","svelte-1wmdu7e")},m(t,i){f(t,n,i),C(n,o),f(t,l,i),f(t,y,i),$.m(y,null),C(y,_),N(k,y,null),C(y,S),G.m(y,null),E=!0,A||(O=[D(window,"keydown",V(e[6]),!0),D(window,"keyup",V(e[7]),!0),se(a=mu.call(null,n,e[1].help))],A=!0)},p(e,[n]){(!E||2&n)&&I!==(I=e[1].description+"")&&R(o,I),a&&r(a.update)&&2&n&&a.update.call(null,e[1].help),q===(q=B(e))&&$?$.p(e,n):($.d(1),$=q(e),$&&($.c(),$.m(y,_)));const s={};!T&&8&n&&(T=!0,s.ref=e[3],X((()=>T=!1))),k.$set(s),1&n&&i(F,F=e[0].isChanged)?(w(),b(G,1,1,t),x(),G=pc(e),G.c(),v(G),G.m(y,null)):G.p(e,n)},i(e){E||(v(k.$$.fragment,e),v(G),E=!0)},o(e){b(k.$$.fragment,e),b(G),E=!1},d(e){e&&m(n),e&&m(l),e&&m(y),$.d(),L(k),G.d(e),A=!1,s(O)}}}function gc(e,t,i){let n,{shortcut:s}=t,{meta:r}=t,o=!1;const a=B(),l=e=>a("update",e);return e.$$set=e=>{"shortcut"in e&&i(0,s=e.shortcut),"meta"in e&&i(1,r=e.meta)},[s,r,o,n,l,()=>a("reset"),e=>o&&e.stopPropagation(),e=>{o&&(l(e),i(2,o=!1),n.blur(),e.stopPropagation())},function(e){n=e,i(3,n)},()=>i(2,o=!o)]}class fc extends a{constructor(e){super(),l(this,e,gc,mc,i,{shortcut:0,meta:1})}}if("undefined"!=typeof document){const e='dd.svelte-14t62ll span.svelte-14t62ll{width:4ch;text-align:right}dd.svelte-14t62ll input[type="range"]{height:100%;margin:0 1em;width:7em}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}if("undefined"!=typeof document){const e="[type=range].svelte-gwkia6{-webkit-appearance:none;background:transparent;margin:7px 0;width:100%}[type=range].svelte-gwkia6::-moz-focus-outer{border:0}[type=range].svelte-gwkia6:focus{outline:0}[type=range].svelte-gwkia6:focus::-webkit-slider-runnable-track{background:#f7f7f7}[type=range].svelte-gwkia6:focus::-ms-fill-lower{background:#eaeaea}[type=range].svelte-gwkia6:focus::-ms-fill-upper{background:#f7f7f7}[type=range].svelte-gwkia6::-webkit-slider-runnable-track{cursor:default;height:2px;-webkit-transition:all 0.2s ease;transition:all 0.2s ease;width:100%;box-shadow:1px 1px 1px rgba(0, 0, 0, 0.2), 0 0 1px rgba(13, 13, 13, 0.2);background:#eaeaea;border:0px solid #cfd8dc;border-radius:5px}[type=range].svelte-gwkia6::-webkit-slider-thumb{box-shadow:2px 2px 4px rgba(0, 0, 0, 0.2), 0 0 2px rgba(13, 13, 13, 0.2);background:var(--primary-accent);border:0px solid #eaeaea;border-radius:14px;box-sizing:border-box;cursor:default;height:14px;width:14px;-webkit-appearance:none;margin-top:-6px}[type=range].svelte-gwkia6::-moz-range-track{box-shadow:1px 1px 1px rgba(0, 0, 0, 0.2), 0 0 1px rgba(13, 13, 13, 0.2);cursor:default;height:2px;-moz-transition:all 0.2s ease;transition:all 0.2s ease;width:100%;background:#eaeaea;border:0px solid #cfd8dc;border-radius:5px;height:1px}[type=range].svelte-gwkia6::-moz-range-thumb{box-shadow:2px 2px 4px rgba(0, 0, 0, 0.2), 0 0 2px rgba(13, 13, 13, 0.2);background:var(--primary-accent);border:0px solid #eaeaea;border-radius:14px;box-sizing:border-box;cursor:default;height:14px;width:14px}[type=range].svelte-gwkia6::-ms-track{cursor:default;height:2px;-ms-transition:all 0.2s ease;transition:all 0.2s ease;width:100%;background:transparent;border-color:transparent;border-width:7px 0;color:transparent}[type=range].svelte-gwkia6::-ms-fill-lower{box-shadow:1px 1px 1px rgba(0, 0, 0, 0.2), 0 0 1px rgba(13, 13, 13, 0.2);background:#dddddd;border:0px solid #cfd8dc;border-radius:10px}[type=range].svelte-gwkia6::-ms-fill-upper{box-shadow:1px 1px 1px rgba(0, 0, 0, 0.2), 0 0 1px rgba(13, 13, 13, 0.2);background:#eaeaea;border:0px solid #cfd8dc;border-radius:10px}[type=range].svelte-gwkia6::-ms-thumb{box-shadow:2px 2px 4px rgba(0, 0, 0, 0.2), 0 0 2px rgba(13, 13, 13, 0.2);background:var(--primary-accent);border:0px solid #eaeaea;border-radius:14px;box-sizing:border-box;cursor:default;height:14px;width:14px;margin-top:0.5px}[type=range].svelte-gwkia6:disabled::-webkit-slider-thumb,[type=range].svelte-gwkia6:disabled::-moz-range-thumb,[type=range].svelte-gwkia6:disabled::-ms-thumb,[type=range].svelte-gwkia6:disabled::-webkit-slider-runnable-track,[type=range].svelte-gwkia6:disabled::-ms-fill-lower,[type=range].svelte-gwkia6:disabled::-ms-fill-upper{cursor:not-allowed}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function vc(e){let i,n,r;return{c(){i=u("input"),this.h()},l(e){i=d(e,"INPUT",{type:!0,id:!0,min:!0,max:!0,step:!0,name:!0,class:!0}),this.h()},h(){g(i,"type","range"),g(i,"id",e[4]),g(i,"min",e[1]),g(i,"max",e[2]),g(i,"step",e[3]),g(i,"name",e[4]),g(i,"class","svelte-gwkia6")},m(t,s){f(t,i,s),ae(i,e[0]),n||(r=[D(i,"change",e[9]),D(i,"input",e[9]),D(i,"input",e[7]),D(i,"change",e[8]),D(i,"mousewheel",e[5])],n=!0)},p(e,[t]){16&t&&g(i,"id",e[4]),2&t&&g(i,"min",e[1]),4&t&&g(i,"max",e[2]),8&t&&g(i,"step",e[3]),16&t&&g(i,"name",e[4]),1&t&&ae(i,e[0])},i:t,o:t,d(e){e&&m(i),n=!1,s(r)}}}function yc(e,t,i){let{min:n}=t,{max:s}=t,{step:r}=t,{name:o}=t,{value:a}=t,{mousewheel:l=!0}=t;const h=e=>Math.min(Math.max(e,n),s);return e.$$set=e=>{"min"in e&&i(1,n=e.min),"max"in e&&i(2,s=e.max),"step"in e&&i(3,r=e.step),"name"in e&&i(4,o=e.name),"value"in e&&i(0,a=e.value),"mousewheel"in e&&i(6,l=e.mousewheel)},[a,n,s,r,o,e=>{if(!l)return;e.preventDefault();const t=(r.toString().split(".")[1]||"").length;e.deltaY>0?i(0,a=h((Number(a)+Number(r)).toFixed(t))):i(0,a=h((Number(a)-Number(r)).toFixed(t)))},l,function(t){re.call(this,e,t)},function(t){re.call(this,e,t)},function(){a=le(this.value),i(0,a)}]}class _c extends a{constructor(e){super(),l(this,e,yc,vc,i,{min:1,max:2,step:3,name:4,value:0,mousewheel:6})}}function wc(e){let t,i;return t=new vu({props:{iconName:"reset",label:"Reset Increment to Default",height:"20",width:"20",disabled:!e[3],tooltip:e[3]?"Reset to Default":void 0}}),t.$on("click",e[5]),{c(){j(t.$$.fragment)},l(e){z(t.$$.fragment,e)},m(e,n){N(t,e,n),i=!0},p(e,i){const n={};8&i&&(n.disabled=!e[3]),8&i&&(n.tooltip=e[3]?"Reset to Default":void 0),t.$set(n)},i(e){i||(v(t.$$.fragment,e),i=!0)},o(e){b(t.$$.fragment,e),i=!1},d(e){L(t,e)}}}function bc(e){let n,s,o,a,l,y,_,k,T,S,E,D,A,O,I,F=e[2].description+"",B=e[3];function q(t){e[6](t)}let $={min:"0",max:"1",step:"0.01",name:e[1]};void 0!==e[0]&&($.value=e[0]),S=new _c({props:$}),W.push((()=>Z(S,"value",q))),S.$on("input",e[4]);let V=wc(e);return{c(){n=u("dt"),s=P(F),a=h(),l=u("dd"),y=P("±"),_=u("span"),k=P(e[0]),T=h(),j(S.$$.fragment),D=h(),V.c(),this.h()},l(t){n=d(t,"DT",{});var i=p(n);s=M(i,F),i.forEach(m),a=c(t),l=d(t,"DD",{class:!0});var r=p(l);y=M(r,"±"),_=d(r,"SPAN",{class:!0});var o=p(_);k=M(o,e[0]),o.forEach(m),T=c(r),z(S.$$.fragment,r),D=c(r),V.l(r),r.forEach(m),this.h()},h(){g(_,"class","svelte-14t62ll"),g(l,"class","svelte-14t62ll")},m(t,i){f(t,n,i),C(n,s),f(t,a,i),f(t,l,i),C(l,y),C(l,_),C(_,k),C(l,T),N(S,l,null),C(l,D),V.m(l,null),A=!0,O||(I=se(o=mu.call(null,n,e[2].help)),O=!0)},p(e,[n]){(!A||4&n)&&F!==(F=e[2].description+"")&&R(s,F),o&&r(o.update)&&4&n&&o.update.call(null,e[2].help),(!A||1&n)&&R(k,e[0]);const a={};2&n&&(a.name=e[1]),!E&&1&n&&(E=!0,a.value=e[0],X((()=>E=!1))),S.$set(a),8&n&&i(B,B=e[3])?(w(),b(V,1,1,t),x(),V=wc(e),V.c(),v(V),V.m(l,null)):V.p(e,n)},i(e){A||(v(S.$$.fragment,e),v(V),A=!0)},o(e){b(S.$$.fragment,e),b(V),A=!1},d(e){e&&m(n),e&&m(a),e&&m(l),L(S),V.d(e),O=!1,I()}}}function xc(e,t,i){let{shortcut:n}=t,{meta:s}=t,{controlConfigValue:r}=t,{isChanged:o}=t;const a=B();return e.$$set=e=>{"shortcut"in e&&i(1,n=e.shortcut),"meta"in e&&i(2,s=e.meta),"controlConfigValue"in e&&i(0,r=e.controlConfigValue),"isChanged"in e&&i(3,o=e.isChanged)},[r,n,s,o,()=>a("update",r),()=>a("reset"),function(e){r=e,i(0,r)}]}class kc extends a{constructor(e){super(),l(this,e,xc,bc,i,{shortcut:1,meta:2,controlConfigValue:0,isChanged:3})}}function Tc(e,t,i){const n=e.slice();return n[15]=t[i],n}function Sc(e,t,i){const n=e.slice();return n[18]=t[i],n}function Ec(e){let t,i,n,s,r,o,a,l,k,T,S,E,R,D,O,I,F,B,$,V;function H(t){e[10](t)}s=new vu({props:{iconName:"cross",label:"Close Keyboard Controls Panel",height:"24",width:"24"}}),s.$on("click",jc);let U={panels:e[2],class:"panel-switcher"};void 0!==e[1]&&(U.selectedPanel=e[1]),k=new uc({props:U}),W.push((()=>Z(k,"selectedPanel",H)));let G=Object.keys(e[2]),Y=[];for(let t=0;t<G.length;t+=1)Y[t]=Ac(Tc(e,G,t));const K=e=>b(Y[e],1,1,(()=>{Y[e]=null}));let Q=e[0]&&Oc(e);return B=new vu({props:{iconName:"reset",tooltip:"Reset all Keystrokes to Default",label:"Reset all Keystrokes to Default",height:"24",width:"24"}}),B.$on("click",e[8]),{c(){t=u("div"),i=u("header"),n=P("Keyboard Controls\n      "),j(s.$$.fragment),r=h(),o=u("p"),a=P("Click the edit button to reassign a control button."),l=h(),j(k.$$.fragment),S=h(),E=u("div");for(let e=0;e<Y.length;e+=1)Y[e].c();R=h(),D=u("footer"),Q&&Q.c(),O=h(),I=u("p"),F=P("Reset to defaults: "),j(B.$$.fragment),this.h()},l(e){t=d(e,"DIV",{class:!0});var h=p(t);i=d(h,"HEADER",{class:!0});var u=p(i);n=M(u,"Keyboard Controls\n      "),z(s.$$.fragment,u),u.forEach(m),r=c(h),o=d(h,"P",{class:!0});var g=p(o);a=M(g,"Click the edit button to reassign a control button."),g.forEach(m),l=c(h),z(k.$$.fragment,h),S=c(h),E=d(h,"DIV",{class:!0});var f=p(E);for(let e=0;e<Y.length;e+=1)Y[e].l(f);f.forEach(m),R=c(h),D=d(h,"FOOTER",{class:!0});var v=p(D);Q&&Q.l(v),O=c(v),I=d(v,"P",{class:!0});var y=p(I);F=M(y,"Reset to defaults: "),z(B.$$.fragment,y),y.forEach(m),v.forEach(m),h.forEach(m),this.h()},h(){g(i,"class","svelte-qlqndb"),g(o,"class","svelte-qlqndb"),g(E,"class","panels svelte-qlqndb"),g(I,"class","reset svelte-qlqndb"),q(I,"shown",Object.values(e[4]).some(zc)||Object.values(e[3]).some(Nc)),g(D,"class","svelte-qlqndb"),g(t,"class","shortcut-editor svelte-qlqndb")},m(e,h){f(e,t,h),C(t,i),C(i,n),N(s,i,null),C(t,r),C(t,o),C(o,a),C(t,l),N(k,t,null),C(t,S),C(t,E);for(let e=0;e<Y.length;e+=1)Y[e].m(E,null);C(t,R),C(t,D),Q&&Q.m(D,null),C(D,O),C(D,I),C(I,F),N(B,I,null),V=!0},p(e,t){const i={};if(4&t&&(i.panels=e[2]),!T&&2&t&&(T=!0,i.selectedPanel=e[1],X((()=>T=!1))),k.$set(i),222&t){let i;for(G=Object.keys(e[2]),i=0;i<G.length;i+=1){const n=Tc(e,G,i);Y[i]?(Y[i].p(n,t),v(Y[i],1)):(Y[i]=Ac(n),Y[i].c(),v(Y[i],1),Y[i].m(E,null))}for(w(),i=G.length;i<Y.length;i+=1)K(i);x()}e[0]?Q?(Q.p(e,t),1&t&&v(Q,1)):(Q=Oc(e),Q.c(),v(Q,1),Q.m(D,O)):Q&&(w(),b(Q,1,1,(()=>{Q=null})),x()),24&t&&q(I,"shown",Object.values(e[4]).some(zc)||Object.values(e[3]).some(Nc))},i(e){if(!V){v(s.$$.fragment,e),v(k.$$.fragment,e);for(let e=0;e<G.length;e+=1)v(Y[e]);v(Q),v(B.$$.fragment,e),y((()=>{$||($=_(t,ye,{},!0)),$.run(1)})),V=!0}},o(e){b(s.$$.fragment,e),b(k.$$.fragment,e),Y=Y.filter(Boolean);for(let e=0;e<Y.length;e+=1)b(Y[e]);b(Q),b(B.$$.fragment,e),$||($=_(t,ye,{},!1)),$.run(0),V=!1},d(e){e&&m(t),L(s),L(k),A(Y,e),Q&&Q.d(),L(B),e&&$&&$.end()}}}function Cc(e){let i;return{c(){i=u("hr"),this.h()},l(e){i=d(e,"HR",{class:!0}),this.h()},h(){g(i,"class","section")},m(e,t){f(e,i,t)},p:t,i:t,o:t,d(e){e&&m(i)}}}function Pc(e){let i;return{c(){i=u("hr")},l(e){i=d(e,"HR",{})},m(e,t){f(e,i,t)},p:t,i:t,o:t,d(e){e&&m(i)}}}function Mc(e){let t,i;return t=new kc({props:{shortcut:e[18],controlConfigValue:e[3][Qu[e[18]].control][Qu[e[18]].deltaType],meta:Qu[e[18]],isChanged:e[3][Qu[e[18]].control].isChanged?.includes(Qu[e[18]].deltaType)}}),t.$on("update",(function(...t){return e[13](e[18],...t)})),t.$on("reset",(function(){return e[14](e[18])})),{c(){j(t.$$.fragment)},l(e){z(t.$$.fragment,e)},m(e,n){N(t,e,n),i=!0},p(i,n){e=i;const s={};4&n&&(s.shortcut=e[18]),12&n&&(s.controlConfigValue=e[3][Qu[e[18]].control][Qu[e[18]].deltaType]),4&n&&(s.meta=Qu[e[18]]),12&n&&(s.isChanged=e[3][Qu[e[18]].control].isChanged?.includes(Qu[e[18]].deltaType)),t.$set(s)},i(e){i||(v(t.$$.fragment,e),i=!0)},o(e){b(t.$$.fragment,e),i=!1},d(e){L(t,e)}}}function Rc(e){let t,i;return t=new fc({props:{shortcut:e[4][e[18]],meta:Xu[e[18]]}}),t.$on("update",(function(...t){return e[11](e[18],...t)})),t.$on("reset",(function(){return e[12](e[18])})),{c(){j(t.$$.fragment)},l(e){z(t.$$.fragment,e)},m(e,n){N(t,e,n),i=!0},p(i,n){e=i;const s={};20&n&&(s.shortcut=e[4][e[18]]),4&n&&(s.meta=Xu[e[18]]),t.$set(s)},i(e){i||(v(t.$$.fragment,e),i=!0)},o(e){b(t.$$.fragment,e),i=!1},d(e){L(t,e)}}}function Dc(e){let t,i,n,s;const r=[Rc,Mc,Pc,Cc],o=[];function a(e,t){return e[18]in e[4]?0:e[18]in Qu?1:"---"===e[18]?2:"==="===e[18]?3:-1}return~(t=a(e))&&(i=o[t]=r[t](e)),{c(){i&&i.c(),n=T()},l(e){i&&i.l(e),n=T()},m(e,i){~t&&o[t].m(e,i),f(e,n,i),s=!0},p(e,s){let l=t;t=a(e),t===l?~t&&o[t].p(e,s):(i&&(w(),b(o[l],1,1,(()=>{o[l]=null})),x()),~t?(i=o[t],i?i.p(e,s):(i=o[t]=r[t](e),i.c()),v(i,1),i.m(n.parentNode,n)):i=null)},i(e){s||(v(i),s=!0)},o(e){b(i),s=!1},d(e){~t&&o[t].d(e),e&&m(n)}}}function Ac(e){let t,i,n=e[2][e[15]].shortcuts,s=[];for(let t=0;t<n.length;t+=1)s[t]=Dc(Sc(e,n,t));const r=e=>b(s[e],1,1,(()=>{s[e]=null}));return{c(){t=u("dl");for(let e=0;e<s.length;e+=1)s[e].c();this.h()},l(e){t=d(e,"DL",{class:!0});var i=p(t);for(let e=0;e<s.length;e+=1)s[e].l(i);i.forEach(m),this.h()},h(){g(t,"class","svelte-qlqndb"),q(t,"shown",e[1]===e[15])},m(e,n){f(e,t,n);for(let e=0;e<s.length;e+=1)s[e].m(t,null);i=!0},p(e,i){if(220&i){let o;for(n=e[2][e[15]].shortcuts,o=0;o<n.length;o+=1){const r=Sc(e,n,o);s[o]?(s[o].p(r,i),v(s[o],1)):(s[o]=Dc(r),s[o].c(),v(s[o],1),s[o].m(t,null))}for(w(),o=n.length;o<s.length;o+=1)r(o);x()}6&i&&q(t,"shown",e[1]===e[15])},i(e){if(!i){for(let e=0;e<n.length;e+=1)v(s[e]);i=!0}},o(e){s=s.filter(Boolean);for(let e=0;e<s.length;e+=1)b(s[e]);i=!1},d(e){e&&m(t),A(s,e)}}}function Oc(e){let t,i,n,s;return{c(){t=u("p"),i=P(e[0]),this.h()},l(n){t=d(n,"P",{class:!0});var s=p(t);i=M(s,e[0]),s.forEach(m),this.h()},h(){g(t,"class","error-message svelte-qlqndb")},m(e,n){f(e,t,n),C(t,i),s=!0},p(e,t){(!s||1&t)&&R(i,e[0])},i(e){s||(y((()=>{n||(n=_(t,ye,{},!0)),n.run(1)})),s=!0)},o(e){n||(n=_(t,ye,{},!1)),n.run(0),s=!1},d(e){e&&m(t),e&&n&&n.end()}}}function Ic(e){let t,i,n,s,r=e[5]&&Ec(e);return{c(){r&&r.c(),t=T()},l(e){r&&r.l(e),t=T()},m(o,a){r&&r.m(o,a),f(o,t,a),i=!0,n||(s=D(window,"keydown",e[9]),n=!0)},p(e,[i]){e[5]?r?(r.p(e,i),32&i&&v(r,1)):(r=Ec(e),r.c(),v(r,1),r.m(t.parentNode,t)):r&&(w(),b(r,1,1,(()=>{r=null})),x())},i(e){i||(v(r),i=!0)},o(e){b(r),i=!1},d(e){r&&r.d(e),e&&m(t),n=!1,s()}}}const Fc=Ce(!1),jc=()=>Fc.update((e=>!e)),zc=e=>e.isChanged,Nc=e=>e.isChanged?.length;function Lc(e,t,i){let n,s,r,o;S(e,tc,(e=>i(3,n=e))),S(e,ec,(e=>i(4,s=e))),S(e,Fc,(e=>i(5,r=e)));let a="playback";const l={playback:{text:"Playback Controls",shortcuts:["SOFT","SUSTAIN","ACCENT","---","PLAY_PAUSE","REWIND","FORWARD","BACKWARD"]},volumeAndTempo:{text:"Volume & Tempo",shortcuts:["VOLUME_UP","VOLUME_DOWN","VOLUME_DELTA","VOLUME_AUGMENTED_DELTA","---","TREBLE_VOLUME_UP","TREBLE_VOLUME_DOWN","TREBLE_VOLUME_DELTA","TREBLE_VOLUME_AUGMENTED_DELTA","---","RIGHT_HAND_AUGMENT","===","BASS_VOLUME_UP","BASS_VOLUME_DOWN","BASS_VOLUME_DELTA","BASS_VOLUME_AUGMENTED_DELTA","---","TEMPO_UP","TEMPO_DOWN","TEMPO_DELTA","TEMPO_AUGMENTED_DELTA","---","LEFT_HAND_AUGMENT"]}};l.others={text:"Others",shortcuts:Object.keys(s).filter((e=>!Array.prototype.concat(...Object.values(l).map((e=>e.shortcuts))).includes(e)))};const h=(e,t)=>{if(i(0,o=void 0),Object.values(s).map((({code:e})=>e)).includes(t.code)&&t.code!==s[e].code)return void i(0,o=`The "${t.key}" key is already assigned.`);if(Yu.includes(t.code))return void i(0,o=`The "${t.key}" key cannot be assigned.`);F(ec,s[e].code=t.code,s);const{keyboard:n}=navigator;n&&"function"==typeof n.getLayoutMap?n.getLayoutMap().then((i=>{const n=i.get(t.code);F(ec,s[e].key=n||Ku[t.code]||t.key,s)})):F(ec,s[e].key=Ku[t.code]||t.key,s),F(ec,s[e].isChanged=t.key!==Zu[e].key,s)},u=(e,t)=>{const{control:i,deltaType:s}=Qu[e],r=t||Uu[i][s];F(tc,n[i][s]=r,n),F(tc,n[i].isChanged=(n[i].isChanged||[]).filter((e=>e!==s)),n),r!==Uu[i][s]&&F(tc,n[i].isChanged=[...n[i].isChanged,s],n)};return[o,a,l,n,s,r,h,u,()=>{i(0,o=void 0),F(ec,s=JSON.parse(JSON.stringify(Zu)),s),F(tc,n=JSON.parse(JSON.stringify(Uu)),n)},({code:e})=>{"Escape"===e&&r&&jc()},function(e){a=e,i(1,a)},(e,{detail:t})=>h(e,t),e=>h(e,Zu[e]),(e,{detail:t})=>u(e,t),e=>u(e)]}class Bc extends a{constructor(e){super(),l(this,e,Lc,Ic,i,{})}}if("undefined"!=typeof document){const e='div.svelte-1skz4ul{display:flex;flex-direction:column;flex:1 1 auto;overflow:hidden;position:relative}div.svelte-1skz4ul > div{background:linear-gradient(var(--background-angle), var(--background-darker) 0%, var(--background-color) 25%, var(--background-color) 75%, var(--background-darker) 100%);background-attachment:fixed;background-position:center;display:flex;flex-direction:column;gap:4%;height:100%;left:0;overflow-y:auto;position:absolute;top:0;width:100%}div.svelte-1skz4ul .setting + .setting{margin-top:1em}div.svelte-1skz4ul fieldset{border-color:rgba(255, 255, 255, 0.8);padding:1em 0.75em}div.svelte-1skz4ul legend{font-family:"Barlow", sans-serif;font-size:1.4em}div.svelte-1skz4ul fieldset div{display:flex;justify-content:space-between}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}if("undefined"!=typeof document){const e="#playback-controls.svelte-1fglpsh.svelte-1fglpsh{margin:0 0.5em}button.svelte-1fglpsh.svelte-1fglpsh{background-color:var(--primary-accent);border-radius:0.25em;border:0.1em solid #ffffff;color:#ffffff;cursor:pointer;display:inline-block;margin:0;padding:0.35em 0.8em;transition:all 0.2s}button.svelte-1fglpsh.svelte-1fglpsh:hover{color:var(--primary-accent);border-color:var(--primary-accent);background-color:#ffffff}button.pedal-on.svelte-1fglpsh.svelte-1fglpsh{background-color:yellow;border-color:var(--primary-accent);color:var(--primary-accent)}button.svelte-1fglpsh kbd.svelte-1fglpsh{margin:0 -0.4em 0 0.4em}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function Wc(e){let i,n,o,a,l,v,y,_,w,b,x,k,T,S,E,A,O,I,F,j,z,N,L,B,W,$,V,H,U,G=e[2].PLAY_PAUSE.key+"",Z=e[2].REWIND.key+"",X=e[2].SOFT.key+"",Y=e[2].SUSTAIN.key+"",K=e[2].ACCENT.key+"";return{c(){i=u("div"),n=u("button"),o=P("Play/Pause\n    "),a=u("kbd"),l=P(G),v=h(),y=u("button"),_=P("Rewind\n    "),w=u("kbd"),b=P(Z),x=h(),k=u("button"),T=P("Soft\n    "),S=u("kbd"),E=P(X),A=h(),O=u("button"),I=P("Sustain\n    "),F=u("kbd"),j=P(Y),z=h(),N=u("br"),L=h(),B=u("button"),W=P("Accent\n    "),$=u("kbd"),V=P(K),this.h()},l(e){i=d(e,"DIV",{id:!0,class:!0});var t=p(i);n=d(t,"BUTTON",{type:!0,class:!0});var s=p(n);o=M(s,"Play/Pause\n    "),a=d(s,"KBD",{class:!0});var r=p(a);l=M(r,G),r.forEach(m),s.forEach(m),v=c(t),y=d(t,"BUTTON",{type:!0,class:!0});var h=p(y);_=M(h,"Rewind\n    "),w=d(h,"KBD",{class:!0});var u=p(w);b=M(u,Z),u.forEach(m),h.forEach(m),x=c(t),k=d(t,"BUTTON",{type:!0,"aria-pressed":!0,class:!0});var g=p(k);T=M(g,"Soft\n    "),S=d(g,"KBD",{class:!0});var f=p(S);E=M(f,X),f.forEach(m),g.forEach(m),A=c(t),O=d(t,"BUTTON",{type:!0,"aria-pressed":!0,class:!0});var C=p(O);I=M(C,"Sustain\n    "),F=d(C,"KBD",{class:!0});var P=p(F);j=M(P,Y),P.forEach(m),C.forEach(m),z=c(t),N=d(t,"BR",{}),L=c(t),B=d(t,"BUTTON",{type:!0,style:!0,"aria-pressed":!0,class:!0});var R=p(B);W=M(R,"Accent\n    "),$=d(R,"KBD",{class:!0});var D=p($);V=M(D,K),D.forEach(m),R.forEach(m),t.forEach(m),this.h()},h(){g(a,"class","svelte-1fglpsh"),q(a,"depressed",e[2].PLAY_PAUSE.active),g(n,"type","button"),g(n,"class","svelte-1fglpsh"),g(w,"class","svelte-1fglpsh"),q(w,"depressed",e[2].REWIND.active),g(y,"type","button"),g(y,"class","svelte-1fglpsh"),g(S,"class","svelte-1fglpsh"),q(S,"depressed",e[3]),g(k,"type","button"),g(k,"aria-pressed",e[3]),g(k,"class","svelte-1fglpsh"),q(k,"pedal-on",e[3]),g(F,"class","svelte-1fglpsh"),q(F,"depressed",e[4]),g(O,"type","button"),g(O,"aria-pressed",e[4]),g(O,"class","svelte-1fglpsh"),q(O,"pedal-on",e[4]),g($,"class","svelte-1fglpsh"),q($,"depressed",e[5]),g(B,"type","button"),oe(B,"width","100%"),g(B,"aria-pressed",e[5]),g(B,"class","svelte-1fglpsh"),q(B,"pedal-on",e[5]),g(i,"id","playback-controls"),g(i,"class","svelte-1fglpsh")},m(t,s){f(t,i,s),C(i,n),C(n,o),C(n,a),C(a,l),C(i,v),C(i,y),C(y,_),C(y,w),C(w,b),C(i,x),C(i,k),C(k,T),C(k,S),C(S,E),C(i,A),C(i,O),C(O,I),C(O,F),C(F,j),C(i,z),C(i,N),C(i,L),C(i,B),C(B,W),C(B,$),C($,V),H||(U=[D(window,"mouseup",e[6]),D(n,"click",(function(){r(e[0])&&e[0].apply(this,arguments)})),D(y,"click",(function(){r(e[1])&&e[1].apply(this,arguments)})),D(k,"click",e[7]),D(O,"click",e[8]),D(B,"mousedown",e[9])],H=!0)},p(t,[i]){e=t,4&i&&G!==(G=e[2].PLAY_PAUSE.key+"")&&R(l,G),4&i&&q(a,"depressed",e[2].PLAY_PAUSE.active),4&i&&Z!==(Z=e[2].REWIND.key+"")&&R(b,Z),4&i&&q(w,"depressed",e[2].REWIND.active),4&i&&X!==(X=e[2].SOFT.key+"")&&R(E,X),8&i&&q(S,"depressed",e[3]),8&i&&g(k,"aria-pressed",e[3]),8&i&&q(k,"pedal-on",e[3]),4&i&&Y!==(Y=e[2].SUSTAIN.key+"")&&R(j,Y),16&i&&q(F,"depressed",e[4]),16&i&&g(O,"aria-pressed",e[4]),16&i&&q(O,"pedal-on",e[4]),4&i&&K!==(K=e[2].ACCENT.key+"")&&R(V,K),32&i&&q($,"depressed",e[5]),32&i&&g(B,"aria-pressed",e[5]),32&i&&q(B,"pedal-on",e[5])},i:t,o:t,d(e){e&&m(i),H=!1,s(U)}}}function qc(e,t,i){let n,s,r,o;S(e,ec,(e=>i(2,n=e))),S(e,je,(e=>i(3,s=e))),S(e,ze,(e=>i(4,r=e))),S(e,Ne,(e=>i(5,o=e)));let{playPauseApp:a}=t,{stopApp:l}=t;return e.$$set=e=>{"playPauseApp"in e&&i(0,a=e.playPauseApp),"stopApp"in e&&i(1,l=e.stopApp)},[a,l,n,s,r,o,()=>F(Ne,o=!1,o),()=>F(je,s=!s,s),()=>F(ze,r=!r,r),()=>F(Ne,o=!0,o)]}class $c extends a{constructor(e){super(),l(this,e,qc,Wc,i,{playPauseApp:0,stopApp:1})}}if("undefined"!=typeof document){const e='div.svelte-14c7kor{display:flex;height:3.5em;justify-content:space-between;padding:0 0.5em 0.5em;position:relative}div.svelte-14c7kor input[type="range"]{left:0;margin:0;padding:2.5em 0 1em 0;position:absolute;top:0}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}const Vc=e=>({}),Hc=e=>({}),Uc=e=>({}),Gc=e=>({});function Zc(e){let t,i,n,s,r,o,a,l;const y=e[7].label,_=he(y,e,e[6],Gc),w=_||function(e){let t;return{c(){t=P(e[4])},l(i){t=M(i,e[4])},m(e,i){f(e,t,i)},p(e,i){16&i&&R(t,e[4])},d(e){e&&m(t)}}}(e),x=e[7].value,k=he(x,e,e[6],Hc),T=k||function(e){let t;return{c(){t=P(e[0])},l(i){t=M(i,e[0])},m(e,i){f(e,t,i)},p(e,i){1&i&&R(t,e[0])},d(e){e&&m(t)}}}(e);function S(t){e[8](t)}let E={min:e[1],max:e[2],step:e[3],name:e[4],mousewheel:e[5]};return void 0!==e[0]&&(E.value=e[0]),o=new _c({props:E}),W.push((()=>Z(o,"value",S))),o.$on("input",e[9]),o.$on("change",e[10]),{c(){t=u("div"),i=u("label"),w&&w.c(),n=h(),s=u("span"),T&&T.c(),r=h(),j(o.$$.fragment),this.h()},l(e){t=d(e,"DIV",{class:!0});var a=p(t);i=d(a,"LABEL",{for:!0});var l=p(i);w&&w.l(l),l.forEach(m),n=c(a),s=d(a,"SPAN",{});var h=p(s);T&&T.l(h),h.forEach(m),r=c(a),z(o.$$.fragment,a),a.forEach(m),this.h()},h(){g(i,"for",e[4]),g(t,"class","svelte-14c7kor")},m(e,a){f(e,t,a),C(t,i),w&&w.m(i,null),C(t,n),C(t,s),T&&T.m(s,null),C(t,r),N(o,t,null),l=!0},p(e,[t]){_?_.p&&(!l||64&t)&&ue(_,y,e,e[6],l?de(y,e[6],t,Uc):ce(e[6]),Gc):w&&w.p&&(!l||16&t)&&w.p(e,l?t:-1),(!l||16&t)&&g(i,"for",e[4]),k?k.p&&(!l||64&t)&&ue(k,x,e,e[6],l?de(x,e[6],t,Vc):ce(e[6]),Hc):T&&T.p&&(!l||1&t)&&T.p(e,l?t:-1);const n={};2&t&&(n.min=e[1]),4&t&&(n.max=e[2]),8&t&&(n.step=e[3]),16&t&&(n.name=e[4]),32&t&&(n.mousewheel=e[5]),!a&&1&t&&(a=!0,n.value=e[0],X((()=>a=!1))),o.$set(n)},i(e){l||(v(w,e),v(T,e),v(o.$$.fragment,e),l=!0)},o(e){b(w,e),b(T,e),b(o.$$.fragment,e),l=!1},d(e){e&&m(t),w&&w.d(e),T&&T.d(e),L(o)}}}function Xc(e,t,i){let{$$slots:n={},$$scope:s}=t,{value:r}=t,{min:o}=t,{max:a}=t,{step:l}=t,{name:h}=t,{mousewheel:u=!0}=t;return e.$$set=e=>{"value"in e&&i(0,r=e.value),"min"in e&&i(1,o=e.min),"max"in e&&i(2,a=e.max),"step"in e&&i(3,l=e.step),"name"in e&&i(4,h=e.name),"mousewheel"in e&&i(5,u=e.mousewheel),"$$scope"in e&&i(6,s=e.$$scope)},[r,o,a,l,h,u,s,n,function(e){r=e,i(0,r)},function(t){re.call(this,e,t)},function(t){re.call(this,e,t)}]}class Yc extends a{constructor(e){super(),l(this,e,Xc,Zc,i,{value:0,min:1,max:2,step:3,name:4,mousewheel:5})}}function Kc(e){let t,i,n,s,r,o,a,l=e[2].VOLUME_DOWN.key+"",h=e[2].VOLUME_UP.key+"";return{c(){t=P("Volume:\n      "),i=u("kbd"),n=P(l),s=P("↓\n      "),r=u("kbd"),o=P(h),a=P("↑"),this.h()},l(e){t=M(e,"Volume:\n      "),i=d(e,"KBD",{});var u=p(i);n=M(u,l),u.forEach(m),s=M(e,"↓\n      "),r=d(e,"KBD",{});var c=p(r);o=M(c,h),c.forEach(m),a=M(e,"↑"),this.h()},h(){q(i,"depressed",e[2].VOLUME_DOWN.active),q(r,"depressed",e[2].VOLUME_UP.active)},m(e,l){f(e,t,l),f(e,i,l),C(i,n),f(e,s,l),f(e,r,l),C(r,o),f(e,a,l)},p(e,t){4&t&&l!==(l=e[2].VOLUME_DOWN.key+"")&&R(n,l),4&t&&q(i,"depressed",e[2].VOLUME_DOWN.active),4&t&&h!==(h=e[2].VOLUME_UP.key+"")&&R(o,h),4&t&&q(r,"depressed",e[2].VOLUME_UP.active)},d(e){e&&m(t),e&&m(i),e&&m(s),e&&m(r),e&&m(a)}}}function Qc(e){let t,i,n,s,r,o,a,l=e[2].TREBLE_VOLUME_DOWN.key+"",h=e[2].TREBLE_VOLUME_UP.key+"";return{c(){t=P("Treble Volume:\n      "),i=u("kbd"),n=P(l),s=P("↓\n      "),r=u("kbd"),o=P(h),a=P("↑"),this.h()},l(e){t=M(e,"Treble Volume:\n      "),i=d(e,"KBD",{});var u=p(i);n=M(u,l),u.forEach(m),s=M(e,"↓\n      "),r=d(e,"KBD",{});var c=p(r);o=M(c,h),c.forEach(m),a=M(e,"↑"),this.h()},h(){q(i,"depressed",e[2].TREBLE_VOLUME_DOWN.active),q(r,"depressed",e[2].TREBLE_VOLUME_UP.active)},m(e,l){f(e,t,l),f(e,i,l),C(i,n),f(e,s,l),f(e,r,l),C(r,o),f(e,a,l)},p(e,t){4&t&&l!==(l=e[2].TREBLE_VOLUME_DOWN.key+"")&&R(n,l),4&t&&q(i,"depressed",e[2].TREBLE_VOLUME_DOWN.active),4&t&&h!==(h=e[2].TREBLE_VOLUME_UP.key+"")&&R(o,h),4&t&&q(r,"depressed",e[2].TREBLE_VOLUME_UP.active)},d(e){e&&m(t),e&&m(i),e&&m(s),e&&m(r),e&&m(a)}}}function Jc(e){let t,i,n,s,r,o,a,l=e[2].BASS_VOLUME_DOWN.key+"",h=e[2].BASS_VOLUME_UP.key+"";return{c(){t=P("Bass Volume:\n      "),i=u("kbd"),n=P(l),s=P("↓\n      "),r=u("kbd"),o=P(h),a=P("↑"),this.h()},l(e){t=M(e,"Bass Volume:\n      "),i=d(e,"KBD",{});var u=p(i);n=M(u,l),u.forEach(m),s=M(e,"↓\n      "),r=d(e,"KBD",{});var c=p(r);o=M(c,h),c.forEach(m),a=M(e,"↑"),this.h()},h(){q(i,"depressed",e[2].BASS_VOLUME_DOWN.active),q(r,"depressed",e[2].BASS_VOLUME_UP.active)},m(e,l){f(e,t,l),f(e,i,l),C(i,n),f(e,s,l),f(e,r,l),C(r,o),f(e,a,l)},p(e,t){4&t&&l!==(l=e[2].BASS_VOLUME_DOWN.key+"")&&R(n,l),4&t&&q(i,"depressed",e[2].BASS_VOLUME_DOWN.active),4&t&&h!==(h=e[2].BASS_VOLUME_UP.key+"")&&R(o,h),4&t&&q(r,"depressed",e[2].BASS_VOLUME_UP.active)},d(e){e&&m(t),e&&m(i),e&&m(s),e&&m(r),e&&m(a)}}}function ed(e){let t,i,n,s,r,o,a,l=e[2].TEMPO_DOWN.key+"",h=e[2].TEMPO_UP.key+"";return{c(){t=P("Tempo:\n      "),i=u("kbd"),n=P(l),s=P("↓\n      "),r=u("kbd"),o=P(h),a=P("↑"),this.h()},l(e){t=M(e,"Tempo:\n      "),i=d(e,"KBD",{});var u=p(i);n=M(u,l),u.forEach(m),s=M(e,"↓\n      "),r=d(e,"KBD",{});var c=p(r);o=M(c,h),c.forEach(m),a=M(e,"↑"),this.h()},h(){q(i,"depressed",e[2].TEMPO_DOWN.active),q(r,"depressed",e[2].TEMPO_UP.active)},m(e,l){f(e,t,l),f(e,i,l),C(i,n),f(e,s,l),f(e,r,l),C(r,o),f(e,a,l)},p(e,t){4&t&&l!==(l=e[2].TEMPO_DOWN.key+"")&&R(n,l),4&t&&q(i,"depressed",e[2].TEMPO_DOWN.active),4&t&&h!==(h=e[2].TEMPO_UP.key+"")&&R(o,h),4&t&&q(r,"depressed",e[2].TEMPO_UP.active)},d(e){e&&m(t),e&&m(i),e&&m(s),e&&m(r),e&&m(a)}}}function td(e){let t;return{c(){t=P("Progress:")},l(e){t=M(e,"Progress:")},m(e,i){f(e,t,i)},d(e){e&&m(t)}}}function id(e){let t,i,n=(100*e[6]).toFixed(2)+"";return{c(){t=P(n),i=P("%")},l(e){t=M(e,n),i=M(e,"%")},m(e,n){f(e,t,n),f(e,i,n)},p(e,i){64&i&&n!==(n=(100*e[6]).toFixed(2)+"")&&R(t,n)},d(e){e&&m(t),e&&m(i)}}}function nd(e){let t,i,n,s,r,o,a,l,y,_,w,x,k,T,S;function E(t){e[7](t)}let P={min:Uu.volume.min,max:Uu.volume.max,step:Uu.volume.delta,name:"volume",$$slots:{label:[Kc]},$$scope:{ctx:e}};function M(t){e[8](t)}void 0!==e[1]&&(P.value=e[1]),i=new Yc({props:P}),W.push((()=>Z(i,"value",E)));let R={min:Uu.trebleVolume.min,max:Uu.trebleVolume.max,step:Uu.trebleVolume.delta,name:"treble-volume",$$slots:{label:[Qc]},$$scope:{ctx:e}};function D(t){e[9](t)}void 0!==e[3]&&(R.value=e[3]),r=new Yc({props:R}),W.push((()=>Z(r,"value",M)));let A={min:Uu.bassVolume.min,max:Uu.bassVolume.max,step:Uu.bassVolume.delta,name:"bass-volume",$$slots:{label:[Jc]},$$scope:{ctx:e}};function O(t){e[10](t)}void 0!==e[4]&&(A.value=e[4]),l=new Yc({props:A}),W.push((()=>Z(l,"value",D)));let I={min:Uu.tempo.min,max:Uu.tempo.max,step:Uu.tempo.delta,name:"tempo",$$slots:{label:[ed]},$$scope:{ctx:e}};return void 0!==e[5]&&(I.value=e[5]),w=new Yc({props:I}),W.push((()=>Z(w,"value",O))),T=new Yc({props:{value:e[6],min:"0",max:"1",step:"0.001",name:"progress",mousewheel:!1,$$slots:{value:[id],label:[td]},$$scope:{ctx:e}}}),T.$on("input",e[11]),{c(){t=u("div"),j(i.$$.fragment),s=h(),j(r.$$.fragment),a=h(),j(l.$$.fragment),_=h(),j(w.$$.fragment),k=h(),j(T.$$.fragment),this.h()},l(e){t=d(e,"DIV",{id:!0});var n=p(t);z(i.$$.fragment,n),s=c(n),z(r.$$.fragment,n),a=c(n),z(l.$$.fragment,n),_=c(n),z(w.$$.fragment,n),k=c(n),z(T.$$.fragment,n),n.forEach(m),this.h()},h(){g(t,"id","playback-settings")},m(e,n){f(e,t,n),N(i,t,null),C(t,s),N(r,t,null),C(t,a),N(l,t,null),C(t,_),N(w,t,null),C(t,k),N(T,t,null),S=!0},p(e,[t]){const s={};4100&t&&(s.$$scope={dirty:t,ctx:e}),!n&&2&t&&(n=!0,s.value=e[1],X((()=>n=!1))),i.$set(s);const a={};4100&t&&(a.$$scope={dirty:t,ctx:e}),!o&&8&t&&(o=!0,a.value=e[3],X((()=>o=!1))),r.$set(a);const h={};4100&t&&(h.$$scope={dirty:t,ctx:e}),!y&&16&t&&(y=!0,h.value=e[4],X((()=>y=!1))),l.$set(h);const u={};4100&t&&(u.$$scope={dirty:t,ctx:e}),!x&&32&t&&(x=!0,u.value=e[5],X((()=>x=!1))),w.$set(u);const c={};64&t&&(c.value=e[6]),4160&t&&(c.$$scope={dirty:t,ctx:e}),T.$set(c)},i(e){S||(v(i.$$.fragment,e),v(r.$$.fragment,e),v(l.$$.fragment,e),v(w.$$.fragment,e),v(T.$$.fragment,e),S=!0)},o(e){b(i.$$.fragment,e),b(r.$$.fragment,e),b(l.$$.fragment,e),b(w.$$.fragment,e),b(T.$$.fragment,e),S=!1},d(e){e&&m(t),L(i),L(r),L(l),L(w),L(T)}}}function sd(e,t,i){let n,s,r,o,a,l;S(e,We,(e=>i(1,n=e))),S(e,ec,(e=>i(2,s=e))),S(e,$e,(e=>i(3,r=e))),S(e,qe,(e=>i(4,o=e))),S(e,Ve,(e=>i(5,a=e))),S(e,nt,(e=>i(6,l=e)));let{skipToPercentage:h}=t;return e.$$set=e=>{"skipToPercentage"in e&&i(0,h=e.skipToPercentage)},[h,n,s,r,o,a,l,function(e){n=e,We.set(n)},function(e){r=e,$e.set(r)},function(e){o=e,qe.set(o)},function(e){a=e,Ve.set(a)},({target:{value:e}})=>h(e)]}class rd extends a{constructor(e){super(),l(this,e,sd,nd,i,{skipToPercentage:0})}}if("undefined"!=typeof document){const e=".theme-selector.svelte-8sth8k button.svelte-8sth8k{height:1.5em;width:1.5em;border-radius:1.5em;border:none;margin:0 0.5em;cursor:pointer}.theme-selector.svelte-8sth8k button.active.svelte-8sth8k{outline:1px solid var(--primary-accent);outline-offset:4px}.theme-selector.svelte-8sth8k button.cardinal.svelte-8sth8k{background:#8c1515}.theme-selector.svelte-8sth8k button.blue.svelte-8sth8k{background:steelblue}.theme-selector.svelte-8sth8k button.green.svelte-8sth8k{background:darkolivegreen}.theme-selector.svelte-8sth8k button.grey.svelte-8sth8k{background:darkslategrey}button.full-width.svelte-8sth8k.svelte-8sth8k{margin:0;padding:3px 0;width:100%}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function od(e,t,i){const n=e.slice();return n[14]=t[i],n}function ad(e){let t,i,n,s;function r(){return e[12](e[14])}return{c(){t=u("button"),this.h()},l(e){t=d(e,"BUTTON",{class:!0}),p(t).forEach(m),this.h()},h(){g(t,"class",i=ne(e[14])+" svelte-8sth8k"),q(t,"active",e[0].theme===e[14])},m(e,i){f(e,t,i),n||(s=D(t,"click",r),n=!0)},p(i,n){e=i,33&n&&q(t,"active",e[0].theme===e[14])},d(e){e&&m(t),n=!1,s()}}}function ld(e){let i,n,r,o,a,l,v,y,_,w,b,x,k,T,S,E,R,O,I,F,j,z,N,L,B,W,q,$,V,H,U,G,Z,X,Y,K,Q,J,ee,te,ie,ne,se,re,oe,ae=e[5],le=[];for(let t=0;t<ae.length;t+=1)le[t]=ad(od(e,ae,t));return{c(){i=u("div"),n=u("fieldset"),r=u("legend"),o=P("Visualization Settings"),a=h(),l=u("div"),v=P("Show Details for Active Notes:\n      "),y=u("input"),_=h(),w=u("div"),b=P("Display Note Velocities:\n      "),x=u("input"),k=h(),T=u("div"),S=P("Highlight Enabled Holes:\n      "),E=u("input"),R=h(),O=u("fieldset"),I=u("legend"),F=P("Roll Emulation Settings"),j=h(),z=u("div"),N=P("Play Expressions:\n      "),L=u("input"),W=h(),q=u("div"),$=P("Use Roll Pedaling:\n      "),V=u("input"),U=h(),G=u("div"),Z=P("Emulate Roll Acceleration:\n      "),X=u("input"),Y=h(),K=u("div"),Q=P("Theme:\n    ");for(let e=0;e<le.length;e+=1)le[e].c();J=h(),ee=u("button"),te=P("Configure Key Bindings"),ie=h(),ne=u("button"),se=P("Reset All Settings"),this.h()},l(e){i=d(e,"DIV",{id:!0});var t=p(i);n=d(t,"FIELDSET",{});var s=p(n);r=d(s,"LEGEND",{});var h=p(r);o=M(h,"Visualization Settings"),h.forEach(m),a=c(s),l=d(s,"DIV",{class:!0});var u=p(l);v=M(u,"Show Details for Active Notes:\n      "),y=d(u,"INPUT",{type:!0}),u.forEach(m),_=c(s),w=d(s,"DIV",{class:!0});var g=p(w);b=M(g,"Display Note Velocities:\n      "),x=d(g,"INPUT",{type:!0}),g.forEach(m),k=c(s),T=d(s,"DIV",{class:!0});var f=p(T);S=M(f,"Highlight Enabled Holes:\n      "),E=d(f,"INPUT",{type:!0}),f.forEach(m),s.forEach(m),R=c(t),O=d(t,"FIELDSET",{});var C=p(O);I=d(C,"LEGEND",{});var P=p(I);F=M(P,"Roll Emulation Settings"),P.forEach(m),j=c(C),z=d(C,"DIV",{class:!0});var D=p(z);N=M(D,"Play Expressions:\n      "),L=d(D,"INPUT",{type:!0}),D.forEach(m),W=c(C),q=d(C,"DIV",{class:!0});var A=p(q);$=M(A,"Use Roll Pedaling:\n      "),V=d(A,"INPUT",{type:!0}),A.forEach(m),U=c(C),G=d(C,"DIV",{class:!0});var B=p(G);Z=M(B,"Emulate Roll Acceleration:\n      "),X=d(B,"INPUT",{type:!0}),B.forEach(m),C.forEach(m),Y=c(t),K=d(t,"DIV",{class:!0});var H=p(K);Q=M(H,"Theme:\n    ");for(let e=0;e<le.length;e+=1)le[e].l(H);H.forEach(m),J=c(t),ee=d(t,"BUTTON",{class:!0});var re=p(ee);te=M(re,"Configure Key Bindings"),re.forEach(m),ie=c(t),ne=d(t,"BUTTON",{class:!0});var oe=p(ne);se=M(oe,"Reset All Settings"),oe.forEach(m),t.forEach(m),this.h()},h(){g(y,"type","checkbox"),g(l,"class","setting"),g(x,"type","checkbox"),g(w,"class","setting"),g(E,"type","checkbox"),g(T,"class","setting"),g(L,"type","checkbox"),L.disabled=B=!e[1],g(z,"class","setting"),g(V,"type","checkbox"),V.disabled=H=!e[1],g(q,"class","setting"),g(X,"type","checkbox"),g(G,"class","setting"),g(K,"class","theme-selector svelte-8sth8k"),g(ee,"class","full-width svelte-8sth8k"),g(ne,"class","full-width svelte-8sth8k"),g(i,"id","settings-panel")},m(t,s){f(t,i,s),C(i,n),C(n,r),C(r,o),C(n,a),C(n,l),C(l,v),C(l,y),y.checked=e[0].activeNoteDetails,C(n,_),C(n,w),C(w,b),C(w,x),x.checked=e[0].showNoteVelocities,C(n,k),C(n,T),C(T,S),C(T,E),E.checked=e[0].highlightEnabledHoles,C(i,R),C(i,O),C(O,I),C(I,F),C(O,j),C(O,z),C(z,N),C(z,L),L.checked=e[2],C(O,W),C(O,q),C(q,$),C(q,V),V.checked=e[3],C(O,U),C(O,G),C(G,Z),C(G,X),X.checked=e[4],C(i,Y),C(i,K),C(K,Q);for(let e=0;e<le.length;e+=1)le[e].m(K,null);C(i,J),C(i,ee),C(ee,te),C(i,ie),C(i,ne),C(ne,se),re||(oe=[D(y,"change",e[6]),D(x,"change",e[7]),D(E,"change",e[8]),D(L,"change",e[9]),D(V,"change",e[10]),D(X,"change",e[11]),D(ee,"click",jc),D(ne,"click",e[13])],re=!0)},p(e,[t]){if(1&t&&(y.checked=e[0].activeNoteDetails),1&t&&(x.checked=e[0].showNoteVelocities),1&t&&(E.checked=e[0].highlightEnabledHoles),2&t&&B!==(B=!e[1])&&(L.disabled=B),4&t&&(L.checked=e[2]),2&t&&H!==(H=!e[1])&&(V.disabled=H),8&t&&(V.checked=e[3]),16&t&&(X.checked=e[4]),33&t){let i;for(ae=e[5],i=0;i<ae.length;i+=1){const n=od(e,ae,i);le[i]?le[i].p(n,t):(le[i]=ad(n),le[i].c(),le[i].m(K,null))}for(;i<le.length;i+=1)le[i].d(1);le.length=ae.length}},i:t,o:t,d(e){e&&m(i),A(le,e),re=!1,s(oe)}}}function hd(e,t,i){let n,s,r,o,a;S(e,rt,(e=>i(0,n=e))),S(e,Oe,(e=>i(1,s=e))),S(e,He,(e=>i(2,r=e))),S(e,Ue,(e=>i(3,o=e))),S(e,Ge,(e=>i(4,a=e)));return e.$$.update=()=>{1&e.$$.dirty&&document.documentElement.setAttribute("data-theme",n.theme)},[n,s,r,o,a,["cardinal","blue","green","grey"],function(){n.activeNoteDetails=this.checked,rt.set(n)},function(){n.showNoteVelocities=this.checked,rt.set(n)},function(){n.highlightEnabledHoles=this.checked,rt.set(n)},function(){r=this.checked,He.set(r)},function(){o=this.checked,Ue.set(o)},function(){a=this.checked,Ge.set(a)},e=>rt.update((t=>({...t,theme:e}))),()=>{rt.reset(),Ze.reset(),Xe.reset(),Ye.reset(),Ql({message:"Settings have been reset!",type:"success",timeout:4e3})}]}class ud extends a{constructor(e){super(),l(this,e,hd,ld,i,{})}}if("undefined"!=typeof document){const e=".wrapper.svelte-27tmk0{position:relative}.spliner-container.svelte-27tmk0{height:200px;width:100%}.x-axis.svelte-27tmk0,.y-axis.svelte-27tmk0{position:absolute;color:rgba(0, 0, 0, 0.5)}.x-axis.svelte-27tmk0{bottom:0;left:50%;transform:translateX(-50%)}.y-axis.svelte-27tmk0{left:0;top:50%;transform:rotate(270deg) translateX(-50%);transform-origin:top left}button.svelte-27tmk0{background:none;border:none;bottom:4px;cursor:pointer;display:flex;margin:0;padding:0;position:absolute;right:4px}button.svelte-27tmk0 svg{stroke:grey}button.svelte-27tmk0:not([disabled]):hover svg{stroke:black}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}var cd;cd=function(){function e(e,t){var i,n,s,r,o,a,l,h,u,c,d,p,m,g,f,v,y;for(s=[],a=[],i=[],n=[],r=[],h=[],o=0,g=(l=e.length)-1;0<=g?o<g:o>g;0<=g?o+=1:o-=1)s[o]=(t[o+1]-t[o])/(e[o+1]-e[o]),o>0&&(a[o]=(s[o-1]+s[o])/2);for(a[0]=s[0],a[l-1]=s[l-2],u=[],o=0,f=l-1;0<=f?o<f:o>f;0<=f?o+=1:o-=1)0===s[o]&&u.push(o);for(c=0,p=u.length;c<p;c++)a[o=u[c]]=a[o+1]=0;for(o=0,v=l-1;0<=v?o<v:o>v;0<=v?o+=1:o-=1)i[o]=a[o]/s[o],n[o]=a[o+1]/s[o],r[o]=Math.pow(i[o],2)+Math.pow(n[o],2),h[o]=3/Math.sqrt(r[o]);for(u=[],o=0,y=l-1;0<=y?o<y:o>y;0<=y?o+=1:o-=1)r[o]>9&&u.push(o);for(d=0,m=u.length;d<m;d++)a[o=u[d]]=h[o]*i[o]*s[o],a[o+1]=h[o]*n[o]*s[o];this.x=e.slice(0,l),this.y=t.slice(0,l),this.m=a}return e.prototype.interpolate=function(e){var t,i,n,s,r,o,a,l,h;for(r=h=this.x.length-2;(h<=0?r<=0:r>=0)&&!(this.x[r]<=e);h<=0?r+=1:r-=1);return t=this.x[r+1]-this.x[r],o=(e-this.x[r])/t,a=Math.pow(o,2),n=(l=Math.pow(o,3))-2*a+o,i=-2*l+3*a,s=l-a,(2*l-3*a+1)*this.y[r]+n*t*this.m[r]+i*this.y[r+1]+s*t*this.m[r+1]},e}();var dd={CubicSpline:function(){function e(e,t,i,n){var s,r,o,a,l,h,u,c,d,p,m,g,f,v;if(null!=e&&null!=t){for(o=null!=i&&null!=n,d=e.length-1,l=[],g=[],c=[],m=[],f=[],r=[],s=[],a=[],u=[],p=[],h=0;0<=d?h<d:h>d;0<=d?h+=1:h-=1)l[h]=e[h+1]-e[h],u[h]=t[h+1]-t[h],p[h]=u[h]/l[h];for(o&&(g[0]=3*(t[1]-t[0])/l[0]-3*i,g[d]=3*n-3*(t[d]-t[d-1])/l[d-1]),h=1;1<=d?h<d:h>d;1<=d?h+=1:h-=1)g[h]=3/l[h]*(t[h+1]-t[h])-3/l[h-1]*(t[h]-t[h-1]);for(o?(c[0]=2*l[0],m[0]=.5,f[0]=g[0]/c[0]):(c[0]=1,m[0]=0,f[0]=0),h=1;1<=d?h<d:h>d;1<=d?h+=1:h-=1)c[h]=2*(e[h+1]-e[h-1])-l[h-1]*m[h-1],m[h]=l[h]/c[h],f[h]=(g[h]-l[h-1]*f[h-1])/c[h];for(o?(c[d]=l[d-1]*(2-m[d-1]),f[d]=(g[d]-l[d-1]*f[d-1])/c[d],r[d]=f[d]):(c[d]=1,f[d]=0,r[d]=0),h=v=d-1;v<=0?h<=0:h>=0;v<=0?h+=1:h-=1)r[h]=f[h]-m[h]*r[h+1],s[h]=(t[h+1]-t[h])/l[h]-l[h]*(r[h+1]+2*r[h])/3,a[h]=(r[h+1]-r[h])/(3*l[h]);this.x=e.slice(0,d+1),this.a=t.slice(0,d),this.b=s,this.c=r.slice(0,d),this.d=a}}return e.prototype.derivative=function(){var e,t,i,n,s,r,o,a,l,h,u;for((i=new this.constructor).x=this.x.slice(0,this.x.length),i.a=this.b.slice(0,this.b.length),s=0,o=(l=this.c).length;s<o;s++)e=l[s],i.b=2*e;for(r=0,a=(h=this.d).length;r<a;r++)t=h[r],i.c=3*t;for(n=0,u=this.d.length;0<=u?n<u:n>u;0<=u?n+=1:n-=1)i.d=0;return i},e.prototype.interpolate=function(e){var t,i,n;for(i=n=this.x.length-1;(n<=0?i<=0:i>=0)&&!(this.x[i]<=e);n<=0?i+=1:i-=1);return t=e-this.x[i],this.a[i]+this.b[i]*t+this.c[i]*Math.pow(t,2)+this.d[i]*Math.pow(t,3)},e}(),MonotonicCubicSpline:cd};class pd{constructor(){this._points=[],this._min={x:0,y:0},this._max={x:1/0,y:1/0}}setBoundary(e,t,i){this["_"+e][t]=i}add(e){var t=null;return e.x>=this._min.x&&e.x<=this._max.x&&e.y>=this._min.y&&e.y<=this._max.y&&("xLocked"in e||(e.xLocked=!1),"yLocked"in e||(e.yLocked=!1),"safe"in e||(e.safe=!1),this._points.push(e),this._sortPoints(),t=this._points.indexOf(e)),t}_sortPoints(){this._points.sort((function(e,t){return e.x-t.x}))}remove(e){var t=null;return e>=0&&e<this._points.length&&!this._points[e].safe&&(t=this._points.splice(e,1)),t}getClosestFrom(e){if(!this._points.length)return null;for(var t=1/0,i=null,n=0;n<this._points.length;n++){var s=Math.sqrt(Math.pow(e.x-this._points[n].x,2)+Math.pow(e.y-this._points[n].y,2));s<t&&(t=s,i=n)}return{index:i,distance:t}}getPoint(e){return e>=0&&e<this._points.length?this._points[e]:null}getNumberOfPoints(){return this._points.length}updatePoint(e,t){var i=e;if(e>=0&&e<this._points.length&&t.x>=this._min.x&&t.x<this._max.x&&t.y>=this._min.y&&t.y<this._max.y){this._points[e].xLocked||(this._points[e].x=t.x),this._points[e].yLocked||(this._points[e].y=t.y);var n=this._points[e];this._sortPoints(),i=this._points.indexOf(n)}return i}getXseries(){for(var e=[],t=0;t<this._points.length;t++)e.push(this._points[t].x);return e}getYseries(){for(var e=[],t=0;t<this._points.length;t++)e.push(this._points[t].y);return e}}class md{constructor(e,t,i,n="natural"){this._borderStyle={in:"1px solid #d3d3ff",out:"1px solid #e3e3e3"},this._controlPointRadius=8,this._controlPointColor={idle:"rgba(244, 66, 167, 0.5)",hovered:"rgba(0, 0, 255, 0.5)",grabbed:"rgba(0, 200, 0, 0.5)"},this._curveColor={idle:"rgba(0, 128, 255, 1)",moving:"rgba(255, 128, 0, 1)"},this._gridColor="rgba(0, 0, 0, 0.3)",this._textColor="rgba(0, 0, 0, 0.1)",this._curveThickness=1,this._backgroundColor=!1,this._mouse=null,this._pointHoveredIndex=-1,this._pointGrabbedIndex=-1,this._mouseDown=!1,this._canvas=null,this._ctx=null,this._screenRatio=window.devicePixelRatio;var s=null;(s="string"==typeof e||e instanceof String?document.getElementById(e):e)&&(this._canvas=document.createElement("canvas"),this._canvas.width=t,this._canvas.height=i,this._canvas.setAttribute("tabIndex",1),this._canvas.style.outline="none",this._canvas.style.cursor="default",this._canvas.style.border=this._borderStyle.out,this._canvas.onselectstart=function(){return!1},this._width=t,this._height=i,s.appendChild(this._canvas),this._ctx=this._canvas.getContext("2d"),this._ctx.scale(this._screenRatio,this._screenRatio),this._canvas.addEventListener("mousemove",this._onCanvasMouseMove.bind(this),!1),this._canvas.addEventListener("mousedown",this._onCanvasMouseDown.bind(this),!1),window.addEventListener("mouseup",this._onCanvasMouseUp.bind(this),!1),this._canvas.addEventListener("dblclick",this._onCanvasMouseDbclick.bind(this),!1),this._canvas.addEventListener("mouseleave",this._onCanvasMouseLeave.bind(this),!1),this._canvas.addEventListener("mouseenter",this._onCanvasMouseEnter.bind(this),!1),this._canvas.addEventListener("keyup",this._onKeyUp.bind(this),!1),this._splineConstructor=dd.CubicSpline,"monotonic"===n&&(this._splineConstructor=dd.MonotonicCubicSpline),this._pointCollection=new pd,this._pointCollection.setBoundary("max","x",t),this._pointCollection.setBoundary("max","y",i),this._xSeriesInterpolated=new Float32Array(this._width).fill(0),this._ySeriesInterpolated=new Float32Array(this._width).fill(0),this._gridStep=1/3,this._onEvents={movePoint:null,releasePoint:null,pointAdded:null},this.draw())}getXSeriesInterpolated(){return this._xSeriesInterpolated}getYSeriesInterpolated(){return this._ySeriesInterpolated}setControlPointRadius(e){this._controlPointRadius=e}setControlPointColor(e,t){this._controlPointColor[e]=t}setCurveColor(e,t){this._curveColor[e]=t}setGridColor(e){this._gridColor=e}setGridStep(e){this._gridStep=e<=0||e>=1?0:e,this.draw()}setTextColor(e){this._textColor=e}setCurveThickness(e){this._curveThickness=e}setBackgroundColor(e){this._backgroundColor=e}setSplineType(e){this._splineConstructor="monotonic"===e?dd.MonotonicCubicSpline:dd.CubicSpline}_updateMousePosition(e){var t=this._canvas.getBoundingClientRect();this._mouse={x:e.clientX-t.left,y:this._height-(e.clientY-t.top)}}_onCanvasMouseMove(e){this._updateMousePosition(e);var t=this._pointCollection.getClosestFrom(this._mouse);if(t){if(-1==this._pointGrabbedIndex)if(t.distance<=this._controlPointRadius)this._pointHoveredIndex=t.index;else{var i=!1;-1!=this._pointHoveredIndex&&(i=!0),this._pointHoveredIndex=-1,i&&this.draw()}else this._pointGrabbedIndex=this._pointCollection.updatePoint(this._pointGrabbedIndex,this._mouse),this._pointHoveredIndex=this._pointGrabbedIndex;if(-1==this._pointHoveredIndex&&-1==this._pointGrabbedIndex||this.draw(),-1!=this._pointGrabbedIndex){var n=this._pointCollection.getPoint(this._pointGrabbedIndex);this._drawCoordinates(Math.round(n.x/this._width*1e3)/1e3,Math.round(n.y/this._height*1e3)/1e3),this._onEvents.movePoint&&this._onEvents.movePoint(this)}}}_onCanvasMouseDown(e){this._mouseDown=!0,-1!=this._pointHoveredIndex&&(this._pointGrabbedIndex=this._pointHoveredIndex)}_onCanvasMouseUp(e){var t=-1!=this._pointGrabbedIndex;this._mouseDown=!1,this._pointGrabbedIndex=-1,this.draw(),this._onEvents.releasePoint&&t&&this._onEvents.releasePoint(this)}_onCanvasMouseDbclick(e){if(this._canvas.focus(),-1==this._pointHoveredIndex){var t=this.add({x:this._mouse.x/this._width,y:this._mouse.y/this._height});this._pointHoveredIndex=t}else this.remove(this._pointHoveredIndex),this._pointHoveredIndex=-1,this._pointGrabbedIndex=-1}_onCanvasMouseLeave(e){this.draw()}_onCanvasMouseEnter(e){this._canvas.focus(),this._canvas.style.border=this._borderStyle.in}_onKeyUp(e){if(this._mouse)switch(e.key){case"d":this.remove(this._pointHoveredIndex)}}add(e,t=!0){var i=null;return"x"in e&&"y"in e&&(e.x*=this._width,e.y*=this._height,i=this._pointCollection.add(e)),t&&this.draw(),this._onEvents.pointAdded&&this._onEvents.pointAdded(this),i}remove(e){this._pointCollection.remove(e),this.draw(),this._onEvents.pointRemoved&&this._onEvents.pointRemoved(this)}draw(){this._ctx.clearRect(0,0,this._width,this._height),this._fillBackground(),this._drawGrid(),this._drawData()}_fillBackground(){this._backgroundColor&&(this._ctx.beginPath(),this._ctx.rect(0,0,this._width,this._height),this._ctx.fillStyle=this._backgroundColor,this._ctx.fill())}_drawCoordinates(e,t){var i=14/this._screenRatio;this._ctx.fillStyle=this._textColor,this._ctx.font=i+"px courier",this._ctx.fillText("x: "+e,10/this._screenRatio,20/this._screenRatio),this._ctx.fillText("y: "+t,10/this._screenRatio,35/this._screenRatio)}_drawGrid(){var e=this._gridStep;if(0!=e){this._ctx.beginPath(),this._ctx.moveTo(0,0);for(var t=e*this._height/this._screenRatio;t<this._height/this._screenRatio;t+=e*this._height/this._screenRatio)this._ctx.moveTo(0,Math.round(t)+.5/this._screenRatio),this._ctx.lineTo(this._width,Math.round(t)+.5/this._screenRatio);this._ctx.moveTo(0,0);for(t=e*this._width/this._screenRatio;t<this._width/this._screenRatio;t+=e*this._width/this._screenRatio)this._ctx.moveTo(Math.round(t)+.5/this._screenRatio,0),this._ctx.lineTo(Math.round(t)+.5/this._screenRatio,this._height);this._ctx.strokeStyle=this._gridColor,this._ctx.lineWidth=.5,this._ctx.stroke(),this._ctx.closePath()}}_drawData(e=!0,t=!0){var i=this._pointCollection.getXseries(),n=this._pointCollection.getYseries(),s=this._width,r=this._height;if(i.length){if(e){this._ctx.beginPath(),this._ctx.moveTo(i[0]/this._screenRatio,(r-n[0])/this._screenRatio);var o=new this._splineConstructor(i,n);this._xSeriesInterpolated.fill(0),this._ySeriesInterpolated.fill(0);for(var a=0;a<Math.ceil(i[0]);a++){var l=n[0];this._xSeriesInterpolated[a]=a/s,this._ySeriesInterpolated[a]=l/r,l=l<0?.5:l>r?r-.5:l,this._ctx.lineTo(a/this._screenRatio,(r-l)/this._screenRatio)}for(a=Math.ceil(i[0]);a<Math.ceil(i[i.length-1]);a++){l=o.interpolate(a);this._xSeriesInterpolated[a]=a/s,this._ySeriesInterpolated[a]=l/r,l=l<0?.5:l>r?r-.5:l,this._ctx.lineTo(a/this._screenRatio,(r-l)/this._screenRatio)}for(a=Math.ceil(i[i.length-1]);a<s;a++){l=n[n.length-1];this._xSeriesInterpolated[a]=a/s,this._ySeriesInterpolated[a]=l/r,l=l<0?.5:l>r?r-.5:l,this._ctx.lineTo(a/this._screenRatio,(r-l)/this._screenRatio)}this._ctx.strokeStyle=-1==this._pointGrabbedIndex?this._curveColor.idle:this._curveColor.moving,this._ctx.lineWidth=this._curveThickness/this._screenRatio,this._ctx.stroke(),this._ctx.closePath()}if(t)for(var h=0;h<i.length;h++)this._ctx.beginPath(),this._ctx.arc(i[h]/this._screenRatio,(r-n[h])/this._screenRatio,this._controlPointRadius/this._screenRatio,0,2*Math.PI),-1==this._pointHoveredIndex?this._ctx.fillStyle=this._controlPointColor.idle:h==this._pointHoveredIndex?this._mouseDown?this._ctx.fillStyle=this._controlPointColor.grabbed:this._ctx.fillStyle=this._controlPointColor.hovered:this._ctx.fillStyle=this._controlPointColor.idle,this._ctx.fill(),this._ctx.closePath()}}getValue(e){var t=this._pointCollection.getXseries(),i=this._pointCollection.getYseries();return e<=t[0]/this._width?i[0]/this._height:e>=t[t.length-1]/this._width?i[i.length-1]/this._height:new this._splineConstructor(t,i).interpolate(e*this._width)/this._height}on(e,t){this._onEvents[e]=t}}function gd(e){let i,n,r,o,a,l,h;return n=new Rh({props:{name:"reset",height:"24",width:"24"}}),{c(){i=u("button"),j(n.$$.fragment),this.h()},l(e){i=d(e,"BUTTON",{class:!0});var t=p(i);z(n.$$.fragment,t),t.forEach(m),this.h()},h(){g(i,"class","svelte-27tmk0")},m(t,s){f(t,i,s),N(n,i,null),a=!0,l||(h=[se(r=mu.call(null,i,"Reset")),D(i,"click",e[6])],l=!0)},p:t,i(e){a||(v(n.$$.fragment,e),o||y((()=>{o=pe(i,ye,{}),o.start()})),a=!0)},o(e){b(n.$$.fragment,e),a=!1},d(e){e&&m(i),L(n),l=!1,s(h)}}}function fd(e){let t,i,n,s,r,o,a,l,y,_,k,T,S,E,D,A,O,I=lt(e[2].firstMidi)+"",F=lt(e[2].lastMidi)+"",j=e[2].velocityPoints&&gd(e);return{c(){t=u("fieldset"),i=u("legend"),n=P(I),s=P("-"),r=P(F),o=P(" Velocity Curve"),a=h(),l=u("div"),y=u("div"),_=h(),j&&j.c(),k=h(),T=u("span"),S=P("input velocity"),E=h(),D=u("span"),A=P("output velocity"),this.h()},l(e){t=d(e,"FIELDSET",{});var h=p(t);i=d(h,"LEGEND",{});var u=p(i);n=M(u,I),s=M(u,"-"),r=M(u,F),o=M(u," Velocity Curve"),u.forEach(m),a=c(h),l=d(h,"DIV",{class:!0});var g=p(l);y=d(g,"DIV",{class:!0}),p(y).forEach(m),_=c(g),j&&j.l(g),k=c(g),T=d(g,"SPAN",{class:!0});var f=p(T);S=M(f,"input velocity"),f.forEach(m),E=c(g),D=d(g,"SPAN",{class:!0});var v=p(D);A=M(v,"output velocity"),v.forEach(m),g.forEach(m),h.forEach(m),this.h()},h(){g(y,"class","spliner-container svelte-27tmk0"),g(T,"class","x-axis svelte-27tmk0"),g(D,"class","y-axis svelte-27tmk0"),g(l,"class","wrapper svelte-27tmk0")},m(h,u){f(h,t,u),C(t,i),C(i,n),C(i,s),C(i,r),C(i,o),C(t,a),C(t,l),C(l,y),e[5](y),C(l,_),j&&j.m(l,null),C(l,k),C(l,T),C(T,S),C(l,E),C(l,D),C(D,A),O=!0},p(e,[t]){(!O||4&t)&&I!==(I=lt(e[2].firstMidi)+"")&&R(n,I),(!O||4&t)&&F!==(F=lt(e[2].lastMidi)+"")&&R(r,F),e[2].velocityPoints?j?(j.p(e,t),4&t&&v(j,1)):(j=gd(e),j.c(),v(j,1),j.m(l,k)):j&&(w(),b(j,1,1,(()=>{j=null})),x())},i(e){O||(v(j),O=!0)},o(e){b(j),O=!1},d(i){i&&m(t),e[5](null),j&&j.d()}}}function vd(e,i,s){let r,o=t,a=()=>(o(),o=n(l,(e=>s(2,r=e))),l);e.$$.on_destroy.push((()=>o()));let{keyboardRegion:l}=i;a();let h,u,{accentColor:c}=i;const d=()=>{F(l,r.velocityCurve=(()=>{const e=u.getYSeriesInterpolated();return[...u.getXSeriesInterpolated()].map(((t,i)=>[t,e[i]]))})(),r),F(l,r.velocityPoints=u._pointCollection,r)},p=()=>{for(;h.firstChild;)h.removeChild(h.firstChild);return u=new md(h,h.clientWidth,h.clientHeight,"monotonic"),r.velocityPoints?r.velocityPoints._points.forEach((e=>{u.add({x:e.x/r.velocityPoints._max.x,y:e.y/r.velocityPoints._max.y})})):(u.add({x:0,y:0}),u.add({x:.5,y:.5}),u.add({x:1,y:1})),u.setControlPointRadius(7),u.setCurveColor("moving","#000000"),u.setCurveThickness(.5),u.setGridColor("#dad7cb"),u.setGridStep(.1),u.setBackgroundColor("#FFFFFF"),c&&(u.setControlPointColor("idle",c),u.setControlPointColor("hovered",c),u.setControlPointColor("grabbed",c),u.setCurveColor("idle",c),u.setTextColor(c)),u.draw(),["movePoint","releasePoint","pointAdded","pointRemoved"].forEach((e=>u.on(e,d))),()=>u=null};I(p);return e.$$set=e=>{"keyboardRegion"in e&&a(s(0,l=e.keyboardRegion)),"accentColor"in e&&s(4,c=e.accentColor)},[l,h,r,p,c,function(e){W[e?"unshift":"push"]((()=>{h=e,s(1,h)}))},()=>{l.reset(),p()}]}class yd extends a{constructor(e){super(),l(this,e,vd,fd,i,{keyboardRegion:0,accentColor:4})}}function _d(e,t,i){const n=e.slice();return n[11]=t[i],n[12]=t,n[13]=i,n}function wd(e){let t,i,n=e[11]+"";return{c(){t=u("span"),i=P(n),this.h()},l(e){t=d(e,"SPAN",{slot:!0,style:!0});var s=p(t);i=M(s,n),s.forEach(m),this.h()},h(){g(t,"slot","label"),oe(t,"text-transform","capitalize")},m(e,n){f(e,t,n),C(t,i)},p(e,t){16&t&&n!==(n=e[11]+"")&&R(i,n)},d(e){e&&m(t)}}}function bd(e){let t,i,n;function s(t){e[6](t,e[11])}let r={min:"-60",max:"10",step:"1",name:`${e[11]}-volume`,$$slots:{label:[wd]},$$scope:{ctx:e}};return void 0!==e[4][e[11]]&&(r.value=e[4][e[11]]),t=new Yc({props:r}),W.push((()=>Z(t,"value",s))),{c(){j(t.$$.fragment)},l(e){z(t.$$.fragment,e)},m(e,i){N(t,e,i),n=!0},p(n,s){e=n;const r={};16&s&&(r.name=`${e[11]}-volume`),16400&s&&(r.$$scope={dirty:s,ctx:e}),!i&&16&s&&(i=!0,r.value=e[4][e[11]],X((()=>i=!1))),t.$set(r)},i(e){n||(v(t.$$.fragment,e),n=!0)},o(e){b(t.$$.fragment,e),n=!1},d(e){L(t,e)}}}function xd(e){let t;return{c(){t=P("Sample Count")},l(e){t=M(e,"Sample Count")},m(e,i){f(e,t,i)},d(e){e&&m(t)}}}function kd(e){let t;return{c(){t=P("Reverb")},l(e){t=M(e,"Reverb")},m(e,i){f(e,t,i)},d(e){e&&m(t)}}}function Td(e){let t,i,n,s,r,o,a,l,y,_,k,T,S,E,R,D,O,I,F,B,q,$,V=Object.keys(e[4]),H=[];for(let t=0;t<V.length;t+=1)H[t]=bd(_d(e,V,t));const U=e=>b(H[e],1,1,(()=>{H[e]=null}));function G(t){e[7](t)}let Y={min:"1",max:"16",step:"1",name:"sample-velocities",mousewheel:!1,$$slots:{label:[xd]},$$scope:{ctx:e}};function K(t){e[9](t)}void 0!==e[2]&&(Y.value=e[2]),k=new Yc({props:Y}),W.push((()=>Z(k,"value",G))),k.$on("change",e[8]);let Q={min:"0",max:"1",step:".05",name:"reverb-wetdry",mousewheel:!1,$$slots:{label:[kd]},$$scope:{ctx:e}};return void 0!==e[3]&&(Q.value=e[3]),E=new Yc({props:Q}),W.push((()=>Z(E,"value",K))),E.$on("change",e[10]),O=new yd({props:{keyboardRegion:Ke,accentColor:e[5]}}),F=new yd({props:{keyboardRegion:Qe,accentColor:e[5]}}),q=new yd({props:{keyboardRegion:Je,accentColor:e[5]}}),{c(){t=u("div"),i=u("fieldset"),n=u("legend"),s=P("Piano Sample Volumes"),r=h();for(let e=0;e<H.length;e+=1)H[e].c();o=h(),a=u("fieldset"),l=u("legend"),y=P("Audio Controls"),_=h(),j(k.$$.fragment),S=h(),j(E.$$.fragment),D=h(),j(O.$$.fragment),I=h(),j(F.$$.fragment),B=h(),j(q.$$.fragment),this.h()},l(e){t=d(e,"DIV",{id:!0});var h=p(t);i=d(h,"FIELDSET",{});var u=p(i);n=d(u,"LEGEND",{});var g=p(n);s=M(g,"Piano Sample Volumes"),g.forEach(m),r=c(u);for(let e=0;e<H.length;e+=1)H[e].l(u);u.forEach(m),o=c(h),a=d(h,"FIELDSET",{});var f=p(a);l=d(f,"LEGEND",{});var v=p(l);y=M(v,"Audio Controls"),v.forEach(m),_=c(f),z(k.$$.fragment,f),S=c(f),z(E.$$.fragment,f),f.forEach(m),D=c(h),z(O.$$.fragment,h),I=c(h),z(F.$$.fragment,h),B=c(h),z(q.$$.fragment,h),h.forEach(m),this.h()},h(){g(t,"id","audio-panel")},m(e,h){f(e,t,h),C(t,i),C(i,n),C(n,s),C(i,r);for(let e=0;e<H.length;e+=1)H[e].m(i,null);C(t,o),C(t,a),C(a,l),C(l,y),C(a,_),N(k,a,null),C(a,S),N(E,a,null),C(t,D),N(O,t,null),C(t,I),N(F,t,null),C(t,B),N(q,t,null),$=!0},p(e,[t]){if(16&t){let n;for(V=Object.keys(e[4]),n=0;n<V.length;n+=1){const s=_d(e,V,n);H[n]?(H[n].p(s,t),v(H[n],1)):(H[n]=bd(s),H[n].c(),v(H[n],1),H[n].m(i,null))}for(w(),n=V.length;n<H.length;n+=1)U(n);x()}const n={};16384&t&&(n.$$scope={dirty:t,ctx:e}),!T&&4&t&&(T=!0,n.value=e[2],X((()=>T=!1))),k.$set(n);const s={};16384&t&&(s.$$scope={dirty:t,ctx:e}),!R&&8&t&&(R=!0,s.value=e[3],X((()=>R=!1))),E.$set(s)},i(e){if(!$){for(let e=0;e<V.length;e+=1)v(H[e]);v(k.$$.fragment,e),v(E.$$.fragment,e),v(O.$$.fragment,e),v(F.$$.fragment,e),v(q.$$.fragment,e),$=!0}},o(e){H=H.filter(Boolean);for(let e=0;e<H.length;e+=1)b(H[e]);b(k.$$.fragment,e),b(E.$$.fragment,e),b(O.$$.fragment,e),b(F.$$.fragment,e),b(q.$$.fragment,e),$=!1},d(e){e&&m(t),A(H,e),L(k),L(E),L(O),L(F),L(q)}}}function Sd(e,t,i){let n,s,r,o,a;S(e,Ye,(e=>i(0,n=e))),S(e,Xe,(e=>i(1,s=e))),S(e,Ze,(e=>i(4,r=e)));const l=getComputedStyle(document.documentElement).getPropertyValue("--primary-accent");return e.$$.update=()=>{2&e.$$.dirty&&i(2,o=s),1&e.$$.dirty&&i(3,a=n)},[n,s,o,a,r,l,function(t,i){e.$$.not_equal(r[i],t)&&(r[i]=t,Ze.set(r))},function(e){o=e,i(2,o),i(1,s)},({target:{value:e}})=>F(Xe,s=e,s),function(e){a=e,i(3,a),i(0,n)},({target:{value:e}})=>F(Ye,n=e,n)]}class Ed extends a{constructor(e){super(),l(this,e,Sd,Td,i,{})}}if("undefined"!=typeof document){const e='.setting.svelte-1ixiyy1{margin:1em 0}.list-header.svelte-1ixiyy1{font-family:"Barlow", sans-serif;font-size:0.9em;margin-top:1em;text-transform:uppercase;color:rgba(0, 0, 0, 0.6);display:inline-block;width:100%}.list-header.svelte-1ixiyy1::first-letter{font-size:1.3em}ul.svelte-1ixiyy1{margin:0.5em 0 0 1em;padding:0;list-style-type:none}li.svelte-1ixiyy1{padding:0.25em 0}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function Cd(e,t,i){const n=e.slice();return n[11]=t[i],n}function Pd(e,t,i){const n=e.slice();return n[14]=t[i],n}function Md(e){let i,n,s,r,o,a;return{c(){i=u("fieldset"),n=u("legend"),s=P("MIDI in/out not available"),r=h(),o=u("p"),a=P("This browser does not support connecting to a digital piano or other\n        MIDI device.")},l(e){i=d(e,"FIELDSET",{});var t=p(i);n=d(t,"LEGEND",{});var l=p(n);s=M(l,"MIDI in/out not available"),l.forEach(m),r=c(t),o=d(t,"P",{});var h=p(o);a=M(h,"This browser does not support connecting to a digital piano or other\n        MIDI device."),h.forEach(m),t.forEach(m)},m(e,t){f(e,i,t),C(i,n),C(n,s),C(i,r),C(i,o),C(o,a)},p:t,i:t,o:t,d(e){e&&m(i)}}}function Rd(e){let t,i,n,s,r,o,a,l,y,_,k,T,S,E,R=e[2].useWebMidi&&Dd(e);return{c(){t=u("fieldset"),i=u("legend"),n=P("MIDI in/out available"),s=h(),r=u("p"),o=P("Connect a digital piano or other MIDI device to send/receive keyboard\n        and pedal events."),a=h(),l=u("div"),y=P("Enable WebMIDI:\n        "),_=u("input"),k=h(),R&&R.c(),this.h()},l(e){t=d(e,"FIELDSET",{});var h=p(t);i=d(h,"LEGEND",{});var u=p(i);n=M(u,"MIDI in/out available"),u.forEach(m),s=c(h),r=d(h,"P",{});var g=p(r);o=M(g,"Connect a digital piano or other MIDI device to send/receive keyboard\n        and pedal events."),g.forEach(m),a=c(h),l=d(h,"DIV",{class:!0});var f=p(l);y=M(f,"Enable WebMIDI:\n        "),_=d(f,"INPUT",{type:!0}),f.forEach(m),k=c(h),R&&R.l(h),h.forEach(m),this.h()},h(){g(_,"type","checkbox"),g(l,"class","setting svelte-1ixiyy1")},m(h,u){f(h,t,u),C(t,i),C(i,n),C(t,s),C(t,r),C(r,o),C(t,a),C(t,l),C(l,y),C(l,_),_.checked=e[2].useWebMidi,C(t,k),R&&R.m(t,null),T=!0,S||(E=D(_,"change",e[5]),S=!0)},p(e,i){4&i&&(_.checked=e[2].useWebMidi),e[2].useWebMidi?R?(R.p(e,i),4&i&&v(R,1)):(R=Dd(e),R.c(),v(R,1),R.m(t,null)):R&&(w(),b(R,1,1,(()=>{R=null})),x())},i(e){T||(v(R),T=!0)},o(e){b(R),T=!1},d(e){e&&m(t),R&&R.d(),S=!1,E()}}}function Dd(e){let t,i,n,r,o,a,l,k,T,S,E,R,O,I,F,j,z,N,L,B,W,q,$,V,H=e[3],U=[];for(let t=0;t<H.length;t+=1)U[t]=Ad(Pd(e,H,t));const G=e=>b(U[e],1,1,(()=>{U[e]=null}));let Z=e[4],X=[];for(let t=0;t<Z.length;t+=1)X[t]=Od(Cd(e,Z,t));const Y=e=>b(X[e],1,1,(()=>{X[e]=null}));return{c(){t=u("div"),i=P("Sustain from External MIDI:\n          "),n=u("input"),o=h(),a=u("div"),l=P("Soft from External MIDI:\n          "),k=u("input"),S=h(),E=u("p"),R=P("Connected Inputs:"),I=h(),F=u("ul");for(let e=0;e<U.length;e+=1)U[e].c();j=h(),z=u("p"),N=P("Connected Outputs:"),B=h(),W=u("ul");for(let e=0;e<X.length;e+=1)X[e].c();this.h()},l(e){t=d(e,"DIV",{class:!0});var s=p(t);i=M(s,"Sustain from External MIDI:\n          "),n=d(s,"INPUT",{type:!0}),s.forEach(m),o=c(e),a=d(e,"DIV",{class:!0});var r=p(a);l=M(r,"Soft from External MIDI:\n          "),k=d(r,"INPUT",{type:!0}),r.forEach(m),S=c(e),E=d(e,"P",{class:!0});var h=p(E);R=M(h,"Connected Inputs:"),h.forEach(m),I=c(e),F=d(e,"UL",{class:!0});var u=p(F);for(let e=0;e<U.length;e+=1)U[e].l(u);u.forEach(m),j=c(e),z=d(e,"P",{class:!0});var g=p(z);N=M(g,"Connected Outputs:"),g.forEach(m),B=c(e),W=d(e,"UL",{class:!0});var f=p(W);for(let e=0;e<X.length;e+=1)X[e].l(f);f.forEach(m),this.h()},h(){g(n,"type","checkbox"),g(t,"class","setting svelte-1ixiyy1"),g(k,"type","checkbox"),g(a,"class","setting svelte-1ixiyy1"),g(E,"class","list-header svelte-1ixiyy1"),g(F,"class","svelte-1ixiyy1"),g(z,"class","list-header svelte-1ixiyy1"),g(W,"class","svelte-1ixiyy1")},m(s,r){f(s,t,r),C(t,i),C(t,n),n.checked=e[1],f(s,o,r),f(s,a,r),C(a,l),C(a,k),k.checked=e[0],f(s,S,r),f(s,E,r),C(E,R),f(s,I,r),f(s,F,r);for(let e=0;e<U.length;e+=1)U[e].m(F,null);f(s,j,r),f(s,z,r),C(z,N),f(s,B,r),f(s,W,r);for(let e=0;e<X.length;e+=1)X[e].m(W,null);q=!0,$||(V=[D(n,"change",e[6]),D(k,"change",e[7])],$=!0)},p(e,t){if(2&t&&(n.checked=e[1]),1&t&&(k.checked=e[0]),8&t){let i;for(H=e[3],i=0;i<H.length;i+=1){const n=Pd(e,H,i);U[i]?(U[i].p(n,t),v(U[i],1)):(U[i]=Ad(n),U[i].c(),v(U[i],1),U[i].m(F,null))}for(w(),i=H.length;i<U.length;i+=1)G(i);x()}if(16&t){let i;for(Z=e[4],i=0;i<Z.length;i+=1){const n=Cd(e,Z,i);X[i]?(X[i].p(n,t),v(X[i],1)):(X[i]=Od(n),X[i].c(),v(X[i],1),X[i].m(W,null))}for(w(),i=Z.length;i<X.length;i+=1)Y(i);x()}},i(e){if(!q){y((()=>{r||(r=_(t,ye,{},!0)),r.run(1)})),y((()=>{T||(T=_(a,ye,{},!0)),T.run(1)})),y((()=>{O||(O=_(E,ye,{},!0)),O.run(1)}));for(let e=0;e<H.length;e+=1)v(U[e]);y((()=>{L||(L=_(z,ye,{},!0)),L.run(1)}));for(let e=0;e<Z.length;e+=1)v(X[e]);q=!0}},o(e){r||(r=_(t,ye,{},!1)),r.run(0),T||(T=_(a,ye,{},!1)),T.run(0),O||(O=_(E,ye,{},!1)),O.run(0),U=U.filter(Boolean);for(let e=0;e<U.length;e+=1)b(U[e]);L||(L=_(z,ye,{},!1)),L.run(0),X=X.filter(Boolean);for(let e=0;e<X.length;e+=1)b(X[e]);q=!1},d(e){e&&m(t),e&&r&&r.end(),e&&m(o),e&&m(a),e&&T&&T.end(),e&&m(S),e&&m(E),e&&O&&O.end(),e&&m(I),e&&m(F),A(U,e),e&&m(j),e&&m(z),e&&L&&L.end(),e&&m(B),e&&m(W),A(X,e),$=!1,s(V)}}}function Ad(e){let t,i,n,s,r,o,a=e[14].name+"",l=e[14].manufacturer+"";return{c(){t=u("li"),i=P(a),n=h(),s=P(l),this.h()},l(e){t=d(e,"LI",{class:!0});var r=p(t);i=M(r,a),n=c(r),s=M(r,l),r.forEach(m),this.h()},h(){g(t,"class","svelte-1ixiyy1")},m(e,r){f(e,t,r),C(t,i),C(t,n),C(t,s),o=!0},p(e,t){(!o||8&t)&&a!==(a=e[14].name+"")&&R(i,a),(!o||8&t)&&l!==(l=e[14].manufacturer+"")&&R(s,l)},i(e){o||(y((()=>{r||(r=_(t,ye,{},!0)),r.run(1)})),o=!0)},o(e){r||(r=_(t,ye,{},!1)),r.run(0),o=!1},d(e){e&&m(t),e&&r&&r.end()}}}function Od(e){let t,i,n,s,r,o,a=e[11].name+"",l=e[11].manufacturer+"";return{c(){t=u("li"),i=P(a),n=h(),s=P(l),this.h()},l(e){t=d(e,"LI",{class:!0});var r=p(t);i=M(r,a),n=c(r),s=M(r,l),r.forEach(m),this.h()},h(){g(t,"class","svelte-1ixiyy1")},m(e,r){f(e,t,r),C(t,i),C(t,n),C(t,s),o=!0},p(e,t){(!o||16&t)&&a!==(a=e[11].name+"")&&R(i,a),(!o||16&t)&&l!==(l=e[11].manufacturer+"")&&R(s,l)},i(e){o||(y((()=>{r||(r=_(t,ye,{},!0)),r.run(1)})),o=!0)},o(e){r||(r=_(t,ye,{},!1)),r.run(0),o=!1},d(e){e&&m(t),e&&r&&r.end()}}}function Id(e){let t,i,n,s;const r=[Rd,Md],o=[];return i=navigator.requestMIDIAccess?0:1,n=o[i]=r[i](e),{c(){t=u("section"),n.c()},l(e){t=d(e,"SECTION",{});var i=p(t);n.l(i),i.forEach(m)},m(e,n){f(e,t,n),o[i].m(t,null),s=!0},p(e,[t]){n.p(e,t)},i(e){s||(v(n),s=!0)},o(e){b(n),s=!1},d(e){e&&m(t),o[i].d()}}}function Fd(e,t,i){let n,s,r,o,a,l,h;S(e,Be,(e=>i(0,n=e))),S(e,Le,(e=>i(1,s=e))),S(e,je,(e=>i(8,r=e))),S(e,ze,(e=>i(9,o=e))),S(e,rt,(e=>i(2,a=e))),S(e,et,(e=>i(3,l=e))),S(e,tt,(e=>i(4,h=e)));const u=()=>{F(ze,o=!1,o),F(je,r=!1,r)};return e.$$.update=()=>{2&e.$$.dirty&&u(),1&e.$$.dirty&&u()},[n,s,a,l,h,function(){a.useWebMidi=this.checked,rt.set(a)},function(){s=this.checked,Le.set(s)},function(){n=this.checked,Be.set(n)}]}class jd extends a{constructor(e){super(),l(this,e,Fd,Id,i,{})}}function zd(e){let t,i,n,s,r,o,a,l;function y(t){e[5](t)}let _={panels:e[3]};void 0!==e[2]&&(_.selectedPanel=e[2]),t=new uc({props:_}),W.push((()=>Z(t,"selectedPanel",y)));const k=[e[3][e[2]].props];var T=e[3][e[2]].component;function S(e){let t={};for(let e=0;e<k.length;e+=1)t=Y(t,k[e]);return{props:t}}return T&&(r=new T(S())),a=new $c({props:{playPauseApp:e[0],stopApp:e[1]}}),{c(){j(t.$$.fragment),n=h(),s=u("div"),r&&j(r.$$.fragment),o=h(),j(a.$$.fragment),this.h()},l(e){z(t.$$.fragment,e),n=c(e),s=d(e,"DIV",{class:!0});var i=p(s);r&&z(r.$$.fragment,i),i.forEach(m),o=c(e),z(a.$$.fragment,e),this.h()},h(){g(s,"class","svelte-1skz4ul")},m(e,i){N(t,e,i),f(e,n,i),f(e,s,i),r&&N(r,s,null),f(e,o,i),N(a,e,i),l=!0},p(e,[n]){const o={};!i&&4&n&&(i=!0,o.selectedPanel=e[2],X((()=>i=!1))),t.$set(o);const l=12&n?ee(k,[me(e[3][e[2]].props)]):{};if(T!==(T=e[3][e[2]].component)){if(r){w();const e=r;b(e.$$.fragment,1,0,(()=>{L(e,1)})),x()}T?(r=new T(S()),j(r.$$.fragment),v(r.$$.fragment,1),N(r,s,null)):r=null}else T&&r.$set(l);const h={};1&n&&(h.playPauseApp=e[0]),2&n&&(h.stopApp=e[1]),a.$set(h)},i(e){l||(v(t.$$.fragment,e),r&&v(r.$$.fragment,e),v(a.$$.fragment,e),l=!0)},o(e){b(t.$$.fragment,e),r&&b(r.$$.fragment,e),b(a.$$.fragment,e),l=!1},d(e){L(t,e),e&&m(n),e&&m(s),r&&L(r),e&&m(o),L(a,e)}}}function Nd(e,t,i){let{playPauseApp:n}=t,{skipToPercentage:s}=t,{stopApp:r}=t;const o={controls:{component:rd,props:{skipToPercentage:s},icon:"sliders"},settings:{component:ud,icon:"cog"},audio:{component:Ed,icon:"piano"},midi:{component:jd,icon:"midi"}};let a="controls";return e.$$set=e=>{"playPauseApp"in e&&i(0,n=e.playPauseApp),"skipToPercentage"in e&&i(4,s=e.skipToPercentage),"stopApp"in e&&i(1,r=e.stopApp)},[n,r,a,o,s,function(e){a=e,i(2,a)}]}class Ld extends a{constructor(e){super(),l(this,e,Nd,zd,i,{playPauseApp:0,skipToPercentage:4,stopApp:1})}}if("undefined"!=typeof document){const e="article.svelte-1gxqnd7{background-color:white;border-radius:5px;box-shadow:0 1px 3px 0 rgba(0, 0, 0, 0.12), 0 1px 2px 0 rgba(0, 0, 0, 0.24);left:50%;max-height:80vh;max-width:728px;padding:20px;position:absolute;text-align:center;top:10vh;transform:translate(-50%);width:calc(100% - 40px);z-index:10}header.svelte-1gxqnd7{color:var(--primary-accent);font-size:40px;font-weight:bold;width:100%;text-shadow:4px 4px 4px rgba(38, 50, 56, 0.2);border-bottom:1px solid var(--primary-accent);padding-bottom:0.2em}p.svelte-1gxqnd7{margin:2em 0}a.svelte-1gxqnd7{color:var(--primary-accent);text-decoration:none}a.svelte-1gxqnd7:hover{color:#333;text-decoration:none}button.svelte-1gxqnd7{float:right}img.svelte-1gxqnd7{height:176px;width:300px;opacity:0;transition:opacity 1s ease}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function Bd(e){let i,n,r,o,a,l,v,w,b,x,k,T,S,E,R,A,O,I,F,j,z;return{c(){i=u("article"),n=u("header"),r=P("Welcome to the Pianolatron"),o=h(),a=u("p"),l=P("This site is under active development."),v=u("br"),w=P("Please direct enquiries and\n    feedback to\n    "),b=u("a"),x=P("contact-cidr@stanford.edu"),k=P(".\n    "),T=u("a"),S=u("img"),R=h(),A=u("button"),O=P("Dismiss, and don't show again"),this.h()},l(e){i=d(e,"ARTICLE",{class:!0});var t=p(i);n=d(t,"HEADER",{class:!0});var s=p(n);r=M(s,"Welcome to the Pianolatron"),s.forEach(m),o=c(t),a=d(t,"P",{class:!0});var h=p(a);l=M(h,"This site is under active development."),v=d(h,"BR",{}),w=M(h,"Please direct enquiries and\n    feedback to\n    "),b=d(h,"A",{href:!0,class:!0});var u=p(b);x=M(u,"contact-cidr@stanford.edu"),u.forEach(m),k=M(h,".\n    "),T=d(h,"A",{href:!0,title:!0,class:!0});var g=p(T);S=d(g,"IMG",{src:!0,alt:!0,class:!0}),g.forEach(m),h.forEach(m),R=c(t),A=d(t,"BUTTON",{class:!0});var f=p(A);O=M(f,"Dismiss, and don't show again"),f.forEach(m),t.forEach(m),this.h()},h(){g(n,"class","svelte-1gxqnd7"),g(b,"href","mailto:contact-cidr@stanford.edu"),g(b,"class","svelte-1gxqnd7"),ge(S.src,E="cidr.trsp.300x176.png")||g(S,"src","cidr.trsp.300x176.png"),g(S,"alt","CIDR logo"),g(S,"class","svelte-1gxqnd7"),g(T,"href","http://cidr.stanford.edu/"),g(T,"title","Center for Interdisciplinary Digital Research @ Stanford Libraries"),g(T,"class","svelte-1gxqnd7"),g(a,"class","svelte-1gxqnd7"),g(A,"class","svelte-1gxqnd7"),g(i,"class","svelte-1gxqnd7")},m(t,s){f(t,i,s),C(i,n),C(n,r),C(i,o),C(i,a),C(a,l),C(a,v),C(a,w),C(a,b),C(b,x),C(a,k),C(a,T),C(T,S),C(i,R),C(i,A),C(A,O),F=!0,j||(z=[D(window,"keydown",e[2]),D(S,"load",qd),D(A,"click",e[3]),D(i,"click",e[4])],j=!0)},p:t,i(e){F||(y((()=>{I||(I=_(i,_e,{y:-400},!0)),I.run(1)})),F=!0)},o(e){I||(I=_(i,_e,{y:-400},!1)),I.run(0),F=!1},d(e){e&&m(i),e&&I&&I.end(),j=!1,s(z)}}}const Wd=Ce(!o(rt).welcomeScreenInhibited),qd=({target:e})=>e.style.opacity=1;function $d(e,i,n){let s,r,o=t;S(e,Wd,(e=>n(0,s=e))),S(e,rt,(e=>n(1,r=e))),e.$$.on_destroy.push((()=>o()));return[s,r,e=>{"Escape"===e.code&&F(Wd,s=!1,s)},()=>{F(rt,r.welcomeScreenInhibited=!0,r),F(Wd,s=!1,s)},()=>F(Wd,s=!1,s)]}class Vd extends a{constructor(e){super(),l(this,e,$d,Bd,i,{})}}if("undefined"!=typeof document){const e='input.svelte-v0giq5.svelte-v0giq5{display:none}.flex-collapsible.svelte-v0giq5.svelte-v0giq5{transition:all 0.3s ease}.flex-collapsible.svelte-v0giq5>div.svelte-v0giq5{bottom:0;display:flex;flex-direction:column;gap:0.5em;overflow:visible;padding:0.5em;position:absolute;top:0}.flex-collapsible.svelte-v0giq5.svelte-v0giq5:hover:not(.hidden){box-shadow:2px -3px 3px rgba(0, 0, 0, 0.4)}.flex-collapsible:hover:not(.hidden).left.svelte-v0giq5.svelte-v0giq5{box-shadow:-2px -3px 3px rgba(0, 0, 0, 0.4)}.flex-collapsible.svelte-v0giq5:hover label.svelte-v0giq5{opacity:1}.flex-collapsible.left.svelte-v0giq5 label.svelte-v0giq5{left:-40px;border-radius:4px 0 0 4px}.flex-collapsible.left.svelte-v0giq5 label.svelte-v0giq5::after{content:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="white" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="14" y1="12" x2="4" y2="12" /><line x1="14" y1="12" x2="10" y2="16" /><line x1="14" y1="12" x2="10" y2="8" /><line x1="20" y1="4" x2="20" y2="20" /></svg>\')}.hidden.svelte-v0giq5 label.svelte-v0giq5{opacity:1}.hidden.svelte-v0giq5 label.svelte-v0giq5::after{content:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="white" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="20" y1="12" x2="10" y2="12" /><line x1="20" y1="12" x2="16" y2="16" /><line x1="20" y1="12" x2="16" y2="8" /><line x1="4" y1="4" x2="4" y2="20" /></svg>\')}.hidden.left.svelte-v0giq5 label.svelte-v0giq5::after{content:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="white" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="12" x2="14" y2="12" /><line x1="4" y1="12" x2="8" y2="16" /><line x1="4" y1="12" x2="8" y2="8" /><line x1="20" y1="4" x2="20" y2="20" /></svg>\')}label.svelte-v0giq5.svelte-v0giq5{background:rgba(0, 0, 0, 0.4);border-radius:0 4px 4px 0;cursor:pointer;display:grid;height:40px;left:100%;opacity:0;place-items:center;position:relative;top:1em;transition:all 0.3s ease;width:40px;z-index:4}label.svelte-v0giq5.svelte-v0giq5::after{content:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="white" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="10" y1="12" x2="20" y2="12" /><line x1="10" y1="12" x2="14" y2="16" /><line x1="10" y1="12" x2="14" y2="8" /><line x1="4" y1="4" x2="4" y2="20" /></svg>\')}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function Hd(e){let t,i,n,s,r,o,a,l,y,_,w,x,k,T;const S=e[5].default,E=he(S,e,e[4],null);return{c(){t=u("div"),i=u("input"),s=h(),r=u("label"),a=h(),l=u("div"),E&&E.c(),this.h()},l(e){t=d(e,"DIV",{id:!0,class:!0,style:!0});var n=p(t);i=d(n,"INPUT",{type:!0,id:!0,class:!0}),s=c(n),r=d(n,"LABEL",{for:!0,class:!0}),p(r).forEach(m),a=c(n),l=d(n,"DIV",{style:!0,class:!0});var o=p(l);E&&E.l(o),o.forEach(m),n.forEach(m),this.h()},h(){g(i,"type","checkbox"),g(i,"id",n=`${e[0]}_collapse`),g(i,"class","svelte-v0giq5"),g(r,"for",o=`${e[0]}_collapse`),g(r,"class","svelte-v0giq5"),g(l,"style",y=`width: ${e[1]};`),g(l,"class","svelte-v0giq5"),g(t,"id",e[0]),g(t,"class",_=ne(`flex-collapsible ${e[2]}`)+" svelte-v0giq5"),g(t,"style",w=`width: ${e[3]?0:e[1]};`),q(t,"hidden",e[3])},m(n,o){f(n,t,o),C(t,i),i.checked=e[3],C(t,s),C(t,r),C(t,a),C(t,l),E&&E.m(l,null),x=!0,k||(T=D(i,"change",e[6]),k=!0)},p(e,[s]){(!x||1&s&&n!==(n=`${e[0]}_collapse`))&&g(i,"id",n),8&s&&(i.checked=e[3]),(!x||1&s&&o!==(o=`${e[0]}_collapse`))&&g(r,"for",o),E&&E.p&&(!x||16&s)&&ue(E,S,e,e[4],x?de(S,e[4],s,null):ce(e[4]),null),(!x||2&s&&y!==(y=`width: ${e[1]};`))&&g(l,"style",y),(!x||1&s)&&g(t,"id",e[0]),(!x||4&s&&_!==(_=ne(`flex-collapsible ${e[2]}`)+" svelte-v0giq5"))&&g(t,"class",_),(!x||10&s&&w!==(w=`width: ${e[3]?0:e[1]};`))&&g(t,"style",w),12&s&&q(t,"hidden",e[3])},i(e){x||(v(E,e),x=!0)},o(e){b(E,e),x=!1},d(e){e&&m(t),E&&E.d(e),k=!1,T()}}}function Ud(e,t,i){let{$$slots:n={},$$scope:s}=t,{id:r}=t,{width:o}=t,{position:a="right"}=t,l=!1;return e.$$set=e=>{"id"in e&&i(0,r=e.id),"width"in e&&i(1,o=e.width),"position"in e&&i(2,a=e.position),"$$scope"in e&&i(4,s=e.$$scope)},[r,o,a,l,s,n,function(){l=this.checked,i(3,l)}]}class Gd extends a{constructor(e){super(),l(this,e,Ud,Hd,i,{id:0,width:1,position:2})}}function Zd(e){let t,i,n,s,r,o,a,l,v,w,b,x,k,T,S;return{c(){t=u("div"),i=u("div"),n=u("span"),s=P(" \n      "),r=u("span"),o=P(" \n      "),a=u("span"),l=P(" \n      "),v=u("span"),w=P(" \n      "),b=u("span"),x=h(),k=P(e[1]),this.h()},l(h){t=d(h,"DIV",{id:!0});var u=p(t);i=d(u,"DIV",{});var g=p(i);n=d(g,"SPAN",{}),p(n).forEach(m),s=M(g," \n      "),r=d(g,"SPAN",{}),p(r).forEach(m),o=M(g," \n      "),a=d(g,"SPAN",{}),p(a).forEach(m),l=M(g," \n      "),v=d(g,"SPAN",{}),p(v).forEach(m),w=M(g," \n      "),b=d(g,"SPAN",{}),p(b).forEach(m),g.forEach(m),x=c(u),k=M(u,e[1]),u.forEach(m),this.h()},h(){g(t,"id","loading")},m(e,h){f(e,t,h),C(t,i),C(i,n),C(i,s),C(i,r),C(i,o),C(i,a),C(i,l),C(i,v),C(i,w),C(i,b),C(t,x),C(t,k),S=!0},p(e,t){(!S||2&t)&&R(k,e[1])},i(e){S||(y((()=>{T||(T=_(t,ye,{},!0)),T.run(1)})),S=!0)},o(e){T||(T=_(t,ye,{},!1)),T.run(0),S=!1},d(e){e&&m(t),e&&T&&T.end()}}}function Xd(e){let t,i,n=e[0]&&Zd(e);return{c(){n&&n.c(),t=T()},l(e){n&&n.l(e),t=T()},m(e,s){n&&n.m(e,s),f(e,t,s),i=!0},p(e,[i]){e[0]?n?(n.p(e,i),1&i&&v(n,1)):(n=Zd(e),n.c(),v(n,1),n.m(t.parentNode,t)):n&&(w(),b(n,1,1,(()=>{n=null})),x())},i(e){i||(v(n),i=!0)},o(e){b(n),i=!1},d(e){n&&n.d(e),e&&m(t)}}}function Yd(e,t,i){let{showLoadingSpinner:n}=t,{loadingSpinnerText:s="Loading resources..."}=t;return e.$$set=e=>{"showLoadingSpinner"in e&&i(0,n=e.showLoadingSpinner),"loadingSpinnerText"in e&&i(1,s=e.loadingSpinnerText)},[n,s]}class Kd extends a{constructor(e){super(),l(this,e,Yd,Xd,i,{showLoadingSpinner:0,loadingSpinnerText:1})}}let Qd=[{druid:"my670qk6863",image_url:"https://stacks.stanford.edu/image/iiif/my670qk6863%2Fmy670qk6863_0001/info.json",number:"2673",publisher:"Welte-Mignon",title:"Adam - Hymns",type:"welte-red"},{druid:"sj617nc3041",image_url:"https://stacks.stanford.edu/image/iiif/sj617nc3041%2Fsj617nc3041_0001/info.json",number:"2543",publisher:"Welte-Mignon",title:"Adam/Bernick - Si j'étais roi: Ouverture",type:"welte-red"},{druid:"sz948zd1422",image_url:"https://stacks.stanford.edu/image/iiif/sz948zd1422%2Fsz948zd1422_0002/info.json",number:"4538",publisher:"Princesa",title:"Akst - Dinah: Charlestón",type:"88-note"},{druid:"ty610zx2946",image_url:"https://stacks.stanford.edu/image/iiif/ty610zx2946%2Fty610zx2946_0001/info.json",number:"416",publisher:"Welte-Mignon",title:"Albert/Albert - Tiefland ballade",type:"welte-red"},{druid:"mb915gc4689",image_url:"https://stacks.stanford.edu/image/iiif/mb915gc4689%2Fmb915gc4689_0001/info.json",number:"520",publisher:"Welte-Mignon",title:"Alkan/Petri - Ancienne melodie de la synagogue a. d. präludien: op. 31",type:"welte-red"},{druid:"xn196fs1128",image_url:"https://stacks.stanford.edu/image/iiif/xn196fs1128%2Fxn196fs1128_0002/info.json",number:"4652",publisher:"Princesa",title:"Alonso - La Parranda: Ronda de las solteras",type:"88-note"},{druid:"cy287wz7683",image_url:"https://stacks.stanford.edu/image/iiif/cy287wz7683%2Fcy287wz7683_0002/info.json",number:"653",publisher:"P.O.C.H.",title:"Alonso - Las Castigadoras: Charlestón",type:"88-note"},{druid:"nw222vm1898",image_url:"https://stacks.stanford.edu/image/iiif/nw222vm1898%2Fnw222vm1898_0002/info.json",number:"4566",publisher:"Princesa",title:"Alonso - Las Castigadoras: Pasodoble",type:"88-note"},{druid:"pz594dj8436",image_url:"https://stacks.stanford.edu/image/iiif/pz594dj8436%2Fpz594dj8436_0002/info.json",number:"4391",publisher:"Princesa",title:"Alonso - Las Corsarias: selecciones",type:"88-note"},{druid:"tn412mq0486",image_url:"https://stacks.stanford.edu/image/iiif/tn412mq0486%2Ftn412mq0486_0002/info.json",number:"40076",publisher:"Princesa",title:"Alonso - Por si las moscas: Schotis",type:"88-note"},{druid:"rs892mq5364",image_url:"https://stacks.stanford.edu/image/iiif/rs892mq5364%2Frs892mq5364_0002/info.json",number:"40008",publisher:"Princesa",title:"Barta - Rosa de madrid: schotis",type:"88-note"},{druid:"ch984dr4932",image_url:"https://stacks.stanford.edu/image/iiif/ch984dr4932%2Fch984dr4932_0002/info.json",number:"1894",publisher:"N/A",title:"Beethoven - Cuarteto op. 130: III: Andante con moto ma non troppo",type:"88-note"},{druid:"vz386xg9451",image_url:"https://stacks.stanford.edu/image/iiif/vz386xg9451%2Fvz386xg9451_0002/info.json",number:"4155",publisher:"Victoria",title:"Beethoven - Sonata op. 31, no 1: Rondó",type:"88-note"},{druid:"hb523vs3190",image_url:"https://stacks.stanford.edu/image/iiif/hb523vs3190%2Fhb523vs3190_0002/info.json",number:"4108",publisher:"Victoria",title:"Beethoven - Sonata, op. 2, no 1, en fa menor: minuetto",type:"88-note"},{druid:"bc072xf6791",image_url:"https://stacks.stanford.edu/image/iiif/bc072xf6791%2Fbc072xf6791_0001/info.json",number:"443",publisher:"Welte-Mignon",title:"Beethoven-Liszt/Busoni - Adelaïde: (transcription)",type:"welte-red"},{druid:"bq744nq5945",image_url:"https://stacks.stanford.edu/image/iiif/bq744nq5945%2Fbq744nq5945_0001/info.json",number:"1462",publisher:"Welte-Mignon",title:"Beethoven/Bloomfield-Zeisler - Sonata op. 111, c minor: 1st movement",type:"welte-red"},{druid:"yt974cv2625",image_url:"https://stacks.stanford.edu/image/iiif/yt974cv2625%2Fyt974cv2625_0001/info.json",number:"1463",publisher:"Welte-Mignon",title:"Beethoven/Bloomfield-Zeisler - Sonate op. 111, c-moll: II. Teil",type:"welte-red"},{druid:"qz671pq0609",image_url:"https://stacks.stanford.edu/image/iiif/qz671pq0609%2Fqz671pq0609_0001/info.json",number:"372",publisher:"Welte-Mignon",title:"Beethoven/Carreño - Sonate c-dur, op. 53: (Waldstein): 1. Teil",type:"welte-red"},{druid:"kg263bn9176",image_url:"https://stacks.stanford.edu/image/iiif/kg263bn9176%2Fkg263bn9176_0001/info.json",number:"373",publisher:"Welte-Mignon",title:"Beethoven/Carreño - Waldstein sonata: (2nd movement)",type:"welte-red"},{druid:"ph692rh6823",image_url:"https://stacks.stanford.edu/image/iiif/ph692rh6823%2Fph692rh6823_0001/info.json",number:"2311",publisher:"Welte-Mignon",title:"Beethoven/Del Grande - Symphonie eroica: I. Satz",type:"welte-red"},{druid:"dz112ky5575",image_url:"https://stacks.stanford.edu/image/iiif/dz112ky5575%2Fdz112ky5575_0001/info.json",number:"2312",publisher:"Welte-Mignon",title:"Beethoven/Del Grande - Symphonie eroica: II. Satz",type:"welte-red"},{druid:"ht339gy6128",image_url:"https://stacks.stanford.edu/image/iiif/ht339gy6128%2Fht339gy6128_0001/info.json",number:"2313",publisher:"Welte-Mignon",title:"Beethoven/Del Grande - Symphonie eroica: III. Satz",type:"welte-red"},{druid:"ks452px2704",image_url:"https://stacks.stanford.edu/image/iiif/ks452px2704%2Fks452px2704_0001/info.json",number:"2314",publisher:"Welte-Mignon",title:"Beethoven/Del Grande - Symphonie eroica: IV. Satz",type:"welte-red"},{druid:"xx766cn9843",image_url:"https://stacks.stanford.edu/image/iiif/xx766cn9843%2Fxx766cn9843_0001/info.json",number:"1326",publisher:"Welte-Mignon",title:"Beethoven/Fryer - Menuett es-dur",type:"welte-red"},{druid:"ty382mw3181",image_url:"https://stacks.stanford.edu/image/iiif/ty382mw3181%2Fty382mw3181_0001/info.json",number:"3026",publisher:"Welte-Mignon",title:"Beethoven/Hofmann - Sonate a-dur, op. 101: I. und II. Teil",type:"welte-red"},{druid:"jk842rg9750",image_url:"https://stacks.stanford.edu/image/iiif/jk842rg9750%2Fjk842rg9750_0001/info.json",number:"3027",publisher:"Welte-Mignon",title:"Beethoven/Hofmann - Sonate op. 103: III. und IV. Teil",type:"welte-red"},{druid:"mw870hc7232",image_url:"https://stacks.stanford.edu/image/iiif/mw870hc7232%2Fmw870hc7232_0001/info.json",number:"3156",publisher:"Welte-Mignon",title:"Beethoven/Kiek - 2nd symphony: Movements 2 & 3",type:"welte-red"},{druid:"ch718mg2581",image_url:"https://stacks.stanford.edu/image/iiif/ch718mg2581%2Fch718mg2581_0001/info.json",number:"284",publisher:"Welte-Mignon",title:"Beethoven/Lambrino - Menuett (from sonata op. 31 e flat major)",type:"welte-red"},{druid:"wt621xq0875",image_url:"https://stacks.stanford.edu/image/iiif/wt621xq0875%2Fwt621xq0875_0001/info.json",number:"561",publisher:"Welte-Mignon",title:"Beethoven/Lamond - Sonate pathétique: II. Satz",type:"welte-red"},{druid:"kr397bv2881",image_url:"https://stacks.stanford.edu/image/iiif/kr397bv2881%2Fkr397bv2881_0001/info.json",number:"562",publisher:"Welte-Mignon",title:"Beethoven/Lamond - Sonate pathétique: op. 13, 3rd movement",type:"welte-red"},{druid:"dx555xv9093",image_url:"https://stacks.stanford.edu/image/iiif/dx555xv9093%2Fdx555xv9093_0001/info.json",number:"1246",publisher:"Welte-Mignon",title:"Beethoven/Paderewski - Moonlight sonata: C sharp minor: 1st & 2nd movements",type:"welte-red"},{druid:"xm993qd2681",image_url:"https://stacks.stanford.edu/image/iiif/xm993qd2681%2Fxm993qd2681_0001/info.json",number:"1247",publisher:"Welte-Mignon",title:"Beethoven/Paderewski - Sonata c sharp minor: (moonlight): Part 3",type:"welte-red"},{druid:"yb187qn0290",image_url:"https://stacks.stanford.edu/image/iiif/yb187qn0290%2Fyb187qn0290_0001/info.json",number:"1246",publisher:"Welte-Mignon",title:"Beethoven/Paderewski - Sonate cis-moll: (Mondschein): I. und II. Teil",type:"welte-red"},{druid:"wp877mn0317",image_url:"https://stacks.stanford.edu/image/iiif/wp877mn0317%2Fwp877mn0317_0001/info.json",number:"1247",publisher:"Welte-Mignon",title:"Beethoven/Paderewski - Sonate cis-moll: (Mondschein): III. Teil",type:"welte-red"},{druid:"ch918dn4026",image_url:"https://stacks.stanford.edu/image/iiif/ch918dn4026%2Fch918dn4026_0001/info.json",number:"3270",publisher:"Welte-Mignon",title:"Beethoven/Pembaur - Fantasia op. 77, g minor",type:"welte-green"},{druid:"wk295jd5289",image_url:"https://stacks.stanford.edu/image/iiif/wk295jd5289%2Fwk295jd5289_0001/info.json",number:"527",publisher:"Welte-Mignon",title:"Beethoven/Petri - 32 variationen: c-Moll",type:"welte-red"},{druid:"pv279zy5193",image_url:"https://stacks.stanford.edu/image/iiif/pv279zy5193%2Fpv279zy5193_0001/info.json",number:"1505",publisher:"Welte-Mignon",title:"Beethoven/Pückler - Sonata appassionata: II. u. III. Teil",type:"welte-red"},{druid:"ns119ny6089",image_url:"https://stacks.stanford.edu/image/iiif/ns119ny6089%2Fns119ny6089_0001/info.json",number:"184",publisher:"Welte-Mignon",title:"Beethoven/Reinecke - Ecossaisen",type:"welte-green"},{druid:"tt435dd2897",image_url:"https://stacks.stanford.edu/image/iiif/tt435dd2897%2Ftt435dd2897_0001/info.json",number:"326",publisher:"Welte-Mignon",title:"Beethoven/Reisenauer - Rondo capriccioso: G-Dur, op. 129: (Die Wut über den verlorenen Groschen)",type:"welte-red"},{druid:"wb381qd3151",image_url:"https://stacks.stanford.edu/image/iiif/wb381qd3151%2Fwb381qd3151_0001/info.json",number:"330",publisher:"Welte-Mignon",title:"Beethoven/Reisenauer - Rondo op. 51",type:"welte-red"},{druid:"dp801zr4347",image_url:"https://stacks.stanford.edu/image/iiif/dp801zr4347%2Fdp801zr4347_0001/info.json",number:"3130",publisher:"Welte-Mignon",title:"Beethoven/Ritter - Leonora no. 3 overture",type:"welte-red"},{druid:"gm170gy7498",image_url:"https://stacks.stanford.edu/image/iiif/gm170gy7498%2Fgm170gy7498_0001/info.json",number:"239",publisher:"Welte-Mignon",title:"Beethoven/Scharwenka - Sonata appassionata, op. 57: Part 1",type:"welte-red"},{druid:"bf074nj8801",image_url:"https://stacks.stanford.edu/image/iiif/bf074nj8801%2Fbf074nj8801_0001/info.json",number:"1443",publisher:"Welte-Mignon",title:"Beethoven/Schelling - Sonata appassionata: op. 57, F Minor: 2nd and 3rd movements",type:"welte-red"},{druid:"fz215xr4723",image_url:"https://stacks.stanford.edu/image/iiif/fz215xr4723%2Ffz215xr4723_0001/info.json",number:"1443",publisher:"Welte-Mignon",title:"Beethoven/Schelling - Sonata appassionata: op. 57, F Minor: 2nd and 3rd movements",type:"welte-red"},{druid:"mh156nr8259",image_url:"https://stacks.stanford.edu/image/iiif/mh156nr8259%2Fmh156nr8259_0001/info.json",number:"1442",publisher:"Welte-Mignon",title:"Beethoven/Schelling - Sonata appassionata: op. 57, F minor: 1st movement",type:"welte-red"},{druid:"pp798fc0175",image_url:"https://stacks.stanford.edu/image/iiif/pp798fc0175%2Fpp798fc0175_0001/info.json",number:"5667",publisher:"Welte-Mignon",title:"Berlin/Haass - All alone: waltz",type:"welte-red"},{druid:"bz327kz4744",image_url:"https://stacks.stanford.edu/image/iiif/bz327kz4744%2Fbz327kz4744_0001/info.json",number:"5634",publisher:"Welte-Mignon",title:"Berlin/Hare - What'll i do: waltz",type:"welte-red"},{druid:"dr971dy1221",image_url:"https://stacks.stanford.edu/image/iiif/dr971dy1221%2Fdr971dy1221_0001/info.json",number:"965",publisher:"Welte-Mignon",title:"Berlioz-Liszt/Landowska - Ballet des sylves",type:"welte-red"},{druid:"kt852zf4103",image_url:"https://stacks.stanford.edu/image/iiif/kt852zf4103%2Fkt852zf4103_0001/info.json",number:"137",publisher:"Welte-Mignon",title:"Bizet/Adam-Benard - Carmens lied: tralalala",type:"welte-red"},{druid:"tp747vf1137",image_url:"https://stacks.stanford.edu/image/iiif/tp747vf1137%2Ftp747vf1137_0001/info.json",number:"163",publisher:"Welte-Mignon",title:"Bizet/Adam-Benard - Lied des don josé und duo aus carmen: 2. Akt (Carmens Tanz)",type:"welte-red"},{druid:"gr034qm4805",image_url:"https://stacks.stanford.edu/image/iiif/gr034qm4805%2Fgr034qm4805_0001/info.json",number:"1593",publisher:"Welte-Mignon",title:"Bizet/Francklyn - Carmen: selection",type:"welte-red"},{druid:"xg976jt9573",image_url:"https://stacks.stanford.edu/image/iiif/xg976jt9573%2Fxg976jt9573_0001/info.json",number:"5521",publisher:"Welte-Mignon",title:"Blaufuss/Dark - My isle of golden dreams: waltz",type:"welte-red"},{druid:"ps108fn1431",image_url:"https://stacks.stanford.edu/image/iiif/ps108fn1431%2Fps108fn1431_0001/info.json",number:"1288",publisher:"Welte-Mignon",title:"Borel-Clerc/Fichter - La Mattchiche",type:"welte-red"},{druid:"rk591jt8964",image_url:"https://stacks.stanford.edu/image/iiif/rk591jt8964%2Frk591jt8964_0001/info.json",number:"1148",publisher:"Welte-Mignon",title:"Brahms/Carreño - Sonata f minor, op. 5, 1st movement",type:"welte-red"},{druid:"jj589sc7898",image_url:"https://stacks.stanford.edu/image/iiif/jj589sc7898%2Fjj589sc7898_0001/info.json",number:"497",publisher:"Welte-Mignon",title:"Brahms/Dohnányi - Cappriccio op. 76, no. 2",type:"welte-red"},{druid:"yw484ky7093",image_url:"https://stacks.stanford.edu/image/iiif/yw484ky7093%2Fyw484ky7093_0001/info.json",number:"589",publisher:"Welte-Mignon",title:"Brahms/Galston - Waltzes op. 39, 6 and 11",type:"welte-red"},{druid:"tx437pj1389",image_url:"https://stacks.stanford.edu/image/iiif/tx437pj1389%2Ftx437pj1389_0001/info.json",number:"1108",publisher:"Welte-Mignon",title:"Brahms/Ney - Sonata f minor, op. 5: 2nd movement",type:"welte-red"},{druid:"dc661yr7679",image_url:"https://stacks.stanford.edu/image/iiif/dc661yr7679%2Fdc661yr7679_0001/info.json",number:"1085",publisher:"Welte-Mignon",title:"Brahms/Nikisch - Ungarischer tanz: No. 1",type:"welte-red"},{druid:"jf938sf5847",image_url:"https://stacks.stanford.edu/image/iiif/jf938sf5847%2Fjf938sf5847_0001/info.json",number:"2555",publisher:"Welte-Mignon",title:"Brahms/Paur - Intermezzo op. 76, no. 2",type:"welte-red"},{druid:"rk796xd9697",image_url:"https://stacks.stanford.edu/image/iiif/rk796xd9697%2Frk796xd9697_0001/info.json",number:"1476",publisher:"Welte-Mignon",title:"Brahms/Samaroff Stokowski - Ii. rhapsodie",type:"welte-red"},{druid:"ht999gf1829",image_url:"https://stacks.stanford.edu/image/iiif/ht999gf1829%2Fht999gf1829_0002/info.json",number:"2191",publisher:"Princesa",title:"Caballero - Gigantes y cabezudos: selección",type:"88-note"},{druid:"rv703vf3503",image_url:"https://stacks.stanford.edu/image/iiif/rv703vf3503%2Frv703vf3503_0001/info.json",number:"3042",publisher:"Welte-Mignon",title:"Cady/Ganz - Song of the boatmen of the volga =: (Schifferlied auf der Wolga)",type:"welte-red"},{druid:"jc718cb5784",image_url:"https://stacks.stanford.edu/image/iiif/jc718cb5784%2Fjc718cb5784_0001/info.json",number:"2594",publisher:"Welte-Mignon",title:"Chaminade/Bloomfield-Zeisler - Le Retour",type:"welte-red"},{druid:"cd435bw2771",image_url:"https://stacks.stanford.edu/image/iiif/cd435bw2771%2Fcd435bw2771_0001/info.json",number:"2539",publisher:"Welte-Mignon",title:"Chaminade/Mero - Arlequine",type:"welte-red"},{druid:"rx933wn3761",image_url:"https://stacks.stanford.edu/image/iiif/rx933wn3761%2Frx933wn3761_0001/info.json",number:"2537",publisher:"Welte-Mignon",title:"Chaminade/Mero - Automne: op. 35, no. 2",type:"welte-red"},{druid:"cw378sb0125",image_url:"https://stacks.stanford.edu/image/iiif/cw378sb0125%2Fcw378sb0125_0001/info.json",number:"2538",publisher:"Welte-Mignon",title:"Chaminade/Mero - Elevation: op. 76, no. 2",type:"welte-red"},{druid:"tm408mz6807",image_url:"https://stacks.stanford.edu/image/iiif/tm408mz6807%2Ftm408mz6807_0001/info.json",number:"2538",publisher:"Welte-Mignon",title:"Chaminade/Mero - Elévation: romance sans paroles: op. 76, no. 2",type:"welte-red"},{druid:"tr243mz6407",image_url:"https://stacks.stanford.edu/image/iiif/tr243mz6407%2Ftr243mz6407_0001/info.json",number:"2540",publisher:"Welte-Mignon",title:"Chaminade/Mero - La Lisonjera",type:"welte-red"},{druid:"zf037wk3650",image_url:"https://stacks.stanford.edu/image/iiif/zf037wk3650%2Fzf037wk3650_0001/info.json",number:"1127",publisher:"Welte-Mignon",title:"Chaminade/Uzielli - Pierrette: air de ballet, op. 41",type:"welte-red"},{druid:"ms604gp1206",image_url:"https://stacks.stanford.edu/image/iiif/ms604gp1206%2Fms604gp1206_0002/info.json",number:"4466",publisher:"Princesa",title:"Chapí - El Puñao de rosas: selecciones",type:"88-note"},{druid:"br351xc9456",image_url:"https://stacks.stanford.edu/image/iiif/br351xc9456%2Fbr351xc9456_0002/info.json",number:"1944",publisher:"Princesa",title:"Chapí - La Tempestad: valses sobre varios motivos",type:"88-note"},{druid:"wx138dx1211",image_url:"https://stacks.stanford.edu/image/iiif/wx138dx1211%2Fwx138dx1211_0002/info.json",number:"4108",publisher:"Victoria",title:"Chopin - Nocturno, op. 15, no 1, en fa",type:"88-note"},{druid:"zp866tm4852",image_url:"https://stacks.stanford.edu/image/iiif/zp866tm4852%2Fzp866tm4852_0001/info.json",number:"3310",publisher:"Welte-Mignon",title:"Chopin-Backhaus/Backhaus - Pianoforte concerto op. ii, e minor: 2nd movement",type:"welte-red"},{druid:"qd784zj3903",image_url:"https://stacks.stanford.edu/image/iiif/qd784zj3903%2Fqd784zj3903_0001/info.json",number:"3310",publisher:"Welte-Mignon",title:"Chopin-Backhaus/Backhaus - Romanze a. e-moll konzert: II. Satz",type:"welte-red"},{druid:"nq628rc4181",image_url:"https://stacks.stanford.edu/image/iiif/nq628rc4181%2Fnq628rc4181_0001/info.json",number:"83",publisher:"Welte-Mignon",title:"Chopin/Adam-Benard - Nocturne op. 9, no. 2, e flat major",type:"welte-red"},{druid:"gf160gq3516",image_url:"https://stacks.stanford.edu/image/iiif/gf160gq3516%2Fgf160gq3516_0001/info.json",number:"2979",publisher:"Welte-Mignon",title:"Chopin/Albert - Nocturne op. 9, no. 1, b-flat minor",type:"welte-red"},{druid:"fr853pn6519",image_url:"https://stacks.stanford.edu/image/iiif/fr853pn6519%2Ffr853pn6519_0001/info.json",number:"419",publisher:"Welte-Mignon",title:"Chopin/Albert - Polonaise op. 53, a flat",type:"welte-red"},{druid:"pj688nx2384",image_url:"https://stacks.stanford.edu/image/iiif/pj688nx2384%2Fpj688nx2384_0001/info.json",number:"1464",publisher:"Welte-Mignon",title:"Chopin/Bloomfield-Zeisler - Scherzo b-moll",type:"welte-red"},{druid:"fh358rd2268",image_url:"https://stacks.stanford.edu/image/iiif/fh358rd2268%2Ffh358rd2268_0001/info.json",number:"2586",publisher:"Welte-Mignon",title:"Chopin/Bloomfield-Zeisler - Sonata op. 35, b minor: Part 1",type:"welte-red"},{druid:"kw738fg7467",image_url:"https://stacks.stanford.edu/image/iiif/kw738fg7467%2Fkw738fg7467_0001/info.json",number:"2588",publisher:"Welte-Mignon",title:"Chopin/Bloomfield-Zeisler - Sonata op. 35: Funeralmarch and Presto",type:"welte-red"},{druid:"zw904vm6502",image_url:"https://stacks.stanford.edu/image/iiif/zw904vm6502%2Fzw904vm6502_0001/info.json",number:"1465",publisher:"Welte-Mignon",title:"Chopin/Bloomfield-Zeisler - Waltz, op. 70, no. 1",type:"welte-red"},{druid:"wz719qg6993",image_url:"https://stacks.stanford.edu/image/iiif/wz719qg6993%2Fwz719qg6993_0001/info.json",number:"441",publisher:"Welte-Mignon",title:"Chopin/Busoni - Nocturne op. 15, no. 2, fis-dur",type:"welte-red"},{druid:"gc795vb4435",image_url:"https://stacks.stanford.edu/image/iiif/gc795vb4435%2Fgc795vb4435_0001/info.json",number:"1319",publisher:"Welte-Mignon",title:"Chopin/Busoni - Prelude op. 28, nr. 15, d flat",type:"welte-red"},{druid:"sn610pr8684",image_url:"https://stacks.stanford.edu/image/iiif/sn610pr8684%2Fsn610pr8684_0001/info.json",number:"3184",publisher:"Welte-Mignon",title:"Chopin/Carreras - Preludes: No. 3, G major; No. 6, B minor",type:"welte-red"},{druid:"bj606rp8160",image_url:"https://stacks.stanford.edu/image/iiif/bj606rp8160%2Fbj606rp8160_0001/info.json",number:"367",publisher:"Welte-Mignon",title:"Chopin/Carreño - Ballade op. 23, g minor",type:"welte-red"},{druid:"rj799hj0968",image_url:"https://stacks.stanford.edu/image/iiif/rj799hj0968%2Frj799hj0968_0001/info.json",number:"364",publisher:"Welte-Mignon",title:"Chopin/Carreño - Nocturne g major, op. 37, no. 2",type:"welte-red"},{druid:"st828pc9818",image_url:"https://stacks.stanford.edu/image/iiif/st828pc9818%2Fst828pc9818_0001/info.json",number:"364",publisher:"Welte-Mignon",title:"Chopin/Carreño - Nocturne op. 37, no. 2, g major",type:"welte-red"},{druid:"gs556hk6631",image_url:"https://stacks.stanford.edu/image/iiif/gs556hk6631%2Fgs556hk6631_0001/info.json",number:"366",publisher:"Welte-Mignon",title:"Chopin/Carreño - Nocturne op. 48, no. 1, c minor",type:"welte-red"},{druid:"wg598sj1504",image_url:"https://stacks.stanford.edu/image/iiif/wg598sj1504%2Fwg598sj1504_0001/info.json",number:"2621",publisher:"Welte-Mignon",title:"Chopin/Di Benici - Etude ges dur, op. 10, no. 5: (Schwarze Tasten)",type:"welte-red"},{druid:"jm300wy4714",image_url:"https://stacks.stanford.edu/image/iiif/jm300wy4714%2Fjm300wy4714_0001/info.json",number:"2622",publisher:"Welte-Mignon",title:"Chopin/Di Benici - Prelude op. 28, no. 18, f minor",type:"welte-red"},{druid:"nf733yv1324",image_url:"https://stacks.stanford.edu/image/iiif/nf733yv1324%2Fnf733yv1324_0001/info.json",number:"498",publisher:"Welte-Mignon",title:"Chopin/Dohnányi - Valse op. 64, no. 2, cis-moll",type:"welte-red"},{druid:"kv601my2750",image_url:"https://stacks.stanford.edu/image/iiif/kv601my2750%2Fkv601my2750_0001/info.json",number:"1077",publisher:"Welte-Mignon",title:"Chopin/Esipova - Prelude, a flat major",type:"welte-red"},{druid:"gs573tj9547",image_url:"https://stacks.stanford.edu/image/iiif/gs573tj9547%2Fgs573tj9547_0001/info.json",number:"1328",publisher:"Welte-Mignon",title:"Chopin/Fryer - Preludes op. 28, nos. 6 & 11",type:"welte-red"},{druid:"mj416dn1432",image_url:"https://stacks.stanford.edu/image/iiif/mj416dn1432%2Fmj416dn1432_0001/info.json",number:"594",publisher:"Welte-Mignon",title:"Chopin/Galston - Etude op. 10, no. 12: (Revolutions-Etude)",type:"welte-red"},{druid:"qf640sj3141",image_url:"https://stacks.stanford.edu/image/iiif/qf640sj3141%2Fqf640sj3141_0001/info.json",number:"2159",publisher:"Welte-Mignon",title:"Chopin/Goraïnoff - Concert e-moll, op. 11: 1. Teil",type:"welte-red"},{druid:"bs279zc9206",image_url:"https://stacks.stanford.edu/image/iiif/bs279zc9206%2Fbs279zc9206_0001/info.json",number:"2160",publisher:"Welte-Mignon",title:"Chopin/Goraïnoff - Concerto e minor: Part II",type:"welte-red"},{druid:"yk477xx5343",image_url:"https://stacks.stanford.edu/image/iiif/yk477xx5343%2Fyk477xx5343_0001/info.json",number:"2161",publisher:"Welte-Mignon",title:"Chopin/Goraïnoff - Concerto op. 11, e minor: 3rd movement",type:"welte-red"},{druid:"gg384dv5303",image_url:"https://stacks.stanford.edu/image/iiif/gg384dv5303%2Fgg384dv5303_0001/info.json",number:"194",publisher:"Welte-Mignon",title:"Chopin/Grünfeld - Nocturne h-dur op. 32",type:"welte-red"},{druid:"wj177bx9196",image_url:"https://stacks.stanford.edu/image/iiif/wj177bx9196%2Fwj177bx9196_0001/info.json",number:"931",publisher:"Welte-Mignon",title:"Chopin/Hambourg - Mazurka a-moll: (posthume)",type:"welte-red"},{druid:"vs167qc5364",image_url:"https://stacks.stanford.edu/image/iiif/vs167qc5364%2Fvs167qc5364_0001/info.json",number:"668",publisher:"Welte-Mignon",title:"Chopin/Hofmann - Nocturne, d flat major, op. 27, no. 2",type:"welte-red"},{druid:"qq244fh1388",image_url:"https://stacks.stanford.edu/image/iiif/qq244fh1388%2Fqq244fh1388_0001/info.json",number:"669",publisher:"Welte-Mignon",title:"Chopin/Hofmann - Polonaise op. 44, fis-moll",type:"welte-red"},{druid:"xm418xm6937",image_url:"https://stacks.stanford.edu/image/iiif/xm418xm6937%2Fxm418xm6937_0001/info.json",number:"3976",publisher:"Welte-Mignon",title:"Chopin/Koczalski - Concerto op. 11, e minor, 1st movement: Allegro maestoso",type:"welte-red"},{druid:"nf274ng7905",image_url:"https://stacks.stanford.edu/image/iiif/nf274ng7905%2Fnf274ng7905_0001/info.json",number:"209",publisher:"Welte-Mignon",title:"Chopin/Krah - Nocturne op. 55, no. 2, e flat major",type:"welte-red"},{druid:"kt780tm7975",image_url:"https://stacks.stanford.edu/image/iiif/kt780tm7975%2Fkt780tm7975_0001/info.json",number:"568",publisher:"Welte-Mignon",title:"Chopin/Lamond - Valse op. 70",type:"welte-red"},{druid:"bm016sg7202",image_url:"https://stacks.stanford.edu/image/iiif/bm016sg7202%2Fbm016sg7202_0001/info.json",number:"1671",publisher:"Welte-Mignon",title:"Chopin/Margolies - Polonaise: (polonaise militaire): op. 40, no. 1",type:"welte-red"},{druid:"ym117yd8356",image_url:"https://stacks.stanford.edu/image/iiif/ym117yd8356%2Fym117yd8356_0001/info.json",number:"1670",publisher:"Welte-Mignon",title:"Chopin/Margolies - Sonata b-moll, op. 35: Parts 2, 3, & 4",type:"welte-red"},{druid:"xc665jf8254",image_url:"https://stacks.stanford.edu/image/iiif/xc665jf8254%2Fxc665jf8254_0001/info.json",number:"719",publisher:"Welte-Mignon",title:"Chopin/Motta - Scherzo e-dur, op. 54",type:"welte-red"},{druid:"ky458kj7325",image_url:"https://stacks.stanford.edu/image/iiif/ky458kj7325%2Fky458kj7325_0001/info.json",number:"2882",publisher:"Welte-Mignon",title:"Chopin/Novaes - Ballade, op. 47, a major",type:"welte-red"},{druid:"wq296df7434",image_url:"https://stacks.stanford.edu/image/iiif/wq296df7434%2Fwq296df7434_0001/info.json",number:"1212",publisher:"Welte-Mignon",title:"Chopin/Pachmann - Prelude op. 28, no. 16, b-flat minor",type:"welte-red"},{druid:"fn111kx0654",image_url:"https://stacks.stanford.edu/image/iiif/fn111kx0654%2Ffn111kx0654_0001/info.json",number:"1213",publisher:"Welte-Mignon",title:"Chopin/Pachmann - Prélude op. 28, no. 20, c-moll",type:"welte-red"},{druid:"cw078rn1143",image_url:"https://stacks.stanford.edu/image/iiif/cw078rn1143%2Fcw078rn1143_0001/info.json",number:"1220",publisher:"Welte-Mignon",title:"Chopin/Pachmann - Waltz, d flat major, op. 64, no. 1",type:"welte-red"},{druid:"hc229ht1024",image_url:"https://stacks.stanford.edu/image/iiif/hc229ht1024%2Fhc229ht1024_0001/info.json",number:"1249",publisher:"Welte-Mignon",title:"Chopin/Paderewski - Ballade op. 47, a flat major",type:"welte-red"},{druid:"qv334zb6243",image_url:"https://stacks.stanford.edu/image/iiif/qv334zb6243%2Fqv334zb6243_0001/info.json",number:"1254",publisher:"Welte-Mignon",title:"Chopin/Paderewski - Etude e-dur, op. 10, no. 3",type:"welte-red"},{druid:"ft746ns5736",image_url:"https://stacks.stanford.edu/image/iiif/ft746ns5736%2Fft746ns5736_0001/info.json",number:"1253",publisher:"Welte-Mignon",title:"Chopin/Paderewski - Etude op. 25, no. 9, g flat",type:"welte-red"},{druid:"sm246yb9650",image_url:"https://stacks.stanford.edu/image/iiif/sm246yb9650%2Fsm246yb9650_0001/info.json",number:"1256",publisher:"Welte-Mignon",title:"Chopin/Paderewski - Polonaise a flat major, op. 53",type:"welte-red"},{druid:"zc614qh7060",image_url:"https://stacks.stanford.edu/image/iiif/zc614qh7060%2Fzc614qh7060_0001/info.json",number:"545",publisher:"Welte-Mignon",title:"Chopin/Pugno - Grande polonaise: op. 22, Es-Dur",type:"welte-red"},{druid:"vm423wb2944",image_url:"https://stacks.stanford.edu/image/iiif/vm423wb2944%2Fvm423wb2944_0001/info.json",number:"548",publisher:"Welte-Mignon",title:"Chopin/Pugno - Nocturn op. 15, no. 2, fis-dur",type:"welte-red"},{druid:"bj021jc9795",image_url:"https://stacks.stanford.edu/image/iiif/bj021jc9795%2Fbj021jc9795_0001/info.json",number:"328",publisher:"Welte-Mignon",title:"Chopin/Reisenauer - Berceuse",type:"welte-red"},{druid:"mv259zt7103",image_url:"https://stacks.stanford.edu/image/iiif/mv259zt7103%2Fmv259zt7103_0001/info.json",number:"325",publisher:"Welte-Mignon",title:"Chopin/Reisenauer - Chant polonais: (Des Mädchens Wunsch)",type:"welte-red"},{druid:"tx963yw9164",image_url:"https://stacks.stanford.edu/image/iiif/tx963yw9164%2Ftx963yw9164_0001/info.json",number:"807",publisher:"Welte-Mignon",title:"Chopin/Saint-Saëns - Nocturne f sharp, op. 15, no. 2",type:"welte-red"},{druid:"dw559kr7002",image_url:"https://stacks.stanford.edu/image/iiif/dw559kr7002%2Fdw559kr7002_0001/info.json",number:"1472",publisher:"Welte-Mignon",title:"Chopin/Samaroff Stokowski - Sonata b minor: 1st and 2nd movement",type:"welte-red"},{druid:"wz252pk3255",image_url:"https://stacks.stanford.edu/image/iiif/wz252pk3255%2Fwz252pk3255_0001/info.json",number:"1473",publisher:"Welte-Mignon",title:"Chopin/Samaroff Stokowski - Sonata b minor: 3rd and 4th movement",type:"welte-red"},{druid:"ch197br4742",image_url:"https://stacks.stanford.edu/image/iiif/ch197br4742%2Fch197br4742_0001/info.json",number:"881",publisher:"Welte-Mignon",title:"Chopin/Sauer - Etude op. 25, no. 9: (staccato)",type:"welte-red"},{druid:"rp390kt0160",image_url:"https://stacks.stanford.edu/image/iiif/rp390kt0160%2Frp390kt0160_0001/info.json",number:"879",publisher:"Welte-Mignon",title:"Chopin/Sauer - Nocturne des-dur, op. 27, no. 2",type:"welte-red"},{druid:"vy018tw5237",image_url:"https://stacks.stanford.edu/image/iiif/vy018tw5237%2Fvy018tw5237_0001/info.json",number:"245",publisher:"Welte-Mignon",title:"Chopin/Scharwenka - Valse op. 42 as-dur",type:"welte-red"},{druid:"kg488qt3887",image_url:"https://stacks.stanford.edu/image/iiif/kg488qt3887%2Fkg488qt3887_0001/info.json",number:"1447",publisher:"Welte-Mignon",title:"Chopin/Schelling - 2 préludes: op. 28, Nr. 1, C-Dur u. Nr. 21, B-Dur",type:"welte-red"},{druid:"jg886ps8946",image_url:"https://stacks.stanford.edu/image/iiif/jg886ps8946%2Fjg886ps8946_0001/info.json",number:"1445",publisher:"Welte-Mignon",title:"Chopin/Schelling - Etude op. 10, no. 10, a flat",type:"welte-green"},{druid:"pz175wg5571",image_url:"https://stacks.stanford.edu/image/iiif/pz175wg5571%2Fpz175wg5571_0001/info.json",number:"1447",publisher:"Welte-Mignon",title:"Chopin/Schelling - Préludes, op. 28, no. 1, c major, op. 28, no. 21, b flat",type:"welte-red"},{druid:"st755cm2486",image_url:"https://stacks.stanford.edu/image/iiif/st755cm2486%2Fst755cm2486_0001/info.json",number:"390",publisher:"Welte-Mignon",title:"Chopin/Schnabel - Etude op. 10, no. 5, ges-dur",type:"welte-red"},{druid:"ww627mg3287",image_url:"https://stacks.stanford.edu/image/iiif/ww627mg3287%2Fww627mg3287_0001/info.json",number:"1035",publisher:"Welte-Mignon",title:"Chopin/Stavenhagen - Chant polonaise: Ges-Dur: (nach persönlichen Erinnerungen)",type:"welte-red"},{druid:"kv921kh0629",image_url:"https://stacks.stanford.edu/image/iiif/kv921kh0629%2Fkv921kh0629_0001/info.json",number:"1039",publisher:"Welte-Mignon",title:"Chopin/Stavenhagen - Valse op. 69, no. 1, as-dur",type:"welte-red"},{druid:"jh069yf5255",image_url:"https://stacks.stanford.edu/image/iiif/jh069yf5255%2Fjh069yf5255_0001/info.json",number:"704",publisher:"Welte-Mignon",title:"Chopin/Wurmser - Waltz op. 64, no. 2, c-sharp minor",type:"welte-red"},{druid:"vy941zv8672",image_url:"https://stacks.stanford.edu/image/iiif/vy941zv8672%2Fvy941zv8672_0001/info.json",number:"470",publisher:"Welte-Mignon",title:"Chopin/Zadora - Preludes: Nos. 2, 4, 9, 13 and 22",type:"welte-red"},{druid:"vc943nk4921",image_url:"https://stacks.stanford.edu/image/iiif/vc943nk4921%2Fvc943nk4921_0002/info.json",number:"4319",publisher:"Princesa",title:"Chueca - La Alegría de la huerta: selecciones",type:"88-note"},{druid:"rh357hg0211",image_url:"https://stacks.stanford.edu/image/iiif/rh357hg0211%2Frh357hg0211_0002/info.json",number:"4301",publisher:"Princesa",title:"Clará - Modern pericón",type:"88-note"},{druid:"kz454tt7354",image_url:"https://stacks.stanford.edu/image/iiif/kz454tt7354%2Fkz454tt7354_0002/info.json",number:"4629",publisher:"Princesa",title:"Clará - Qué mujer, qué mujer!: vals de la Revista Bis Bis",type:"88-note"},{druid:"cg834ff4729",image_url:"https://stacks.stanford.edu/image/iiif/cg834ff4729%2Fcg834ff4729_0001/info.json",number:"3647",publisher:"Welte-Mignon",title:"Cuvillier/Heineck - Lilac domino: hesitation waltz",type:"welte-red"},{druid:"wn516xn5163",image_url:"https://stacks.stanford.edu/image/iiif/wn516xn5163%2Fwn516xn5163_0001/info.json",number:"2430",publisher:"Welte-Mignon",title:"Czerny/Lhévinne - Oktavenetude: op. 740, no. 5",type:"welte-red"},{druid:"rq642tt1626",image_url:"https://stacks.stanford.edu/image/iiif/rq642tt1626%2Frq642tt1626_0001/info.json",number:"2580",publisher:"Welte-Mignon",title:"D'Egville/D'Egville - A Canadian rondo: a passing-fancy",type:"welte-red"},{druid:"wp666fn2104",image_url:"https://stacks.stanford.edu/image/iiif/wp666fn2104%2Fwp666fn2104_0001/info.json",number:"5537",publisher:"Welte-Mignon",title:"Daly/Coach - Oh gee! oh gosh!: from Stop flirting: fox-trot",type:"welte-red"},{druid:"jh696my0069",image_url:"https://stacks.stanford.edu/image/iiif/jh696my0069%2Fjh696my0069_0001/info.json",number:"1765",publisher:"Welte-Mignon",title:"Debussy/Buhlig - Poissons d'or",type:"welte-red"},{druid:"dc920rk8870",image_url:"https://stacks.stanford.edu/image/iiif/dc920rk8870%2Fdc920rk8870_0001/info.json",number:"2733",publisher:"Welte-Mignon",title:"Debussy/Debussy - Children's corner",type:"welte-red"},{druid:"ws250sr1272",image_url:"https://stacks.stanford.edu/image/iiif/ws250sr1272%2Fws250sr1272_0001/info.json",number:"2739",publisher:"Welte-Mignon",title:"Debussy/Debussy - Preludes: Le vent dans la plaine; Minstrels",type:"welte-red"},{druid:"tq268fs9721",image_url:"https://stacks.stanford.edu/image/iiif/tq268fs9721%2Ftq268fs9721_0001/info.json",number:"3045",publisher:"Welte-Mignon",title:"Debussy/Ganz - Preludes: La fille aux cheveux de lin; La puerto del vino",type:"welte-red"},{druid:"dw005gw3358",image_url:"https://stacks.stanford.edu/image/iiif/dw005gw3358%2Fdw005gw3358_0001/info.json",number:"1450",publisher:"Welte-Mignon",title:"Debussy/Schelling - La Soirée dane granade",type:"welte-red"},{druid:"rg591sj4242",image_url:"https://stacks.stanford.edu/image/iiif/rg591sj4242%2Frg591sj4242_0001/info.json",number:"1451",publisher:"Welte-Mignon",title:"Debussy/Schelling - Toccata",type:"welte-red"},{druid:"bs533ns1949",image_url:"https://stacks.stanford.edu/image/iiif/bs533ns1949%2Fbs533ns1949_0001/info.json",number:"3398",publisher:"Welte-Mignon",title:'Delibes-Dohnányi/Blumen - "naïla": Walzer',type:"welte-red"},{druid:"xn585zh2707",image_url:"https://stacks.stanford.edu/image/iiif/xn585zh2707%2Fxn585zh2707_0001/info.json",number:"2805",publisher:"Welte-Mignon",title:"Delibes/Gayraud - Lakmé: Fantasie I",type:"welte-red"},{druid:"fz632cv0288",image_url:"https://stacks.stanford.edu/image/iiif/fz632cv0288%2Ffz632cv0288_0001/info.json",number:"1828",publisher:"Welte-Mignon",title:"Dohnányi/Mero - Rhapsody, c major, op. 11, no. 3",type:"welte-red"},{druid:"bp952tr1116",image_url:"https://stacks.stanford.edu/image/iiif/bp952tr1116%2Fbp952tr1116_0001/info.json",number:"399",publisher:"Welte-Mignon",title:"Dohnányi/Weiss - Ii rhapsodie op. 11",type:"welte-red"},{druid:"xy699sy1462",image_url:"https://stacks.stanford.edu/image/iiif/xy699sy1462%2Fxy699sy1462_0001/info.json",number:"1324",publisher:"Welte-Mignon",title:"Dvořák/Fryer - Humoreske op. 10, no. 7",type:"welte-red"},{druid:"dy191sv5188",image_url:"https://stacks.stanford.edu/image/iiif/dy191sv5188%2Fdy191sv5188_0001/info.json",number:"2261",publisher:"Welte-Mignon",title:"Epstein/Epstein - Wiener walzer",type:"welte-red"},{druid:"nt812xg8796",image_url:"https://stacks.stanford.edu/image/iiif/nt812xg8796%2Fnt812xg8796_0001/info.json",number:"3567",publisher:"Welte-Mignon",title:"Europe/Europe - Castle house rag: one-step",type:"welte-red"},{druid:"mv647hz9361",image_url:"https://stacks.stanford.edu/image/iiif/mv647hz9361%2Fmv647hz9361_0001/info.json",number:"5669",publisher:"Welte-Mignon",title:"Fall/Black - Sergeant percy: one-step",type:"welte-red"},{druid:"qk926qc7779",image_url:"https://stacks.stanford.edu/image/iiif/qk926qc7779%2Fqk926qc7779_0001/info.json",number:"5728",publisher:"Welte-Mignon",title:"Fall/Haass - Was machst du mit dem knie, lieber hans?: paso doble",type:"welte-red"},{druid:"hj604wr7502",image_url:"https://stacks.stanford.edu/image/iiif/hj604wr7502%2Fhj604wr7502_0001/info.json",number:"1526",publisher:"Welte-Mignon",title:'Fall/Utz - Potpourri aus "der fidele bauer"',type:"welte-red"},{druid:"mw139zj5450",image_url:"https://stacks.stanford.edu/image/iiif/mw139zj5450%2Fmw139zj5450_0002/info.json",number:"4420",publisher:"Aeolian",title:"Font y de Anta - El Organillo y... yo: schotish",type:"88-note"},{druid:"jt036qh8967",image_url:"https://stacks.stanford.edu/image/iiif/jt036qh8967%2Fjt036qh8967_0001/info.json",number:"3549",publisher:"Welte-Mignon",title:"Foster/Merrigan - Old black joe: Old folks at home: (way upon the Swanee River)",type:"welte-red"},{druid:"xz373zg4809",image_url:"https://stacks.stanford.edu/image/iiif/xz373zg4809%2Fxz373zg4809_0002/info.json",number:"40.007",publisher:"Princesa",title:"Franco Ribate - Gitanillo de triana: pasodoble",type:"88-note"},{druid:"vd312rr8990",image_url:"https://stacks.stanford.edu/image/iiif/vd312rr8990%2Fvd312rr8990_0001/info.json",number:"3568",publisher:"Welte-Mignon",title:'Friml/Europe - Ting-a-ling-a-ling: (from "High Jinks")',type:"welte-red"},{druid:"zk082zq3962",image_url:"https://stacks.stanford.edu/image/iiif/zk082zq3962%2Fzk082zq3962_0001/info.json",number:"5707",publisher:"Welte-Mignon",title:'Friml/Johnson - Rose marie: fox-trot: from the musical play "Rose Marie"',type:"welte-red"},{druid:"kz819wb8990",image_url:"https://stacks.stanford.edu/image/iiif/kz819wb8990%2Fkz819wb8990_0001/info.json",number:"3505",publisher:"Welte-Mignon",title:'Friml/Savino - Sympathy: (waltz song): from the comedy-opera "The Firefly"',type:"welte-red"},{druid:"wq696jd1149",image_url:"https://stacks.stanford.edu/image/iiif/wq696jd1149%2Fwq696jd1149_0002/info.json",number:"4663",publisher:"Princesa",title:"Fugazot - Barrio reo: tango",type:"88-note"},{druid:"zn339mg3395",image_url:"https://stacks.stanford.edu/image/iiif/zn339mg3395%2Fzn339mg3395_0001/info.json",number:"297",publisher:"Welte-Mignon",title:"Gabrilowitsch/Gabrilowitsch - Caprice-burlesque op. 3",type:"welte-red"},{druid:"dk418xy4378",image_url:"https://stacks.stanford.edu/image/iiif/dk418xy4378%2Fdk418xy4378_0002/info.json",number:"4668",publisher:"Princesa",title:"García Ibáñez - Félix rodríguez: Pasodoble flamenco",type:"88-note"},{druid:"qd424rx3516",image_url:"https://stacks.stanford.edu/image/iiif/qd424rx3516%2Fqd424rx3516_0001/info.json",number:"3671",publisher:"Welte-Mignon",title:"German/La Forge - Three dances from henry viii",type:"welte-red"},{druid:"ry050yb9492",image_url:"https://stacks.stanford.edu/image/iiif/ry050yb9492%2Fry050yb9492_0001/info.json",number:"2525",publisher:"Welte-Mignon",title:"Gilbert/Ebenstein - Die Keusche susanna: Potpourri",type:"welte-red"},{druid:"zm791gz4425",image_url:"https://stacks.stanford.edu/image/iiif/zm791gz4425%2Fzm791gz4425_0002/info.json",number:"4490",publisher:"Princesa",title:"Giménez - El Barbero de sevilla: (zarzuela española): selecciones",type:"88-note"},{druid:"qd454gb9111",image_url:"https://stacks.stanford.edu/image/iiif/qd454gb9111%2Fqd454gb9111_0002/info.json",number:"4514",publisher:"Princesa",title:"Giménez - La Tempranica: selecciones",type:"88-note"},{druid:"fn744pq2157",image_url:"https://stacks.stanford.edu/image/iiif/fn744pq2157%2Ffn744pq2157_0001/info.json",number:"1990",publisher:"Welte-Mignon",title:"Glazunov-Blumenfeld/Lemba - Grande valse de concert: op. 47, D major",type:"welte-red"},{druid:"nz678zw1579",image_url:"https://stacks.stanford.edu/image/iiif/nz678zw1579%2Fnz678zw1579_0001/info.json",number:"1939",publisher:"Welte-Mignon",title:"Glazunov/Glazunov - 1. sonata op. 74, b flat: 2nd movement, Andante",type:"welte-red"},{druid:"dq276yn8963",image_url:"https://stacks.stanford.edu/image/iiif/dq276yn8963%2Fdq276yn8963_0001/info.json",number:"1945",publisher:"Welte-Mignon",title:"Glazunov/Glazunov - Les Saisons, ballet",type:"welte-red"},{druid:"vs880hb3425",image_url:"https://stacks.stanford.edu/image/iiif/vs880hb3425%2Fvs880hb3425_0001/info.json",number:"1942",publisher:"Welte-Mignon",title:"Glazunov/Glazunov - Raymonda",type:"welte-red"},{druid:"kx293yk2859",image_url:"https://stacks.stanford.edu/image/iiif/kx293yk2859%2Fkx293yk2859_0001/info.json",number:"1996",publisher:"Welte-Mignon",title:"Glazunov/Hoffmann - Theme and variations, f sharp minor",type:"welte-red"},{druid:"kq892pn7618",image_url:"https://stacks.stanford.edu/image/iiif/kq892pn7618%2Fkq892pn7618_0001/info.json",number:"1968",publisher:"Welte-Mignon",title:"Glazunov/Kimontt-Jacynowa - Grand valse de concert: op. 41",type:"welte-red"},{druid:"xb072rc7617",image_url:"https://stacks.stanford.edu/image/iiif/xb072rc7617%2Fxb072rc7617_0001/info.json",number:"4028",publisher:"Welte-Mignon",title:"Gomes/Haass - Il Guarany: fantasie",type:"welte-red"},{druid:"hj502vv5162",image_url:"https://stacks.stanford.edu/image/iiif/hj502vv5162%2Fhj502vv5162_0001/info.json",number:"B-6294",publisher:"De Luxe",title:"Gottschalk/Hart - Ricordati",type:"welte-licensee"},{druid:"jy277ht0636",image_url:"https://stacks.stanford.edu/image/iiif/jy277ht0636%2Fjy277ht0636_0001/info.json",number:"1819",publisher:"Welte-Mignon",title:"Gottschalk/Utz - The Last hope: (meditation réligieuse)",type:"welte-red"},{druid:"xq762nt7491",image_url:"https://stacks.stanford.edu/image/iiif/xq762nt7491%2Fxq762nt7491_0001/info.json",number:"26",publisher:"Welte-Mignon",title:"Gounod-Liszt/Adam-Benard - Faust-walzer",type:"welte-red"},{druid:"hm373bm3807",image_url:"https://stacks.stanford.edu/image/iiif/hm373bm3807%2Fhm373bm3807_0001/info.json",number:"57",publisher:"Welte-Mignon",title:"Gounod/Adam-Benard - Faust prelude",type:"welte-red"},{druid:"py987gg6088",image_url:"https://stacks.stanford.edu/image/iiif/py987gg6088%2Fpy987gg6088_0001/info.json",number:"57",publisher:"Welte-Mignon",title:"Gounod/Adam-Benard - Faust prelude",type:"welte-red"},{druid:"hr679fk5315",image_url:"https://stacks.stanford.edu/image/iiif/hr679fk5315%2Fhr679fk5315_0001/info.json",number:"2172",publisher:"Welte-Mignon",title:"Gounod/Adam-Benard - Nazareth: sacred song",type:"welte-red"},{druid:"rg931dy5023",image_url:"https://stacks.stanford.edu/image/iiif/rg931dy5023%2Frg931dy5023_0001/info.json",number:"2944",publisher:"Welte-Mignon",title:"Gounod/Cor de Las - Faust reminiscenzen a. d. iii. und iv. akt",type:"welte-red"},{druid:"sj582bt2976",image_url:"https://stacks.stanford.edu/image/iiif/sj582bt2976%2Fsj582bt2976_0001/info.json",number:"2799",publisher:"Welte-Mignon",title:"Gounod/Gayraud - Faust: Selection I",type:"welte-red"},{druid:"gs012fx5529",image_url:"https://stacks.stanford.edu/image/iiif/gs012fx5529%2Fgs012fx5529_0001/info.json",number:"1343",publisher:"Welte-Mignon",title:"Gounod/Starke - Romeo and juliette: potpourri",type:"welte-red"},{druid:"nw765mr4994",image_url:"https://stacks.stanford.edu/image/iiif/nw765mr4994%2Fnw765mr4994_0001/info.json",number:"3790",publisher:"Welte-Mignon",title:'Grainger/Haass - British folkmusic: Settings Nr. 4: "Shepherd\'s hey"',type:"welte-red"},{druid:"qv976bq3639",image_url:"https://stacks.stanford.edu/image/iiif/qv976bq3639%2Fqv976bq3639_0001/info.json",number:"3791",publisher:"Welte-Mignon",title:"Grainger/Haass - British folkmusic: Settings Nr. 6: Irish tune from County Derry",type:"welte-red"},{druid:"df354sy6634",image_url:"https://stacks.stanford.edu/image/iiif/df354sy6634%2Fdf354sy6634_0001/info.json",number:"3379",publisher:"Welte-Mignon",title:"Grieg/Berend - Peer gynt ii, op. 55, no. 4: Solvejgs Lied",type:"welte-green"},{druid:"jw822wm2644",image_url:"https://stacks.stanford.edu/image/iiif/jw822wm2644%2Fjw822wm2644_0001/info.json",number:"1275",publisher:"Welte-Mignon",title:"Grieg/Grieg - Butterfly: op. 43, no. 1",type:"welte-red"},{druid:"mh255vw4599",image_url:"https://stacks.stanford.edu/image/iiif/mh255vw4599%2Fmh255vw4599_0001/info.json",number:"1276",publisher:"Welte-Mignon",title:"Grieg/Grieg - Norwegischer brautzug im vorüberziehen",type:"welte-red"},{druid:"zf882fv0052",image_url:"https://stacks.stanford.edu/image/iiif/zf882fv0052%2Fzf882fv0052_0001/info.json",number:"1277",publisher:"Welte-Mignon",title:"Grieg/Grieg - Vögelein a. lyrische stücke, op. 43",type:"welte-red"},{druid:"kj344bw3083",image_url:"https://stacks.stanford.edu/image/iiif/kj344bw3083%2Fkj344bw3083_0001/info.json",number:"1307",publisher:"Welte-Mignon",title:"Grieg/Pugno - An Den frühling: op. 43, no. 1: (Lyrische Stücke)",type:"welte-red"},{druid:"yr522jf5585",image_url:"https://stacks.stanford.edu/image/iiif/yr522jf5585%2Fyr522jf5585_0001/info.json",number:"1478",publisher:"Welte-Mignon",title:"Grieg/Samaroff Stokowski - Concerto a minor, op. 16",type:"welte-red"},{druid:"ym773gh2267",image_url:"https://stacks.stanford.edu/image/iiif/ym773gh2267%2Fym773gh2267_0001/info.json",number:"1478",publisher:"Welte-Mignon",title:"Grieg/Samaroff Stokowski - Concerto a minor: 1st movement",type:"welte-red"},{druid:"bf644yy6536",image_url:"https://stacks.stanford.edu/image/iiif/bf644yy6536%2Fbf644yy6536_0001/info.json",number:"1480",publisher:"Welte-Mignon",title:"Grieg/Samaroff Stokowski - Peer gynt suite ii",type:"welte-red"},{druid:"vz717bq6543",image_url:"https://stacks.stanford.edu/image/iiif/vz717bq6543%2Fvz717bq6543_0001/info.json",number:"1480",publisher:"Welte-Mignon",title:"Grieg/Samaroff Stokowski - Peer gynt suite: No. 1",type:"welte-red"},{druid:"hk155fw7898",image_url:"https://stacks.stanford.edu/image/iiif/hk155fw7898%2Fhk155fw7898_0001/info.json",number:"1005",publisher:"Welte-Mignon",title:"Grieg/Stebel - Schmetterling",type:"welte-red"},{druid:"hs635sh6729",image_url:"https://stacks.stanford.edu/image/iiif/hs635sh6729%2Fhs635sh6729_0001/info.json",number:"378",publisher:"Welte-Mignon",title:"Grieg/Wendling - Hochzeitstag auf troldhangen op. 65 no. 1",type:"welte-red"},{druid:"km927sd2616",image_url:"https://stacks.stanford.edu/image/iiif/km927sd2616%2Fkm927sd2616_0002/info.json",number:"4323",publisher:"Caecilia",title:"Guerrero - Don quintín el amargao: Java",type:"88-note"},{druid:"gn803sk7089",image_url:"https://stacks.stanford.edu/image/iiif/gn803sk7089%2Fgn803sk7089_0002/info.json",number:"5404",publisher:"Princesa",title:"Guerrero - El Huésped del sevillano: Lagarteranas",type:"88-note"},{druid:"vk572hg6636",image_url:"https://stacks.stanford.edu/image/iiif/vk572hg6636%2Fvk572hg6636_0002/info.json",number:"4540",publisher:"Princesa",title:"Guerrero - El Sobre verde: Bombones de chocolate",type:"88-note"},{druid:"hx789sg2918",image_url:"https://stacks.stanford.edu/image/iiif/hx789sg2918%2Fhx789sg2918_0001/info.json",number:"3376",publisher:"Welte-Mignon",title:"Halévy/Berend - Die Jüdin",type:"welte-red"},{druid:"sw740gd4329",image_url:"https://stacks.stanford.edu/image/iiif/sw740gd4329%2Fsw740gd4329_0001/info.json",number:"76",publisher:"Welte-Mignon",title:"Handel/Adam-Benard - Largo",type:"welte-red"},{druid:"hx184ww0780",image_url:"https://stacks.stanford.edu/image/iiif/hx184ww0780%2Fhx184ww0780_0001/info.json",number:"10",publisher:"Welte-Mignon",title:"Handel/Adam-Benard - The Harmonius blacksmith: E major, 5th suite = Le forgeron harmonieux",type:"welte-red"},{druid:"cw965qx3168",image_url:"https://stacks.stanford.edu/image/iiif/cw965qx3168%2Fcw965qx3168_0001/info.json",number:"5661",publisher:"Welte-Mignon",title:"Henderson/Johnson - Follow the swallow: fox-trot",type:"welte-red"},{druid:"fb623cd1247",image_url:"https://stacks.stanford.edu/image/iiif/fb623cd1247%2Ffb623cd1247_0001/info.json",number:"1654",publisher:"Welte-Mignon",title:"Henselt/Cory - Si oiseau j'étais",type:"welte-red"},{druid:"sc787kg5664",image_url:"https://stacks.stanford.edu/image/iiif/sc787kg5664%2Fsc787kg5664_0001/info.json",number:"1654",publisher:"Welte-Mignon",title:"Henselt/Cory - Si oiseau j'étais",type:"welte-red"},{druid:"kr645mg0298",image_url:"https://stacks.stanford.edu/image/iiif/kr645mg0298%2Fkr645mg0298_0001/info.json",number:"1405",publisher:"Welte-Mignon",title:"Holzmann/Orlando - Love land",type:"welte-red"},{druid:"sb388kg1678",image_url:"https://stacks.stanford.edu/image/iiif/sb388kg1678%2Fsb388kg1678_0002/info.json",number:"40019",publisher:"Princesa",title:"Hoyos - El Carrerito: tango argentino",type:"88-note"},{druid:"rt308hy9235",image_url:"https://stacks.stanford.edu/image/iiif/rt308hy9235%2Frt308hy9235_0001/info.json",number:"646",publisher:"Welte-Mignon",title:"Humperdinck/Humperdinck - Traumscene a. hänsel und gretel",type:"welte-red"},{druid:"fb100cb2366",image_url:"https://stacks.stanford.edu/image/iiif/fb100cb2366%2Ffb100cb2366_0001/info.json",number:"2948",publisher:"Welte-Mignon",title:'Humperdinck/Sommer - Selections from "hansel & gretel"',type:"welte-red"},{druid:"zy618kz1670",image_url:"https://stacks.stanford.edu/image/iiif/zy618kz1670%2Fzy618kz1670_0002/info.json",number:"4677",publisher:"Victoria",title:"Joyce - Remembrance: valse",type:"88-note"},{druid:"fr859hh7893",image_url:"https://stacks.stanford.edu/image/iiif/fr859hh7893%2Ffr859hh7893_0001/info.json",number:"3524",publisher:"Welte-Mignon",title:"Joyce/Dyck - Dreaming: waltz",type:"welte-red"},{druid:"mr400mf6531",image_url:"https://stacks.stanford.edu/image/iiif/mr400mf6531%2Fmr400mf6531_0001/info.json",number:"5662",publisher:"Welte-Mignon",title:"Keefer/Johnson - Dream daddy: fox-trot",type:"welte-red"},{druid:"gm296rz0673",image_url:"https://stacks.stanford.edu/image/iiif/gm296rz0673%2Fgm296rz0673_0001/info.json",number:"3055",publisher:"Welte-Mignon",title:"Korngold/Ganz - Sonate e-dur, op. 2, no. 2: I. und II. Satz",type:"welte-red"},{druid:"rb861vm6094",image_url:"https://stacks.stanford.edu/image/iiif/rb861vm6094%2Frb861vm6094_0001/info.json",number:"3056",publisher:"Welte-Mignon",title:"Korngold/Ganz - Sonate e-dur, op. 2, no. 2: III. und IV. Satz",type:"welte-red"},{druid:"ct503bz7189",image_url:"https://stacks.stanford.edu/image/iiif/ct503bz7189%2Fct503bz7189_0001/info.json",number:"3842",publisher:"Welte-Mignon",title:"Korngold/Heinemann - Märchenbilder: 5-7",type:"welte-red"},{druid:"xh403hj3866",image_url:"https://stacks.stanford.edu/image/iiif/xh403hj3866%2Fxh403hj3866_0001/info.json",number:"384",publisher:"Welte-Mignon",title:"Kreisler/Schnabel - Old vienna waltzes",type:"welte-red"},{druid:"ft113cg5195",image_url:"https://stacks.stanford.edu/image/iiif/ft113cg5195%2Fft113cg5195_0001/info.json",number:"2810",publisher:"Welte-Mignon",title:"Lecocq/Gayraud - La Fille de madame angot: (fantasie mosaïque)",type:"welte-red"},{druid:"pc364sy7115",image_url:"https://stacks.stanford.edu/image/iiif/pc364sy7115%2Fpc364sy7115_0001/info.json",number:"2609",publisher:"Welte-Mignon",title:"Lehár/Goodall - Graf von luxemburg: Selektion I",type:"welte-red"},{druid:"wj488tq5861",image_url:"https://stacks.stanford.edu/image/iiif/wj488tq5861%2Fwj488tq5861_0001/info.json",number:"1338",publisher:"Welte-Mignon",title:"Lehár/Starke - Die Lustige witwe: II. Potpourri",type:"welte-red"},{druid:"jg699wz4435",image_url:"https://stacks.stanford.edu/image/iiif/jg699wz4435%2Fjg699wz4435_0001/info.json",number:"106",publisher:"Welte-Mignon",title:"Leoncavallo/Adam-Benard - Prolog a. bajazzo",type:"welte-red"},{druid:"zw751nw0097",image_url:"https://stacks.stanford.edu/image/iiif/zw751nw0097%2Fzw751nw0097_0001/info.json",number:"1023",publisher:"Welte-Mignon",title:'Leoncavallo/Leoncavallo - Valse de musette: a. II. Act "die Bohème"',type:"welte-red"},{druid:"ts972sy8288",image_url:"https://stacks.stanford.edu/image/iiif/ts972sy8288%2Fts972sy8288_0001/info.json",number:"1196",publisher:"Welte-Mignon",title:"Leschetizky/Leschetizky - Barcarolle op. 39, no. 1",type:"welte-red"},{druid:"ws749sk4778",image_url:"https://stacks.stanford.edu/image/iiif/ws749sk4778%2Fws749sk4778_0001/info.json",number:"1203",publisher:"Welte-Mignon",title:"Leschetizky/Leschetizky - The Two larks",type:"welte-red"},{druid:"xk500gs5691",image_url:"https://stacks.stanford.edu/image/iiif/xk500gs5691%2Fxk500gs5691_0001/info.json",number:"337",publisher:"Welte-Mignon",title:"Lincke/Kupfernagel - Berliner luft: Marsch",type:"welte-red"},{druid:"fw547rc7021",image_url:"https://stacks.stanford.edu/image/iiif/fw547rc7021%2Ffw547rc7021_0001/info.json",number:"1396",publisher:"Welte-Mignon",title:'Lincke/Orlando - Luna-walzer: a. d. Operette "Frau Luna"',type:"welte-red"},{druid:"jg717nb8731",image_url:"https://stacks.stanford.edu/image/iiif/jg717nb8731%2Fjg717nb8731_0001/info.json",number:"2703",publisher:"Welte-Mignon",title:"Liszt-Vetter/Lohr - Ii. ungarische rhapsodie: mit Cadenz von Prof. H. Vetter",type:"welte-red"},{druid:"vs059bb4318",image_url:"https://stacks.stanford.edu/image/iiif/vs059bb4318%2Fvs059bb4318_0001/info.json",number:"104",publisher:"Welte-Mignon",title:"Liszt/Adam-Benard - Nocturne no. 2",type:"welte-red"},{druid:"gg920pz0818",image_url:"https://stacks.stanford.edu/image/iiif/gg920pz0818%2Fgg920pz0818_0001/info.json",number:"415",publisher:"Welte-Mignon",title:"Liszt/Albert - Loves dream",type:"welte-red"},{druid:"ky445sz4630",image_url:"https://stacks.stanford.edu/image/iiif/ky445sz4630%2Fky445sz4630_0001/info.json",number:"412",publisher:"Welte-Mignon",title:"Liszt/Albert - Soirée de vienne: I [i.e., 2]",type:"welte-red"},{druid:"vy193qr6005",image_url:"https://stacks.stanford.edu/image/iiif/vy193qr6005%2Fvy193qr6005_0001/info.json",number:"2988",publisher:"Welte-Mignon",title:"Liszt/Albert - Sonata b minor, 2nd part",type:"welte-red"},{druid:"gy310qs3678",image_url:"https://stacks.stanford.edu/image/iiif/gy310qs3678%2Fgy310qs3678_0001/info.json",number:"2987",publisher:"Welte-Mignon",title:"Liszt/Albert - Sonata b minor, part 1",type:"welte-red"},{druid:"kv550vj8954",image_url:"https://stacks.stanford.edu/image/iiif/kv550vj8954%2Fkv550vj8954_0001/info.json",number:"444",publisher:"Welte-Mignon",title:"Liszt/Busoni - La Campanella: Paganini etude no. 3",type:"welte-red"},{druid:"tp302mb4101",image_url:"https://stacks.stanford.edu/image/iiif/tp302mb4101%2Ftp302mb4101_0001/info.json",number:"1321",publisher:"Welte-Mignon",title:"Liszt/Busoni - Norma: Fantasie",type:"welte-red"},{druid:"yx536mq2915",image_url:"https://stacks.stanford.edu/image/iiif/yx536mq2915%2Fyx536mq2915_0001/info.json",number:"365",publisher:"Welte-Mignon",title:"Liszt/Carreño - 6th hungarian rhapsody",type:"welte-red"},{druid:"yj598pj2879",image_url:"https://stacks.stanford.edu/image/iiif/yj598pj2879%2Fyj598pj2879_0001/info.json",number:"360",publisher:"Welte-Mignon",title:"Liszt/Carreño - Soirée de vienne, no. 6",type:"welte-red"},{druid:"yc867qr9425",image_url:"https://stacks.stanford.edu/image/iiif/yc867qr9425%2Fyc867qr9425_0001/info.json",number:"2456",publisher:"Welte-Mignon",title:"Liszt/Danziger - Gondoliera from venezia e napoli",type:"welte-red"},{druid:"bg098gg3899",image_url:"https://stacks.stanford.edu/image/iiif/bg098gg3899%2Fbg098gg3899_0001/info.json",number:"494",publisher:"Welte-Mignon",title:"Liszt/Dohnányi - 13th rhapsody",type:"welte-red"},{druid:"dp563zh2166",image_url:"https://stacks.stanford.edu/image/iiif/dp563zh2166%2Fdp563zh2166_0001/info.json",number:"492",publisher:"Welte-Mignon",title:"Liszt/Dohnányi - Rakoczy-marsch",type:"welte-red"},{druid:"hn488rk0690",image_url:"https://stacks.stanford.edu/image/iiif/hn488rk0690%2Fhn488rk0690_0001/info.json",number:"496",publisher:"Welte-Mignon",title:"Liszt/Dohnányi - Soiree de vienne, no. 4",type:"welte-red"},{druid:"hh429fw8081",image_url:"https://stacks.stanford.edu/image/iiif/hh429fw8081%2Fhh429fw8081_0001/info.json",number:"274",publisher:"Welte-Mignon",title:"Liszt/Droucker - Gnomenreigen",type:"welte-red"},{druid:"tb707nd8515",image_url:"https://stacks.stanford.edu/image/iiif/tb707nd8515%2Ftb707nd8515_0001/info.json",number:"993",publisher:"Welte-Mignon",title:"Liszt/Elvyn - Widmung",type:"welte-red"},{druid:"mx460bt7026",image_url:"https://stacks.stanford.edu/image/iiif/mx460bt7026%2Fmx460bt7026_0001/info.json",number:"198",publisher:"Welte-Mignon",title:"Liszt/Friedheim - Xii rhapsodie",type:"welte-red"},{druid:"ch401rm7382",image_url:"https://stacks.stanford.edu/image/iiif/ch401rm7382%2Fch401rm7382_0001/info.json",number:"3058",publisher:"Welte-Mignon",title:"Liszt/Ganz - Mignon's lied",type:"welte-red"},{druid:"jf649gs2184",image_url:"https://stacks.stanford.edu/image/iiif/jf649gs2184%2Fjf649gs2184_0001/info.json",number:"936",publisher:"Welte-Mignon",title:"Liszt/Hambourg - Polonaise e major",type:"welte-red"},{druid:"cv806rf2664",image_url:"https://stacks.stanford.edu/image/iiif/cv806rf2664%2Fcv806rf2664_0001/info.json",number:"3410",publisher:"Welte-Mignon",title:"Liszt/Kwast-Hodapp - Wilde jagd: Etude",type:"welte-red"},{druid:"rb625rv7300",image_url:"https://stacks.stanford.edu/image/iiif/rb625rv7300%2Frb625rv7300_0001/info.json",number:"569",publisher:"Welte-Mignon",title:"Liszt/Lamond - Etude no. 3, des-dur",type:"welte-red"},{druid:"kz379jn2491",image_url:"https://stacks.stanford.edu/image/iiif/kz379jn2491%2Fkz379jn2491_0001/info.json",number:"570",publisher:"Welte-Mignon",title:"Liszt/Lamond - Liebestraum",type:"welte-red"},{druid:"ng103jj1150",image_url:"https://stacks.stanford.edu/image/iiif/ng103jj1150%2Fng103jj1150_0001/info.json",number:"570",publisher:"Welte-Mignon",title:"Liszt/Lamond - Liebestraum: Nocturn No. 3",type:"welte-red"},{druid:"dw083wh0675",image_url:"https://stacks.stanford.edu/image/iiif/dw083wh0675%2Fdw083wh0675_0001/info.json",number:"1302",publisher:"Welte-Mignon",title:"Liszt/Lhévinne - Loreley",type:"welte-red"},{druid:"jy572md2211",image_url:"https://stacks.stanford.edu/image/iiif/jy572md2211%2Fjy572md2211_0001/info.json",number:"3333",publisher:"Welte-Mignon",title:"Liszt/Lászlò - Piano-concert e major: 1st movement",type:"welte-red"},{druid:"zk440mh1715",image_url:"https://stacks.stanford.edu/image/iiif/zk440mh1715%2Fzk440mh1715_0001/info.json",number:"757",publisher:"Welte-Mignon",title:"Liszt/Mero - 2nd hungarian rhapsody",type:"welte-red"},{druid:"hg174cq6672",image_url:"https://stacks.stanford.edu/image/iiif/hg174cq6672%2Fhg174cq6672_0001/info.json",number:"757",publisher:"Welte-Mignon",title:"Liszt/Mero - Ii. ungarische rhapsodie",type:"welte-red"},{druid:"cz847th6835",image_url:"https://stacks.stanford.edu/image/iiif/cz847th6835%2Fcz847th6835_0001/info.json",number:"1112",publisher:"Welte-Mignon",title:"Liszt/Ney - Viii. rhapsodie",type:"welte-red"},{druid:"wp442mf3514",image_url:"https://stacks.stanford.edu/image/iiif/wp442mf3514%2Fwp442mf3514_0001/info.json",number:"1216",publisher:"Welte-Mignon",title:"Liszt/Pachmann - Etude de concert: no. 2, f-Moll",type:"welte-red"},{druid:"zv884mc0794",image_url:"https://stacks.stanford.edu/image/iiif/zv884mc0794%2Fzv884mc0794_0001/info.json",number:"1259",publisher:"Welte-Mignon",title:"Liszt/Paderewski - 10th hungarian rhapsody",type:"welte-red"},{druid:"qg121rz6125",image_url:"https://stacks.stanford.edu/image/iiif/qg121rz6125%2Fqg121rz6125_0001/info.json",number:"1259",publisher:"Welte-Mignon",title:"Liszt/Paderewski - X. rhapsodie",type:"welte-red"},{druid:"gz430tm0196",image_url:"https://stacks.stanford.edu/image/iiif/gz430tm0196%2Fgz430tm0196_0001/info.json",number:"844",publisher:"Welte-Mignon",title:"Liszt/Pauer - Harmonie du soir",type:"welte-red"},{druid:"fd761bx2206",image_url:"https://stacks.stanford.edu/image/iiif/fd761bx2206%2Ffd761bx2206_0001/info.json",number:"518",publisher:"Welte-Mignon",title:"Liszt/Petri - Années de pélerinage, iii, no. 4: les jeux d'eaux de la Villa d'Este",type:"welte-red"},{druid:"qq914np5449",image_url:"https://stacks.stanford.edu/image/iiif/qq914np5449%2Fqq914np5449_0001/info.json",number:"324",publisher:"Welte-Mignon",title:"Liszt/Reisenauer - X ung. rhapsodie",type:"welte-red"},{druid:"zw755dp8285",image_url:"https://stacks.stanford.edu/image/iiif/zw755dp8285%2Fzw755dp8285_0001/info.json",number:"483",publisher:"Welte-Mignon",title:"Liszt/Ripper - Faust-walzer",type:"welte-red"},{druid:"fv104hn7521",image_url:"https://stacks.stanford.edu/image/iiif/fv104hn7521%2Ffv104hn7521_0001/info.json",number:"304",publisher:"Welte-Mignon",title:"Liszt/Rössel - V. hungarian rhapsody: (Heroide elegique)",type:"welte-red"},{druid:"ns598kr8616",image_url:"https://stacks.stanford.edu/image/iiif/ns598kr8616%2Fns598kr8616_0001/info.json",number:"1474",publisher:"Welte-Mignon",title:"Liszt/Samaroff Stokowski - Tannhauser march",type:"welte-red"},{druid:"fj448by1666",image_url:"https://stacks.stanford.edu/image/iiif/fj448by1666%2Ffj448by1666_0001/info.json",number:"1474",publisher:"Welte-Mignon",title:"Liszt/Samaroff Stokowski - Tannhäuser-marsch",type:"welte-red"},{druid:"rq927dq9061",image_url:"https://stacks.stanford.edu/image/iiif/rq927dq9061%2Frq927dq9061_0001/info.json",number:"951",publisher:"Welte-Mignon",title:'Liszt/Sapellnikoff - Nocturne: No. 1: "Hohe Liebe"',type:"welte-red"},{druid:"hm523dq5554",image_url:"https://stacks.stanford.edu/image/iiif/hm523dq5554%2Fhm523dq5554_0001/info.json",number:"876",publisher:"Welte-Mignon",title:"Liszt/Sauer - Don juan: Fantasie",type:"welte-red"},{druid:"yt837kd6607",image_url:"https://stacks.stanford.edu/image/iiif/yt837kd6607%2Fyt837kd6607_0001/info.json",number:"244",publisher:"Welte-Mignon",title:"Liszt/Scharwenka - Ricordanza",type:"welte-red"},{druid:"ny706rg1119",image_url:"https://stacks.stanford.edu/image/iiif/ny706rg1119%2Fny706rg1119_0001/info.json",number:"895",publisher:"Welte-Mignon",title:"Liszt/Schnitzer - Ix. rhapsodie",type:"welte-red"},{druid:"st011pr3757",image_url:"https://stacks.stanford.edu/image/iiif/st011pr3757%2Fst011pr3757_0001/info.json",number:"738",publisher:"Welte-Mignon",title:"Liszt/Schumann - Waldesrauschen: 1st concert étude",type:"welte-red"},{druid:"bx815rz0622",image_url:"https://stacks.stanford.edu/image/iiif/bx815rz0622%2Fbx815rz0622_0001/info.json",number:"1033",publisher:"Welte-Mignon",title:"Liszt/Stavenhagen - 12th hungarian rhapsody: (as played by Liszt)",type:"welte-red"},{druid:"ry948sf9078",image_url:"https://stacks.stanford.edu/image/iiif/ry948sf9078%2Fry948sf9078_0001/info.json",number:"1032",publisher:"Welte-Mignon",title:"Liszt/Stavenhagen - Ii. legende: Der hl. Franziskus über die Wogen schreitend",type:"welte-red"},{druid:"hg282mg9396",image_url:"https://stacks.stanford.edu/image/iiif/hg282mg9396%2Fhg282mg9396_0001/info.json",number:"1033",publisher:"Welte-Mignon",title:"Liszt/Stavenhagen - Xii. ungar. rapsodie: (nach persönlicher Erinnerung an Liszt = (played by as Liszt)",type:"welte-red"},{druid:"np829dt9039",image_url:"https://stacks.stanford.edu/image/iiif/np829dt9039%2Fnp829dt9039_0001/info.json",number:"1386",publisher:"Welte-Mignon",title:"Liszt/Timanoff - I. ungarische rhapsodie",type:"welte-red"},{druid:"sr504pc8797",image_url:"https://stacks.stanford.edu/image/iiif/sr504pc8797%2Fsr504pc8797_0001/info.json",number:"376",publisher:"Welte-Mignon",title:"Liszt/Wendling - Lohengrin: Elsa's bridal procession",type:"welte-red"},{druid:"gx118hr0306",image_url:"https://stacks.stanford.edu/image/iiif/gx118hr0306%2Fgx118hr0306_0001/info.json",number:"1957",publisher:"Welte-Mignon",title:"Li͡apunov/Drozdov - Carillon",type:"welte-red"},{druid:"gv741wj6162",image_url:"https://stacks.stanford.edu/image/iiif/gv741wj6162%2Fgv741wj6162_0002/info.json",number:"4478",publisher:"Princesa",title:"Lope - Gallito: paso doble flamenco",type:"88-note"},{druid:"xy812vy7103",image_url:"https://stacks.stanford.edu/image/iiif/xy812vy7103%2Fxy812vy7103_0001/info.json",number:"3681",publisher:"Welte-Mignon",title:"MacDowell/Cone - An Old love story: op. 61, no. 1",type:"welte-red"},{druid:"fk269mx8427",image_url:"https://stacks.stanford.edu/image/iiif/fk269mx8427%2Ffk269mx8427_0001/info.json",number:"2998",publisher:"Welte-Mignon",title:"MacDowell/Winogradoff-Gorges - Polonaise e minor, op. 46, no. 12",type:"welte-red"},{druid:"dp497dz1055",image_url:"https://stacks.stanford.edu/image/iiif/dp497dz1055%2Fdp497dz1055_0001/info.json",number:"469",publisher:"Welte-Mignon",title:"MacDowell/Zadora - Hexentanz: op. 17, no. 2",type:"welte-red"},{druid:"md908xy8241",image_url:"https://stacks.stanford.edu/image/iiif/md908xy8241%2Fmd908xy8241_0001/info.json",number:"5551",publisher:"Welte-Mignon",title:"Malderen/Schrempp - Tango du rêve: (Traum Tango)",type:"welte-red"},{druid:"qh464nj1973",image_url:"https://stacks.stanford.edu/image/iiif/qh464nj1973%2Fqh464nj1973_0002/info.json",number:"4671",publisher:"Princesa",title:"Marquina - Ecos españoles: pasodoble",type:"88-note"},{druid:"jp202jq5812",image_url:"https://stacks.stanford.edu/image/iiif/jp202jq5812%2Fjp202jq5812_0002/info.json",number:"1606",publisher:"Caecilia",title:"Martínez Valls - Serenata poética: en forma de fox trot",type:"88-note"},{druid:"ps751km7125",image_url:"https://stacks.stanford.edu/image/iiif/ps751km7125%2Fps751km7125_0001/info.json",number:"814",publisher:"Welte-Mignon",title:"Marx-Goldschmidt/Marx-Goldschmidt - Rhapsodie hongroise: nach Sarasates Zigeunerweisen",type:"welte-red"},{druid:"ny606dc0992",image_url:"https://stacks.stanford.edu/image/iiif/ny606dc0992%2Fny606dc0992_0001/info.json",number:"B-6239",publisher:"De Luxe",title:"Mascagni/Davis - Cavelleria rusticana",type:"welte-licensee"},{druid:"vm351pv9656",image_url:"https://stacks.stanford.edu/image/iiif/vm351pv9656%2Fvm351pv9656_0001/info.json",number:"253",publisher:"Welte-Mignon",title:"Mascagni/Zscherneck - Intermezzo aus cavalleria rusticana",type:"welte-red"},{druid:"jd052zg1047",image_url:"https://stacks.stanford.edu/image/iiif/jd052zg1047%2Fjd052zg1047_0001/info.json",number:"2685",publisher:"Welte-Mignon",title:"Mason/Adam - Nearer my god to thee",type:"welte-red"},{druid:"fm197wc9522",image_url:"https://stacks.stanford.edu/image/iiif/fm197wc9522%2Ffm197wc9522_0001/info.json",number:"2908",publisher:"Welte-Mignon",title:"Massenet/Epstein - Manon: selection",type:"welte-red"},{druid:"rs765sm2000",image_url:"https://stacks.stanford.edu/image/iiif/rs765sm2000%2Frs765sm2000_0001/info.json",number:"2822",publisher:"Welte-Mignon",title:"Massenet/Gayraud - Thaïs: fantasia mosaïc",type:"welte-red"},{druid:"zr938kz3902",image_url:"https://stacks.stanford.edu/image/iiif/zr938kz3902%2Fzr938kz3902_0001/info.json",number:"2823",publisher:"Welte-Mignon",title:"Massenet/Gayraud - Werther: fantasia, part I",type:"welte-red"},{druid:"nz852nk6103",image_url:"https://stacks.stanford.edu/image/iiif/nz852nk6103%2Fnz852nk6103_0001/info.json",number:"2556",publisher:"Welte-Mignon",title:"Massenet/Paur - Thais, meditation",type:"welte-red"},{druid:"hh361xy4933",image_url:"https://stacks.stanford.edu/image/iiif/hh361xy4933%2Fhh361xy4933_0001/info.json",number:"C-6893",publisher:"De Luxe",title:"Mendelssohn-Bartholdy-Hutcheson/Bacon - Scherzo (midsummer night's dream)",type:"welte-licensee"},{druid:"xp003dy0437",image_url:"https://stacks.stanford.edu/image/iiif/xp003dy0437%2Fxp003dy0437_0001/info.json",number:"882",publisher:"Welte-Mignon",title:"Mendelssohn-Bartholdy-Liszt/Sauer - Auf flügeln des gesangs",type:"welte-red"},{druid:"xn796bh4368",image_url:"https://stacks.stanford.edu/image/iiif/xn796bh4368%2Fxn796bh4368_0001/info.json",number:"216",publisher:"Welte-Mignon",title:"Mendelssohn-Bartholdy/Adam-Benard - Lied ohne worte: Moderato, No. 4",type:"welte-red"},{druid:"mx599qs6329",image_url:"https://stacks.stanford.edu/image/iiif/mx599qs6329%2Fmx599qs6329_0001/info.json",number:"40",publisher:"Welte-Mignon",title:"Mendelssohn-Bartholdy/Adam-Benard - Lied ohne worte: Volkslied, No. 23",type:"welte-red"},{druid:"jk702cg2022",image_url:"https://stacks.stanford.edu/image/iiif/jk702cg2022%2Fjk702cg2022_0001/info.json",number:"1466",publisher:"Welte-Mignon",title:"Mendelssohn-Bartholdy/Bloomfield-Zeisler - Frühlingslied",type:"welte-red"},{druid:"cw427tw4145",image_url:"https://stacks.stanford.edu/image/iiif/cw427tw4145%2Fcw427tw4145_0001/info.json",number:"2000",publisher:"Welte-Mignon",title:"Mendelssohn-Bartholdy/Goraïnoff - Rondo capriccioso",type:"welte-red"},{druid:"cd381jt9273",image_url:"https://stacks.stanford.edu/image/iiif/cd381jt9273%2Fcd381jt9273_0001/info.json",number:"3172",publisher:"Welte-Mignon",title:"Mendelssohn-Bartholdy/Kiek - 3th symphony: Allegro vivacissimo",type:"welte-red"},{druid:"bd915bs0646",image_url:"https://stacks.stanford.edu/image/iiif/bd915bs0646%2Fbd915bs0646_0001/info.json",number:"3162",publisher:"Welte-Mignon",title:"Mendelssohn-Bartholdy/Kiek - Capriccio brilliante b major",type:"welte-red"},{druid:"zv706jf8277",image_url:"https://stacks.stanford.edu/image/iiif/zv706jf8277%2Fzv706jf8277_0001/info.json",number:"458",publisher:"Welte-Mignon",title:"Mendelssohn-Bartholdy/Kleeberg - Duetto: (Song without words): A flat major",type:"welte-red"},{druid:"ym420hv4366",image_url:"https://stacks.stanford.edu/image/iiif/ym420hv4366%2Fym420hv4366_0001/info.json",number:"231",publisher:"Welte-Mignon",title:"Mendelssohn-Bartholdy/Möhle - Lied ohne worte, op. 62, [no. 4], no. 28",type:"welte-red"},{druid:"mz508vq7890",image_url:"https://stacks.stanford.edu/image/iiif/mz508vq7890%2Fmz508vq7890_0001/info.json",number:"232",publisher:"Welte-Mignon",title:"Mendelssohn-Bartholdy/Scharwenka - Scherzo e-moll",type:"welte-red"},{druid:"sg713kb1834",image_url:"https://stacks.stanford.edu/image/iiif/sg713kb1834%2Fsg713kb1834_0001/info.json",number:"3548",publisher:"Welte-Mignon",title:"Merrigan - Carry me back to ole virginny",type:"welte-red"},{druid:"rf416pb7833",image_url:"https://stacks.stanford.edu/image/iiif/rf416pb7833%2Frf416pb7833_0001/info.json",number:"3452",publisher:"Welte-Mignon",title:"Meyer-Helmund/Haass - Zauberlied",type:"welte-red"},{druid:"sq235zh0909",image_url:"https://stacks.stanford.edu/image/iiif/sq235zh0909%2Fsq235zh0909_0001/info.json",number:"612",publisher:"Welte-Mignon",title:"Meyer-Helmund/Meyer-Helmund - Dein gedenk ich, margarethe",type:"welte-red"},{druid:"qf152xr6941",image_url:"https://stacks.stanford.edu/image/iiif/qf152xr6941%2Fqf152xr6941_0002/info.json",number:"4660",publisher:"Princesa",title:"Moreno Torroba - La Marchenera: Petenera",type:"88-note"},{druid:"mn110mt1775",image_url:"https://stacks.stanford.edu/image/iiif/mn110mt1775%2Fmn110mt1775_0001/info.json",number:"3556",publisher:"Welte-Mignon",title:"Moszkowski/Danziger - Barcarole: (from Tales of Hoffman)",type:"welte-red"},{druid:"hq933dq4264",image_url:"https://stacks.stanford.edu/image/iiif/hq933dq4264%2Fhq933dq4264_0001/info.json",number:"449",publisher:"Welte-Mignon",title:"Moszkowski/Kleeberg - Liebes walzer: op. 57 no. 5 = (Love's waltz)",type:"welte-red"},{druid:"jx095ty1753",image_url:"https://stacks.stanford.edu/image/iiif/jx095ty1753%2Fjx095ty1753_0001/info.json",number:"1204",publisher:"Welte-Mignon",title:"Mozart/Pachmann - Sonate, a-dur, nr. 9",type:"welte-red"},{druid:"zb497jz4405",image_url:"https://stacks.stanford.edu/image/iiif/zb497jz4405%2Fzb497jz4405_0001/info.json",number:"182",publisher:"Welte-Mignon",title:"Mozart/Reinecke - Türkischer marsch",type:"welte-red"},{druid:"dq126tp4234",image_url:"https://stacks.stanford.edu/image/iiif/dq126tp4234%2Fdq126tp4234_0001/info.json",number:"3143",publisher:"Welte-Mignon",title:"Mozart/Ritter - Don juan: Overture",type:"welte-red"},{druid:"zx785pg9042",image_url:"https://stacks.stanford.edu/image/iiif/zx785pg9042%2Fzx785pg9042_0002/info.json",number:"4636",publisher:"Princesa",title:"Muñoz Aceña - La Cieguita: tango-canción",type:"88-note"},{druid:"tr981xw2871",image_url:"https://stacks.stanford.edu/image/iiif/tr981xw2871%2Ftr981xw2871_0001/info.json",number:"1613",publisher:"Welte-Mignon",title:"Offenbach/Francklyn - Tales of hoffmann: selection",type:"welte-red"},{druid:"jf942gh3232",image_url:"https://stacks.stanford.edu/image/iiif/jf942gh3232%2Fjf942gh3232_0001/info.json",number:"258",publisher:"Welte-Mignon",title:'Offenbach/Zscherneck - Barcarole aus "hoffmann\'s erzählungen"',type:"welte-red"},{druid:"pd354nj6106",image_url:"https://stacks.stanford.edu/image/iiif/pd354nj6106%2Fpd354nj6106_0001/info.json",number:"1454",publisher:"Welte-Mignon",title:"Orlando - God save the king: (national anthem)",type:"welte-red"},{druid:"qb477sd2923",image_url:"https://stacks.stanford.edu/image/iiif/qb477sd2923%2Fqb477sd2923_0001/info.json",number:"1226",publisher:"Welte-Mignon",title:'Pachmann/Pachmann - Improvisation on "the maiden\'s prayer"',type:"welte-red"},{druid:"dw479gk0103",image_url:"https://stacks.stanford.edu/image/iiif/dw479gk0103%2Fdw479gk0103_0001/info.json",number:"1263",publisher:"Welte-Mignon",title:"Paderewski/Paderewski - Minuett g major",type:"welte-red"},{druid:"qt363fp0799",image_url:"https://stacks.stanford.edu/image/iiif/qt363fp0799%2Fqt363fp0799_0001/info.json",number:"1262",publisher:"Welte-Mignon",title:"Paderewski/Paderewski - Nocturne op. 16, no. 4",type:"welte-red"},{druid:"sb487jm2092",image_url:"https://stacks.stanford.edu/image/iiif/sb487jm2092%2Fsb487jm2092_0001/info.json",number:"1262",publisher:"Welte-Mignon",title:"Paderewski/Paderewski - Nocturno op. 16, no. 4",type:"welte-red"},{druid:"bp752qs6053",image_url:"https://stacks.stanford.edu/image/iiif/bp752qs6053%2Fbp752qs6053_0002/info.json",number:"4291",publisher:"Princesa",title:"Pancho Pérez - Grana y oro: pasodoble",type:"88-note"},{druid:"qj765hb3428",image_url:"https://stacks.stanford.edu/image/iiif/qj765hb3428%2Fqj765hb3428_0002/info.json",number:"40059",publisher:"Princesa",title:"Patiño - Suspiro flamenco: pasodoble",type:"88-note"},{druid:"rx870zt5437",image_url:"https://stacks.stanford.edu/image/iiif/rx870zt5437%2Frx870zt5437_0002/info.json",number:"4394",publisher:"Princesa",title:"Pettorossi - Galleguita: tango argentino",type:"88-note"},{druid:"mf940cg4339",image_url:"https://stacks.stanford.edu/image/iiif/mf940cg4339%2Fmf940cg4339_0001/info.json",number:"1468",publisher:"Welte-Mignon",title:"Poldini/Bloomfield-Zeisler - Poupée valsante",type:"welte-red"},{druid:"ms935qj0194",image_url:"https://stacks.stanford.edu/image/iiif/ms935qj0194%2Fms935qj0194_0001/info.json",number:"2255",publisher:"Welte-Mignon",title:"Puccini/Epstein - La Boheme: selection",type:"welte-red"},{druid:"fk036vh7282",image_url:"https://stacks.stanford.edu/image/iiif/fk036vh7282%2Ffk036vh7282_0001/info.json",number:"2254",publisher:"Welte-Mignon",title:"Puccini/Epstein - Madam butterfly: selection",type:"welte-red"},{druid:"pf050rx0162",image_url:"https://stacks.stanford.edu/image/iiif/pf050rx0162%2Fpf050rx0162_0001/info.json",number:"2254",publisher:"Welte-Mignon",title:"Puccini/Epstein - Madam butterfly: selektion",type:"welte-red"},{druid:"rr990ym0199",image_url:"https://stacks.stanford.edu/image/iiif/rr990ym0199%2Frr990ym0199_0001/info.json",number:"2560",publisher:"Welte-Mignon",title:"Puccini/Paur - Tosca, fantasia",type:"welte-red"},{druid:"jg489yw0942",image_url:"https://stacks.stanford.edu/image/iiif/jg489yw0942%2Fjg489yw0942_0002/info.json",number:"4309",publisher:"Princesa",title:"Pérez Soriano - El Guitarrico: Jota",type:"88-note"},{druid:"kj388dj3308",image_url:"https://stacks.stanford.edu/image/iiif/kj388dj3308%2Fkj388dj3308_0001/info.json",number:"2079",publisher:"Welte-Mignon",title:"Rachmaninoff/Hill - Prelude op. 3, no. 2, c sharp minor",type:"welte-red"},{druid:"bh573cc4821",image_url:"https://stacks.stanford.edu/image/iiif/bh573cc4821%2Fbh573cc4821_0001/info.json",number:"X-6622",publisher:"De Luxe",title:"Rachmaninoff/Leonardi - Prelude (op. 32, no. 12)",type:"welte-licensee"},{druid:"pr464zk8674",image_url:"https://stacks.stanford.edu/image/iiif/pr464zk8674%2Fpr464zk8674_0001/info.json",number:"1567",publisher:"Welte-Mignon",title:"Rachmaninoff/Pintel - Prélude d-dur",type:"welte-red"},{druid:"yg250xz9762",image_url:"https://stacks.stanford.edu/image/iiif/yg250xz9762%2Fyg250xz9762_0001/info.json",number:"1571",publisher:"Welte-Mignon",title:"Rachmaninoff/Pintel - Prélude g minor",type:"welte-red"},{druid:"qj203cn5343",image_url:"https://stacks.stanford.edu/image/iiif/qj203cn5343%2Fqj203cn5343_0001/info.json",number:"1959",publisher:"Welte-Mignon",title:"Rachmaninoff/Pouishnoff - Polichenelle: op. 3, no. 4",type:"welte-red"},{druid:"jy320zw1102",image_url:"https://stacks.stanford.edu/image/iiif/jy320zw1102%2Fjy320zw1102_0002/info.json",number:"4486",publisher:"Victoria",title:"Raff - Valse impromptu",type:"88-note"},{druid:"kw215gn3365",image_url:"https://stacks.stanford.edu/image/iiif/kw215gn3365%2Fkw215gn3365_0001/info.json",number:"3357",publisher:"Welte-Mignon",title:"Raff/Flohr - Cachoucha",type:"welte-red"},{druid:"hh466mq4616",image_url:"https://stacks.stanford.edu/image/iiif/hh466mq4616%2Fhh466mq4616_0001/info.json",number:"296",publisher:"Welte-Mignon",title:"Raff/Gabrilowitsch - Rigaudon d-dur",type:"welte-red"},{druid:"vq227vv6345",image_url:"https://stacks.stanford.edu/image/iiif/vq227vv6345%2Fvq227vv6345_0001/info.json",number:"424",publisher:"Welte-Mignon",title:"Raff/Wendling - La Fileuse: op. 157, no. 2",type:"welte-red"},{druid:"rd899zb5188",image_url:"https://stacks.stanford.edu/image/iiif/rd899zb5188%2Frd899zb5188_0001/info.json",number:"5608",publisher:"Welte-Mignon",title:'Rimsky-Korsakov-Whiteman/Black - Play that song of india again: fox-trot-song after "Korsakow\'s Sadko"',type:"welte-red"},{druid:"rv790qz2532",image_url:"https://stacks.stanford.edu/image/iiif/rv790qz2532%2Frv790qz2532_0001/info.json",number:"226",publisher:"Welte-Mignon",title:"Rosenzweig/Popper - Sei mir gut: Walzerlied",type:"welte-red"},{druid:"xr433hz5827",image_url:"https://stacks.stanford.edu/image/iiif/xr433hz5827%2Fxr433hz5827_0001/info.json",number:"5718",publisher:"Welte-Mignon",title:"Rosoff/Johnson - When you and i were seventeen",type:"welte-red"},{druid:"sb158jt0685",image_url:"https://stacks.stanford.edu/image/iiif/sb158jt0685%2Fsb158jt0685_0001/info.json",number:"953",publisher:"Welte-Mignon",title:"Rossini-Liszt/Sapellnikoff - William tell: Overture",type:"welte-red"},{druid:"dv468zh8208",image_url:"https://stacks.stanford.edu/image/iiif/dv468zh8208%2Fdv468zh8208_0002/info.json",number:"4246",publisher:"Pricesa",title:"Rouget de Lisle - La Marsellesa: himno francés",type:"88-note"},{druid:"dt352gh2011",image_url:"https://stacks.stanford.edu/image/iiif/dt352gh2011%2Fdt352gh2011_0001/info.json",number:"2457",publisher:"Welte-Mignon",title:"Rubinstein/Danziger - Kamennoi ostrow: op. 10, Nr. 22",type:"welte-red"},{druid:"xr682fm1233",image_url:"https://stacks.stanford.edu/image/iiif/xr682fm1233%2Fxr682fm1233_0001/info.json",number:"660",publisher:"Welte-Mignon",title:"Rubinstein/Hofmann - Melodie op. 3, f major",type:"welte-red"},{druid:"td134mh2760",image_url:"https://stacks.stanford.edu/image/iiif/td134mh2760%2Ftd134mh2760_0001/info.json",number:"660",publisher:"Welte-Mignon",title:"Rubinstein/Hofmann - Melodie op. 3, f-dur",type:"welte-red"},{druid:"zc568zf0361",image_url:"https://stacks.stanford.edu/image/iiif/zc568zf0361%2Fzc568zf0361_0001/info.json",number:"661",publisher:"Welte-Mignon",title:"Rubinstein/Hofmann - Valse allemande",type:"welte-red"},{druid:"wv641dn9264",image_url:"https://stacks.stanford.edu/image/iiif/wv641dn9264%2Fwv641dn9264_0001/info.json",number:"1304",publisher:"Welte-Mignon",title:'Rubinstein/Lhévinne - Polka a. "le bal"',type:"welte-red"},{druid:"cp145vd3423",image_url:"https://stacks.stanford.edu/image/iiif/cp145vd3423%2Fcp145vd3423_0001/info.json",number:"1382",publisher:"Welte-Mignon",title:"Rubinstein/Timanoff - Sérénade espagnole: op. 16, no 3",type:"welte-red"},{druid:"cp259ms0085",image_url:"https://stacks.stanford.edu/image/iiif/cp259ms0085%2Fcp259ms0085_0001/info.json",number:"2260",publisher:"Welte-Mignon",title:"Saint-Saëns/Epstein - Samson and delilah: Cantabile du grand duo",type:"welte-red"},{druid:"pc276zv7038",image_url:"https://stacks.stanford.edu/image/iiif/pc276zv7038%2Fpc276zv7038_0001/info.json",number:"2260",publisher:"Welte-Mignon",title:"Saint-Saëns/Epstein - Samson and delilah: Cantabile du grand duo",type:"welte-red"},{druid:"fy803vj4057",image_url:"https://stacks.stanford.edu/image/iiif/fy803vj4057%2Ffy803vj4057_0001/info.json",number:"799",publisher:"Welte-Mignon",title:"Saint-Saëns/Saint-Saëns - Mazurka, no. 3",type:"welte-red"},{druid:"pk349zj4179",image_url:"https://stacks.stanford.edu/image/iiif/pk349zj4179%2Fpk349zj4179_0001/info.json",number:"797",publisher:"Welte-Mignon",title:"Saint-Saëns/Saint-Saëns - Samson and delilah: Finale, Act 1",type:"welte-red"},{druid:"zk199jz1564",image_url:"https://stacks.stanford.edu/image/iiif/zk199jz1564%2Fzk199jz1564_0002/info.json",number:"4670",publisher:"Princesa",title:"Sanders - Adiós muchachos: tango",type:"88-note"},{druid:"cz952kx0008",image_url:"https://stacks.stanford.edu/image/iiif/cz952kx0008%2Fcz952kx0008_0001/info.json",number:"1453",publisher:"Welte-Mignon",title:"Schelling/Schelling - Romanze cis-moll",type:"welte-red"},{druid:"sz207mm8382",image_url:"https://stacks.stanford.edu/image/iiif/sz207mm8382%2Fsz207mm8382_0001/info.json",number:"1296",publisher:"Welte-Mignon",title:"Schlözer/Lhévinne - Etude de concert e flat",type:"welte-red"},{druid:"sq640bh1919",image_url:"https://stacks.stanford.edu/image/iiif/sq640bh1919%2Fsq640bh1919_0001/info.json",number:"1296",publisher:"Welte-Mignon",title:"Schlözer/Lhévinne - Etude e flat major",type:"welte-red"},{druid:"gq401ng9171",image_url:"https://stacks.stanford.edu/image/iiif/gq401ng9171%2Fgq401ng9171_0001/info.json",number:"3309",publisher:"Welte-Mignon",title:"Schubert-Backhaus/Backhaus - Military march e-flat",type:"welte-red"},{druid:"jq774vx6544",image_url:"https://stacks.stanford.edu/image/iiif/jq774vx6544%2Fjq774vx6544_0001/info.json",number:"3309",publisher:"Welte-Mignon",title:"Schubert-Backhaus/Backhaus - Militärmarsch in es-dur",type:"welte-red"},{druid:"kf903tz5142",image_url:"https://stacks.stanford.edu/image/iiif/kf903tz5142%2Fkf903tz5142_0001/info.json",number:"3312",publisher:"Welte-Mignon",title:"Schubert-Backhaus/Backhaus - Wanderer-fantasie: 1st and 2nd movements",type:"welte-red"},{druid:"md331fy4209",image_url:"https://stacks.stanford.edu/image/iiif/md331fy4209%2Fmd331fy4209_0001/info.json",number:"723",publisher:"Welte-Mignon",title:"Schubert-Liszt/Burmeister - Ave maria",type:"welte-red"},{druid:"sx417qf9868",image_url:"https://stacks.stanford.edu/image/iiif/sx417qf9868%2Fsx417qf9868_0001/info.json",number:"723",publisher:"Welte-Mignon",title:"Schubert-Liszt/Burmeister - Ave maria",type:"welte-red"},{druid:"yg667ds7662",image_url:"https://stacks.stanford.edu/image/iiif/yg667ds7662%2Fyg667ds7662_0001/info.json",number:"446",publisher:"Welte-Mignon",title:"Schubert-Liszt/Busoni - Hungarian march: (Hungarian melodies)",type:"welte-red"},{druid:"gq898yv9510",image_url:"https://stacks.stanford.edu/image/iiif/gq898yv9510%2Fgq898yv9510_0001/info.json",number:"665",publisher:"Welte-Mignon",title:"Schubert-Liszt/Hofmann - Erlkönig",type:"welte-red"},{druid:"sc188ff2842",image_url:"https://stacks.stanford.edu/image/iiif/sc188ff2842%2Fsc188ff2842_0001/info.json",number:"1260",publisher:"Welte-Mignon",title:"Schubert-Liszt/Paderewski - The Erl king",type:"welte-red"},{druid:"rc749wx0227",image_url:"https://stacks.stanford.edu/image/iiif/rc749wx0227%2Frc749wx0227_0001/info.json",number:"1471",publisher:"Welte-Mignon",title:"Schubert-Tausig/Bloomfield-Zeisler - Militär-marsch =: (Military march)",type:"welte-red"},{druid:"gb034mq5877",image_url:"https://stacks.stanford.edu/image/iiif/gb034mq5877%2Fgb034mq5877_0001/info.json",number:"422",publisher:"Welte-Mignon",title:"Schubert/Albert - Impromptu g major, op. 90, no. 3",type:"welte-red"},{druid:"cm852bp8620",image_url:"https://stacks.stanford.edu/image/iiif/cm852bp8620%2Fcm852bp8620_0001/info.json",number:"3313",publisher:"Welte-Mignon",title:"Schubert/Backhaus - Wanderer-fantasie: III. und IV. Satz",type:"welte-red"},{druid:"gx107hd3026",image_url:"https://stacks.stanford.edu/image/iiif/gx107hd3026%2Fgx107hd3026_0001/info.json",number:"3316",publisher:"Welte-Mignon",title:"Schubert/Lászlò - 8th symphony b minor: 2nd movement: Andante con motto (unfinished)",type:"welte-red"},{druid:"fg074rf2950",image_url:"https://stacks.stanford.edu/image/iiif/fg074rf2950%2Ffg074rf2950_0001/info.json",number:"2386",publisher:"Welte-Mignon",title:"Schubert/Mackle - Am meer",type:"welte-red"},{druid:"sk832rf0203",image_url:"https://stacks.stanford.edu/image/iiif/sk832rf0203%2Fsk832rf0203_0001/info.json",number:"2388",publisher:"Welte-Mignon",title:"Schubert/Mackle - Der Wanderer",type:"welte-red"},{druid:"tj337qh7786",image_url:"https://stacks.stanford.edu/image/iiif/tj337qh7786%2Ftj337qh7786_0001/info.json",number:"1211",publisher:"Welte-Mignon",title:"Schubert/Pachmann - Moment musical: op. 94, no. 3, F minor",type:"welte-red"},{druid:"jv484vp9065",image_url:"https://stacks.stanford.edu/image/iiif/jv484vp9065%2Fjv484vp9065_0001/info.json",number:"1248",publisher:"Welte-Mignon",title:"Schubert/Paderewski - Impromptu op. 142, b-dur",type:"welte-red"},{druid:"vc908xz3554",image_url:"https://stacks.stanford.edu/image/iiif/vc908xz3554%2Fvc908xz3554_0002/info.json",number:"7822",publisher:"Ideal",title:"Schulhoff - Carnaval de venezia",type:"88-note"},{druid:"yn137rt9938",image_url:"https://stacks.stanford.edu/image/iiif/yn137rt9938%2Fyn137rt9938_0001/info.json",number:"1305",publisher:"Welte-Mignon",title:'Schulz-Evler/Lhévinne - Arabesque über "an der schönen blauen donau"',type:"welte-red"},{druid:"tc493dq4498",image_url:"https://stacks.stanford.edu/image/iiif/tc493dq4498%2Ftc493dq4498_0002/info.json",number:"3020",publisher:"Victoria",title:"Schumann - Fantaisiestück, op. 12: N. 8: Amici, comedia finita est",type:"88-note"},{druid:"rt595wj4442",image_url:"https://stacks.stanford.edu/image/iiif/rt595wj4442%2Frt595wj4442_0001/info.json",number:"28",publisher:"Welte-Mignon",title:"Schumann/Adam-Benard - Klavierconcert a-moll, op. 54: Allegro affectuoso, allegro molto",type:"welte-red"},{druid:"bj093nh2591",image_url:"https://stacks.stanford.edu/image/iiif/bj093nh2591%2Fbj093nh2591_0001/info.json",number:"28",publisher:"Welte-Mignon",title:"Schumann/Adam-Benard - Piano concerto op. 54, a minor: Allegro affectuoso, allegro molto",type:"welte-red"},{druid:"ps931qh5746",image_url:"https://stacks.stanford.edu/image/iiif/ps931qh5746%2Fps931qh5746_0001/info.json",number:"2591",publisher:"Welte-Mignon",title:"Schumann/Bloomfield-Zeisler - Caprice e dur",type:"welte-red"},{druid:"vw531zy4220",image_url:"https://stacks.stanford.edu/image/iiif/vw531zy4220%2Fvw531zy4220_0001/info.json",number:"2591",publisher:"Welte-Mignon",title:"Schumann/Bloomfield-Zeisler - Caprice e dur",type:"welte-red"},{druid:"gf569df0451",image_url:"https://stacks.stanford.edu/image/iiif/gf569df0451%2Fgf569df0451_0001/info.json",number:"361",publisher:"Welte-Mignon",title:"Schumann/Carreño - Fantasia op. 17, c-major: Part 1",type:"welte-red"},{druid:"vm096df0179",image_url:"https://stacks.stanford.edu/image/iiif/vm096df0179%2Fvm096df0179_0001/info.json",number:"363",publisher:"Welte-Mignon",title:"Schumann/Carreño - Fantasie c-dur, op. 17: III. Satz",type:"welte-red"},{druid:"kx034vy1374",image_url:"https://stacks.stanford.edu/image/iiif/kx034vy1374%2Fkx034vy1374_0001/info.json",number:"362",publisher:"Welte-Mignon",title:"Schumann/Carreño - Fantasie op. 17, c-dur: II. Satz",type:"welte-red"},{druid:"kq525dc4373",image_url:"https://stacks.stanford.edu/image/iiif/kq525dc4373%2Fkq525dc4373_0001/info.json",number:"1755",publisher:"Welte-Mignon",title:"Schumann/Collins - Widmung =: (Devotion)",type:"welte-red"},{druid:"jb107tz1859",image_url:"https://stacks.stanford.edu/image/iiif/jb107tz1859%2Fjb107tz1859_0001/info.json",number:"1772",publisher:"Welte-Mignon",title:"Schumann/Davies - Kinderscenen: 1-6",type:"welte-red"},{druid:"ds710xd1794",image_url:"https://stacks.stanford.edu/image/iiif/ds710xd1794%2Fds710xd1794_0001/info.json",number:"1773",publisher:"Welte-Mignon",title:"Schumann/Davies - Scenes from childhood: No. 7-13",type:"welte-red"},{druid:"nk632jz1564",image_url:"https://stacks.stanford.edu/image/iiif/nk632jz1564%2Fnk632jz1564_0001/info.json",number:"501",publisher:"Welte-Mignon",title:"Schumann/Dohnányi - Romance op. 28, no. 2, fis-dur",type:"welte-red"},{druid:"ph502kz9777",image_url:"https://stacks.stanford.edu/image/iiif/ph502kz9777%2Fph502kz9777_0001/info.json",number:"270",publisher:"Welte-Mignon",title:"Schumann/Droucker - Arabesque c major op. 18",type:"welte-red"},{druid:"sk293jg8184",image_url:"https://stacks.stanford.edu/image/iiif/sk293jg8184%2Fsk293jg8184_0001/info.json",number:"1063",publisher:"Welte-Mignon",title:"Schumann/Grosz - 2nd sonata, op. 22, no. 2, g minor: Adantino",type:"welte-red"},{druid:"hn285vs3930",image_url:"https://stacks.stanford.edu/image/iiif/hn285vs3930%2Fhn285vs3930_0001/info.json",number:"1064",publisher:"Welte-Mignon",title:"Schumann/Grosz - 2nd sonata, op. 22, no. 2, g minor: scherzo, rondo, presto",type:"welte-red"},{druid:"yg150mb0559",image_url:"https://stacks.stanford.edu/image/iiif/yg150mb0559%2Fyg150mb0559_0001/info.json",number:"207",publisher:"Welte-Mignon",title:"Schumann/Grünfeld - Des abends op. 12",type:"welte-red"},{druid:"wv912mm2332",image_url:"https://stacks.stanford.edu/image/iiif/wv912mm2332%2Fwv912mm2332_0001/info.json",number:"225",publisher:"Welte-Mignon",title:"Schumann/Grünfeld - Traumerei: op. 15, no. 7",type:"welte-red"},{druid:"mf320jq4997",image_url:"https://stacks.stanford.edu/image/iiif/mf320jq4997%2Fmf320jq4997_0001/info.json",number:"225",publisher:"Welte-Mignon",title:"Schumann/Grünfeld - Träumerei",type:"welte-red"},{druid:"kx695yq4528",image_url:"https://stacks.stanford.edu/image/iiif/kx695yq4528%2Fkx695yq4528_0001/info.json",number:"1301",publisher:"Welte-Mignon",title:"Schumann/Lhévinne - Toccata c major, op. 7",type:"welte-red"},{druid:"cw211cn1219",image_url:"https://stacks.stanford.edu/image/iiif/cw211cn1219%2Fcw211cn1219_0001/info.json",number:"691",publisher:"Welte-Mignon",title:"Schumann/Neitzel - Davidsbündler dances",type:"welte-red"},{druid:"qw257qp8232",image_url:"https://stacks.stanford.edu/image/iiif/qw257qp8232%2Fqw257qp8232_0001/info.json",number:"690",publisher:"Welte-Mignon",title:"Schumann/Neitzel - Symphonische etüde",type:"welte-red"},{druid:"xj540rr2929",image_url:"https://stacks.stanford.edu/image/iiif/xj540rr2929%2Fxj540rr2929_0001/info.json",number:"1208",publisher:"Welte-Mignon",title:"Schumann/Pachmann - Vogel als prophet",type:"welte-red"},{druid:"jk211zx0169",image_url:"https://stacks.stanford.edu/image/iiif/jk211zx0169%2Fjk211zx0169_0001/info.json",number:"525",publisher:"Welte-Mignon",title:"Schumann/Petri - Abegg varationen: op. 1",type:"welte-red"},{druid:"xw872bc8052",image_url:"https://stacks.stanford.edu/image/iiif/xw872bc8052%2Fxw872bc8052_0001/info.json",number:"321",publisher:"Welte-Mignon",title:"Schumann/Reisenauer - Carneval part. 1",type:"welte-red"},{druid:"zt739gs4926",image_url:"https://stacks.stanford.edu/image/iiif/zt739gs4926%2Fzt739gs4926_0001/info.json",number:"321",publisher:"Welte-Mignon",title:"Schumann/Reisenauer - Carneval: Part. 1",type:"welte-red"},{druid:"wk320bj4724",image_url:"https://stacks.stanford.edu/image/iiif/wk320bj4724%2Fwk320bj4724_0001/info.json",number:"322",publisher:"Welte-Mignon",title:"Schumann/Reisenauer - Carneval: Part. 2",type:"welte-red"},{druid:"cs175wr2428",image_url:"https://stacks.stanford.edu/image/iiif/cs175wr2428%2Fcs175wr2428_0001/info.json",number:"248",publisher:"Welte-Mignon",title:"Schumann/Scharwenka - Kreisleriana",type:"welte-red"},{druid:"hy749gh2331",image_url:"https://stacks.stanford.edu/image/iiif/hy749gh2331%2Fhy749gh2331_0001/info.json",number:"2086",publisher:"Welte-Mignon",title:"Schumann/Schorr - Schlummerlied",type:"welte-red"},{druid:"dz678wd2724",image_url:"https://stacks.stanford.edu/image/iiif/dz678wd2724%2Fdz678wd2724_0001/info.json",number:"970",publisher:"Welte-Mignon",title:"Schytte/Schytte - Berceuse op. 26, nr. 7",type:"welte-red"},{druid:"pb026mb0704",image_url:"https://stacks.stanford.edu/image/iiif/pb026mb0704%2Fpb026mb0704_0001/info.json",number:"921",publisher:"Welte-Mignon",title:"Schütt/Conne - Kunstlerleben waltz: concert paraphrase",type:"welte-red"},{druid:"ny937ph6981",image_url:"https://stacks.stanford.edu/image/iiif/ny937ph6981%2Fny937ph6981_0001/info.json",number:"3745",publisher:"Welte-Mignon",title:"Schütt/Danziger - Romance op. 38, no. 2",type:"welte-red"},{druid:"sp773vt2651",image_url:"https://stacks.stanford.edu/image/iiif/sp773vt2651%2Fsp773vt2651_0001/info.json",number:"3695",publisher:"Welte-Mignon",title:"Schütt/Seckendorf Popper - Carnaval mignon: scènes pantomimiques: op. 48",type:"welte-red"},{druid:"vq862qw5039",image_url:"https://stacks.stanford.edu/image/iiif/vq862qw5039%2Fvq862qw5039_0002/info.json",number:"40011",publisher:"Princesa",title:"Sciammarella - No te engañes corazón: tango",type:"88-note"},{druid:"vf252dc4872",image_url:"https://stacks.stanford.edu/image/iiif/vf252dc4872%2Fvf252dc4872_0001/info.json",number:"1697",publisher:"Welte-Mignon",title:"Scott/Scott - A Song from the east: Danse nègre",type:"welte-red"},{druid:"br324td1538",image_url:"https://stacks.stanford.edu/image/iiif/br324td1538%2Fbr324td1538_0001/info.json",number:"C7602",publisher:"De Luxe",title:"Scriabin/Pouishnoff - Poeme op. 32, no. 1",type:"welte-licensee"},{druid:"zf673fy4620",image_url:"https://stacks.stanford.edu/image/iiif/zf673fy4620%2Fzf673fy4620_0001/info.json",number:"2068",publisher:"Welte-Mignon",title:"Scriabin/Scriabin - Poême: op. 32, no. 1",type:"welte-red"},{druid:"sk925fn6049",image_url:"https://stacks.stanford.edu/image/iiif/sk925fn6049%2Fsk925fn6049_0001/info.json",number:"2021",publisher:"Welte-Mignon",title:"Scriabin/Vengerova - Prelude für die linke hand",type:"welte-red"},{druid:"vg335rq3648",image_url:"https://stacks.stanford.edu/image/iiif/vg335rq3648%2Fvg335rq3648_0001/info.json",number:"2634",publisher:"Welte-Mignon",title:"Sibelius/Di Benici - Caprice f minor",type:"welte-green"},{druid:"vp438dy0628",image_url:"https://stacks.stanford.edu/image/iiif/vp438dy0628%2Fvp438dy0628_0001/info.json",number:"3356",publisher:"Welte-Mignon",title:"Sibelius/Flohr - Finlandia",type:"welte-red"},{druid:"zw828tx0197",image_url:"https://stacks.stanford.edu/image/iiif/zw828tx0197%2Fzw828tx0197_0001/info.json",number:"3537",publisher:"Welte-Mignon",title:"Silésu/Daly - Un Peu d'amour: popular song",type:"welte-red"},{druid:"qg041hb4569",image_url:"https://stacks.stanford.edu/image/iiif/qg041hb4569%2Fqg041hb4569_0001/info.json",number:"2993",publisher:"Welte-Mignon",title:"Sinding/Albert - March grotesque",type:"welte-red"},{druid:"qk333zc6515",image_url:"https://stacks.stanford.edu/image/iiif/qk333zc6515%2Fqk333zc6515_0001/info.json",number:"2637",publisher:"Welte-Mignon",title:"Sinding/Di Benici - Frühlingsrauschen: op. 32, no. 3",type:"welte-red"},{druid:"gq990gn6753",image_url:"https://stacks.stanford.edu/image/iiif/gq990gn6753%2Fgq990gn6753_0001/info.json",number:"375",publisher:"Welte-Mignon",title:"Sinding/Wendling - Rustle of spring: op. 32, no. 3",type:"welte-red"},{druid:"fr396nf3639",image_url:"https://stacks.stanford.edu/image/iiif/fr396nf3639%2Ffr396nf3639_0001/info.json",number:"1539",publisher:"Welte-Mignon",title:"Steinway/Brightwell - Madeleine: valse poetique",type:"welte-red"},{druid:"jt308hp0877",image_url:"https://stacks.stanford.edu/image/iiif/jt308hp0877%2Fjt308hp0877_0001/info.json",number:"2198",publisher:"Welte-Mignon",title:"Straus/Burkard - Walzer: der tapfere Soldat",type:"welte-red"},{druid:"qp421cd7297",image_url:"https://stacks.stanford.edu/image/iiif/qp421cd7297%2Fqp421cd7297_0001/info.json",number:"2613",publisher:"Welte-Mignon",title:"Straus/Goodall - The Chocolate soldier: selection 1",type:"welte-red"},{druid:"sv842td3290",image_url:"https://stacks.stanford.edu/image/iiif/sv842td3290%2Fsv842td3290_0001/info.json",number:"4190",publisher:"Welte-Mignon",title:"Strauss-Grünfeld/Serkin - Delirien-walzer",type:"welte-red"},{druid:"kp368nb7707",image_url:"https://stacks.stanford.edu/image/iiif/kp368nb7707%2Fkp368nb7707_0001/info.json",number:"532",publisher:"Welte-Mignon",title:"Strauss-Tausig/Zadora - Man lives but once",type:"welte-red"},{druid:"rn154dd5329",image_url:"https://stacks.stanford.edu/image/iiif/rn154dd5329%2Frn154dd5329_0001/info.json",number:"357",publisher:"Welte-Mignon",title:"Strauss/Brzeziński - An der schönen blauen donau",type:"welte-red"},{druid:"sj250cc6451",image_url:"https://stacks.stanford.edu/image/iiif/sj250cc6451%2Fsj250cc6451_0001/info.json",number:"277",publisher:"Welte-Mignon",title:"Strauss/Brzeziński - Rosen a. d. süden",type:"welte-red"},{druid:"sk565bp3463",image_url:"https://stacks.stanford.edu/image/iiif/sk565bp3463%2Fsk565bp3463_0001/info.json",number:"349",publisher:"Welte-Mignon",title:"Strauss/Kupfernagel - Wiener blut: Walzer",type:"welte-red"},{druid:"qp506dy4541",image_url:"https://stacks.stanford.edu/image/iiif/qp506dy4541%2Fqp506dy4541_0001/info.json",number:"1398",publisher:"Welte-Mignon",title:"Strauss/Orlando - Du und du: aus Fledermaus: Walzer",type:"welte-red"},{druid:"kt568yb8982",image_url:"https://stacks.stanford.edu/image/iiif/kt568yb8982%2Fkt568yb8982_0001/info.json",number:"382",publisher:"Welte-Mignon",title:"Strauss/Schnabel - Village swallows",type:"welte-red"},{druid:"zw485gh6070",image_url:"https://stacks.stanford.edu/image/iiif/zw485gh6070%2Fzw485gh6070_0001/info.json",number:"1184",publisher:"Welte-Mignon",title:'Strauss/Strauss - Liebesscene a. "heldenleben"',type:"welte-red"},{druid:"ds528dg7725",image_url:"https://stacks.stanford.edu/image/iiif/ds528dg7725%2Fds528dg7725_0001/info.json",number:"D-759",publisher:"Aeolian Co., Ltd.",title:"Stravinsky/Stravinsky - My life and music: First series: To 'The fire-bird,' in six rolls",type:"duo-art"},{druid:"gk717vy6323",image_url:"https://stacks.stanford.edu/image/iiif/gk717vy6323%2Fgk717vy6323_0001/info.json",number:"D-759",publisher:"Aeolian Co., Ltd.",title:"Stravinsky/Stravinsky - My life and music: First series: To 'The fire-bird,' in six rolls",type:"duo-art"},{druid:"kk651ck1593",image_url:"https://stacks.stanford.edu/image/iiif/kk651ck1593%2Fkk651ck1593_0001/info.json",number:"D-759",publisher:"Aeolian Co., Ltd.",title:"Stravinsky/Stravinsky - My life and music: First series: To 'The fire-bird,' in six rolls",type:"duo-art"},{druid:"rb863nd0220",image_url:"https://stacks.stanford.edu/image/iiif/rb863nd0220%2Frb863nd0220_0001/info.json",number:"D-759",publisher:"Aeolian Co., Ltd.",title:"Stravinsky/Stravinsky - My life and music: First series: To 'The fire-bird,' in six rolls",type:"duo-art"},{druid:"zc672fb8379",image_url:"https://stacks.stanford.edu/image/iiif/zc672fb8379%2Fzc672fb8379_0001/info.json",number:"D-759",publisher:"Aeolian Co., Ltd.",title:"Stravinsky/Stravinsky - My life and music: First series: To 'The fire-bird,' in six rolls",type:"duo-art"},{druid:"rh801bs4556",image_url:"https://stacks.stanford.edu/image/iiif/rh801bs4556%2Frh801bs4556_0001/info.json",number:"2615",publisher:"Welte-Mignon",title:"Sullivan/Goodall - The Gondoliers, or the king of barataria",type:"welte-red"},{druid:"xg228jc5213",image_url:"https://stacks.stanford.edu/image/iiif/xg228jc5213%2Fxg228jc5213_0001/info.json",number:"2616",publisher:"Welte-Mignon",title:"Sullivan/Goodall - The Mikado, or the town of titibu: I (Selection)",type:"welte-red"},{druid:"zp424ps8426",image_url:"https://stacks.stanford.edu/image/iiif/zp424ps8426%2Fzp424ps8426_0001/info.json",number:"2617",publisher:"Welte-Mignon",title:"Sullivan/Goodall - The Mikado, or the town of titibu: II (Selection)",type:"welte-red"},{druid:"fg895gs1373",image_url:"https://stacks.stanford.edu/image/iiif/fg895gs1373%2Ffg895gs1373_0001/info.json",number:"2618",publisher:"Welte-Mignon",title:"Sullivan/Goodall - The Yeomen of the guard, or the merry man and his maid",type:"welte-red"},{druid:"zc118hn1152",image_url:"https://stacks.stanford.edu/image/iiif/zc118hn1152%2Fzc118hn1152_0001/info.json",number:"2995",publisher:"Welte-Mignon",title:"Tchaikovsky/Albert - Casse noisette suite op. 71, i. teil",type:"welte-red"},{druid:"fk960pq3086",image_url:"https://stacks.stanford.edu/image/iiif/fk960pq3086%2Ffk960pq3086_0001/info.json",number:"2995",publisher:"Welte-Mignon",title:"Tchaikovsky/Albert - Casse noisette suite: op. 71, part 1",type:"welte-red"},{druid:"hk752ck1008",image_url:"https://stacks.stanford.edu/image/iiif/hk752ck1008%2Fhk752ck1008_0001/info.json",number:"3330",publisher:"Welte-Mignon",title:"Tchaikovsky/Lászlò - Symphonic pathétic op. 74, no. 6, part ii",type:"welte-red"},{druid:"bk297ff8944",image_url:"https://stacks.stanford.edu/image/iiif/bk297ff8944%2Fbk297ff8944_0001/info.json",number:"3329",publisher:"Welte-Mignon",title:"Tchaikovsky/Lászlò - Symphonic pathétic op. 74, part. i (final)",type:"welte-red"},{druid:"rv766dc1369",image_url:"https://stacks.stanford.edu/image/iiif/rv766dc1369%2Frv766dc1369_0001/info.json",number:"3328",publisher:"Welte-Mignon",title:"Tchaikovsky/Lászlò - Symphony pathétique op. 74, no. 6, part i",type:"welte-red"},{druid:"gr136pc5388",image_url:"https://stacks.stanford.edu/image/iiif/gr136pc5388%2Fgr136pc5388_0001/info.json",number:"3331",publisher:"Welte-Mignon",title:"Tchaikovsky/Lászlò - Symphony pathétique op. 74, no. 6, part iii",type:"welte-red"},{druid:"qm069fy5200",image_url:"https://stacks.stanford.edu/image/iiif/qm069fy5200%2Fqm069fy5200_0001/info.json",number:"3332",publisher:"Welte-Mignon",title:"Tchaikovsky/Lászlò - Symphony pathétique op. 74, no. 6, part iv",type:"welte-red"},{druid:"jv485mx5227",image_url:"https://stacks.stanford.edu/image/iiif/jv485mx5227%2Fjv485mx5227_0002/info.json",number:"40003",publisher:"Princesa",title:"Texidor - Amparito roca: pasodoble",type:"88-note"},{druid:"vj052cw2158",image_url:"https://stacks.stanford.edu/image/iiif/vj052cw2158%2Fvj052cw2158_0001/info.json",number:"1534",publisher:"Welte-Mignon",title:"Thalberg/Brightwell - Home sweet home",type:"welte-red"},{druid:"xg924dm1245",image_url:"https://stacks.stanford.edu/image/iiif/xg924dm1245%2Fxg924dm1245_0001/info.json",number:"3430",publisher:"Welte-Mignon",title:"Toselli/Haass - Serenade",type:"welte-red"},{druid:"cw746gb6753",image_url:"https://stacks.stanford.edu/image/iiif/cw746gb6753%2Fcw746gb6753_0002/info.json",number:"473",publisher:"Princesa",title:"Verdi - Aida: Acto II: Gran marcha triunfal",type:"88-note"},{druid:"mf443ns5829",image_url:"https://stacks.stanford.edu/image/iiif/mf443ns5829%2Fmf443ns5829_0001/info.json",number:"445",publisher:"Welte-Mignon",title:"Verdi-Liszt/Busoni - Rigoletto: (paraphrase)",type:"welte-red"},{druid:"np204br1080",image_url:"https://stacks.stanford.edu/image/iiif/np204br1080%2Fnp204br1080_0001/info.json",number:"2844",publisher:"Welte-Mignon",title:"Verdi/Gayraud - Rigoletto: Fantasie",type:"welte-red"},{druid:"sr577gv4813",image_url:"https://stacks.stanford.edu/image/iiif/sr577gv4813%2Fsr577gv4813_0001/info.json",number:"2844",publisher:"Welte-Mignon",title:"Verdi/Gayraud - Rigoletto: fantasia",type:"welte-red"},{druid:"nq190zp1066",image_url:"https://stacks.stanford.edu/image/iiif/nq190zp1066%2Fnq190zp1066_0001/info.json",number:"1341",publisher:"Welte-Mignon",title:"Verdi/Starke - Aïda: Fantasie",type:"welte-red"},{druid:"nx970yn7253",image_url:"https://stacks.stanford.edu/image/iiif/nx970yn7253%2Fnx970yn7253_0001/info.json",number:"1339",publisher:"Welte-Mignon",title:"Verdi/Starke - La Traviata: fantasie",type:"welte-red"},{druid:"tw054jm0773",image_url:"https://stacks.stanford.edu/image/iiif/tw054jm0773%2Ftw054jm0773_0001/info.json",number:"1339",publisher:"Welte-Mignon",title:"Verdi/Starke - La Traviata: fantasie",type:"welte-red"},{druid:"vr247rd6766",image_url:"https://stacks.stanford.edu/image/iiif/vr247rd6766%2Fvr247rd6766_0002/info.json",number:"4312",publisher:" Princesa",title:"Vidal - Porque era negro: tango",type:"88-note"},{druid:"tp613xb9088",image_url:"https://stacks.stanford.edu/image/iiif/tp613xb9088%2Ftp613xb9088_0002/info.json",number:"4518",publisher:"Princesa",title:"Viladomat - El Tango de la cocaína",type:"88-note"},{druid:"ps866sb0637",image_url:"https://stacks.stanford.edu/image/iiif/ps866sb0637%2Fps866sb0637_0002/info.json",number:"2841",publisher:"Princesa",title:"Villa - Cantos asturianos: no. 1: Andante, allegro non molto",type:"88-note"},{druid:"sm344xv2220",image_url:"https://stacks.stanford.edu/image/iiif/sm344xv2220%2Fsm344xv2220_0002/info.json",number:"357",publisher:"Princesa",title:"Vives - Bohemios: Escena y coro",type:"88-note"},{druid:"gh208gz5033",image_url:"https://stacks.stanford.edu/image/iiif/gh208gz5033%2Fgh208gz5033_0001/info.json",number:"763",publisher:"Welte-Mignon",title:"Vogrich/Mero - Staccato caprice",type:"welte-red"},{druid:"dj406yq6980",image_url:"https://stacks.stanford.edu/image/iiif/dj406yq6980%2Fdj406yq6980_0001/info.json",number:"663",publisher:"Welte-Mignon",title:"Wagner-Brassin/Hofmann - Feuerzauber",type:"welte-red"},{druid:"fd660zf8362",image_url:"https://stacks.stanford.edu/image/iiif/fd660zf8362%2Ffd660zf8362_0001/info.json",number:"990",publisher:"Welte-Mignon",title:"Wagner-Bülow/Elvyn - Meistersinger von nürnberg: Vorspiel",type:"welte-red"},{druid:"bs173rx9307",image_url:"https://stacks.stanford.edu/image/iiif/bs173rx9307%2Fbs173rx9307_0001/info.json",number:"188",publisher:"Welte-Mignon",title:"Wagner-Liszt/Grünfeld - Isoldens liebestod",type:"welte-red"},{druid:"qf751dd5412",image_url:"https://stacks.stanford.edu/image/iiif/qf751dd5412%2Fqf751dd5412_0001/info.json",number:"662",publisher:"Welte-Mignon",title:"Wagner-Liszt/Hofmann - Tannhauser overture",type:"welte-red"},{druid:"hh095vc8073",image_url:"https://stacks.stanford.edu/image/iiif/hh095vc8073%2Fhh095vc8073_0001/info.json",number:"662",publisher:"Welte-Mignon",title:"Wagner-Liszt/Hofmann - Tannhäuser overture",type:"welte-red"},{druid:"hg709nf1997",image_url:"https://stacks.stanford.edu/image/iiif/hg709nf1997%2Fhg709nf1997_0001/info.json",number:"3019",publisher:"Welte-Mignon",title:"Wagner-Rybner/Rybner - Die Meistersinger von nürnberg: Konzert-Paraphrase",type:"welte-red"},{druid:"yr287jf4422",image_url:"https://stacks.stanford.edu/image/iiif/yr287jf4422%2Fyr287jf4422_0001/info.json",number:"144",publisher:"Welte-Mignon",title:"Wagner-Spindler/Adam-Benard - Lied a. d. abendstern: a. Tannhäuser op. 94",type:"welte-red"},{druid:"ys288dd6430",image_url:"https://stacks.stanford.edu/image/iiif/ys288dd6430%2Fys288dd6430_0001/info.json",number:"118",publisher:"Welte-Mignon",title:"Wagner/Adam-Benard - Schwanenlied aus lohengrin",type:"welte-red"},{druid:"dr835xg3992",image_url:"https://stacks.stanford.edu/image/iiif/dr835xg3992%2Fdr835xg3992_0001/info.json",number:"3335",publisher:"Welte-Mignon",title:"Wagner/Lászlò - Rienzi: Ouverture",type:"welte-red"},{druid:"rp146dk0477",image_url:"https://stacks.stanford.edu/image/iiif/rp146dk0477%2Frp146dk0477_0001/info.json",number:"1352",publisher:"Welte-Mignon",title:"Wagner/Mottl - Am stillen herd zur winterszeit: a. die Meistersinger von Nürnberg",type:"welte-red"},{druid:"mg285ps6787",image_url:"https://stacks.stanford.edu/image/iiif/mg285ps6787%2Fmg285ps6787_0001/info.json",number:"1352",publisher:"Welte-Mignon",title:"Wagner/Mottl - Die Meistersinger von nürnberg: Am stillen Herd zur Winterszeit",type:"welte-red"},{druid:"jn038xx9588",image_url:"https://stacks.stanford.edu/image/iiif/jn038xx9588%2Fjn038xx9588_0001/info.json",number:"1348",publisher:"Welte-Mignon",title:"Wagner/Mottl - Lohengrin: Bridal chorus",type:"welte-red"},{druid:"dt046tz6296",image_url:"https://stacks.stanford.edu/image/iiif/dt046tz6296%2Fdt046tz6296_0001/info.json",number:"1349",publisher:"Welte-Mignon",title:"Wagner/Mottl - Lohengrin: Elsa's dream",type:"welte-red"},{druid:"nn203bm7432",image_url:"https://stacks.stanford.edu/image/iiif/nn203bm7432%2Fnn203bm7432_0001/info.json",number:"1347",publisher:"Welte-Mignon",title:"Wagner/Mottl - Tristan und isolde: Vorspiel",type:"welte-red"},{druid:"xx912rs1788",image_url:"https://stacks.stanford.edu/image/iiif/xx912rs1788%2Fxx912rs1788_0001/info.json",number:"1346",publisher:"Welte-Mignon",title:"Wagner/Mottl - Vorspiel zu parsival",type:"welte-red"},{druid:"xy736dn5214",image_url:"https://stacks.stanford.edu/image/iiif/xy736dn5214%2Fxy736dn5214_0002/info.json",number:"2539",publisher:"N/A",title:"Waldteufel - Très jolie: suite de valses",type:"88-note"},{druid:"xg670df7262",image_url:"https://stacks.stanford.edu/image/iiif/xg670df7262%2Fxg670df7262_0001/info.json",number:"2466",publisher:"Welte-Mignon",title:"Waldteufel/Dubois - Immer oder nimmer: Walzer",type:"welte-red"},{druid:"jn782fq7439",image_url:"https://stacks.stanford.edu/image/iiif/jn782fq7439%2Fjn782fq7439_0001/info.json",number:"134",publisher:"Welte-Mignon",title:"Weber/Adam-Benard - Rondo brillante op. 62",type:"welte-red"},{druid:"jd143sb1087",image_url:"https://stacks.stanford.edu/image/iiif/jd143sb1087%2Fjd143sb1087_0001/info.json",number:"5553",publisher:"Welte-Mignon",title:"Whiteman/Wolf - Wonderful one: waltz song",type:"welte-red"},{druid:"sx275gw8801",image_url:"https://stacks.stanford.edu/image/iiif/sx275gw8801%2Fsx275gw8801_0001/info.json",number:"5675",publisher:"Welte-Mignon",title:"Youmans/Johnson - Tea for two: fox-trot",type:"welte-red"},{druid:"yk645sm6970",image_url:"https://stacks.stanford.edu/image/iiif/yk645sm6970%2Fyk645sm6970_0001/info.json",number:"5905",publisher:"Welte-Mignon",title:'Youmans/Sommer - Hallelujah!: fox-trot from "Hit the deck"',type:"welte-red"}];const{window:Jd}=fe;function ep(e){let t,i,n,s;t=new Sh({props:{metadata:e[4]}});let r=!e[6].count&&tp();return{c(){j(t.$$.fragment),i=h(),r&&r.c(),n=T()},l(e){z(t.$$.fragment,e),i=c(e),r&&r.l(e),n=T()},m(e,o){N(t,e,o),f(e,i,o),r&&r.m(e,o),f(e,n,o),s=!0},p(e,i){const s={};16&i[0]&&(s.metadata=e[4]),t.$set(s),e[6].count?r&&(r.d(1),r=null):r||(r=tp(),r.c(),r.m(n.parentNode,n))},i(e){s||(v(t.$$.fragment,e),s=!0)},o(e){b(t.$$.fragment,e),s=!1},d(e){L(t,e),e&&m(i),r&&r.d(e),e&&m(n)}}}function tp(e){let t,i,n,s;return{c(){t=u("p"),i=P("Note:"),n=u("br"),s=P("Hole visualization data is not available for this roll at\n            this time. Hole highlighting will not be enabled."),this.h()},l(e){t=d(e,"P",{class:!0});var r=p(t);i=M(r,"Note:"),n=d(r,"BR",{}),s=M(r,"Hole visualization data is not available for this roll at\n            this time. Hole highlighting will not be enabled."),r.forEach(m),this.h()},h(){g(t,"class","svelte-hmwwtk")},m(e,r){f(e,t,r),C(t,i),C(t,n),C(t,s)},d(e){e&&m(t)}}}function ip(e){let t,i,n,s,r;function o(t){e[25](t)}let a={rollListItems:e[14]};void 0!==e[0]&&(a.currentRoll=e[0]),t=new bh({props:a}),W.push((()=>Z(t,"currentRoll",o)));let l=e[2]&&ep(e);return{c(){j(t.$$.fragment),n=h(),l&&l.c(),s=T()},l(e){z(t.$$.fragment,e),n=c(e),l&&l.l(e),s=T()},m(e,i){N(t,e,i),f(e,n,i),l&&l.m(e,i),f(e,s,i),r=!0},p(e,n){const r={};!i&&1&n[0]&&(i=!0,r.currentRoll=e[0],X((()=>i=!1))),t.$set(r),e[2]?l?(l.p(e,n),4&n[0]&&v(l,1)):(l=ep(e),l.c(),v(l,1),l.m(s.parentNode,s)):l&&(w(),b(l,1,1,(()=>{l=null})),x())},i(e){r||(v(t.$$.fragment,e),v(l),r=!0)},o(e){b(t.$$.fragment,e),b(l),r=!1},d(e){L(t,e),e&&m(n),l&&l.d(e),e&&m(s)}}}function np(e){let t,i,n={imageUrl:e[0].image_url,holeData:e[5],holesByTickInterval:e[6],skipToTick:e[16]};return t=new Iu({props:n}),e[26](t),{c(){j(t.$$.fragment)},l(e){z(t.$$.fragment,e)},m(e,n){N(t,e,n),i=!0},p(e,i){const n={};1&i[0]&&(n.imageUrl=e[0].image_url),32&i[0]&&(n.holeData=e[5]),64&i[0]&&(n.holesByTickInterval=e[6]),t.$set(n)},i(e){i||(v(t.$$.fragment,e),i=!0)},o(e){b(t.$$.fragment,e),i=!1},d(i){e[26](null),L(t,i)}}}function sp(e){let t,i,n,s;return i=new Hu({props:{keyCount:"88",startNote:e[8],stopNote:e[9]}}),{c(){t=u("div"),j(i.$$.fragment),this.h()},l(e){t=d(e,"DIV",{id:!0,class:!0});var n=p(t);z(i.$$.fragment,n),n.forEach(m),this.h()},h(){g(t,"id","keyboard-overlay"),g(t,"class","svelte-hmwwtk")},m(e,n){f(e,t,n),N(i,t,null),s=!0},p(e,t){const n={};256&t[0]&&(n.startNote=e[8]),512&t[0]&&(n.stopNote=e[9]),i.$set(n)},i(e){s||(v(i.$$.fragment,e),y((()=>{n||(n=_(t,ye,{},!0)),n.run(1)})),s=!0)},o(e){b(i.$$.fragment,e),n||(n=_(t,ye,{},!1)),n.run(0),s=!1},d(e){e&&m(t),L(i),e&&n&&n.end()}}}function rp(e){let i,n;return i=new Ld({props:{playPauseApp:e[18],stopApp:e[19],skipToPercentage:e[17]}}),{c(){j(i.$$.fragment)},l(e){z(i.$$.fragment,e)},m(e,t){N(i,e,t),n=!0},p:t,i(e){n||(v(i.$$.fragment,e),n=!0)},o(e){b(i.$$.fragment,e),n=!1},d(e){L(i,e)}}}function op(e){let i,n;return i=new Nu({props:{outside:!0}}),{c(){j(i.$$.fragment)},l(e){z(i.$$.fragment,e)},m(e,t){N(i,e,t),n=!0},p:t,i(e){n||(v(i.$$.fragment,e),n=!0)},o(e){b(i.$$.fragment,e),n=!1},d(e){L(i,e)}}}function ap(e){let t,i,n,s;return i=new Hu({props:{keyCount:"88",startNote:e[8],stopNote:e[9]}}),{c(){t=u("div"),j(i.$$.fragment),this.h()},l(e){t=d(e,"DIV",{id:!0,class:!0});var n=p(t);z(i.$$.fragment,n),n.forEach(m),this.h()},h(){g(t,"id","keyboard-container"),g(t,"class","svelte-hmwwtk")},m(e,n){f(e,t,n),N(i,t,null),s=!0},p(e,t){const n={};256&t[0]&&(n.startNote=e[8]),512&t[0]&&(n.stopNote=e[9]),i.$set(n)},i(r){s||(v(i.$$.fragment,r),y((()=>{n||(n=_(t,e[15],{},!0)),n.run(1)})),s=!0)},o(r){b(i.$$.fragment,r),n||(n=_(t,e[15],{},!1)),n.run(0),s=!1},d(e){e&&m(t),L(i),e&&n&&n.end()}}}function lp(e){let t,i;return t=new Vd({}),{c(){j(t.$$.fragment)},l(e){z(t.$$.fragment,e)},m(e,n){N(t,e,n),i=!0},i(e){i||(v(t.$$.fragment,e),i=!0)},o(e){b(t.$$.fragment,e),i=!1},d(e){L(t,e)}}}function hp(e){let t,i,n,s,r,o,a,l,y,_,k,S,E,P,M,R,A,O,I,F,B,W,q,$,V,H;n=new Gd({props:{id:"left-sidebar",width:"20vw",$$slots:{default:[ip]},$$scope:{ctx:e}}});let U=e[2]&&np(e),G=e[12].showKeyboard&&e[12].overlayKeyboard&&sp(e);l=new Gd({props:{id:"right-sidebar",width:"20vw",position:"left",$$slots:{default:[rp]},$$scope:{ctx:e}}});const Z=[ap,op],X=[];function Y(e,t){return e[12].showKeyboard&&!e[12].overlayKeyboard?0:e[12].showKeyboard?-1:1}~(_=Y(e))&&(k=X[_]=Z[_](e)),E=new Kd({props:{showLoadingSpinner:e[3]}});M=new ah({props:{}}),e[27](M),M.$on("loading",e[28]),A=new nc({props:{playPauseApp:e[18],stopApp:e[19],updateTickByViewportIncrement:e[10],panHorizontal:e[11]}}),I=new Bc({}),B=new th({});let K=e[13]&&lp();return{c(){t=u("div"),i=u("div"),j(n.$$.fragment),s=h(),r=u("div"),U&&U.c(),o=h(),G&&G.c(),a=h(),j(l.$$.fragment),y=h(),k&&k.c(),S=h(),j(E.$$.fragment),P=h(),j(M.$$.fragment),R=h(),j(A.$$.fragment),O=h(),j(I.$$.fragment),F=h(),j(B.$$.fragment),W=h(),K&&K.c(),q=T(),this.h()},l(e){t=d(e,"DIV",{id:!0,class:!0});var h=p(t);i=d(h,"DIV",{class:!0});var u=p(i);z(n.$$.fragment,u),s=c(u),r=d(u,"DIV",{id:!0,class:!0});var g=p(r);U&&U.l(g),o=c(g),G&&G.l(g),g.forEach(m),a=c(u),z(l.$$.fragment,u),u.forEach(m),y=c(h),k&&k.l(h),S=c(h),z(E.$$.fragment,h),h.forEach(m),P=c(e),z(M.$$.fragment,e),R=c(e),z(A.$$.fragment,e),O=c(e),z(I.$$.fragment,e),F=c(e),z(B.$$.fragment,e),W=c(e),K&&K.l(e),q=T(),this.h()},h(){g(r,"id","roll"),g(r,"class","svelte-hmwwtk"),g(i,"class","svelte-hmwwtk"),g(t,"id","app"),g(t,"class","svelte-hmwwtk")},m(h,u){f(h,t,u),C(t,i),N(n,i,null),C(i,s),C(i,r),U&&U.m(r,null),C(r,o),G&&G.m(r,null),C(i,a),N(l,i,null),C(t,y),~_&&X[_].m(t,null),C(t,S),N(E,t,null),f(h,P,u),N(M,h,u),f(h,R,u),N(A,h,u),f(h,O,u),N(I,h,u),f(h,F,u),N(B,h,u),f(h,W,u),K&&K.m(h,u),f(h,q,u),$=!0,V||(H=D(Jd,"popstate",e[24]),V=!0)},p(e,i){const s={};85&i[0]|16384&i[1]&&(s.$$scope={dirty:i,ctx:e}),n.$set(s),e[2]?U?(U.p(e,i),4&i[0]&&v(U,1)):(U=np(e),U.c(),v(U,1),U.m(r,o)):U&&(w(),b(U,1,1,(()=>{U=null})),x()),e[12].showKeyboard&&e[12].overlayKeyboard?G?(G.p(e,i),4096&i[0]&&v(G,1)):(G=sp(e),G.c(),v(G,1),G.m(r,null)):G&&(w(),b(G,1,1,(()=>{G=null})),x());const a={};16384&i[1]&&(a.$$scope={dirty:i,ctx:e}),l.$set(a);let h=_;_=Y(e),_===h?~_&&X[_].p(e,i):(k&&(w(),b(X[h],1,1,(()=>{X[h]=null})),x()),~_?(k=X[_],k?k.p(e,i):(k=X[_]=Z[_](e),k.c()),v(k,1),k.m(t,S)):k=null);const u={};8&i[0]&&(u.showLoadingSpinner=e[3]),E.$set(u);M.$set({});const c={};1024&i[0]&&(c.updateTickByViewportIncrement=e[10]),2048&i[0]&&(c.panHorizontal=e[11]),A.$set(c),e[13]?K?8192&i[0]&&v(K,1):(K=lp(),K.c(),v(K,1),K.m(q.parentNode,q)):K&&(w(),b(K,1,1,(()=>{K=null})),x())},i(e){$||(v(n.$$.fragment,e),v(U),v(G),v(l.$$.fragment,e),v(k),v(E.$$.fragment,e),v(M.$$.fragment,e),v(A.$$.fragment,e),v(I.$$.fragment,e),v(B.$$.fragment,e),v(K),$=!0)},o(e){b(n.$$.fragment,e),b(U),b(G),b(l.$$.fragment,e),b(k),b(E.$$.fragment,e),b(M.$$.fragment,e),b(A.$$.fragment,e),b(I.$$.fragment,e),b(B.$$.fragment,e),b(K),$=!1},d(i){i&&m(t),L(n),U&&U.d(),G&&G.d(),L(l),~_&&X[_].d(),L(E),i&&m(P),e[27](null),L(M,i),i&&m(R),L(A,i),i&&m(O),L(I,i),i&&m(F),L(B,i),i&&m(W),K&&K.d(i),i&&m(q),V=!1,H()}}}function up(e,t,i){let n,s,r,o,a,l,h,u;S(e,it,(e=>i(23,n=e))),S(e,Ie,(e=>i(37,s=e))),S(e,Ue,(e=>i(38,r=e))),S(e,He,(e=>i(39,o=e))),S(e,Fe,(e=>i(40,a=e))),S(e,Ae,(e=>i(41,l=e))),S(e,rt,(e=>i(12,h=e))),S(e,Wd,(e=>i(13,u=e)));let c,d,p,m,g,f,v,y,_,w,b,x,k,T,E,C,P,M,R=!0,D=!1,A=!0,O=new Se;const j=Qd.map((e=>({...e,_label:`${e.number} ${e.title} [${e.publisher}]`}))),z=e=>{e<0&&k(),F(it,n=e,n),w((()=>y.skipToTick(n)))},N=e=>{c=fetch(`./midi/${e.druid}.mid`).then((e=>{if(200===e.status)return e.arrayBuffer();throw new Error("Error fetching MIDI file! (Operation cancelled)")})).then((e=>{C?.$destroy(),c=!1,R||Kl(),i(2,D=!1),k(),E(),nt.reset(),Ve.reset(),qe.reset(),$e.reset(),i(6,O=new Se),y.loadArrayBuffer(e)})).catch((e=>{Ql({title:"Error!",message:e,type:"error"}),i(0,p=m)})),d=fetch(`./json/${e.druid}.json`).then((e=>{if(200===e.status)return e.json();throw new Error("Error fetching metadata file! (Operation cancelled)")})).catch((e=>{Ql({title:"Error!",message:e,type:"error"}),i(0,p=m)})),Promise.all([c,d,_]).then((([,e])=>{i(4,g=(({holeData:e,...t})=>t)(e)),i(5,f=e.holeData),ct(f,l,a),(()=>{const{FIRST_HOLE:e}=l,t=parseInt(e,10);f.forEach((e=>{const{y:i,h:n}=e,s=i-t,r=i+n-t;O.insert(s,r,e)}))})(),F(He,o=s,o),F(Ue,r=s,r),i(2,D=!0),i(3,A=!1),R=!1,i(21,m=p);const t=new URLSearchParams(window.location.search);if(t.has("druid")&&t.get("druid")!==p.druid){const e=new URL(window.location);e.searchParams.set("druid",p.druid),window.history.pushState({roll:p},"",e)}}))},L=()=>{const e=new URLSearchParams(window.location.search);if(e.has("druid")){const t=e.get("druid"),n=j.find((e=>e.druid===t));void 0!==n?i(0,p=n):Ql({title:"DRUID not found!",message:"Please check the specified DRUID, or select a roll to continue.",type:"error",closable:!1})}else i(0,p=j[Math.floor(Math.random()*j.length)])};I((async()=>{document.getElementById("loading").remove(),i(22,({midiSamplePlayer:y,pianoReady:_,updatePlayer:w,startNote:b,stopNote:x,pausePlayback:k,startPlayback:T,resetPlayback:E}=v),y,i(8,b),i(9,x)),L()}));return e.$$.update=()=>{2097153&e.$$.dirty[0]&&p!==m&&N(p),12582912&e.$$.dirty[0]&&nt.update((()=>at(n/y?.totalTicks,0,1))),2&e.$$.dirty[0]&&C&&i(10,({updateTickByViewportIncrement:P,panHorizontal:M}=C),P,(i(11,M),i(1,C)))},[p,C,D,A,g,f,O,v,b,x,P,M,h,u,j,(e,{delay:t=0,duration:i=300})=>{const n=parseInt(getComputedStyle(e).height,10);return{delay:t,duration:i,css:e=>`height: ${function(e){return e<.5?8*Math.pow(e,4):-8*Math.pow(e-1,4)+1}(e)*n}px`}},z,e=>z(y.totalTicks*e),()=>{y.isPlaying()?k():T()},()=>{k(),E()},L,m,y,n,({state:e})=>e?.roll?i(0,p=e.roll):L(),function(e){p=e,i(0,p)},function(e){W[e?"unshift":"push"]((()=>{C=e,i(1,C)}))},function(e){W[e?"unshift":"push"]((()=>{v=e,i(7,v)}))},({detail:e})=>{i(3,A=!0),e.then((()=>i(3,A=!1))).catch((()=>{}))}]}class cp extends a{constructor(e){super(),l(this,e,up,hp,i,{},null,[-1,-1])}}export{cp as default};
