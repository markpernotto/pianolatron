import{y as identity,x as noop,s as safe_not_equal,z as subscribe,A as run_all,B as is_function,C as get_store_value,D as SvelteComponent,i as init,E as space,q as element,F as claim_space,r as claim_element,u as children,G as detach,H as attr,I as insert_hydration,J as append_hydration,o as transition_in,K as add_render_callback,L as create_bidirectional_transition,k as group_outros,t as transition_out,n as check_outros,M as text,N as claim_text,O as set_data,P as listen,Q as destroy_each,b as empty,R as component_subscribe,T as createEventDispatcher,U as set_store_value,V as toggle_class,W as stop_propagation,X as prevent_default,Y as tick,Z as binding_callbacks,_ as HtmlTagHydration,$ as claim_html_tag,a0 as bind,c as create_component,f as claim_component,m as mount_component,a1 as add_flush_callback,l as destroy_component,a as assign,a2 as svg_element,a3 as claim_svg_element,a4 as set_svg_attributes,h as get_spread_update,e as exclude_internal_props,a5 as onMount,a6 as action_destroyer,a7 as set_style,a8 as flush,a9 as set_input_value,aa as bubble,ab as to_number,ac as null_to_empty,ad as src_url_equal,ae as create_slot,af as update_slot_base,ag as get_all_dirty_from_scope,ah as get_slot_changes,ai as globals}from"../../svelte.internal.v3.42.4-05b2aca0.js";if("undefined"!=typeof document){const e=':root{--navigator-width:40px}#app.svelte-j1qpzb.svelte-j1qpzb{height:100vh;display:flex;flex-direction:column;overflow:hidden}#app.svelte-j1qpzb>div.svelte-j1qpzb:first-child{flex:1 0 auto;position:relative;display:grid;grid-template-rows:1fr;grid-template-columns:auto 1fr auto;grid-template-areas:"left center right"}#left-sidebar{grid-area:left}#left-sidebar p.svelte-j1qpzb.svelte-j1qpzb{opacity:0.5;padding:0.5em 1em}#roll.svelte-j1qpzb.svelte-j1qpzb{position:relative;flex:1 0 auto;grid-area:center}#right-sidebar{grid-area:right}#keyboard-container.svelte-j1qpzb.svelte-j1qpzb{flex:0 1 auto;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#keyboard-overlay.svelte-j1qpzb.svelte-j1qpzb{position:absolute;bottom:0;width:calc(100% - var(--navigator-width));opacity:0.5;z-index:5}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function cubicOut(e){const t=e-1;return t*t*t+1}function quartInOut(e){return e<.5?8*Math.pow(e,4):-8*Math.pow(e-1,4)+1}function fade(e,{delay:t=0,duration:i=400,easing:n=identity}={}){const o=+getComputedStyle(e).opacity;return{delay:t,duration:i,easing:n,css:e=>"opacity: "+e*o}}function fly(e,{delay:t=0,duration:i=400,easing:n=cubicOut,x:o=0,y:r=0,opacity:s=0}={}){const a=getComputedStyle(e),l=+a.opacity,c="none"===a.transform?"":a.transform,d=l*(1-s);return{delay:t,duration:i,easing:n,css:(e,t)=>`\n\t\t\ttransform: ${c} translate(${(1-e)*o}px, ${(1-e)*r}px);\n\t\t\topacity: ${l-d*t}`}}function slide(e,{delay:t=0,duration:i=400,easing:n=cubicOut}={}){const o=getComputedStyle(e),r=+o.opacity,s=parseFloat(o.height),a=parseFloat(o.paddingTop),l=parseFloat(o.paddingBottom),c=parseFloat(o.marginTop),d=parseFloat(o.marginBottom),u=parseFloat(o.borderTopWidth),h=parseFloat(o.borderBottomWidth);return{delay:t,duration:i,easing:n,css:e=>`overflow: hidden;opacity: ${Math.min(20*e,1)*r};height: ${e*s}px;padding-top: ${e*a}px;padding-bottom: ${e*l}px;margin-top: ${e*c}px;margin-bottom: ${e*d}px;border-top-width: ${e*u}px;border-bottom-width: ${e*h}px;`}}var shallowequal=function(e,t,i,n){var o=i?i.call(n,e,t):void 0;if(void 0!==o)return!!o;if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;var r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(var a=Object.prototype.hasOwnProperty.bind(t),l=0;l<r.length;l++){var c=r[l];if(!a(c))return!1;var d=e[c],u=t[c];if(!1===(o=i?i.call(n,d,u,c):void 0)||void 0===o&&d!==u)return!1}return!0};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule$1(e,t,i){return e(i={path:t,exports:{},require:function(e,t){return commonjsRequire$1(e,null==t?i.path:t)}},i.exports),i.exports}function commonjsRequire$1(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var lib=createCommonjsModule$1((function(e,t){function i(e){return void 0===e?-1:e.height}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.intervalTree=e,this.records=[],this.height=0,this.key=t.low,this.max=t.high,this.records.push(t)}return e.prototype.getNodeHigh=function(){for(var e=this.records[0].high,t=1;t<this.records.length;t++)this.records[t].high>e&&(e=this.records[t].high);return e},e.prototype.updateHeight=function(){this.height=Math.max(i(this.left),i(this.right))+1},e.prototype.updateMaxOfParents=function(){if(void 0!==this){var e=this.getNodeHigh();void 0!==this.left&&void 0!==this.right?this.max=Math.max(Math.max(this.left.max,this.right.max),e):void 0!==this.left&&void 0===this.right?this.max=Math.max(this.left.max,e):void 0===this.left&&void 0!==this.right?this.max=Math.max(this.right.max,e):this.max=e,this.parent&&this.parent.updateMaxOfParents()}},e.prototype._updateMaxAfterRightRotate=function(){var e=this.parent,t=e.left,i=t.getNodeHigh();void 0===t.left&&void 0!==t.right?t.max=Math.max(i,t.right.max):void 0!==t.left&&void 0===t.right?t.max=Math.max(i,t.left.max):void 0===t.left&&void 0===t.right?t.max=i:t.max=Math.max(Math.max(t.left.max,t.right.max),i);var n=this.getNodeHigh();void 0===this.left&&void 0!==this.right?this.max=Math.max(n,this.right.max):void 0!==this.left&&void 0===this.right?this.max=Math.max(n,this.left.max):void 0===this.left&&void 0===this.right?this.max=n:this.max=Math.max(Math.max(this.left.max,this.right.max),n),e.max=Math.max(Math.max(e.left.max,e.right.max),e.getNodeHigh())},e.prototype._updateMaxAfterLeftRotate=function(){var e=this.parent,t=e.right,i=t.getNodeHigh();void 0===t.left&&void 0!==t.right?t.max=Math.max(i,t.right.max):void 0!==t.left&&void 0===t.right?t.max=Math.max(i,t.left.max):void 0===t.left&&void 0===t.right?t.max=i:t.max=Math.max(Math.max(t.left.max,t.right.max),i);var n=this.getNodeHigh();void 0===this.left&&void 0!==this.right?this.max=Math.max(n,this.right.max):void 0!==this.left&&void 0===this.right?this.max=Math.max(n,this.left.max):void 0===this.left&&void 0===this.right?this.max=n:this.max=Math.max(Math.max(this.left.max,this.right.max),n),e.max=Math.max(Math.max(e.left.max,t.max),e.getNodeHigh())},e.prototype._leftRotate=function(){var e=this.right;e.parent=this.parent,void 0===e.parent?this.intervalTree.root=e:e.parent.left===this?e.parent.left=e:e.parent.right===this&&(e.parent.right=e),this.right=e.left,void 0!==this.right&&(this.right.parent=this),e.left=this,this.parent=e,this.updateHeight(),e.updateHeight()},e.prototype._rightRotate=function(){var e=this.left;e.parent=this.parent,void 0===e.parent?this.intervalTree.root=e:e.parent.left===this?e.parent.left=e:e.parent.right===this&&(e.parent.right=e),this.left=e.right,void 0!==this.left&&(this.left.parent=this),e.right=this,this.parent=e,this.updateHeight(),e.updateHeight()},e.prototype._rebalance=function(){if(i(this.left)>=2+i(this.right)){var e=this.left;i(e.left)>=i(e.right)?(this._rightRotate(),this._updateMaxAfterRightRotate()):(e._leftRotate(),this._rightRotate(),this._updateMaxAfterRightRotate())}else if(i(this.right)>=2+i(this.left)){var t=this.right;i(t.right)>=i(t.left)?(this._leftRotate(),this._updateMaxAfterLeftRotate()):(t._rightRotate(),this._leftRotate(),this._updateMaxAfterLeftRotate())}},e.prototype.insert=function(t){t.low<this.key?void 0===this.left?(this.left=new e(this.intervalTree,t),this.left.parent=this):this.left.insert(t):void 0===this.right?(this.right=new e(this.intervalTree,t),this.right.parent=this):this.right.insert(t),this.max<t.high&&(this.max=t.high),this.updateHeight(),this._rebalance()},e.prototype._getOverlappingRecords=function(e,t,i){if(e.key<=i&&t<=e.getNodeHigh()){for(var n=[],o=0;o<e.records.length;o++)e.records[o].high>=t&&n.push(e.records[o]);return n}return[]},e.prototype.search=function(e,t){if(void 0===this)return[];var i,n=[],o=[];return e>this.max?[]:(void 0!==this.left&&this.left.max>=e&&(n=this.left.search(e,t)),i=this._getOverlappingRecords(this,e,t),t<this.key?n.concat(i):(void 0!==this.right&&(o=this.right.search(e,t)),n.concat(i,o)))},e.prototype.searchExisting=function(e){if(void 0!==this){if(this.key===e)return this;if(e<this.key){if(void 0!==this.left)return this.left.searchExisting(e)}else if(void 0!==this.right)return this.right.searchExisting(e)}},e.prototype._minValue=function(){return void 0===this.left?this:this.left._minValue()},e.prototype.remove=function(e){var t=this.parent;if(e.key<this.key)return void 0!==this.left?this.left.remove(e):void 0;if(e.key>this.key)return void 0!==this.right?this.right.remove(e):void 0;if(void 0!==this.left&&void 0!==this.right){var i=this.right._minValue();return this.key=i.key,this.records=i.records,this.right.remove(this)}return t.left===this?(void 0!==this.right?(t.left=this.right,this.right.parent=t):(t.left=this.left,void 0!==this.left&&(this.left.parent=t)),t.updateMaxOfParents(),t.updateHeight(),t._rebalance(),this):t.right===this?(void 0!==this.right?(t.right=this.right,this.right.parent=t):(t.right=this.left,void 0!==this.left&&(this.left.parent=t)),t.updateMaxOfParents(),t.updateHeight(),t._rebalance(),this):void 0},e}();t.Node=n;var o=function(){function e(){this.count=0}return e.prototype.insert=function(e){if(e.low>e.high)throw new Error("`low` value must be lower or equal to `high` value");if(void 0===this.root)return this.root=new n(this,e),this.count++,!0;var t=this.root.searchExisting(e.low);if(void 0!==t){for(var i=0;i<t.records.length;i++)if(shallowequal(t.records[i],e))return!1;return t.records.push(e),e.high>t.max&&(t.max=e.high,t.parent&&t.parent.updateMaxOfParents()),this.count++,!0}return this.root.insert(e),this.count++,!0},e.prototype.search=function(e,t){return void 0===this.root?[]:this.root.search(e,t)},e.prototype.remove=function(e){if(void 0===this.root)return!1;var t=this.root.searchExisting(e.low);if(void 0===t)return!1;if(t.records.length>1){for(var i=void 0,o=0;o<t.records.length;o++)if(shallowequal(t.records[o],e)){i=t.records[o],t.records.splice(o,1);break}if(i){if(i=void 0,e.high===t.max){var r=t.getNodeHigh();void 0!==t.left&&void 0!==t.right?t.max=Math.max(Math.max(t.left.max,t.right.max),r):void 0!==t.left&&void 0===t.right?t.max=Math.max(t.left.max,r):void 0===t.left&&void 0!==t.right?t.max=Math.max(t.right.max,r):t.max=r,t.parent&&t.parent.updateMaxOfParents()}return this.count--,!0}return!1}if(1===t.records.length){if(shallowequal(t.records[0],e)){if(this.root.key===t.key){var s=new n(this,{low:e.low,high:e.low});s.left=this.root,this.root.parent=s;var a=this.root.remove(t);return this.root=s.left,void 0!==this.root&&(this.root.parent=void 0),!!a&&(a=void 0,this.count--,!0)}return!!(a=this.root.remove(t))&&(a=void 0,this.count--,!0)}return!1}return!1},e.prototype.inOrder=function(){return new s(this.root)},e.prototype.preOrder=function(){return new a(this.root)},e}();t.IntervalTree=o;var r=function(){function e(){this.tree=new o}return e.prototype.insert=function(e,t,i){return this.tree.insert({low:e,high:t,data:i})},e.prototype.remove=function(e,t,i){return this.tree.remove({low:e,high:t,data:i})},e.prototype.search=function(e,t){return this.tree.search(e,t).map((function(e){return e.data}))},e.prototype.inOrder=function(){return this.tree.inOrder()},e.prototype.preOrder=function(){return this.tree.preOrder()},Object.defineProperty(e.prototype,"count",{get:function(){return this.tree.count},enumerable:!0,configurable:!0}),e}();t.default=r;var s=function(){function e(e){this.stack=[],void 0!==e&&this.push(e)}return e.prototype.next=function(){return void 0===this.currentNode?{done:!0,value:void 0}:this.i<this.currentNode.records.length?{done:!1,value:this.currentNode.records[this.i++]}:(void 0!==this.currentNode.right?this.push(this.currentNode.right):this.pop(),this.next())},e.prototype.push=function(e){for(this.currentNode=e,this.i=0;void 0!==this.currentNode.left;)this.stack.push(this.currentNode),this.currentNode=this.currentNode.left},e.prototype.pop=function(){this.currentNode=this.stack.pop(),this.i=0},e}();t.InOrder=s,"function"==typeof Symbol&&(s.prototype[Symbol.iterator]=function(){return this});var a=function(){function e(e){this.stack=[],this.i=0,this.currentNode=e}return e.prototype.next=function(){return void 0===this.currentNode?{done:!0,value:void 0}:this.i<this.currentNode.records.length?{done:!1,value:this.currentNode.records[this.i++]}:(void 0!==this.currentNode.right&&this.push(this.currentNode.right),void 0!==this.currentNode.left&&this.push(this.currentNode.left),this.pop(),this.next())},e.prototype.push=function(e){this.stack.push(e)},e.prototype.pop=function(){this.currentNode=this.stack.pop(),this.i=0},e}();t.PreOrder=a,"function"==typeof Symbol&&(a.prototype[Symbol.iterator]=function(){return this})})),__pika_web_default_export_for_treeshaking__=getDefaultExportFromCjs(lib);lib.InOrder,lib.IntervalTree,lib.Node,lib.PreOrder;const subscriber_queue=[];function readable(e,t){return{subscribe:writable$1(e,t).subscribe}}function writable$1(e,t=noop){let i;const n=new Set;function o(t){if(safe_not_equal(e,t)&&(e=t,i)){const t=!subscriber_queue.length;for(const t of n)t[1](),subscriber_queue.push(t,e);if(t){for(let e=0;e<subscriber_queue.length;e+=2)subscriber_queue[e][0](subscriber_queue[e+1]);subscriber_queue.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(r,s=noop){const a=[r,s];return n.add(a),1===n.size&&(i=t(o)||noop),r(e),()=>{n.delete(a),0===n.size&&(i(),i=null)}}}}function derived(e,t,i){const n=!Array.isArray(e),o=n?[e]:e,r=t.length<2;return readable(i,(e=>{let i=!1;const s=[];let a=0,l=noop;const c=()=>{if(a)return;l();const i=t(n?s[0]:s,e);r?e(i):l=is_function(i)?i:noop},d=o.map(((e,t)=>subscribe(e,(e=>{s[t]=e,a&=~(1<<t),i&&c()}),(()=>{a|=1<<t}))));return i=!0,c(),function(){run_all(d),l()}}))}const createStore=e=>{const{set:t,subscribe:i,update:n}=writable$1(e);return{reset:()=>t(e),set:t,subscribe:i,update:n}},createPersistedStore=(e,t)=>{const i=localStorage.getItem(e);let n="object"==typeof t?{...t}:t;try{i&&(n=JSON.parse(i))}catch{}const o=writable$1(n),{set:r,subscribe:s}=o;return{set(t){localStorage.setItem(e,JSON.stringify(t)),r(t)},update(e){const t=e(get_store_value(o));this.set(t)},reset(){localStorage.removeItem(e),this.set("object"==typeof t?{...t}:t)},subscribe:s}},createSetStore=()=>{const{subscribe:e,update:t,set:i}=writable$1(new Set);return{subscribe:e,add:e=>t((t=>t.add(e))),delete:e=>t((t=>(t.delete(e),t))),reset:e=>i(new Set(e))}},rollMetadata=createStore({}),rollHasExpressions=derived(rollMetadata,(e=>"65-note"!==e.ROLL_TYPE)),isReproducingRoll=derived(rollMetadata,(e=>["welte-red","welte-green","welte-licensee"].includes(e.ROLL_TYPE))),scrollDownwards=derived(rollMetadata,(e=>"welte-red"===e.ROLL_TYPE)),softOnOff=createStore(!1),sustainOnOff=createStore(!1),accentOnOff=createStore(!1),volumeCoefficient=createStore(1.5),bassVolumeCoefficient=createStore(1),trebleVolumeCoefficient=createStore(1),tempoCoefficient=createStore(1),playExpressionsOnOff=createStore(!0),rollPedalingOnOff=createStore(!0),useMidiTempoEventsOnOff=createStore(!0),sampleVolumes=createPersistedStore("sampleVolumes",{strings:-15,harmonics:-10,pedal:-10,keybed:-10}),sampleVelocities=createPersistedStore("sampleVelocities",4),reverbWetDry=createPersistedStore("reverbWetDry",.8),currentTick=createStore(0),playbackProgress=createStore(0),activeNotes=createSetStore(),userSettings=createPersistedStore("userSettings",{theme:"cardinal",activeNoteDetails:!1,showNoteVelocities:!1,highlightEnabledHoles:!1,showKeyboard:!0,overlayKeyboard:!1,welcomeScreenInhibited:!1}),rollProfile={"welte-red":{bassCtrlBegin:14,bassCtrlEnd:23,bassNotesBegin:24,bassNotesEnd:66,trebleNotesBegin:67,trebleNotesEnd:103,trebleCtrlBegin:104,trebleCtrlEnd:113,ctrlMap:{14:"mf_off",15:"mf_on",16:"cresc_off",17:"cresc_on",18:"sf_off",19:"sf_on",20:"soft_off",21:"soft_on",22:"motor_off",23:"motor_on",104:"rewind",105:"elec_off",106:"sust_on",107:"sust_off",108:"sf_on",109:"sf_off",110:"cresc_on",111:"cresc_off",112:"mf_on",113:"mf_off"}},"welte-green":{bassCtrlBegin:16,bassCtrlEnd:20,bassNotesBegin:21,bassNotesEnd:66,trebleNotesBegin:67,trebleNotesEnd:108,trebleCtrlBegin:109,trebleCtrlEnd:113,ctrlMap:{16:"sfp",17:"mf",18:"sust",19:"cresc",20:"sff",109:"sff",110:"cresc",111:"soft",112:"mf",113:"sfp"}},"welte-licensee":{bassCtrlBegin:16,bassCtrlEnd:23,bassNotesBegin:24,bassNotesEnd:66,trebleNotesBegin:67,trebleNotesEnd:103,trebleCtrlBegin:104,trebleCtrlEnd:113,ctrlMap:{16:"mf_off",17:"mf_on",18:"cresc_off",19:"cresc_on",20:"sf_on",21:"sf_off",22:"soft_on",23:"soft_off",104:"rewind",106:"sust_on",107:"sust_off",108:"sf_on",109:"sf_off",110:"cresc_on",111:"cresc_off",112:"mf_on",113:"mf_off"}},"65-note":{bassNotesBegin:33,trebleNotesEnd:97},"88-note":{bassCtrlBegin:15,bassCtrlEnd:20,bassNotesBegin:21,bassNotesEnd:64,trebleNotesBegin:65,trebleNotesEnd:108,trebleCtrlBegin:109,trebleCtrlEnd:110,ctrlMap:{16:"rewind",18:"sust",19:"acc",20:"acc",109:"acc",110:"acc"}}},enforcePrecision=(e,t)=>{const i=10**(t||0);return Math.round(e*i)/i},clamp$1=(e,t,i)=>Math.min(Math.max(e,t),i),normalizeInRange=(e,t,i)=>i-t==0?0:(e-t)/(i-t),getHoleType=({m:e},t)=>{const{bassNotesBegin:i,trebleNotesEnd:n,ctrlMap:o}=rollProfile[t];return e>=i&&e<=n?"note":o[e]?.includes("soft")||o[e]?.includes("sust")?"pedal":"control"},mapToRange=(e,t,i)=>e*(i-t)+t,getNoteName=e=>{const t=parseInt(e/12,10)-1;return`${["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"][(e-21)%12]}${t}`},getHoleLabel=(e,t="welte-red")=>{const{bassNotesBegin:i,trebleNotesEnd:n,ctrlMap:o}=rollProfile[t];return e>=i&&e<=n?getNoteName(e):o&&o[e]?o[e]:`mid_${e}`},easingInterval=(e,t=200,i=5,n=1.1)=>{let o,r=t;const s=()=>{e(),r=Math.max(Math.floor(r/n),i),o=setTimeout(s,r)};return o=setTimeout(s,r),{clear:()=>{o&&(clearTimeout(o),o=null)}}},holeColorMap=["232, 53%, 49%","229, 64%, 58%","225, 78%, 66%","223, 91%, 73%","221, 98%, 79%","219, 95%, 83%","217, 73%, 86%","21, 28%, 86%","20, 69%, 83%","18, 85%, 79%","16, 85%, 73%","13, 80%, 67%","9, 70%, 59%","2, 59%, 51%","348, 96%, 36%"],defaultHoleColor="60, 100%, 50%",controlHoleColor="120, 73%, 75%",pedalHoleColor="39, 100%, 50%",annotateHoleData=(e,{ROLL_TYPE:t,IMAGE_LENGTH:i},n)=>{const o=e.map((({v:e})=>e)).filter((e=>e)),r=o.length?Math.min(...o):64,s=o.length?Math.max(...o):64,a=parseInt(i,10);e.forEach((e=>{switch(e.startY=n?e.y:a-e.y-e.h,e.endY=n?e.y+e.h:a-e.y,getHoleType(e,t)){case"pedal":e.color=pedalHoleColor,e.type="pedal";break;case"control":e.color=controlHoleColor,e.type="control";break;case"note":e.color=(({v:e})=>holeColorMap[Math.round(mapToRange(normalizeInRange(e,r,s),0,holeColorMap.length-1))])(e),e.type="note";break;default:e.color=defaultHoleColor}}))};function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}for(var Constants={VERSION:"2.0.14",NOTES:[],HEADER_CHUNK_LENGTH:14,CIRCLE_OF_FOURTHS:["C","F","Bb","Eb","Ab","Db","Gb","Cb","Fb","Bbb","Ebb","Abb"],CIRCLE_OF_FIFTHS:["C","G","D","A","E","B","F#","C#","G#","D#","A#","E#"]},allNotes$1=[["C"],["C#","Db"],["D"],["D#","Eb"],["E"],["F"],["F#","Gb"],["G"],["G#","Ab"],["A"],["A#","Bb"],["B"]],counter=0,_loop=function(e){allNotes$1.forEach((function(t){t.forEach((function(t){return Constants.NOTES[counter]=t+e})),counter++}))},i=-1;i<=9;i++)_loop(i);var Utils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"byteToHex",value:function(e){return("0"+e.toString(16)).slice(-2)}},{key:"bytesToHex",value:function(t){var i=[];return t.forEach((function(t){return i.push(e.byteToHex(t))})),i.join("")}},{key:"hexToNumber",value:function(e){return parseInt(e,16)}},{key:"bytesToNumber",value:function(t){return e.hexToNumber(e.bytesToHex(t))}},{key:"bytesToLetters",value:function(e){var t=[];return e.forEach((function(e){return t.push(String.fromCharCode(e))})),t.join("")}},{key:"decToBinary",value:function(e){return(e>>>0).toString(2)}},{key:"getVarIntLength",value:function(e){for(var t=e[0],i=1;t>=128;)t=e[i],i++;return i}},{key:"readVarInt",value:function(e){var t=0;return e.forEach((function(e){128&e?(t+=127&e,t<<=7):t+=e})),t}},{key:"atob",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return"function"==typeof atob?atob(e):new Buffer(e,"base64").toString("binary")}))}]),e}(),Track=function(){function e(t,i){_classCallCheck(this,e),this.enabled=!0,this.eventIndex=0,this.pointer=0,this.lastTick=0,this.lastStatus=null,this.index=t,this.data=i,this.delta=0,this.runningDelta=0,this.events=[];var n=this.data.subarray(this.data.length-3,this.data.length);if(255!==n[0]||47!==n[1]||0!==n[2])throw"Invalid MIDI file; Last three bytes of track "+this.index+"must be FF 2F 00 to mark end of track"}return _createClass(e,[{key:"reset",value:function(){return this.enabled=!0,this.eventIndex=0,this.pointer=0,this.lastTick=0,this.lastStatus=null,this.delta=0,this.runningDelta=0,this}},{key:"enable",value:function(){return this.enabled=!0,this}},{key:"disable",value:function(){return this.enabled=!1,this}},{key:"setEventIndexByTick",value:function(e){for(var t in e=e||0,this.events)if(this.events[t].tick>=e)return this.eventIndex=t,this}},{key:"getCurrentByte",value:function(){return this.data[this.pointer]}},{key:"getDeltaByteCount",value:function(){return Utils.getVarIntLength(this.data.subarray(this.pointer))}},{key:"getDelta",value:function(){return Utils.readVarInt(this.data.subarray(this.pointer,this.pointer+this.getDeltaByteCount()))}},{key:"handleEvent",value:function(e,t){if(t=t||!1){var i=e-this.lastTick>=this.getDelta();if(this.pointer<this.data.length&&(t||i)){var n=this.parseEvent();if(this.enabled)return n}}else if(this.events[this.eventIndex]&&this.events[this.eventIndex].tick<=e&&(this.eventIndex++,this.enabled))return this.events[this.eventIndex-1];return null}},{key:"getStringData",value:function(e){var t=Utils.getVarIntLength(this.data.subarray(e+2)),i=Utils.readVarInt(this.data.subarray(e+2,e+2+t));return Utils.bytesToLetters(this.data.subarray(e+2+t,e+2+t+i))}},{key:"parseEvent",value:function(){var e=this.pointer+this.getDeltaByteCount(),t={},i=this.getDeltaByteCount();if(t.track=this.index+1,t.delta=this.getDelta(),this.lastTick=this.lastTick+t.delta,this.runningDelta+=t.delta,t.tick=this.runningDelta,t.byteIndex=this.pointer,255==this.data[e]){switch(this.data[e+1]){case 0:t.name="Sequence Number";break;case 1:t.name="Text Event",t.string=this.getStringData(e);break;case 2:t.name="Copyright Notice";break;case 3:t.name="Sequence/Track Name",t.string=this.getStringData(e);break;case 4:t.name="Instrument Name",t.string=this.getStringData(e);break;case 5:t.name="Lyric",t.string=this.getStringData(e);break;case 6:t.name="Marker";break;case 7:t.name="Cue Point",t.string=this.getStringData(e);break;case 9:t.name="Device Name",t.string=this.getStringData(e);break;case 32:t.name="MIDI Channel Prefix";break;case 33:t.name="MIDI Port",t.data=Utils.bytesToNumber([this.data[e+3]]);break;case 47:t.name="End of Track";break;case 81:t.name="Set Tempo",t.data=Math.round(6e7/Utils.bytesToNumber(this.data.subarray(e+3,e+6))),this.tempo=t.data;break;case 84:t.name="SMTPE Offset";break;case 88:t.name="Time Signature",t.data=this.data.subarray(e+3,e+7),t.timeSignature=t.data[0]+"/"+Math.pow(2,t.data[1]);break;case 89:t.name="Key Signature",t.data=this.data.subarray(e+3,e+5),t.data[0]>=0?t.keySignature=Constants.CIRCLE_OF_FIFTHS[t.data[0]]:t.data[0]<0&&(t.keySignature=Constants.CIRCLE_OF_FOURTHS[Math.abs(t.data[0])]),0==t.data[1]?t.keySignature+=" Major":1==t.data[1]&&(t.keySignature+=" Minor");break;case 127:t.name="Sequencer-Specific Meta-event";break;default:t.name="Unknown: "+this.data[e+1].toString(16)}var n=Utils.getVarIntLength(this.data.subarray(e+2)),o=Utils.readVarInt(this.data.subarray(e+2,e+2+n));this.pointer+=i+3+o}else if(240===this.data[e]){t.name="Sysex";var r=Utils.getVarIntLength(this.data.subarray(e+1)),s=Utils.readVarInt(this.data.subarray(e+1,e+1+r));t.data=this.data.subarray(e+1+r,e+1+r+s),this.pointer+=i+1+r+s}else if(247===this.data[e]){t.name="Sysex (escape)";var a=Utils.getVarIntLength(this.data.subarray(e+1)),l=Utils.readVarInt(this.data.subarray(e+1,e+1+a));t.data=this.data.subarray(e+1+a,e+1+a+l),this.pointer+=i+1+a+l}else if(this.data[e]<128)if(t.running=!0,t.noteNumber=this.data[e],t.noteName=Constants.NOTES[this.data[e]],t.velocity=this.data[e+1],this.lastStatus<=143)t.name="Note off",t.channel=this.lastStatus-128+1,this.pointer+=i+2;else if(this.lastStatus<=159)t.name="Note on",t.channel=this.lastStatus-144+1,this.pointer+=i+2;else if(this.lastStatus<=175)t.name="Polyphonic Key Pressure",t.channel=this.lastStatus-160+1,t.note=Constants.NOTES[this.data[e+1]],t.pressure=event[1],this.pointer+=i+2;else if(this.lastStatus<=191)t.name="Controller Change",t.channel=this.lastStatus-176+1,t.number=this.data[e+1],t.value=this.data[e+2],this.pointer+=i+2;else if(this.lastStatus<=207)t.name="Program Change",t.channel=this.lastStatus-192+1,t.value=this.data[e+1],this.pointer+=i+1;else if(this.lastStatus<=223)t.name="Channel Key Pressure",t.channel=this.lastStatus-208+1,this.pointer+=i+1;else{if(!(this.lastStatus<=239))throw"Unknown event (running): ".concat(this.lastStatus);t.name="Pitch Bend",t.channel=this.lastStatus-224+1,this.pointer+=i+2}else if(this.lastStatus=this.data[e],this.data[e]<=143)t.name="Note off",t.channel=this.lastStatus-128+1,t.noteNumber=this.data[e+1],t.noteName=Constants.NOTES[this.data[e+1]],t.velocity=Math.round(this.data[e+2]/127*100),this.pointer+=i+3;else if(this.data[e]<=159)t.name="Note on",t.channel=this.lastStatus-144+1,t.noteNumber=this.data[e+1],t.noteName=Constants.NOTES[this.data[e+1]],t.velocity=Math.round(this.data[e+2]/127*100),this.pointer+=i+3;else if(this.data[e]<=175)t.name="Polyphonic Key Pressure",t.channel=this.lastStatus-160+1,t.note=Constants.NOTES[this.data[e+1]],t.pressure=event[2],this.pointer+=i+3;else if(this.data[e]<=191)t.name="Controller Change",t.channel=this.lastStatus-176+1,t.number=this.data[e+1],t.value=this.data[e+2],this.pointer+=i+3;else if(this.data[e]<=207)t.name="Program Change",t.channel=this.lastStatus-192+1,t.value=this.data[e+1],this.pointer+=i+2;else if(this.data[e]<=223)t.name="Channel Key Pressure",t.channel=this.lastStatus-208+1,this.pointer+=i+2;else{if(!(this.data[e]<=239))throw"Unknown event: ".concat(this.data[e]);t.name="Pitch Bend",t.channel=this.lastStatus-224+1,this.pointer+=i+3}return this.delta+=t.delta,this.events.push(t),t}},{key:"endOfTrack",value:function(){return 255==this.data[this.pointer+1]&&47==this.data[this.pointer+2]&&0==this.data[this.pointer+3]}}]),e}();Uint8Array.prototype.forEach||Object.defineProperty(Uint8Array.prototype,"forEach",{value:Array.prototype.forEach});var Player$1=function(){function e(t,i){_classCallCheck(this,e),this.sampleRate=5,this.startTime=0,this.buffer=i||null,this.midiChunksByteLength=null,this.division,this.format,this.setIntervalId=!1,this.tracks=[],this.instruments=[],this.defaultTempo=120,this.tempo=null,this.startTick=0,this.tick=0,this.lastTick=null,this.inLoop=!1,this.totalTicks=0,this.events=[],this.totalEvents=0,this.eventListeners={},"function"==typeof t&&this.on("midiEvent",t)}return _createClass(e,[{key:"loadFile",value:function(e){throw"loadFile is only supported on Node.js"}},{key:"loadArrayBuffer",value:function(e){return this.buffer=new Uint8Array(e),this.fileLoaded()}},{key:"loadDataUri",value:function(e){for(var t=Utils.atob(e.split(",")[1]),i=new Uint8Array(t.length),n=0;n<t.length;n++)i[n]=t.charCodeAt(n);return this.buffer=i,this.fileLoaded()}},{key:"getFilesize",value:function(){return this.buffer?this.buffer.length:0}},{key:"fileLoaded",value:function(){if(!this.validate())throw"Invalid MIDI file; should start with MThd";return this.setTempo(this.defaultTempo).getDivision().getFormat().getTracks().dryRun()}},{key:"validate",value:function(){return"MThd"===Utils.bytesToLetters(this.buffer.subarray(0,4))}},{key:"getFormat",value:function(){return this.format=Utils.bytesToNumber(this.buffer.subarray(8,10)),this}},{key:"getTracks",value:function(){this.tracks=[];for(var e=0;e<this.buffer.length;){if("MTrk"==Utils.bytesToLetters(this.buffer.subarray(e,e+4))){var t=Utils.bytesToNumber(this.buffer.subarray(e+4,e+8));this.tracks.push(new Track(this.tracks.length,this.buffer.subarray(e+8,e+8+t)))}e+=Utils.bytesToNumber(this.buffer.subarray(e+4,e+8))+8}var i=0;return this.tracks.forEach((function(e){i+=8+e.data.length})),this.midiChunksByteLength=Constants.HEADER_CHUNK_LENGTH+i,this}},{key:"enableTrack",value:function(e){return this.tracks[e-1].enable(),this}},{key:"disableTrack",value:function(e){return this.tracks[e-1].disable(),this}},{key:"getDivision",value:function(){return this.division=Utils.bytesToNumber(this.buffer.subarray(12,Constants.HEADER_CHUNK_LENGTH)),this}},{key:"playLoop",value:function(e){this.inLoop||(this.inLoop=!0,this.tick=this.getCurrentTick(),this.tracks.forEach((function(t,i){if(!e&&this.endOfFile())this.triggerPlayerEvent("endOfFile"),this.stop();else{var n=t.handleEvent(this.tick,e);e&&n?(n.hasOwnProperty("name")&&"Set Tempo"===n.name&&(this.defaultTempo=n.data,this.setTempo(n.data)),n.hasOwnProperty("name")&&"Program Change"===n.name&&(this.instruments.includes(n.value)||this.instruments.push(n.value))):n&&(n.hasOwnProperty("name")&&"Set Tempo"===n.name&&(this.setTempo(n.data),this.isPlaying()&&this.pause().play()),this.emitEvent(n))}}),this),e||this.triggerPlayerEvent("playing",{tick:this.tick}),this.inLoop=!1)}},{key:"setTempo",value:function(e){return this.tempo=e,this}},{key:"setStartTime",value:function(e){return this.startTime=e,this}},{key:"play",value:function(){if(this.isPlaying())throw"Already playing...";return this.startTime||(this.startTime=(new Date).getTime()),this.setIntervalId=setInterval(this.playLoop.bind(this),this.sampleRate),this}},{key:"loop",value:function(){setTimeout(function(){this.playLoop(),this.loop()}.bind(this),this.sampleRate)}},{key:"pause",value:function(){return clearInterval(this.setIntervalId),this.setIntervalId=!1,this.startTick=this.tick,this.startTime=0,this}},{key:"stop",value:function(){return clearInterval(this.setIntervalId),this.setIntervalId=!1,this.startTick=0,this.startTime=0,this.resetTracks(),this}},{key:"skipToTick",value:function(e){return this.stop(),this.startTick=e,this.tracks.forEach((function(t){t.setEventIndexByTick(e)})),this}},{key:"skipToPercent",value:function(e){if(e<0||e>100)throw"Percent must be number between 1 and 100.";return this.skipToTick(Math.round(e/100*this.totalTicks)),this}},{key:"skipToSeconds",value:function(e){var t=this.getSongTime();if(e<0||e>t)throw e+" seconds not within song time of "+t;return this.skipToPercent(e/t*100),this}},{key:"isPlaying",value:function(){return this.setIntervalId>0||"object"===_typeof(this.setIntervalId)}},{key:"dryRun",value:function(){for(this.resetTracks();!this.endOfFile();)this.playLoop(!0);return this.events=this.getEvents(),this.totalEvents=this.getTotalEvents(),this.totalTicks=this.getTotalTicks(),this.startTick=0,this.startTime=0,this.resetTracks(),this.triggerPlayerEvent("fileLoaded",this),this}},{key:"resetTracks",value:function(){return this.tracks.forEach((function(e){return e.reset()})),this}},{key:"getEvents",value:function(){return this.tracks.map((function(e){return e.events}))}},{key:"getTotalTicks",value:function(){return Math.max.apply(null,this.tracks.map((function(e){return e.delta})))}},{key:"getTotalEvents",value:function(){return this.tracks.reduce((function(e,t){return{events:{length:e.events.length+t.events.length}}}),{events:{length:0}}).events.length}},{key:"getSongTime",value:function(){return this.totalTicks/this.division/this.tempo*60}},{key:"getSongTimeRemaining",value:function(){return Math.round((this.totalTicks-this.getCurrentTick())/this.division/this.tempo*60)}},{key:"getSongPercentRemaining",value:function(){return Math.round(this.getSongTimeRemaining()/this.getSongTime()*100)}},{key:"bytesProcessed",value:function(){return Constants.HEADER_CHUNK_LENGTH+8*this.tracks.length+this.tracks.reduce((function(e,t){return{pointer:e.pointer+t.pointer}}),{pointer:0}).pointer}},{key:"eventsPlayed",value:function(){return this.tracks.reduce((function(e,t){return{eventIndex:e.eventIndex+t.eventIndex}}),{eventIndex:0}).eventIndex}},{key:"endOfFile",value:function(){return this.isPlaying()?this.totalTicks-this.tick<=0:this.bytesProcessed()>=this.midiChunksByteLength}},{key:"getCurrentTick",value:function(){return!this.startTime&&this.tick?this.startTick:this.startTime?Math.round(((new Date).getTime()-this.startTime)/1e3*(this.division*(this.tempo/60)))+this.startTick:0}},{key:"emitEvent",value:function(e){return this.triggerPlayerEvent("midiEvent",e),this}},{key:"on",value:function(e,t){return this.eventListeners.hasOwnProperty(e)||(this.eventListeners[e]=[]),this.eventListeners[e].push(t),this}},{key:"triggerPlayerEvent",value:function(e,t){return this.eventListeners.hasOwnProperty(e)&&this.eventListeners[e].forEach((function(e){return e(t||{})})),this}}]),e}(),index={Player:Player$1,Utils:Utils,Constants:Constants};const createExtendedExponentialRampToValueAutomationEvent=(e,t,i)=>({endTime:t,insertTime:i,type:"exponentialRampToValue",value:e}),createExtendedLinearRampToValueAutomationEvent=(e,t,i)=>({endTime:t,insertTime:i,type:"linearRampToValue",value:e}),createSetValueAutomationEvent=(e,t)=>({startTime:t,type:"setValue",value:e}),createSetValueCurveAutomationEvent=(e,t,i)=>({duration:i,startTime:t,type:"setValueCurve",values:e}),getTargetValueAtTime=(e,t,{startTime:i,target:n,timeConstant:o})=>n+(t-n)*Math.exp((i-e)/o),isExponentialRampToValueAutomationEvent=e=>"exponentialRampToValue"===e.type,isLinearRampToValueAutomationEvent=e=>"linearRampToValue"===e.type,isAnyRampToValueAutomationEvent=e=>isExponentialRampToValueAutomationEvent(e)||isLinearRampToValueAutomationEvent(e),isSetValueAutomationEvent=e=>"setValue"===e.type,isSetValueCurveAutomationEvent=e=>"setValueCurve"===e.type,getValueOfAutomationEventAtIndexAtTime=(e,t,i,n)=>{const o=e[t];return void 0===o?n:isAnyRampToValueAutomationEvent(o)||isSetValueAutomationEvent(o)?o.value:isSetValueCurveAutomationEvent(o)?o.values[o.values.length-1]:getTargetValueAtTime(i,getValueOfAutomationEventAtIndexAtTime(e,t-1,o.startTime,n),o)},getEndTimeAndValueOfPreviousAutomationEvent=(e,t,i,n,o)=>void 0===i?[n.insertTime,o]:isAnyRampToValueAutomationEvent(i)?[i.endTime,i.value]:isSetValueAutomationEvent(i)?[i.startTime,i.value]:isSetValueCurveAutomationEvent(i)?[i.startTime+i.duration,i.values[i.values.length-1]]:[i.startTime,getValueOfAutomationEventAtIndexAtTime(e,t-1,i.startTime,o)],isCancelAndHoldAutomationEvent=e=>"cancelAndHold"===e.type,isCancelScheduledValuesAutomationEvent=e=>"cancelScheduledValues"===e.type,getEventTime=e=>isCancelAndHoldAutomationEvent(e)||isCancelScheduledValuesAutomationEvent(e)?e.cancelTime:isExponentialRampToValueAutomationEvent(e)||isLinearRampToValueAutomationEvent(e)?e.endTime:e.startTime,getExponentialRampValueAtTime=(e,t,i,{endTime:n,value:o})=>i===o?o:0<i&&0<o||i<0&&o<0?i*(o/i)**((e-t)/(n-t)):0,getLinearRampValueAtTime=(e,t,i,{endTime:n,value:o})=>i+(e-t)/(n-t)*(o-i),interpolateValue=(e,t)=>{const i=Math.floor(t),n=Math.ceil(t);return i===n?e[i]:(1-(t-i))*e[i]+(1-(n-t))*e[n]},getValueCurveValueAtTime=(e,{duration:t,startTime:i,values:n})=>{const o=(e-i)/t*(n.length-1);return interpolateValue(n,o)},isSetTargetAutomationEvent=e=>"setTarget"===e.type;class AutomationEventList{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const t=getEventTime(e);if(isCancelAndHoldAutomationEvent(e)||isCancelScheduledValuesAutomationEvent(e)){const i=this._automationEvents.findIndex((i=>isCancelScheduledValuesAutomationEvent(e)&&isSetValueCurveAutomationEvent(i)?i.startTime+i.duration>=t:getEventTime(i)>=t)),n=this._automationEvents[i];if(-1!==i&&(this._automationEvents=this._automationEvents.slice(0,i)),isCancelAndHoldAutomationEvent(e)){const e=this._automationEvents[this._automationEvents.length-1];if(void 0!==n&&isAnyRampToValueAutomationEvent(n)){if(isSetTargetAutomationEvent(e))throw new Error("The internal list is malformed.");const i=isSetValueCurveAutomationEvent(e)?e.startTime+e.duration:getEventTime(e),o=isSetValueCurveAutomationEvent(e)?e.values[e.values.length-1]:e.value,r=isExponentialRampToValueAutomationEvent(n)?getExponentialRampValueAtTime(t,i,o,n):getLinearRampValueAtTime(t,i,o,n),s=isExponentialRampToValueAutomationEvent(n)?createExtendedExponentialRampToValueAutomationEvent(r,t,this._currenTime):createExtendedLinearRampToValueAutomationEvent(r,t,this._currenTime);this._automationEvents.push(s)}void 0!==e&&isSetTargetAutomationEvent(e)&&this._automationEvents.push(createSetValueAutomationEvent(this.getValue(t),t)),void 0!==e&&isSetValueCurveAutomationEvent(e)&&e.startTime+e.duration>t&&(this._automationEvents[this._automationEvents.length-1]=createSetValueCurveAutomationEvent(new Float32Array([6,7]),e.startTime,t-e.startTime))}}else{const i=this._automationEvents.findIndex((e=>getEventTime(e)>t)),n=-1===i?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[i-1];if(void 0!==n&&isSetValueCurveAutomationEvent(n)&&getEventTime(n)+n.duration>t)return!1;const o=isExponentialRampToValueAutomationEvent(e)?createExtendedExponentialRampToValueAutomationEvent(e.value,e.endTime,this._currenTime):isLinearRampToValueAutomationEvent(e)?createExtendedLinearRampToValueAutomationEvent(e.value,t,this._currenTime):e;if(-1===i)this._automationEvents.push(o);else{if(isSetValueCurveAutomationEvent(e)&&t+e.duration>getEventTime(this._automationEvents[i]))return!1;this._automationEvents.splice(i,0,o)}}return!0}flush(e){const t=this._automationEvents.findIndex((t=>getEventTime(t)>e));if(t>1){const e=this._automationEvents.slice(t-1),i=e[0];isSetTargetAutomationEvent(i)&&e.unshift(createSetValueAutomationEvent(getValueOfAutomationEventAtIndexAtTime(this._automationEvents,t-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=e}}getValue(e){if(0===this._automationEvents.length)return this._defaultValue;const t=this._automationEvents.findIndex((t=>getEventTime(t)>e)),i=this._automationEvents[t],n=(-1===t?this._automationEvents.length:t)-1,o=this._automationEvents[n];if(void 0!==o&&isSetTargetAutomationEvent(o)&&(void 0===i||!isAnyRampToValueAutomationEvent(i)||i.insertTime>e))return getTargetValueAtTime(e,getValueOfAutomationEventAtIndexAtTime(this._automationEvents,n-1,o.startTime,this._defaultValue),o);if(void 0!==o&&isSetValueAutomationEvent(o)&&(void 0===i||!isAnyRampToValueAutomationEvent(i)))return o.value;if(void 0!==o&&isSetValueCurveAutomationEvent(o)&&(void 0===i||!isAnyRampToValueAutomationEvent(i)||o.startTime+o.duration>e))return e<o.startTime+o.duration?getValueCurveValueAtTime(e,o):o.values[o.values.length-1];if(void 0!==o&&isAnyRampToValueAutomationEvent(o)&&(void 0===i||!isAnyRampToValueAutomationEvent(i)))return o.value;if(void 0!==i&&isExponentialRampToValueAutomationEvent(i)){const[t,r]=getEndTimeAndValueOfPreviousAutomationEvent(this._automationEvents,n,o,i,this._defaultValue);return getExponentialRampValueAtTime(e,t,r,i)}if(void 0!==i&&isLinearRampToValueAutomationEvent(i)){const[t,r]=getEndTimeAndValueOfPreviousAutomationEvent(this._automationEvents,n,o,i,this._defaultValue);return getLinearRampValueAtTime(e,t,r,i)}return this._defaultValue}}const createCancelAndHoldAutomationEvent=e=>({cancelTime:e,type:"cancelAndHold"}),createCancelScheduledValuesAutomationEvent=e=>({cancelTime:e,type:"cancelScheduledValues"}),createExponentialRampToValueAutomationEvent=(e,t)=>({endTime:t,type:"exponentialRampToValue",value:e}),createLinearRampToValueAutomationEvent=(e,t)=>({endTime:t,type:"linearRampToValue",value:e}),createSetTargetAutomationEvent=(e,t,i)=>({startTime:t,target:e,timeConstant:i,type:"setTarget"}),createAbortError=()=>new DOMException("","AbortError"),createAddActiveInputConnectionToAudioNode=e=>(t,i,[n,o,r],s)=>{e(t[o],[i,n,r],(e=>e[0]===i&&e[1]===n),s)},createAddAudioNodeConnections=e=>(t,i,n)=>{const o=[];for(let e=0;e<n.numberOfInputs;e+=1)o.push(new Set);e.set(t,{activeInputs:o,outputs:new Set,passiveInputs:new WeakMap,renderer:i})},createAddAudioParamConnections=e=>(t,i)=>{e.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:i})},ACTIVE_AUDIO_NODE_STORE=new WeakSet,AUDIO_NODE_CONNECTIONS_STORE=new WeakMap,AUDIO_NODE_STORE=new WeakMap,AUDIO_PARAM_CONNECTIONS_STORE=new WeakMap,AUDIO_PARAM_STORE=new WeakMap,CONTEXT_STORE=new WeakMap,EVENT_LISTENERS=new WeakMap,CYCLE_COUNTERS=new WeakMap,NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS=new WeakMap,NODE_TO_PROCESSOR_MAPS=new WeakMap,handler={construct:()=>handler},isConstructible=e=>{try{new new Proxy(e,handler)}catch{return!1}return!0},IMPORT_STATEMENT_REGEX=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,splitImportStatements=(e,t)=>{const i=[];let n=e.replace(/^[\s]+/,""),o=n.match(IMPORT_STATEMENT_REGEX);for(;null!==o;){const e=o[1].slice(1,-1),r=o[0].replace(/([\s]+)?;?$/,"").replace(e,new URL(e,t).toString());i.push(r),n=n.slice(o[0].length).replace(/^[\s]+/,""),o=n.match(IMPORT_STATEMENT_REGEX)}return[i.join(";"),n]},verifyParameterDescriptors=e=>{if(void 0!==e&&!Array.isArray(e))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},verifyProcessorCtor=e=>{if(!isConstructible(e))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===e.prototype||"object"!=typeof e.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},createAddAudioWorkletModule=(e,t,i,n,o,r,s,a,l,c,d,u,h)=>{let p=0;return(m,f,g={credentials:"omit"})=>{const v=d.get(m);if(void 0!==v&&v.has(f))return Promise.resolve();const _=c.get(m);if(void 0!==_){const e=_.get(f);if(void 0!==e)return e}const y=r(m),w=void 0===y.audioWorklet?o(f).then((([e,t])=>{const[n,o]=splitImportStatements(e,t);return i(`${n};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${o}\n})})(window,'_AWGS')`)})).then((()=>{const e=h._AWGS.pop();if(void 0===e)throw new SyntaxError;n(y.currentTime,y.sampleRate,(()=>e(class{},void 0,((e,i)=>{if(""===e.trim())throw t();const n=NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.get(y);if(void 0!==n){if(n.has(e))throw t();verifyProcessorCtor(i),verifyParameterDescriptors(i.parameterDescriptors),n.set(e,i)}else verifyProcessorCtor(i),verifyParameterDescriptors(i.parameterDescriptors),NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.set(y,new Map([[e,i]]))}),y.sampleRate,void 0,void 0)))})):Promise.all([o(f),Promise.resolve(e(u,u))]).then((([[e,t],i])=>{const n=p+1;p=n;const[o,r]=splitImportStatements(e,t),c=new Blob([`${o};((AudioWorkletProcessor,registerProcessor)=>{${r}\n})(${i?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${i?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${i?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${n}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),d=URL.createObjectURL(c);return y.audioWorklet.addModule(d,g).then((()=>{if(a(y))return y;const e=s(y);return e.audioWorklet.addModule(d,g).then((()=>e))})).then((e=>{if(null===l)throw new SyntaxError;try{new l(e,`__sac${n}`)}catch{throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(d)))}));return void 0===_?c.set(m,new Map([[f,w]])):_.set(f,w),w.then((()=>{const e=d.get(m);void 0===e?d.set(m,new Set([f])):e.add(f)})).finally((()=>{const e=c.get(m);void 0!==e&&e.delete(f)})),w}},getValueForKey=(e,t)=>{const i=e.get(t);if(void 0===i)throw new Error("A value with the given key could not be found.");return i},pickElementFromSet=(e,t)=>{const i=Array.from(e).filter(t);if(i.length>1)throw Error("More than one element was found.");if(0===i.length)throw Error("No element was found.");const[n]=i;return e.delete(n),n},deletePassiveInputConnectionToAudioNode=(e,t,i,n)=>{const o=getValueForKey(e,t),r=pickElementFromSet(o,(e=>e[0]===i&&e[1]===n));return 0===o.size&&e.delete(t),r},getEventListenersOfAudioNode=e=>getValueForKey(EVENT_LISTENERS,e),setInternalStateToActive=e=>{if(ACTIVE_AUDIO_NODE_STORE.has(e))throw new Error("The AudioNode is already stored.");ACTIVE_AUDIO_NODE_STORE.add(e),getEventListenersOfAudioNode(e).forEach((e=>e(!0)))},isAudioWorkletNode=e=>"port"in e,setInternalStateToPassive=e=>{if(!ACTIVE_AUDIO_NODE_STORE.has(e))throw new Error("The AudioNode is not stored.");ACTIVE_AUDIO_NODE_STORE.delete(e),getEventListenersOfAudioNode(e).forEach((e=>e(!1)))},setInternalStateToPassiveWhenNecessary=(e,t)=>{!isAudioWorkletNode(e)&&t.every((e=>0===e.size))&&setInternalStateToPassive(e)},createAddConnectionToAudioNode=(e,t,i,n,o,r,s,a,l,c,d,u,h)=>{const p=new WeakMap;return(m,f,g,v,_)=>{const{activeInputs:y,passiveInputs:w}=r(f),{outputs:b}=r(m),x=a(m),T=r=>{const a=l(f),c=l(m);if(r){const t=deletePassiveInputConnectionToAudioNode(w,m,g,v);e(y,m,t,!1),_||u(m)||i(c,a,g,v),h(f)&&setInternalStateToActive(f)}else{const e=n(y,m,g,v);t(w,v,e,!1),_||u(m)||o(c,a,g,v);const i=s(f);if(0===i)d(f)&&setInternalStateToPassiveWhenNecessary(f,y);else{const e=p.get(f);void 0!==e&&clearTimeout(e),p.set(f,setTimeout((()=>{d(f)&&setInternalStateToPassiveWhenNecessary(f,y)}),1e3*i))}}};return!!c(b,[f,g,v],(e=>e[0]===f&&e[1]===g&&e[2]===v),!0)&&(x.add(T),d(m)?e(y,m,[g,v,T],!0):t(w,v,[m,g,T],!0),!0)}},createAddPassiveInputConnectionToAudioNode=e=>(t,i,[n,o,r],s)=>{const a=t.get(n);void 0===a?t.set(n,new Set([[o,i,r]])):e(a,[o,i,r],(e=>e[0]===o&&e[1]===i),s)},createAddSilentConnection=e=>(t,i)=>{const n=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.connect(n).connect(t.destination);const o=()=>{i.removeEventListener("ended",o),i.disconnect(n),n.disconnect()};i.addEventListener("ended",o)},createAddUnrenderedAudioWorkletNode=e=>(t,i)=>{e(t).add(i)},DEFAULT_OPTIONS$1={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},createAnalyserNodeConstructor=(e,t,i,n,o,r)=>class extends e{constructor(e,i){const s=o(e),a={...DEFAULT_OPTIONS$1,...i},l=n(s,a);super(e,!1,l,r(s)?t():null),this._nativeAnalyserNode=l}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(e){this._nativeAnalyserNode.fftSize=e}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(e){const t=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=e,!(e>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=t,i()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(e){const t=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=e,!(this._nativeAnalyserNode.maxDecibels>e))throw this._nativeAnalyserNode.minDecibels=t,i()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(e){this._nativeAnalyserNode.smoothingTimeConstant=e}getByteFrequencyData(e){this._nativeAnalyserNode.getByteFrequencyData(e)}getByteTimeDomainData(e){this._nativeAnalyserNode.getByteTimeDomainData(e)}getFloatFrequencyData(e){this._nativeAnalyserNode.getFloatFrequencyData(e)}getFloatTimeDomainData(e){this._nativeAnalyserNode.getFloatTimeDomainData(e)}},isOwnedByContext=(e,t)=>e.context===t,createAnalyserNodeRendererFactory=(e,t,i)=>()=>{const n=new WeakMap;return{render(o,r,s){const a=n.get(r);return void 0!==a?Promise.resolve(a):(async(o,r,s)=>{let a=t(o);if(!isOwnedByContext(a,r)){const t={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,fftSize:a.fftSize,maxDecibels:a.maxDecibels,minDecibels:a.minDecibels,smoothingTimeConstant:a.smoothingTimeConstant};a=e(r,t)}return n.set(r,a),await i(o,r,a,s),a})(o,r,s)}}},testAudioBufferCopyChannelMethodsOutOfBoundsSupport=e=>{try{e.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},createIndexSizeError=()=>new DOMException("","IndexSizeError"),wrapAudioBufferGetChannelDataMethod=e=>{var t;e.getChannelData=(t=e.getChannelData,i=>{try{return t.call(e,i)}catch(e){if(12===e.code)throw createIndexSizeError();throw e}})},DEFAULT_OPTIONS$1$1={numberOfChannels:1},createAudioBufferConstructor=(e,t,i,n,o,r,s,a)=>{let l=null;return class c{constructor(c){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:d,numberOfChannels:u,sampleRate:h}={...DEFAULT_OPTIONS$1$1,...c};null===l&&(l=new o(1,1,44100));const p=null!==n&&t(r,r)?new n({length:d,numberOfChannels:u,sampleRate:h}):l.createBuffer(u,d,h);if(0===p.numberOfChannels)throw i();return"function"!=typeof p.copyFromChannel?(s(p),wrapAudioBufferGetChannelDataMethod(p)):t(testAudioBufferCopyChannelMethodsOutOfBoundsSupport,(()=>testAudioBufferCopyChannelMethodsOutOfBoundsSupport(p)))||a(p),e.add(p),p}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===c.prototype||e.has(t)}}},MOST_NEGATIVE_SINGLE_FLOAT=-34028234663852886e22,MOST_POSITIVE_SINGLE_FLOAT=-MOST_NEGATIVE_SINGLE_FLOAT,isActiveAudioNode=e=>ACTIVE_AUDIO_NODE_STORE.has(e),DEFAULT_OPTIONS$2={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},createAudioBufferSourceNodeConstructor=(e,t,i,n,o,r,s,a)=>class extends e{constructor(e,n){const a=r(e),l={...DEFAULT_OPTIONS$2,...n},c=o(a,l),d=s(a),u=d?t():null;super(e,!1,c,u),this._audioBufferSourceNodeRenderer=u,this._isBufferNullified=!1,this._isBufferSet=null!==l.buffer,this._nativeAudioBufferSourceNode=c,this._onended=null,this._playbackRate=i(this,d,c.playbackRate,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(e){if(this._nativeAudioBufferSourceNode.buffer=e,null!==e){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(e){this._nativeAudioBufferSourceNode.loop=e}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(e){this._nativeAudioBufferSourceNode.loopEnd=e}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(e){this._nativeAudioBufferSourceNode.loopStart=e}get onended(){return this._onended}set onended(e){const t="function"==typeof e?a(this,e):null;this._nativeAudioBufferSourceNode.onended=t;const i=this._nativeAudioBufferSourceNode.onended;this._onended=null!==i&&i===t?e:i}get playbackRate(){return this._playbackRate}start(e=0,t=0,i){if(this._nativeAudioBufferSourceNode.start(e,t,i),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===i?[e,t]:[e,t,i]),"closed"!==this.context.state){setInternalStateToActive(this);const e=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",e),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",e)}}stop(e=0){this._nativeAudioBufferSourceNode.stop(e),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=e)}},createAudioBufferSourceNodeRendererFactory=(e,t,i,n,o)=>()=>{const r=new WeakMap;let s=null,a=null;return{set start(e){s=e},set stop(e){a=e},render(l,c,d){const u=r.get(c);return void 0!==u?Promise.resolve(u):(async(l,c,d)=>{let u=i(l);const h=isOwnedByContext(u,c);if(!h){const e={buffer:u.buffer,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,loop:u.loop,loopEnd:u.loopEnd,loopStart:u.loopStart,playbackRate:u.playbackRate.value};u=t(c,e),null!==s&&u.start(...s),null!==a&&u.stop(a)}return r.set(c,u),h?await e(c,l.playbackRate,u.playbackRate,d):await n(c,l.playbackRate,u.playbackRate,d),await o(l,c,u,d),u})(l,c,d)}}},isAudioBufferSourceNode=e=>"playbackRate"in e,isBiquadFilterNode=e=>"frequency"in e&&"gain"in e,isConstantSourceNode=e=>"offset"in e,isGainNode=e=>!("frequency"in e)&&"gain"in e,isOscillatorNode=e=>"detune"in e&&"frequency"in e,isStereoPannerNode=e=>"pan"in e,getAudioNodeConnections=e=>getValueForKey(AUDIO_NODE_CONNECTIONS_STORE,e),getAudioParamConnections=e=>getValueForKey(AUDIO_PARAM_CONNECTIONS_STORE,e),deactivateActiveAudioNodeInputConnections=(e,t)=>{const{activeInputs:i}=getAudioNodeConnections(e);i.forEach((i=>i.forEach((([i])=>{t.includes(e)||deactivateActiveAudioNodeInputConnections(i,[...t,e])}))));const n=isAudioBufferSourceNode(e)?[e.playbackRate]:isAudioWorkletNode(e)?Array.from(e.parameters.values()):isBiquadFilterNode(e)?[e.Q,e.detune,e.frequency,e.gain]:isConstantSourceNode(e)?[e.offset]:isGainNode(e)?[e.gain]:isOscillatorNode(e)?[e.detune,e.frequency]:isStereoPannerNode(e)?[e.pan]:[];for(const e of n){const i=getAudioParamConnections(e);void 0!==i&&i.activeInputs.forEach((([e])=>deactivateActiveAudioNodeInputConnections(e,t)))}isActiveAudioNode(e)&&setInternalStateToPassive(e)},deactivateAudioGraph=e=>{deactivateActiveAudioNodeInputConnections(e.destination,[])},isValidLatencyHint=e=>void 0===e||"number"==typeof e||"string"==typeof e&&("balanced"===e||"interactive"===e||"playback"===e),createAudioContextConstructor=(e,t,i,n,o,r,s,a,l)=>class extends e{constructor(e={}){if(null===l)throw new Error("Missing the native AudioContext constructor.");let t;try{t=new l(e)}catch(e){if(12===e.code&&"sampleRate is not in range"===e.message)throw i();throw e}if(null===t)throw n();if(!isValidLatencyHint(e.latencyHint))throw new TypeError(`The provided value '${e.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==e.sampleRate&&t.sampleRate!==e.sampleRate)throw i();super(t,2);const{latencyHint:o}=e,{sampleRate:r}=t;if(this._baseLatency="number"==typeof t.baseLatency?t.baseLatency:"balanced"===o?512/r:"interactive"===o||void 0===o?256/r:"playback"===o?1024/r:128*Math.max(2,Math.min(128,Math.round(o*r/128)))/r,this._nativeAudioContext=t,"webkitAudioContext"===l.name?(this._nativeGainNode=t.createGain(),this._nativeOscillatorNode=t.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(t.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===t.state){this._state="suspended";const e=()=>{"suspended"===this._state&&(this._state=null),t.removeEventListener("statechange",e)};t.addEventListener("statechange",e)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw t()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),deactivateAudioGraph(this)})))}createMediaElementSource(e){return new o(this,{mediaElement:e})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(e){return new s(this,{mediaStream:e})}createMediaStreamTrackSource(e){return new a(this,{mediaStreamTrack:e})}resume(){return"suspended"===this._state?new Promise(((e,t)=>{const i=()=>{this._nativeAudioContext.removeEventListener("statechange",i),"running"===this._nativeAudioContext.state?e():this.resume().then(e,t)};this._nativeAudioContext.addEventListener("statechange",i)})):this._nativeAudioContext.resume().catch((e=>{if(void 0===e||15===e.code)throw t();throw e}))}suspend(){return this._nativeAudioContext.suspend().catch((e=>{if(void 0===e)throw t();throw e}))}},createAudioDestinationNodeConstructor=(e,t,i,n,o,r,s,a)=>class extends e{constructor(e,i){const n=r(e),l=s(n),c=o(n,i,l);super(e,!1,c,l?t(a):null),this._isNodeOfNativeOfflineAudioContext=l,this._nativeAudioDestinationNode=c}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(e){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(e>this._nativeAudioDestinationNode.maxChannelCount)throw i();this._nativeAudioDestinationNode.channelCount=e}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(e){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=e}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},createAudioDestinationNodeRenderer=e=>{let t=null;return{render:(i,n,o)=>(null===t&&(t=(async(t,i,n)=>{const o=i.destination;return await e(t,i,o,n),o})(i,n,o)),t)}},createAudioListenerFactory=(e,t,i,n,o,r,s,a)=>(l,c)=>{const d=c.listener,{forwardX:u,forwardY:h,forwardZ:p,positionX:m,positionY:f,positionZ:g,upX:v,upY:_,upZ:y}=void 0===d.forwardX?(()=>{const u=new Float32Array(1),h=t(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),p=s(c);let m=!1,f=[0,0,-1,0,1,0],g=[0,0,0];const v=()=>{if(m)return;m=!0;const e=n(c,256,9,0);e.onaudioprocess=({inputBuffer:e})=>{const t=[r(e,u,0),r(e,u,1),r(e,u,2),r(e,u,3),r(e,u,4),r(e,u,5)];t.some(((e,t)=>e!==f[t]))&&(d.setOrientation(...t),f=t);const i=[r(e,u,6),r(e,u,7),r(e,u,8)];i.some(((e,t)=>e!==g[t]))&&(d.setPosition(...i),g=i)},h.connect(e)},_=e=>t=>{t!==f[e]&&(f[e]=t,d.setOrientation(...f))},y=e=>t=>{t!==g[e]&&(g[e]=t,d.setPosition(...g))},w=(t,n,r)=>{const s=i(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:n});s.connect(h,0,t),s.start(),Object.defineProperty(s.offset,"defaultValue",{get:()=>n});const d=e({context:l},p,s.offset,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT);var u,m,f,g,_,y,w;return a(d,"value",(e=>()=>e.call(d)),(e=>t=>{try{e.call(d,t)}catch(e){if(9!==e.code)throw e}v(),p&&r(t)})),d.cancelAndHoldAtTime=(u=d.cancelAndHoldAtTime,p?()=>{throw o()}:(...e)=>{const t=u.apply(d,e);return v(),t}),d.cancelScheduledValues=(m=d.cancelScheduledValues,p?()=>{throw o()}:(...e)=>{const t=m.apply(d,e);return v(),t}),d.exponentialRampToValueAtTime=(f=d.exponentialRampToValueAtTime,p?()=>{throw o()}:(...e)=>{const t=f.apply(d,e);return v(),t}),d.linearRampToValueAtTime=(g=d.linearRampToValueAtTime,p?()=>{throw o()}:(...e)=>{const t=g.apply(d,e);return v(),t}),d.setTargetAtTime=(_=d.setTargetAtTime,p?()=>{throw o()}:(...e)=>{const t=_.apply(d,e);return v(),t}),d.setValueAtTime=(y=d.setValueAtTime,p?()=>{throw o()}:(...e)=>{const t=y.apply(d,e);return v(),t}),d.setValueCurveAtTime=(w=d.setValueCurveAtTime,p?()=>{throw o()}:(...e)=>{const t=w.apply(d,e);return v(),t}),d};return{forwardX:w(0,0,_(0)),forwardY:w(1,0,_(1)),forwardZ:w(2,-1,_(2)),positionX:w(6,0,y(0)),positionY:w(7,0,y(1)),positionZ:w(8,0,y(2)),upX:w(3,0,_(3)),upY:w(4,1,_(4)),upZ:w(5,0,_(5))}})():d;return{get forwardX(){return u},get forwardY(){return h},get forwardZ(){return p},get positionX(){return m},get positionY(){return f},get positionZ(){return g},get upX(){return v},get upY(){return _},get upZ(){return y}}},isAudioNode$1=e=>"context"in e,isAudioNodeOutputConnection=e=>isAudioNode$1(e[0]),insertElementInSet=(e,t,i,n)=>{for(const t of e)if(i(t)){if(n)return!1;throw Error("The set contains at least one similar element.")}return e.add(t),!0},addActiveInputConnectionToAudioParam=(e,t,[i,n],o)=>{insertElementInSet(e,[t,i,n],(e=>e[0]===t&&e[1]===i),o)},addPassiveInputConnectionToAudioParam=(e,[t,i,n],o)=>{const r=e.get(t);void 0===r?e.set(t,new Set([[i,n]])):insertElementInSet(r,[i,n],(e=>e[0]===i),o)},isNativeAudioNodeFaker=e=>"inputs"in e,connectNativeAudioNodeToNativeAudioNode=(e,t,i,n)=>{if(isNativeAudioNodeFaker(t)){const o=t.inputs[n];return e.connect(o,i,0),[o,i,0]}return e.connect(t,i,n),[t,i,n]},deleteActiveInputConnection=(e,t,i)=>{for(const n of e)if(n[0]===t&&n[1]===i)return e.delete(n),n;return null},deleteActiveInputConnectionToAudioParam=(e,t,i)=>pickElementFromSet(e,(e=>e[0]===t&&e[1]===i)),deleteEventListenerOfAudioNode=(e,t)=>{if(!getEventListenersOfAudioNode(e).delete(t))throw new Error("Missing the expected event listener.")},deletePassiveInputConnectionToAudioParam=(e,t,i)=>{const n=getValueForKey(e,t),o=pickElementFromSet(n,(e=>e[0]===i));return 0===n.size&&e.delete(t),o},disconnectNativeAudioNodeFromNativeAudioNode=(e,t,i,n)=>{isNativeAudioNodeFaker(t)?e.disconnect(t.inputs[n],i,0):e.disconnect(t,i,n)},getNativeAudioNode=e=>getValueForKey(AUDIO_NODE_STORE,e),getNativeAudioParam=e=>getValueForKey(AUDIO_PARAM_STORE,e),isPartOfACycle=e=>CYCLE_COUNTERS.has(e),isPassiveAudioNode=e=>!ACTIVE_AUDIO_NODE_STORE.has(e),testAudioNodeDisconnectMethodSupport=e=>new Promise((t=>{const i=e.createScriptProcessor(256,1,1),n=e.createGain(),o=e.createBuffer(1,2,44100),r=o.getChannelData(0);r[0]=1,r[1]=1;const s=e.createBufferSource();s.buffer=o,s.loop=!0,s.connect(i).connect(e.destination),s.connect(n),s.disconnect(n),i.onaudioprocess=n=>{const o=n.inputBuffer.getChannelData(0);Array.prototype.some.call(o,(e=>1===e))?t(!0):t(!1),s.stop(),i.onaudioprocess=null,s.disconnect(i),i.disconnect(e.destination)},s.start()})),visitEachAudioNodeOnce=(e,t)=>{const i=new Map;for(const t of e)for(const e of t){const t=i.get(e);i.set(e,void 0===t?1:t+1)}i.forEach(((e,i)=>t(i,e)))},isNativeAudioNode=e=>"context"in e,wrapAudioNodeDisconnectMethod=e=>{const t=new Map;e.connect=(e=>(i,n=0,o=0)=>{const r=isNativeAudioNode(i)?e(i,n,o):e(i,n),s=t.get(i);return void 0===s?t.set(i,[{input:o,output:n}]):s.every((e=>e.input!==o||e.output!==n))&&s.push({input:o,output:n}),r})(e.connect.bind(e)),e.disconnect=(i=>(n,o,r)=>{if(i.apply(e),void 0===n)t.clear();else if("number"==typeof n)for(const[e,i]of t){const o=i.filter((e=>e.output!==n));0===o.length?t.delete(e):t.set(e,o)}else if(t.has(n))if(void 0===o)t.delete(n);else{const e=t.get(n);if(void 0!==e){const i=e.filter((e=>e.output!==o&&(e.input!==r||void 0===r)));0===i.length?t.delete(n):t.set(n,i)}}for(const[i,n]of t)n.forEach((t=>{isNativeAudioNode(i)?e.connect(i,t.output,t.input):e.connect(i,t.output)}))})(e.disconnect)},addConnectionToAudioParamOfAudioContext=(e,t,i,n)=>{const{activeInputs:o,passiveInputs:r}=getAudioParamConnections(t),{outputs:s}=getAudioNodeConnections(e),a=getEventListenersOfAudioNode(e),l=s=>{const a=getNativeAudioNode(e),l=getNativeAudioParam(t);if(s){const t=deletePassiveInputConnectionToAudioParam(r,e,i);addActiveInputConnectionToAudioParam(o,e,t,!1),n||isPartOfACycle(e)||a.connect(l,i)}else{const t=deleteActiveInputConnectionToAudioParam(o,e,i);addPassiveInputConnectionToAudioParam(r,t,!1),n||isPartOfACycle(e)||a.disconnect(l,i)}};return!!insertElementInSet(s,[t,i],(e=>e[0]===t&&e[1]===i),!0)&&(a.add(l),isActiveAudioNode(e)?addActiveInputConnectionToAudioParam(o,e,[i,l],!0):addPassiveInputConnectionToAudioParam(r,[e,i,l],!0),!0)},deleteInputConnectionOfAudioNode=(e,t,i,n)=>{const{activeInputs:o,passiveInputs:r}=getAudioNodeConnections(t),s=deleteActiveInputConnection(o[n],e,i);if(null===s){return[deletePassiveInputConnectionToAudioNode(r,e,i,n)[2],!1]}return[s[2],!0]},deleteInputConnectionOfAudioParam=(e,t,i)=>{const{activeInputs:n,passiveInputs:o}=getAudioParamConnections(t),r=deleteActiveInputConnection(n,e,i);if(null===r){return[deletePassiveInputConnectionToAudioParam(o,e,i)[1],!1]}return[r[2],!0]},deleteInputsOfAudioNode=(e,t,i,n,o)=>{const[r,s]=deleteInputConnectionOfAudioNode(e,i,n,o);if(null!==r&&(deleteEventListenerOfAudioNode(e,r),!s||t||isPartOfACycle(e)||disconnectNativeAudioNodeFromNativeAudioNode(getNativeAudioNode(e),getNativeAudioNode(i),n,o)),isActiveAudioNode(i)){const{activeInputs:e}=getAudioNodeConnections(i);setInternalStateToPassiveWhenNecessary(i,e)}},deleteInputsOfAudioParam=(e,t,i,n)=>{const[o,r]=deleteInputConnectionOfAudioParam(e,i,n);null!==o&&(deleteEventListenerOfAudioNode(e,o),!r||t||isPartOfACycle(e)||getNativeAudioNode(e).disconnect(getNativeAudioParam(i),n))},deleteAnyConnection=(e,t)=>{const i=getAudioNodeConnections(e),n=[];for(const o of i.outputs)isAudioNodeOutputConnection(o)?deleteInputsOfAudioNode(e,t,...o):deleteInputsOfAudioParam(e,t,...o),n.push(o[0]);return i.outputs.clear(),n},deleteConnectionAtOutput=(e,t,i)=>{const n=getAudioNodeConnections(e),o=[];for(const r of n.outputs)r[1]===i&&(isAudioNodeOutputConnection(r)?deleteInputsOfAudioNode(e,t,...r):deleteInputsOfAudioParam(e,t,...r),o.push(r[0]),n.outputs.delete(r));return o},deleteConnectionToDestination=(e,t,i,n,o)=>{const r=getAudioNodeConnections(e);return Array.from(r.outputs).filter((e=>!(e[0]!==i||void 0!==n&&e[1]!==n||void 0!==o&&e[2]!==o))).map((i=>(isAudioNodeOutputConnection(i)?deleteInputsOfAudioNode(e,t,...i):deleteInputsOfAudioParam(e,t,...i),r.outputs.delete(i),i[0])))},createAudioNodeConstructor=(e,t,i,n,o,r,s,a,l,c,d,u,h,p,m)=>class extends c{constructor(t,n,o,r){super(o),this._context=t,this._nativeAudioNode=o;const s=d(t);u(s)&&!0!==i(testAudioNodeDisconnectMethodSupport,(()=>testAudioNodeDisconnectMethodSupport(s)))&&wrapAudioNodeDisconnectMethod(o),AUDIO_NODE_STORE.set(this,o),EVENT_LISTENERS.set(this,new Set),"closed"!==t.state&&n&&setInternalStateToActive(this),e(this,r,o)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(e){this._nativeAudioNode.channelCount=e}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(e){this._nativeAudioNode.channelCountMode=e}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(e){this._nativeAudioNode.channelInterpretation=e}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(e,i=0,a=0){if(i<0||i>=this._nativeAudioNode.numberOfOutputs)throw o();const c=d(this._context),u=m(c);if(h(e)||p(e))throw r();if(isAudioNode$1(e)){const o=getNativeAudioNode(e);try{const t=connectNativeAudioNodeToNativeAudioNode(this._nativeAudioNode,o,i,a),n=isPassiveAudioNode(this);(u||n)&&this._nativeAudioNode.disconnect(...t),"closed"!==this.context.state&&!n&&isPassiveAudioNode(e)&&setInternalStateToActive(e)}catch(e){if(12===e.code)throw r();throw e}if(t(this,e,i,a,u)){const t=l([this],e);visitEachAudioNodeOnce(t,n(u))}return e}const f=getNativeAudioParam(e);if("playbackRate"===f.name&&1024===f.maxValue)throw s();try{this._nativeAudioNode.connect(f,i),(u||isPassiveAudioNode(this))&&this._nativeAudioNode.disconnect(f,i)}catch(e){if(12===e.code)throw r();throw e}if(addConnectionToAudioParamOfAudioContext(this,e,i,u)){const t=l([this],e);visitEachAudioNodeOnce(t,n(u))}}disconnect(e,t,i){let n;const s=d(this._context),c=m(s);if(void 0===e)n=deleteAnyConnection(this,c);else if("number"==typeof e){if(e<0||e>=this.numberOfOutputs)throw o();n=deleteConnectionAtOutput(this,c,e)}else{if(void 0!==t&&(t<0||t>=this.numberOfOutputs))throw o();if(isAudioNode$1(e)&&void 0!==i&&(i<0||i>=e.numberOfInputs))throw o();if(n=deleteConnectionToDestination(this,c,e,t,i),0===n.length)throw r()}for(const e of n){const t=l([this],e);visitEachAudioNodeOnce(t,a)}}},createAudioParamFactory=(e,t,i,n,o,r,s,a,l,c,d,u,h)=>(p,m,f,g=null,v=null)=>{const _=new AutomationEventList(f.defaultValue),y=m?n(_):null,w={get defaultValue(){return f.defaultValue},get maxValue(){return null===g?f.maxValue:g},get minValue(){return null===v?f.minValue:v},get value(){return f.value},set value(e){f.value=e,w.setValueAtTime(e,p.context.currentTime)},cancelAndHoldAtTime(e){if("function"==typeof f.cancelAndHoldAtTime)null===y&&_.flush(p.context.currentTime),_.add(o(e)),f.cancelAndHoldAtTime(e);else{const t=Array.from(_).pop();null===y&&_.flush(p.context.currentTime),_.add(o(e));const i=Array.from(_).pop();f.cancelScheduledValues(e),t!==i&&void 0!==i&&("exponentialRampToValue"===i.type?f.exponentialRampToValueAtTime(i.value,i.endTime):"linearRampToValue"===i.type?f.linearRampToValueAtTime(i.value,i.endTime):"setValue"===i.type?f.setValueAtTime(i.value,i.startTime):"setValueCurve"===i.type&&f.setValueCurveAtTime(i.values,i.startTime,i.duration))}return w},cancelScheduledValues:e=>(null===y&&_.flush(p.context.currentTime),_.add(r(e)),f.cancelScheduledValues(e),w),exponentialRampToValueAtTime(e,t){if(0===e)throw new RangeError;if(!Number.isFinite(t)||t<0)throw new RangeError;return null===y&&_.flush(p.context.currentTime),_.add(s(e,t)),f.exponentialRampToValueAtTime(e,t),w},linearRampToValueAtTime:(e,t)=>(null===y&&_.flush(p.context.currentTime),_.add(a(e,t)),f.linearRampToValueAtTime(e,t),w),setTargetAtTime:(e,t,i)=>(null===y&&_.flush(p.context.currentTime),_.add(l(e,t,i)),f.setTargetAtTime(e,t,i),w),setValueAtTime:(e,t)=>(null===y&&_.flush(p.context.currentTime),_.add(c(e,t)),f.setValueAtTime(e,t),w),setValueCurveAtTime(e,t,i){const n=e instanceof Float32Array?e:new Float32Array(e);if(null!==u&&"webkitAudioContext"===u.name){const e=t+i,o=p.context.sampleRate,r=Math.ceil(t*o),s=Math.floor(e*o),a=s-r,l=new Float32Array(a);for(let e=0;e<a;e+=1){const s=(n.length-1)/i*((r+e)/o-t),a=Math.floor(s),c=Math.ceil(s);l[e]=a===c?n[a]:(1-(s-a))*n[a]+(1-(c-s))*n[c]}null===y&&_.flush(p.context.currentTime),_.add(d(l,t,i)),f.setValueCurveAtTime(l,t,i);const c=s/o;c<e&&h(w,l[l.length-1],c),h(w,n[n.length-1],e)}else null===y&&_.flush(p.context.currentTime),_.add(d(n,t,i)),f.setValueCurveAtTime(n,t,i);return w}};return i.set(w,f),t.set(w,p),e(w,y),w},createAudioParamRenderer=e=>({replay(t){for(const i of e)if("exponentialRampToValue"===i.type){const{endTime:e,value:n}=i;t.exponentialRampToValueAtTime(n,e)}else if("linearRampToValue"===i.type){const{endTime:e,value:n}=i;t.linearRampToValueAtTime(n,e)}else if("setTarget"===i.type){const{startTime:e,target:n,timeConstant:o}=i;t.setTargetAtTime(n,e,o)}else if("setValue"===i.type){const{startTime:e,value:n}=i;t.setValueAtTime(n,e)}else{if("setValueCurve"!==i.type)throw new Error("Can't apply an unknown automation.");{const{duration:e,startTime:n,values:o}=i;t.setValueCurveAtTime(o,n,e)}}}});class ReadOnlyMap{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach(((i,n)=>e.call(t,i,n,this)))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const DEFAULT_OPTIONS$3={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},createAudioWorkletNodeConstructor=(e,t,i,n,o,r,s,a,l,c,d,u,h,p)=>class extends t{constructor(t,p,m){var f;const g=a(t),v=l(g),_=d({...DEFAULT_OPTIONS$3,...m});h(_);const y=NODE_NAME_TO_PROCESSOR_CONSTRUCTOR_MAPS.get(g),w=null==y?void 0:y.get(p),b=v||"closed"!==g.state?g:null!==(f=s(g))&&void 0!==f?f:g,x=o(b,v?null:t.baseLatency,c,p,w,_);super(t,!0,x,v?n(p,_,w):null);const T=[];x.parameters.forEach(((e,t)=>{const n=i(this,v,e);T.push([t,n])})),this._nativeAudioWorkletNode=x,this._onprocessorerror=null,this._parameters=new ReadOnlyMap(T),v&&e(g,this);const{activeInputs:S}=r(this);u(x,S)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(e){const t="function"==typeof e?p(this,e):null;this._nativeAudioWorkletNode.onprocessorerror=t;const i=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==i&&i===t?e:i}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function copyFromChannel(e,t,i,n,o){if("function"==typeof e.copyFromChannel)0===t[i].byteLength&&(t[i]=new Float32Array(128)),e.copyFromChannel(t[i],n,o);else{const r=e.getChannelData(n);if(0===t[i].byteLength)t[i]=r.slice(o,o+128);else{const e=new Float32Array(r.buffer,o*Float32Array.BYTES_PER_ELEMENT,128);t[i].set(e)}}}const copyToChannel=(e,t,i,n,o)=>{"function"==typeof e.copyToChannel?0!==t[i].byteLength&&e.copyToChannel(t[i],n,o):0!==t[i].byteLength&&e.getChannelData(n).set(t[i],o)},createNestedArrays=(e,t)=>{const i=[];for(let n=0;n<e;n+=1){const e=[],o="number"==typeof t?t:t[n];for(let t=0;t<o;t+=1)e.push(new Float32Array(128));i.push(e)}return i},getAudioWorkletProcessor=(e,t)=>{const i=getValueForKey(NODE_TO_PROCESSOR_MAPS,e),n=getNativeAudioNode(t);return getValueForKey(i,n)},processBuffer=async(e,t,i,n,o,r,s)=>{const a=null===t?128*Math.ceil(e.context.length/128):t.length,l=n.channelCount*n.numberOfInputs,c=o.reduce(((e,t)=>e+t),0),d=0===c?null:i.createBuffer(c,a,i.sampleRate);if(void 0===r)throw new Error("Missing the processor constructor.");const u=getAudioNodeConnections(e),h=await getAudioWorkletProcessor(i,e),p=createNestedArrays(n.numberOfInputs,n.channelCount),m=createNestedArrays(n.numberOfOutputs,o),f=Array.from(e.parameters.keys()).reduce(((e,t)=>({...e,[t]:new Float32Array(128)})),{});for(let c=0;c<a;c+=128){if(n.numberOfInputs>0&&null!==t)for(let e=0;e<n.numberOfInputs;e+=1)for(let i=0;i<n.channelCount;i+=1)copyFromChannel(t,p[e],i,i,c);void 0!==r.parameterDescriptors&&null!==t&&r.parameterDescriptors.forEach((({name:e},i)=>{copyFromChannel(t,f,e,l+i,c)}));for(let e=0;e<n.numberOfInputs;e+=1)for(let t=0;t<o[e];t+=1)0===m[e][t].byteLength&&(m[e][t]=new Float32Array(128));try{const e=p.map(((e,t)=>0===u.activeInputs[t].size?[]:e)),t=s(c/i.sampleRate,i.sampleRate,(()=>h.process(e,m,f)));if(null!==d)for(let e=0,t=0;e<n.numberOfOutputs;e+=1){for(let i=0;i<o[e];i+=1)copyToChannel(d,m[e],i,t+i,c);t+=o[e]}if(!t)break}catch(t){e.dispatchEvent(new ErrorEvent("processorerror",{colno:t.colno,filename:t.filename,lineno:t.lineno,message:t.message}));break}}return d},createAudioWorkletNodeRendererFactory=(e,t,i,n,o,r,s,a,l,c,d,u,h,p,m,f)=>(g,v,_)=>{const y=new WeakMap;let w=null;return{render(b,x,T){a(x,b);const S=y.get(x);return void 0!==S?Promise.resolve(S):(async(a,b,x)=>{let T=d(a),S=null;const k=isOwnedByContext(T,b),C=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(null===u){const e=C.reduce(((e,t)=>e+t),0),i=o(b,{channelCount:Math.max(1,e),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,e)}),r=[];for(let e=0;e<a.numberOfOutputs;e+=1)r.push(n(b,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:C[e]}));const c=s(b,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1});c.connect=t.bind(null,r),c.disconnect=l.bind(null,r),S=[i,r,c]}else k||(T=new u(b,g));if(y.set(b,null===S?T:S[2]),null!==S){if(null===w){if(void 0===_)throw new Error("Missing the processor constructor.");if(null===h)throw new Error("Missing the native OfflineAudioContext constructor.");const e=a.channelCount*a.numberOfInputs,t=void 0===_.parameterDescriptors?0:_.parameterDescriptors.length,i=e+t,l=async()=>{const l=new h(i,128*Math.ceil(a.context.length/128),b.sampleRate),c=[],d=[];for(let e=0;e<v.numberOfInputs;e+=1)c.push(s(l,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),d.push(o(l,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const u=await Promise.all(Array.from(a.parameters.values()).map((async e=>{const t=r(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:e.value});return await p(l,e,t.offset,x),t}))),g=n(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,e+t)});for(let e=0;e<v.numberOfInputs;e+=1){c[e].connect(d[e]);for(let t=0;t<v.channelCount;t+=1)d[e].connect(g,t,e*v.channelCount+t)}for(const[t,i]of u.entries())i.connect(g,0,e+t),i.start(0);return g.connect(l.destination),await Promise.all(c.map((e=>m(a,l,e,x)))),f(l)};w=processBuffer(a,0===i?null:await l(),b,v,C,_,c)}const e=await w,t=i(b,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[l,d,u]=S;null!==e&&(t.buffer=e,t.start(0)),t.connect(l);for(let e=0,t=0;e<a.numberOfOutputs;e+=1){const i=d[e];for(let n=0;n<C[e];n+=1)l.connect(i,t+n,n);t+=C[e]}return u}if(k)for(const[t,i]of a.parameters.entries())await e(b,i,T.parameters.get(t),x);else for(const[e,t]of a.parameters.entries())await p(b,t,T.parameters.get(e),x);return await m(a,b,T,x),T})(b,x,T)}}},createBaseAudioContextConstructor=(e,t,i,n,o,r,s,a,l,c,d,u,h,p,m,f,g,v,_,y)=>class extends m{constructor(t,i){super(t,i),this._nativeContext=t,this._audioWorklet=void 0===e?void 0:{addModule:(t,i)=>e(this,t,i)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new t(this)}createBiquadFilter(){return new o(this)}createBuffer(e,t,n){return new i({length:t,numberOfChannels:e,sampleRate:n})}createBufferSource(){return new n(this)}createChannelMerger(e=6){return new r(this,{numberOfInputs:e})}createChannelSplitter(e=6){return new s(this,{numberOfOutputs:e})}createConstantSource(){return new a(this)}createConvolver(){return new l(this)}createDelay(e=1){return new d(this,{maxDelayTime:e})}createDynamicsCompressor(){return new u(this)}createGain(){return new h(this)}createIIRFilter(e,t){return new p(this,{feedback:t,feedforward:e})}createOscillator(){return new f(this)}createPanner(){return new g(this)}createPeriodicWave(e,t,i={disableNormalization:!1}){return new v(this,{...i,imag:t,real:e})}createStereoPanner(){return new _(this)}createWaveShaper(){return new y(this)}decodeAudioData(e,t,i){return c(this._nativeContext,e).then((e=>("function"==typeof t&&t(e),e)),(e=>{throw"function"==typeof i&&i(e),e}))}},DEFAULT_OPTIONS$4={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},createBiquadFilterNodeConstructor=(e,t,i,n,o,r,s,a)=>class extends e{constructor(e,n){const l=r(e),c={...DEFAULT_OPTIONS$4,...n},d=o(l,c),u=s(l);super(e,!1,d,u?i():null),this._Q=t(this,u,d.Q,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._detune=t(this,u,d.detune,1200*Math.log2(MOST_POSITIVE_SINGLE_FLOAT),-1200*Math.log2(MOST_POSITIVE_SINGLE_FLOAT)),this._frequency=t(this,u,d.frequency,e.sampleRate/2,0),this._gain=t(this,u,d.gain,40*Math.log10(MOST_POSITIVE_SINGLE_FLOAT),MOST_NEGATIVE_SINGLE_FLOAT),this._nativeBiquadFilterNode=d,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(e){this._nativeBiquadFilterNode.type=e}getFrequencyResponse(e,t,i){try{this._nativeBiquadFilterNode.getFrequencyResponse(e,t,i)}catch(e){if(11===e.code)throw n();throw e}if(e.length!==t.length||t.length!==i.length)throw n()}},createBiquadFilterNodeRendererFactory=(e,t,i,n,o)=>()=>{const r=new WeakMap;return{render(s,a,l){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(s,a,l)=>{let c=i(s);const d=isOwnedByContext(c,a);if(!d){const e={Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type};c=t(a,e)}return r.set(a,c),d?(await e(a,s.Q,c.Q,l),await e(a,s.detune,c.detune,l),await e(a,s.frequency,c.frequency,l),await e(a,s.gain,c.gain,l)):(await n(a,s.Q,c.Q,l),await n(a,s.detune,c.detune,l),await n(a,s.frequency,c.frequency,l),await n(a,s.gain,c.gain,l)),await o(s,a,c,l),c})(s,a,l)}}},createCacheTestResult=(e,t)=>(i,n)=>{const o=t.get(i);if(void 0!==o)return o;const r=e.get(i);if(void 0!==r)return r;try{const o=n();return o instanceof Promise?(e.set(i,o),o.catch((()=>!1)).then((n=>(e.delete(i),t.set(i,n),n)))):(t.set(i,o),o)}catch{return t.set(i,!1),!1}},DEFAULT_OPTIONS$5={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},createChannelMergerNodeConstructor=(e,t,i,n,o)=>class extends e{constructor(e,r){const s=n(e),a={...DEFAULT_OPTIONS$5,...r};super(e,!1,i(s,a),o(s)?t():null)}},createChannelMergerNodeRendererFactory=(e,t,i)=>()=>{const n=new WeakMap;return{render(o,r,s){const a=n.get(r);return void 0!==a?Promise.resolve(a):(async(o,r,s)=>{let a=t(o);if(!isOwnedByContext(a,r)){const t={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfInputs:a.numberOfInputs};a=e(r,t)}return n.set(r,a),await i(o,r,a,s),a})(o,r,s)}}},DEFAULT_OPTIONS$6={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},createChannelSplitterNodeConstructor=(e,t,i,n,o,r)=>class extends e{constructor(e,s){const a=n(e),l=r({...DEFAULT_OPTIONS$6,...s});super(e,!1,i(a,l),o(a)?t():null)}},createChannelSplitterNodeRendererFactory=(e,t,i)=>()=>{const n=new WeakMap;return{render(o,r,s){const a=n.get(r);return void 0!==a?Promise.resolve(a):(async(o,r,s)=>{let a=t(o);if(!isOwnedByContext(a,r)){const t={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,numberOfOutputs:a.numberOfOutputs};a=e(r,t)}return n.set(r,a),await i(o,r,a,s),a})(o,r,s)}}},createConnectAudioParam=e=>(t,i,n,o)=>e(i,t,n,o),createConnectMultipleOutputs=e=>(t,i,n=0,o=0)=>{const r=t[n];if(void 0===r)throw e();return isNativeAudioNode(i)?r.connect(i,0,o):r.connect(i,0)},createConnectedNativeAudioBufferSourceNodeFactory=e=>(t,i)=>{const n=e(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),o=t.createBuffer(1,2,44100);return n.buffer=o,n.loop=!0,n.connect(i),n.start(),()=>{n.stop(),n.disconnect(i)}},DEFAULT_OPTIONS$7={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},createConstantSourceNodeConstructor=(e,t,i,n,o,r,s)=>class extends e{constructor(e,s){const a=o(e),l={...DEFAULT_OPTIONS$7,...s},c=n(a,l),d=r(a),u=d?i():null;super(e,!1,c,u),this._constantSourceNodeRenderer=u,this._nativeConstantSourceNode=c,this._offset=t(this,d,c.offset,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(e){const t="function"==typeof e?s(this,e):null;this._nativeConstantSourceNode.onended=t;const i=this._nativeConstantSourceNode.onended;this._onended=null!==i&&i===t?e:i}start(e=0){if(this._nativeConstantSourceNode.start(e),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=e),"closed"!==this.context.state){setInternalStateToActive(this);const e=()=>{this._nativeConstantSourceNode.removeEventListener("ended",e),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeConstantSourceNode.addEventListener("ended",e)}}stop(e=0){this._nativeConstantSourceNode.stop(e),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=e)}},createConstantSourceNodeRendererFactory=(e,t,i,n,o)=>()=>{const r=new WeakMap;let s=null,a=null;return{set start(e){s=e},set stop(e){a=e},render(l,c,d){const u=r.get(c);return void 0!==u?Promise.resolve(u):(async(l,c,d)=>{let u=i(l);const h=isOwnedByContext(u,c);if(!h){const e={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,offset:u.offset.value};u=t(c,e),null!==s&&u.start(s),null!==a&&u.stop(a)}return r.set(c,u),h?await e(c,l.offset,u.offset,d):await n(c,l.offset,u.offset,d),await o(l,c,u,d),u})(l,c,d)}}},createConvertNumberToUnsignedLong=e=>t=>(e[0]=t,e[0]),DEFAULT_OPTIONS$8={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},createConvolverNodeConstructor=(e,t,i,n,o,r)=>class extends e{constructor(e,s){const a=n(e),l={...DEFAULT_OPTIONS$8,...s},c=i(a,l);super(e,!1,c,o(a)?t():null),this._isBufferNullified=!1,this._nativeConvolverNode=c,null!==l.buffer&&r(this,l.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(e){if(this._nativeConvolverNode.buffer=e,null===e&&null!==this._nativeConvolverNode.buffer){const e=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=e.createBuffer(1,1,44100),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(e){this._nativeConvolverNode.normalize=e}},createConvolverNodeRendererFactory=(e,t,i)=>()=>{const n=new WeakMap;return{render(o,r,s){const a=n.get(r);return void 0!==a?Promise.resolve(a):(async(o,r,s)=>{let a=t(o);if(!isOwnedByContext(a,r)){const t={buffer:a.buffer,channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,disableNormalization:!a.normalize};a=e(r,t)}return n.set(r,a),isNativeAudioNodeFaker(a)?await i(o,r,a.inputs[0],s):await i(o,r,a,s),a})(o,r,s)}}},createCreateNativeOfflineAudioContext=(e,t)=>(i,n,o)=>{if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(i,n,o)}catch(t){if("SyntaxError"===t.name)throw e();throw t}},createDataCloneError=()=>new DOMException("","DataCloneError"),detachArrayBuffer=e=>{const{port1:t,port2:i}=new MessageChannel;return new Promise((n=>{const o=()=>{i.onmessage=null,t.close(),i.close(),n()};i.onmessage=()=>o();try{t.postMessage(e,[e])}finally{o()}}))},createDecodeAudioData=(e,t,i,n,o,r,s,a,l,c,d)=>(u,h)=>{const p=s(u)?u:r(u);if(o.has(h)){const e=i();return Promise.reject(e)}try{o.add(h)}catch{}return t(l,(()=>l(p)))?p.decodeAudioData(h).then((i=>(detachArrayBuffer(h).catch((()=>{})),t(a,(()=>a(i)))||d(i),e.add(i),i))):new Promise(((t,i)=>{const o=async()=>{try{await detachArrayBuffer(h)}catch{}},r=e=>{i(e),o()};try{p.decodeAudioData(h,(i=>{"function"!=typeof i.copyFromChannel&&(c(i),wrapAudioBufferGetChannelDataMethod(i)),e.add(i),o().then((()=>t(i)))}),(e=>{r(null===e?n():e)}))}catch(e){r(e)}}))},createDecrementCycleCounter=(e,t,i,n,o,r,s,a)=>(l,c)=>{const d=t.get(l);if(void 0===d)throw new Error("Missing the expected cycle count.");const u=r(l.context),h=a(u);if(d===c){if(t.delete(l),!h&&s(l)){const t=n(l),{outputs:r}=i(l);for(const i of r)if(isAudioNodeOutputConnection(i)){const o=n(i[0]);e(t,o,i[1],i[2])}else{const e=o(i[0]);t.connect(e,i[1])}}}else t.set(l,d-c)},DEFAULT_OPTIONS$9={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},createDelayNodeConstructor=(e,t,i,n,o,r,s)=>class extends e{constructor(e,a){const l=o(e),c={...DEFAULT_OPTIONS$9,...a},d=n(l,c),u=r(l);super(e,!1,d,u?i(c.maxDelayTime):null),this._delayTime=t(this,u,d.delayTime),s(this,c.maxDelayTime)}get delayTime(){return this._delayTime}},createDelayNodeRendererFactory=(e,t,i,n,o)=>r=>{const s=new WeakMap;return{render(a,l,c){const d=s.get(l);return void 0!==d?Promise.resolve(d):(async(a,l,c)=>{let d=i(a);const u=isOwnedByContext(d,l);if(!u){const e={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,delayTime:d.delayTime.value,maxDelayTime:r};d=t(l,e)}return s.set(l,d),u?await e(l,a.delayTime,d.delayTime,c):await n(l,a.delayTime,d.delayTime,c),await o(a,l,d,c),d})(a,l,c)}}},createDeleteActiveInputConnectionToAudioNode=e=>(t,i,n,o)=>e(t[o],(e=>e[0]===i&&e[1]===n)),createDeleteUnrenderedAudioWorkletNode=e=>(t,i)=>{e(t).delete(i)},isDelayNode=e=>"delayTime"in e,createDetectCycles=(e,t,i)=>function n(o,r){const s=isAudioNode$1(r)?r:i(e,r);if(isDelayNode(s))return[];if(o[0]===s)return[o];if(o.includes(s))return[];const{outputs:a}=t(s);return Array.from(a).map((e=>n([...o,s],e[0]))).reduce(((e,t)=>e.concat(t)),[])},getOutputAudioNodeAtIndex=(e,t,i)=>{const n=t[i];if(void 0===n)throw e();return n},createDisconnectMultipleOutputs=e=>(t,i,n,o=0)=>void 0===i?t.forEach((e=>e.disconnect())):"number"==typeof i?getOutputAudioNodeAtIndex(e,t,i).disconnect():isNativeAudioNode(i)?void 0===n?t.forEach((e=>e.disconnect(i))):void 0===o?getOutputAudioNodeAtIndex(e,t,n).disconnect(i,0):getOutputAudioNodeAtIndex(e,t,n).disconnect(i,0,o):void 0===n?t.forEach((e=>e.disconnect(i))):getOutputAudioNodeAtIndex(e,t,n).disconnect(i,0),DEFAULT_OPTIONS$a={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},createDynamicsCompressorNodeConstructor=(e,t,i,n,o,r,s,a)=>class extends e{constructor(e,o){const l=r(e),c={...DEFAULT_OPTIONS$a,...o},d=n(l,c),u=s(l);super(e,!1,d,u?i():null),this._attack=t(this,u,d.attack),this._knee=t(this,u,d.knee),this._nativeDynamicsCompressorNode=d,this._ratio=t(this,u,d.ratio),this._release=t(this,u,d.release),this._threshold=t(this,u,d.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(e){const t=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=e,e>2)throw this._nativeDynamicsCompressorNode.channelCount=t,o()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(e){const t=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=e,"max"===e)throw this._nativeDynamicsCompressorNode.channelCountMode=t,o()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},createDynamicsCompressorNodeRendererFactory=(e,t,i,n,o)=>()=>{const r=new WeakMap;return{render(s,a,l){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(s,a,l)=>{let c=i(s);const d=isOwnedByContext(c,a);if(!d){const e={attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value};c=t(a,e)}return r.set(a,c),d?(await e(a,s.attack,c.attack,l),await e(a,s.knee,c.knee,l),await e(a,s.ratio,c.ratio,l),await e(a,s.release,c.release,l),await e(a,s.threshold,c.threshold,l)):(await n(a,s.attack,c.attack,l),await n(a,s.knee,c.knee,l),await n(a,s.ratio,c.ratio,l),await n(a,s.release,c.release,l),await n(a,s.threshold,c.threshold,l)),await o(s,a,c,l),c})(s,a,l)}}},createEncodingError=()=>new DOMException("","EncodingError"),createEvaluateSource=e=>t=>new Promise(((i,n)=>{if(null===e)return void n(new SyntaxError);const o=e.document.head;if(null===o)n(new SyntaxError);else{const r=e.document.createElement("script"),s=new Blob([t],{type:"application/javascript"}),a=URL.createObjectURL(s),l=e.onerror,c=()=>{e.onerror=l,URL.revokeObjectURL(a)};e.onerror=(t,i,o,r,s)=>i===a||i===e.location.href&&1===o&&1===r?(c(),n(s),!1):null!==l?l(t,i,o,r,s):void 0,r.onerror=()=>{c(),n(new SyntaxError)},r.onload=()=>{c(),i()},r.src=a,r.type="module",o.appendChild(r)}})),createEventTargetConstructor=e=>class{constructor(e){this._nativeEventTarget=e,this._listeners=new WeakMap}addEventListener(t,i,n){if(null!==i){let o=this._listeners.get(i);void 0===o&&(o=e(this,i),"function"==typeof i&&this._listeners.set(i,o)),this._nativeEventTarget.addEventListener(t,o,n)}}dispatchEvent(e){return this._nativeEventTarget.dispatchEvent(e)}removeEventListener(e,t,i){const n=null===t?void 0:this._listeners.get(t);this._nativeEventTarget.removeEventListener(e,void 0===n?null:n,i)}},createExposeCurrentFrameAndCurrentTime=e=>(t,i,n)=>{Object.defineProperties(e,{currentFrame:{configurable:!0,get:()=>Math.round(t*i)},currentTime:{configurable:!0,get:()=>t}});try{return n()}finally{null!==e&&(delete e.currentFrame,delete e.currentTime)}},createFetchSource=e=>async t=>{try{const e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch{}throw e()},DEFAULT_OPTIONS$b={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},createGainNodeConstructor=(e,t,i,n,o,r)=>class extends e{constructor(e,s){const a=o(e),l={...DEFAULT_OPTIONS$b,...s},c=n(a,l),d=r(a);super(e,!1,c,d?i():null),this._gain=t(this,d,c.gain,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT)}get gain(){return this._gain}},createGainNodeRendererFactory=(e,t,i,n,o)=>()=>{const r=new WeakMap;return{render(s,a,l){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(s,a,l)=>{let c=i(s);const d=isOwnedByContext(c,a);if(!d){const e={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value};c=t(a,e)}return r.set(a,c),d?await e(a,s.gain,c.gain,l):await n(a,s.gain,c.gain,l),await o(s,a,c,l),c})(s,a,l)}}},createGetActiveAudioWorkletNodeInputs=(e,t)=>i=>t(e,i),createGetAudioNodeRenderer=e=>t=>{const i=e(t);if(null===i.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return i.renderer},createGetAudioNodeTailTime=e=>t=>{var i;return null!==(i=e.get(t))&&void 0!==i?i:0},createGetAudioParamRenderer=e=>t=>{const i=e(t);if(null===i.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return i.renderer},createGetBackupOfflineAudioContext=e=>t=>e.get(t),createInvalidStateError=()=>new DOMException("","InvalidStateError"),createGetNativeContext=e=>t=>{const i=e.get(t);if(void 0===i)throw createInvalidStateError();return i},createGetOrCreateBackupOfflineAudioContext=(e,t)=>i=>{let n=e.get(i);if(void 0!==n)return n;if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new t(1,1,44100),e.set(i,n),n},createGetUnrenderedAudioWorkletNodes=e=>t=>{const i=e.get(t);if(void 0===i)throw new Error("The context has no set of AudioWorkletNodes.");return i},createInvalidAccessError=()=>new DOMException("","InvalidAccessError"),wrapIIRFilterNodeGetFrequencyResponseMethod=e=>{var t;e.getFrequencyResponse=(t=e.getFrequencyResponse,(i,n,o)=>{if(i.length!==n.length||n.length!==o.length)throw createInvalidAccessError();return t.call(e,i,n,o)})},DEFAULT_OPTIONS$c={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},createIIRFilterNodeConstructor=(e,t,i,n,o,r)=>class extends e{constructor(e,s){const a=n(e),l=o(a),c={...DEFAULT_OPTIONS$c,...s},d=t(a,l?null:e.baseLatency,c);super(e,!1,d,l?i(c.feedback,c.feedforward):null),wrapIIRFilterNodeGetFrequencyResponseMethod(d),this._nativeIIRFilterNode=d,r(this,1)}getFrequencyResponse(e,t,i){return this._nativeIIRFilterNode.getFrequencyResponse(e,t,i)}},filterBuffer=(e,t,i,n,o,r,s,a,l,c,d)=>{const u=c.length;let h=a;for(let a=0;a<u;a+=1){let u=i[0]*c[a];for(let t=1;t<o;t+=1){const n=h-t&l-1;u+=i[t]*r[n],u-=e[t]*s[n]}for(let e=o;e<n;e+=1)u+=i[e]*r[h-e&l-1];for(let i=o;i<t;i+=1)u-=e[i]*s[h-i&l-1];r[h]=c[a],s[h]=u,h=h+1&l-1,d[a]=u}return h},filterFullBuffer=(e,t,i,n)=>{const o=i instanceof Float64Array?i:new Float64Array(i),r=n instanceof Float64Array?n:new Float64Array(n),s=o.length,a=r.length,l=Math.min(s,a);if(1!==o[0]){for(let e=0;e<s;e+=1)r[e]/=o[0];for(let e=1;e<a;e+=1)o[e]/=o[0]}const c=new Float32Array(32),d=new Float32Array(32),u=t.createBuffer(e.numberOfChannels,e.length,e.sampleRate),h=e.numberOfChannels;for(let t=0;t<h;t+=1){const i=e.getChannelData(t),n=u.getChannelData(t);c.fill(0),d.fill(0),filterBuffer(o,s,r,a,l,c,d,0,32,i,n)}return u},createIIRFilterNodeRendererFactory=(e,t,i,n,o)=>(r,s)=>{const a=new WeakMap;let l=null;return{render(c,d,u){const h=a.get(d);return void 0!==h?Promise.resolve(h):(async(c,d,u)=>{let h=null,p=t(c);const m=isOwnedByContext(p,d);if(void 0===d.createIIRFilter?h=e(d,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):m||(p=d.createIIRFilter(s,r)),a.set(d,null===h?p:h),null!==h){if(null===l){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const e=new i(c.context.destination.channelCount,c.context.length,d.sampleRate);l=(async()=>{await n(c,e,e.destination,u);const t=await o(e);return filterFullBuffer(t,d,r,s)})()}const e=await l;return h.buffer=e,h.start(0),h}return await n(c,d,p,u),p})(c,d,u)}}},createIncrementCycleCounterFactory=(e,t,i,n,o,r)=>s=>(a,l)=>{const c=e.get(a);if(void 0===c){if(!s&&r(a)){const e=n(a),{outputs:r}=i(a);for(const i of r)if(isAudioNodeOutputConnection(i)){const o=n(i[0]);t(e,o,i[1],i[2])}else{const t=o(i[0]);e.disconnect(t,i[1])}}e.set(a,l)}else e.set(a,c+l)},createIsAnyAudioContext=(e,t)=>i=>{const n=e.get(i);return t(n)||t(i)},createIsAnyAudioNode=(e,t)=>i=>e.has(i)||t(i),createIsAnyAudioParam=(e,t)=>i=>e.has(i)||t(i),createIsAnyOfflineAudioContext=(e,t)=>i=>{const n=e.get(i);return t(n)||t(i)},createIsNativeAudioContext=e=>t=>null!==e&&t instanceof e,createIsNativeAudioNode=e=>t=>null!==e&&"function"==typeof e.AudioNode&&t instanceof e.AudioNode,createIsNativeAudioParam=e=>t=>null!==e&&"function"==typeof e.AudioParam&&t instanceof e.AudioParam,createIsNativeContext=(e,t)=>i=>e(i)||t(i),createIsNativeOfflineAudioContext=e=>t=>null!==e&&t instanceof e,createIsSecureContext=e=>null!==e&&e.isSecureContext,createMediaElementAudioSourceNodeConstructor=(e,t,i,n)=>class extends e{constructor(e,o){const r=i(e),s=t(r,o);if(n(r))throw TypeError();super(e,!0,s,null),this._nativeMediaElementAudioSourceNode=s}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},DEFAULT_OPTIONS$d={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},createMediaStreamAudioDestinationNodeConstructor=(e,t,i,n)=>class extends e{constructor(e,o){const r=i(e);if(n(r))throw new TypeError;const s={...DEFAULT_OPTIONS$d,...o},a=t(r,s);super(e,!1,a,null),this._nativeMediaStreamAudioDestinationNode=a}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},createMediaStreamAudioSourceNodeConstructor=(e,t,i,n)=>class extends e{constructor(e,o){const r=i(e),s=t(r,o);if(n(r))throw new TypeError;super(e,!0,s,null),this._nativeMediaStreamAudioSourceNode=s}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},createMediaStreamTrackAudioSourceNodeConstructor=(e,t,i)=>class extends e{constructor(e,n){const o=i(e);super(e,!0,t(o,n),null)}},createMinimalBaseAudioContextConstructor=(e,t,i,n,o,r)=>class extends i{constructor(i,r){super(i),this._nativeContext=i,CONTEXT_STORE.set(this,i),n(i)&&o.set(i,new Set),this._destination=new e(this,r),this._listener=t(this,i),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(e){const t="function"==typeof e?r(this,e):null;this._nativeContext.onstatechange=t;const i=this._nativeContext.onstatechange;this._onstatechange=null!==i&&i===t?e:i}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},testPromiseSupport=e=>{const t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const i=e.decodeAudioData(t.buffer,(()=>{}));return void 0!==i&&(i.catch((()=>{})),!0)}catch{}return!1},createMonitorConnections=(e,t)=>(i,n,o)=>{const r=new Set;return i.connect=(o=>(s,a=0,l=0)=>{const c=0===r.size;if(t(s))return o.call(i,s,a,l),e(r,[s,a,l],(e=>e[0]===s&&e[1]===a&&e[2]===l),!0),c&&n(),s;o.call(i,s,a),e(r,[s,a],(e=>e[0]===s&&e[1]===a),!0),c&&n()})(i.connect),i.disconnect=(e=>(n,s,a)=>{const l=r.size>0;if(void 0===n)e.apply(i),r.clear();else if("number"==typeof n){e.call(i,n);for(const e of r)e[1]===n&&r.delete(e)}else{t(n)?e.call(i,n,s,a):e.call(i,n,s);for(const e of r)e[0]!==n||void 0!==s&&e[1]!==s||void 0!==a&&e[2]!==a||r.delete(e)}const c=0===r.size;l&&c&&o()})(i.disconnect),i},assignNativeAudioNodeOption=(e,t,i)=>{const n=t[i];void 0!==n&&n!==e[i]&&(e[i]=n)},assignNativeAudioNodeOptions=(e,t)=>{assignNativeAudioNodeOption(e,t,"channelCount"),assignNativeAudioNodeOption(e,t,"channelCountMode"),assignNativeAudioNodeOption(e,t,"channelInterpretation")},testAnalyserNodeGetFloatTimeDomainDataMethodSupport=e=>"function"==typeof e.getFloatTimeDomainData,wrapAnalyserNodeGetFloatTimeDomainDataMethod=e=>{e.getFloatTimeDomainData=t=>{const i=new Uint8Array(t.length);e.getByteTimeDomainData(i);const n=Math.max(i.length,e.fftSize);for(let e=0;e<n;e+=1)t[e]=.0078125*(i[e]-128);return t}},createNativeAnalyserNodeFactory=(e,t)=>(i,n)=>{const o=i.createAnalyser();if(assignNativeAudioNodeOptions(o,n),!(n.maxDecibels>n.minDecibels))throw t();return assignNativeAudioNodeOption(o,n,"fftSize"),assignNativeAudioNodeOption(o,n,"maxDecibels"),assignNativeAudioNodeOption(o,n,"minDecibels"),assignNativeAudioNodeOption(o,n,"smoothingTimeConstant"),e(testAnalyserNodeGetFloatTimeDomainDataMethodSupport,(()=>testAnalyserNodeGetFloatTimeDomainDataMethodSupport(o)))||wrapAnalyserNodeGetFloatTimeDomainDataMethod(o),o},createNativeAudioBufferConstructor=e=>null===e?null:e.hasOwnProperty("AudioBuffer")?e.AudioBuffer:null,assignNativeAudioNodeAudioParamValue=(e,t,i)=>{const n=t[i];void 0!==n&&n!==e[i].value&&(e[i].value=n)},wrapAudioBufferSourceNodeStartMethodConsecutiveCalls=e=>{e.start=(t=>{let i=!1;return(n=0,o=0,r)=>{if(i)throw createInvalidStateError();t.call(e,n,o,r),i=!0}})(e.start)},wrapAudioScheduledSourceNodeStartMethodNegativeParameters=e=>{e.start=(t=>(i=0,n=0,o)=>{if("number"==typeof o&&o<0||n<0||i<0)throw new RangeError("The parameters can't be negative.");t.call(e,i,n,o)})(e.start)},wrapAudioScheduledSourceNodeStopMethodNegativeParameters=e=>{var t;e.stop=(t=e.stop,(i=0)=>{if(i<0)throw new RangeError("The parameter can't be negative.");t.call(e,i)})},createNativeAudioBufferSourceNodeFactory=(e,t,i,n,o,r,s,a,l,c,d)=>(u,h)=>{const p=u.createBufferSource();return assignNativeAudioNodeOptions(p,h),assignNativeAudioNodeAudioParamValue(p,h,"playbackRate"),assignNativeAudioNodeOption(p,h,"buffer"),assignNativeAudioNodeOption(p,h,"loop"),assignNativeAudioNodeOption(p,h,"loopEnd"),assignNativeAudioNodeOption(p,h,"loopStart"),t(i,(()=>i(u)))||wrapAudioBufferSourceNodeStartMethodConsecutiveCalls(p),t(n,(()=>n(u)))||l(p),t(o,(()=>o(u)))||c(p,u),t(r,(()=>r(u)))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(p),t(s,(()=>s(u)))||d(p,u),t(a,(()=>a(u)))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(p),e(u,p),p},createNativeAudioContextConstructor=e=>null===e?null:e.hasOwnProperty("AudioContext")?e.AudioContext:e.hasOwnProperty("webkitAudioContext")?e.webkitAudioContext:null,createNativeAudioDestinationNodeFactory=(e,t)=>(i,n,o)=>{const r=i.destination;if(r.channelCount!==n)try{r.channelCount=n}catch{}o&&"explicit"!==r.channelCountMode&&(r.channelCountMode="explicit"),0===r.maxChannelCount&&Object.defineProperty(r,"maxChannelCount",{value:n});const s=e(i,{channelCount:n,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return t(s,"channelCount",(e=>()=>e.call(s)),(e=>t=>{e.call(s,t);try{r.channelCount=t}catch(e){if(t>r.maxChannelCount)throw e}})),t(s,"channelCountMode",(e=>()=>e.call(s)),(e=>t=>{e.call(s,t),r.channelCountMode=t})),t(s,"channelInterpretation",(e=>()=>e.call(s)),(e=>t=>{e.call(s,t),r.channelInterpretation=t})),Object.defineProperty(s,"maxChannelCount",{get:()=>r.maxChannelCount}),s.connect(r),s},createNativeAudioWorkletNodeConstructor=e=>null===e?null:e.hasOwnProperty("AudioWorkletNode")?e.AudioWorkletNode:null,testClonabilityOfAudioWorkletNodeOptions=e=>{const{port1:t}=new MessageChannel;try{t.postMessage(e)}finally{t.close()}},createNativeAudioWorkletNodeFactory=(e,t,i,n,o)=>(r,s,a,l,c,d)=>{if(null!==a)try{const t=new a(r,l,d),n=new Map;let s=null;if(Object.defineProperties(t,{channelCount:{get:()=>d.channelCount,set:()=>{throw e()}},channelCountMode:{get:()=>"explicit",set:()=>{throw e()}},onprocessorerror:{get:()=>s,set:e=>{"function"==typeof s&&t.removeEventListener("processorerror",s),s="function"==typeof e?e:null,"function"==typeof s&&t.addEventListener("processorerror",s)}}}),t.addEventListener=(h=t.addEventListener,(...e)=>{if("processorerror"===e[0]){const t="function"==typeof e[1]?e[1]:"object"==typeof e[1]&&null!==e[1]&&"function"==typeof e[1].handleEvent?e[1].handleEvent:null;if(null!==t){const i=n.get(e[1]);void 0!==i?e[1]=i:(e[1]=i=>{"error"===i.type?(Object.defineProperties(i,{type:{value:"processorerror"}}),t(i)):t(new ErrorEvent(e[0],{...i}))},n.set(t,e[1]))}}return h.call(t,"error",e[1],e[2]),h.call(t,...e)}),t.removeEventListener=(u=t.removeEventListener,(...e)=>{if("processorerror"===e[0]){const t=n.get(e[1]);void 0!==t&&(n.delete(e[1]),e[1]=t)}return u.call(t,"error",e[1],e[2]),u.call(t,e[0],e[1],e[2])}),0!==d.numberOfOutputs){const e=i(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(e).connect(r.destination);return o(t,(()=>e.disconnect()),(()=>e.connect(r.destination)))}return t}catch(e){if(11===e.code)throw n();throw e}var u,h;if(void 0===c)throw n();return testClonabilityOfAudioWorkletNodeOptions(d),t(r,s,c,d)},computeBufferSize=(e,t)=>null===e?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(e*t))))),cloneAudioWorkletNodeOptions=e=>new Promise(((t,i)=>{const{port1:n,port2:o}=new MessageChannel;n.onmessage=({data:e})=>{n.close(),o.close(),t(e)},n.onmessageerror=({data:e})=>{n.close(),o.close(),i(e)},o.postMessage(e)})),createAudioWorkletProcessorPromise=async(e,t)=>new e(await cloneAudioWorkletNodeOptions(t)),createAudioWorkletProcessor=(e,t,i,n)=>{let o=NODE_TO_PROCESSOR_MAPS.get(e);void 0===o&&(o=new WeakMap,NODE_TO_PROCESSOR_MAPS.set(e,o));const r=createAudioWorkletProcessorPromise(i,n);return o.set(t,r),r},createNativeAudioWorkletNodeFakerFactory=(e,t,i,n,o,r,s,a,l,c,d,u,h)=>(p,m,f,g)=>{if(0===g.numberOfInputs&&0===g.numberOfOutputs)throw l();const v=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(v.some((e=>e<1)))throw l();if(v.length!==g.numberOfOutputs)throw t();if("explicit"!==g.channelCountMode)throw l();const _=g.channelCount*g.numberOfInputs,y=v.reduce(((e,t)=>e+t),0),w=void 0===f.parameterDescriptors?0:f.parameterDescriptors.length;if(_+w>6||y>6)throw l();const b=new MessageChannel,x=[],T=[];for(let e=0;e<g.numberOfInputs;e+=1)x.push(s(p,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),T.push(o(p,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const S=[];if(void 0!==f.parameterDescriptors)for(const{defaultValue:e,maxValue:t,minValue:i,name:n}of f.parameterDescriptors){const o=r(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==g.parameterData[n]?g.parameterData[n]:void 0===e?0:e});Object.defineProperties(o.offset,{defaultValue:{get:()=>void 0===e?0:e},maxValue:{get:()=>void 0===t?MOST_POSITIVE_SINGLE_FLOAT:t},minValue:{get:()=>void 0===i?MOST_NEGATIVE_SINGLE_FLOAT:i}}),S.push(o)}const k=n(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,_+w)}),C=computeBufferSize(m,p.sampleRate),A=a(p,C,_+w,Math.max(1,y)),E=o(p,{channelCount:Math.max(1,y),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,y)}),N=[];for(let e=0;e<g.numberOfOutputs;e+=1)N.push(n(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:v[e]}));for(let e=0;e<g.numberOfInputs;e+=1){x[e].connect(T[e]);for(let t=0;t<g.channelCount;t+=1)T[e].connect(k,t,e*g.channelCount+t)}const O=new ReadOnlyMap(void 0===f.parameterDescriptors?[]:f.parameterDescriptors.map((({name:e},t)=>{const i=S[t];return i.connect(k,0,_+t),i.start(0),[e,i.offset]})));k.connect(A);let P=g.channelInterpretation,M=null;const R=0===g.numberOfOutputs?[A]:N,I={get bufferSize(){return C},get channelCount(){return g.channelCount},set channelCount(e){throw i()},get channelCountMode(){return g.channelCountMode},set channelCountMode(e){throw i()},get channelInterpretation(){return P},set channelInterpretation(e){for(const t of x)t.channelInterpretation=e;P=e},get context(){return A.context},get inputs(){return x},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return M},set onprocessorerror(e){"function"==typeof M&&I.removeEventListener("processorerror",M),M="function"==typeof e?e:null,"function"==typeof M&&I.addEventListener("processorerror",M)},get parameters(){return O},get port(){return b.port2},addEventListener:(...e)=>A.addEventListener(e[0],e[1],e[2]),connect:e.bind(null,R),disconnect:c.bind(null,R),dispatchEvent:(...e)=>A.dispatchEvent(e[0]),removeEventListener:(...e)=>A.removeEventListener(e[0],e[1],e[2])},F=new Map;var D,j;b.port1.addEventListener=(D=b.port1.addEventListener,(...e)=>{if("message"===e[0]){const t="function"==typeof e[1]?e[1]:"object"==typeof e[1]&&null!==e[1]&&"function"==typeof e[1].handleEvent?e[1].handleEvent:null;if(null!==t){const i=F.get(e[1]);void 0!==i?e[1]=i:(e[1]=e=>{d(p.currentTime,p.sampleRate,(()=>t(e)))},F.set(t,e[1]))}}return D.call(b.port1,e[0],e[1],e[2])}),b.port1.removeEventListener=(j=b.port1.removeEventListener,(...e)=>{if("message"===e[0]){const t=F.get(e[1]);void 0!==t&&(F.delete(e[1]),e[1]=t)}return j.call(b.port1,e[0],e[1],e[2])});let z=null;Object.defineProperty(b.port1,"onmessage",{get:()=>z,set:e=>{"function"==typeof z&&b.port1.removeEventListener("message",z),z="function"==typeof e?e:null,"function"==typeof z&&(b.port1.addEventListener("message",z),b.port1.start())}}),f.prototype.port=b.port1;let L=null;createAudioWorkletProcessor(p,I,f,g).then((e=>L=e));const B=createNestedArrays(g.numberOfInputs,g.channelCount),$=createNestedArrays(g.numberOfOutputs,v),W=void 0===f.parameterDescriptors?[]:f.parameterDescriptors.reduce(((e,{name:t})=>({...e,[t]:new Float32Array(128)})),{});let V=!0;const q=()=>{g.numberOfOutputs>0&&A.disconnect(E);for(let e=0,t=0;e<g.numberOfOutputs;e+=1){const i=N[e];for(let n=0;n<v[e];n+=1)E.disconnect(i,t+n,n);t+=v[e]}},H=new Map;A.onaudioprocess=({inputBuffer:e,outputBuffer:t})=>{if(null!==L){const i=u(I);for(let n=0;n<C;n+=128){for(let t=0;t<g.numberOfInputs;t+=1)for(let i=0;i<g.channelCount;i+=1)copyFromChannel(e,B[t],i,i,n);void 0!==f.parameterDescriptors&&f.parameterDescriptors.forEach((({name:t},i)=>{copyFromChannel(e,W,t,_+i,n)}));for(let e=0;e<g.numberOfInputs;e+=1)for(let t=0;t<v[e];t+=1)0===$[e][t].byteLength&&($[e][t]=new Float32Array(128));try{const e=B.map(((e,t)=>{if(i[t].size>0)return H.set(t,C/128),e;const n=H.get(t);return void 0===n?[]:(e.every((e=>e.every((e=>0===e))))&&(1===n?H.delete(t):H.set(t,n-1)),e)})),o=d(p.currentTime+n/p.sampleRate,p.sampleRate,(()=>L.process(e,$,W)));V=o;for(let e=0,i=0;e<g.numberOfOutputs;e+=1){for(let o=0;o<v[e];o+=1)copyToChannel(t,$[e],o,i+o,n);i+=v[e]}}catch(e){V=!1,I.dispatchEvent(new ErrorEvent("processorerror",{colno:e.colno,filename:e.filename,lineno:e.lineno,message:e.message}))}if(!V){for(let e=0;e<g.numberOfInputs;e+=1){x[e].disconnect(T[e]);for(let t=0;t<g.channelCount;t+=1)T[n].disconnect(k,t,e*g.channelCount+t)}if(void 0!==f.parameterDescriptors){const e=f.parameterDescriptors.length;for(let t=0;t<e;t+=1){const e=S[t];e.disconnect(k,0,_+t),e.stop()}}k.disconnect(A),A.onaudioprocess=null,U?q():X();break}}}};let U=!1;const G=s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Z=()=>A.connect(G).connect(p.destination),X=()=>{A.disconnect(G),G.disconnect()};return Z(),h(I,(()=>{if(V){X(),g.numberOfOutputs>0&&A.connect(E);for(let e=0,t=0;e<g.numberOfOutputs;e+=1){const i=N[e];for(let n=0;n<v[e];n+=1)E.connect(i,t+n,n);t+=v[e]}}U=!0}),(()=>{V&&(Z(),q()),U=!1}))},createNativeBiquadFilterNode=(e,t)=>{const i=e.createBiquadFilter();return assignNativeAudioNodeOptions(i,t),assignNativeAudioNodeAudioParamValue(i,t,"Q"),assignNativeAudioNodeAudioParamValue(i,t,"detune"),assignNativeAudioNodeAudioParamValue(i,t,"frequency"),assignNativeAudioNodeAudioParamValue(i,t,"gain"),assignNativeAudioNodeOption(i,t,"type"),i},createNativeChannelMergerNodeFactory=(e,t)=>(i,n)=>{const o=i.createChannelMerger(n.numberOfInputs);return null!==e&&"webkitAudioContext"===e.name&&t(i,o),assignNativeAudioNodeOptions(o,n),o},wrapChannelSplitterNode=e=>{const t=e.numberOfOutputs;Object.defineProperty(e,"channelCount",{get:()=>t,set:e=>{if(e!==t)throw createInvalidStateError()}}),Object.defineProperty(e,"channelCountMode",{get:()=>"explicit",set:e=>{if("explicit"!==e)throw createInvalidStateError()}}),Object.defineProperty(e,"channelInterpretation",{get:()=>"discrete",set:e=>{if("discrete"!==e)throw createInvalidStateError()}})},createNativeChannelSplitterNode=(e,t)=>{const i=e.createChannelSplitter(t.numberOfOutputs);return assignNativeAudioNodeOptions(i,t),wrapChannelSplitterNode(i),i},createNativeConstantSourceNodeFactory=(e,t,i,n,o)=>(r,s)=>{if(void 0===r.createConstantSource)return i(r,s);const a=r.createConstantSource();return assignNativeAudioNodeOptions(a,s),assignNativeAudioNodeAudioParamValue(a,s,"offset"),t(n,(()=>n(r)))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(a),t(o,(()=>o(r)))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(a),e(r,a),a},interceptConnections=(e,t)=>(e.connect=t.connect.bind(t),e.disconnect=t.disconnect.bind(t),e),createNativeConstantSourceNodeFakerFactory=(e,t,i,n)=>(o,{offset:r,...s})=>{const a=o.createBuffer(1,2,44100),l=t(o,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),c=i(o,{...s,gain:r}),d=a.getChannelData(0);d[0]=1,d[1]=1,l.buffer=a,l.loop=!0;const u={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(e){c.channelCount=e},get channelCountMode(){return c.channelCountMode},set channelCountMode(e){c.channelCountMode=e},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(e){c.channelInterpretation=e},get context(){return c.context},get inputs(){return[]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get offset(){return c.gain},get onended(){return l.onended},set onended(e){l.onended=e},addEventListener:(...e)=>l.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>l.dispatchEvent(e[0]),removeEventListener:(...e)=>l.removeEventListener(e[0],e[1],e[2]),start(e=0){l.start.call(l,e)},stop(e=0){l.stop.call(l,e)}};return e(o,l),n(interceptConnections(u,c),(()=>l.connect(c)),(()=>l.disconnect(c)))},createNativeConvolverNodeFactory=(e,t)=>(i,n)=>{const o=i.createConvolver();if(assignNativeAudioNodeOptions(o,n),n.disableNormalization===o.normalize&&(o.normalize=!n.disableNormalization),assignNativeAudioNodeOption(o,n,"buffer"),n.channelCount>2)throw e();if(t(o,"channelCount",(e=>()=>e.call(o)),(t=>i=>{if(i>2)throw e();return t.call(o,i)})),"max"===n.channelCountMode)throw e();return t(o,"channelCountMode",(e=>()=>e.call(o)),(t=>i=>{if("max"===i)throw e();return t.call(o,i)})),o},createNativeDelayNode=(e,t)=>{const i=e.createDelay(t.maxDelayTime);return assignNativeAudioNodeOptions(i,t),assignNativeAudioNodeAudioParamValue(i,t,"delayTime"),i},createNativeDynamicsCompressorNodeFactory=e=>(t,i)=>{const n=t.createDynamicsCompressor();if(assignNativeAudioNodeOptions(n,i),i.channelCount>2)throw e();if("max"===i.channelCountMode)throw e();return assignNativeAudioNodeAudioParamValue(n,i,"attack"),assignNativeAudioNodeAudioParamValue(n,i,"knee"),assignNativeAudioNodeAudioParamValue(n,i,"ratio"),assignNativeAudioNodeAudioParamValue(n,i,"release"),assignNativeAudioNodeAudioParamValue(n,i,"threshold"),n},createNativeGainNode=(e,t)=>{const i=e.createGain();return assignNativeAudioNodeOptions(i,t),assignNativeAudioNodeAudioParamValue(i,t,"gain"),i},createNativeIIRFilterNodeFactory=e=>(t,i,n)=>{if(void 0===t.createIIRFilter)return e(t,i,n);const o=t.createIIRFilter(n.feedforward,n.feedback);return assignNativeAudioNodeOptions(o,n),o};function divide(e,t){const i=t[0]*t[0]+t[1]*t[1];return[(e[0]*t[0]+e[1]*t[1])/i,(e[1]*t[0]-e[0]*t[1])/i]}function multiply(e,t){return[e[0]*t[0]-e[1]*t[1],e[0]*t[1]+e[1]*t[0]]}function evaluatePolynomial(e,t){let i=[0,0];for(let n=e.length-1;n>=0;n-=1)i=multiply(i,t),i[0]+=e[n];return i}const createNativeIIRFilterNodeFakerFactory=(e,t,i,n)=>(o,r,{channelCount:s,channelCountMode:a,channelInterpretation:l,feedback:c,feedforward:d})=>{const u=computeBufferSize(r,o.sampleRate),h=c instanceof Float64Array?c:new Float64Array(c),p=d instanceof Float64Array?d:new Float64Array(d),m=h.length,f=p.length,g=Math.min(m,f);if(0===m||m>20)throw n();if(0===h[0])throw t();if(0===f||f>20)throw n();if(0===p[0])throw t();if(1!==h[0]){for(let e=0;e<f;e+=1)p[e]/=h[0];for(let e=1;e<m;e+=1)h[e]/=h[0]}const v=i(o,u,s,s);v.channelCount=s,v.channelCountMode=a,v.channelInterpretation=l;const _=[],y=[],w=[];for(let e=0;e<s;e+=1){_.push(0);const e=new Float32Array(32),t=new Float32Array(32);e.fill(0),t.fill(0),y.push(e),w.push(t)}v.onaudioprocess=e=>{const t=e.inputBuffer,i=e.outputBuffer,n=t.numberOfChannels;for(let e=0;e<n;e+=1){const n=t.getChannelData(e),o=i.getChannelData(e);_[e]=filterBuffer(h,m,p,f,g,y[e],w[e],_[e],32,n,o)}};const b=o.sampleRate/2;return interceptConnections({get bufferSize(){return u},get channelCount(){return v.channelCount},set channelCount(e){v.channelCount=e},get channelCountMode(){return v.channelCountMode},set channelCountMode(e){v.channelCountMode=e},get channelInterpretation(){return v.channelInterpretation},set channelInterpretation(e){v.channelInterpretation=e},get context(){return v.context},get inputs(){return[v]},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},addEventListener:(...e)=>v.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>v.dispatchEvent(e[0]),getFrequencyResponse(t,i,n){if(t.length!==i.length||i.length!==n.length)throw e();const o=t.length;for(let e=0;e<o;e+=1){const o=-Math.PI*(t[e]/b),r=[Math.cos(o),Math.sin(o)],s=divide(evaluatePolynomial(p,r),evaluatePolynomial(h,r));i[e]=Math.sqrt(s[0]*s[0]+s[1]*s[1]),n[e]=Math.atan2(s[1],s[0])}},removeEventListener:(...e)=>v.removeEventListener(e[0],e[1],e[2])},v)},createNativeMediaElementAudioSourceNode=(e,t)=>e.createMediaElementSource(t.mediaElement),createNativeMediaStreamAudioDestinationNode=(e,t)=>{const i=e.createMediaStreamDestination();return assignNativeAudioNodeOptions(i,t),1===i.numberOfOutputs&&Object.defineProperty(i,"numberOfOutputs",{get:()=>0}),i},createNativeMediaStreamAudioSourceNode=(e,{mediaStream:t})=>{const i=t.getAudioTracks();i.sort(((e,t)=>e.id<t.id?-1:e.id>t.id?1:0));const n=i.slice(0,1),o=e.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(o,"mediaStream",{value:t}),o},createNativeMediaStreamTrackAudioSourceNodeFactory=(e,t)=>(i,{mediaStreamTrack:n})=>{if("function"==typeof i.createMediaStreamTrackSource)return i.createMediaStreamTrackSource(n);const o=new MediaStream([n]),r=i.createMediaStreamSource(o);if("audio"!==n.kind)throw e();if(t(i))throw new TypeError;return r},createNativeOfflineAudioContextConstructor=e=>null===e?null:e.hasOwnProperty("OfflineAudioContext")?e.OfflineAudioContext:e.hasOwnProperty("webkitOfflineAudioContext")?e.webkitOfflineAudioContext:null,createNativeOscillatorNodeFactory=(e,t,i,n,o,r)=>(s,a)=>{const l=s.createOscillator();return assignNativeAudioNodeOptions(l,a),assignNativeAudioNodeAudioParamValue(l,a,"detune"),assignNativeAudioNodeAudioParamValue(l,a,"frequency"),void 0!==a.periodicWave?l.setPeriodicWave(a.periodicWave):assignNativeAudioNodeOption(l,a,"type"),t(i,(()=>i(s)))||wrapAudioScheduledSourceNodeStartMethodNegativeParameters(l),t(n,(()=>n(s)))||r(l,s),t(o,(()=>o(s)))||wrapAudioScheduledSourceNodeStopMethodNegativeParameters(l),e(s,l),l},createNativePannerNodeFactory=e=>(t,i)=>{const n=t.createPanner();return void 0===n.orientationX?e(t,i):(assignNativeAudioNodeOptions(n,i),assignNativeAudioNodeAudioParamValue(n,i,"orientationX"),assignNativeAudioNodeAudioParamValue(n,i,"orientationY"),assignNativeAudioNodeAudioParamValue(n,i,"orientationZ"),assignNativeAudioNodeAudioParamValue(n,i,"positionX"),assignNativeAudioNodeAudioParamValue(n,i,"positionY"),assignNativeAudioNodeAudioParamValue(n,i,"positionZ"),assignNativeAudioNodeOption(n,i,"coneInnerAngle"),assignNativeAudioNodeOption(n,i,"coneOuterAngle"),assignNativeAudioNodeOption(n,i,"coneOuterGain"),assignNativeAudioNodeOption(n,i,"distanceModel"),assignNativeAudioNodeOption(n,i,"maxDistance"),assignNativeAudioNodeOption(n,i,"panningModel"),assignNativeAudioNodeOption(n,i,"refDistance"),assignNativeAudioNodeOption(n,i,"rolloffFactor"),n)},createNativePannerNodeFakerFactory=(e,t,i,n,o,r,s,a,l,c)=>(d,{coneInnerAngle:u,coneOuterAngle:h,coneOuterGain:p,distanceModel:m,maxDistance:f,orientationX:g,orientationY:v,orientationZ:_,panningModel:y,positionX:w,positionY:b,positionZ:x,refDistance:T,rolloffFactor:S,...k})=>{const C=d.createPanner();if(k.channelCount>2)throw s();if("max"===k.channelCountMode)throw s();assignNativeAudioNodeOptions(C,k);const A={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},E=i(d,{...A,channelInterpretation:"speakers",numberOfInputs:6}),N=n(d,{...k,gain:1}),O=n(d,{...A,gain:1}),P=n(d,{...A,gain:0}),M=n(d,{...A,gain:0}),R=n(d,{...A,gain:0}),I=n(d,{...A,gain:0}),F=n(d,{...A,gain:0}),D=o(d,256,6,1),j=r(d,{...A,curve:new Float32Array([1,1]),oversample:"none"});let z=[g,v,_],L=[w,b,x];const B=new Float32Array(1);D.onaudioprocess=({inputBuffer:e})=>{const t=[l(e,B,0),l(e,B,1),l(e,B,2)];t.some(((e,t)=>e!==z[t]))&&(C.setOrientation(...t),z=t);const i=[l(e,B,3),l(e,B,4),l(e,B,5)];i.some(((e,t)=>e!==L[t]))&&(C.setPosition(...i),L=i)},Object.defineProperty(P.gain,"defaultValue",{get:()=>0}),Object.defineProperty(M.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(I.gain,"defaultValue",{get:()=>0}),Object.defineProperty(F.gain,"defaultValue",{get:()=>0});const $={get bufferSize(){},get channelCount(){return C.channelCount},set channelCount(e){if(e>2)throw s();N.channelCount=e,C.channelCount=e},get channelCountMode(){return C.channelCountMode},set channelCountMode(e){if("max"===e)throw s();N.channelCountMode=e,C.channelCountMode=e},get channelInterpretation(){return C.channelInterpretation},set channelInterpretation(e){N.channelInterpretation=e,C.channelInterpretation=e},get coneInnerAngle(){return C.coneInnerAngle},set coneInnerAngle(e){C.coneInnerAngle=e},get coneOuterAngle(){return C.coneOuterAngle},set coneOuterAngle(e){C.coneOuterAngle=e},get coneOuterGain(){return C.coneOuterGain},set coneOuterGain(e){if(e<0||e>1)throw t();C.coneOuterGain=e},get context(){return C.context},get distanceModel(){return C.distanceModel},set distanceModel(e){C.distanceModel=e},get inputs(){return[N]},get maxDistance(){return C.maxDistance},set maxDistance(e){if(e<0)throw new RangeError;C.maxDistance=e},get numberOfInputs(){return C.numberOfInputs},get numberOfOutputs(){return C.numberOfOutputs},get orientationX(){return O.gain},get orientationY(){return P.gain},get orientationZ(){return M.gain},get panningModel(){return C.panningModel},set panningModel(e){C.panningModel=e},get positionX(){return R.gain},get positionY(){return I.gain},get positionZ(){return F.gain},get refDistance(){return C.refDistance},set refDistance(e){if(e<0)throw new RangeError;C.refDistance=e},get rolloffFactor(){return C.rolloffFactor},set rolloffFactor(e){if(e<0)throw new RangeError;C.rolloffFactor=e},addEventListener:(...e)=>N.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>N.dispatchEvent(e[0]),removeEventListener:(...e)=>N.removeEventListener(e[0],e[1],e[2])};u!==$.coneInnerAngle&&($.coneInnerAngle=u),h!==$.coneOuterAngle&&($.coneOuterAngle=h),p!==$.coneOuterGain&&($.coneOuterGain=p),m!==$.distanceModel&&($.distanceModel=m),f!==$.maxDistance&&($.maxDistance=f),g!==$.orientationX.value&&($.orientationX.value=g),v!==$.orientationY.value&&($.orientationY.value=v),_!==$.orientationZ.value&&($.orientationZ.value=_),y!==$.panningModel&&($.panningModel=y),w!==$.positionX.value&&($.positionX.value=w),b!==$.positionY.value&&($.positionY.value=b),x!==$.positionZ.value&&($.positionZ.value=x),T!==$.refDistance&&($.refDistance=T),S!==$.rolloffFactor&&($.rolloffFactor=S),1===z[0]&&0===z[1]&&0===z[2]||C.setOrientation(...z),0===L[0]&&0===L[1]&&0===L[2]||C.setPosition(...L);return c(interceptConnections($,C),(()=>{N.connect(C),e(N,j,0,0),j.connect(O).connect(E,0,0),j.connect(P).connect(E,0,1),j.connect(M).connect(E,0,2),j.connect(R).connect(E,0,3),j.connect(I).connect(E,0,4),j.connect(F).connect(E,0,5),E.connect(D).connect(d.destination)}),(()=>{N.disconnect(C),a(N,j,0,0),j.disconnect(O),O.disconnect(E),j.disconnect(P),P.disconnect(E),j.disconnect(M),M.disconnect(E),j.disconnect(R),R.disconnect(E),j.disconnect(I),I.disconnect(E),j.disconnect(F),F.disconnect(E),E.disconnect(D),D.disconnect(d.destination)}))},createNativePeriodicWaveFactory=e=>(t,{disableNormalization:i,imag:n,real:o})=>{const r=n instanceof Float32Array?n:new Float32Array(n),s=o instanceof Float32Array?o:new Float32Array(o),a=t.createPeriodicWave(s,r,{disableNormalization:i});if(Array.from(n).length<2)throw e();return a},createNativeScriptProcessorNode=(e,t,i,n)=>e.createScriptProcessor(t,i,n),createNativeStereoPannerNodeFactory=(e,t)=>(i,n)=>{const o=n.channelCountMode;if("clamped-max"===o)throw t();if(void 0===i.createStereoPanner)return e(i,n);const r=i.createStereoPanner();return assignNativeAudioNodeOptions(r,n),assignNativeAudioNodeAudioParamValue(r,n,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>o,set:e=>{if(e!==o)throw t()}}),r},createNativeStereoPannerNodeFakerFactory=(e,t,i,n,o,r)=>{const s=16385,a=new Float32Array([1,1]),l=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},d={...c,oversample:"none"},u=(e,r,u,h,p)=>{if(1===r)return((e,t,o,r)=>{const u=new Float32Array(s),h=new Float32Array(s);for(let e=0;e<s;e+=1){const t=e/16384*l;u[e]=Math.cos(t),h[e]=Math.sin(t)}const p=i(e,{...c,gain:0}),m=n(e,{...d,curve:u}),f=n(e,{...d,curve:a}),g=i(e,{...c,gain:0}),v=n(e,{...d,curve:h});return{connectGraph(){t.connect(p),t.connect(void 0===f.inputs?f:f.inputs[0]),t.connect(g),f.connect(o),o.connect(void 0===m.inputs?m:m.inputs[0]),o.connect(void 0===v.inputs?v:v.inputs[0]),m.connect(p.gain),v.connect(g.gain),p.connect(r,0,0),g.connect(r,0,1)},disconnectGraph(){t.disconnect(p),t.disconnect(void 0===f.inputs?f:f.inputs[0]),t.disconnect(g),f.disconnect(o),o.disconnect(void 0===m.inputs?m:m.inputs[0]),o.disconnect(void 0===v.inputs?v:v.inputs[0]),m.disconnect(p.gain),v.disconnect(g.gain),p.disconnect(r,0,0),g.disconnect(r,0,1)}}})(e,u,h,p);if(2===r)return((e,o,r,u)=>{const h=new Float32Array(s),p=new Float32Array(s),m=new Float32Array(s),f=new Float32Array(s),g=Math.floor(8192.5);for(let e=0;e<s;e+=1)if(e>g){const t=(e-g)/(16384-g)*l;h[e]=Math.cos(t),p[e]=Math.sin(t),m[e]=0,f[e]=1}else{const t=e/(16384-g)*l;h[e]=1,p[e]=0,m[e]=Math.cos(t),f[e]=Math.sin(t)}const v=t(e,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),_=i(e,{...c,gain:0}),y=n(e,{...d,curve:h}),w=i(e,{...c,gain:0}),b=n(e,{...d,curve:p}),x=n(e,{...d,curve:a}),T=i(e,{...c,gain:0}),S=n(e,{...d,curve:m}),k=i(e,{...c,gain:0}),C=n(e,{...d,curve:f});return{connectGraph(){o.connect(v),o.connect(void 0===x.inputs?x:x.inputs[0]),v.connect(_,0),v.connect(w,0),v.connect(T,1),v.connect(k,1),x.connect(r),r.connect(void 0===y.inputs?y:y.inputs[0]),r.connect(void 0===b.inputs?b:b.inputs[0]),r.connect(void 0===S.inputs?S:S.inputs[0]),r.connect(void 0===C.inputs?C:C.inputs[0]),y.connect(_.gain),b.connect(w.gain),S.connect(T.gain),C.connect(k.gain),_.connect(u,0,0),T.connect(u,0,0),w.connect(u,0,1),k.connect(u,0,1)},disconnectGraph(){o.disconnect(v),o.disconnect(void 0===x.inputs?x:x.inputs[0]),v.disconnect(_,0),v.disconnect(w,0),v.disconnect(T,1),v.disconnect(k,1),x.disconnect(r),r.disconnect(void 0===y.inputs?y:y.inputs[0]),r.disconnect(void 0===b.inputs?b:b.inputs[0]),r.disconnect(void 0===S.inputs?S:S.inputs[0]),r.disconnect(void 0===C.inputs?C:C.inputs[0]),y.disconnect(_.gain),b.disconnect(w.gain),S.disconnect(T.gain),C.disconnect(k.gain),_.disconnect(u,0,0),T.disconnect(u,0,0),w.disconnect(u,0,1),k.disconnect(u,0,1)}}})(e,u,h,p);throw o()};return(t,{channelCount:n,channelCountMode:s,pan:a,...l})=>{if("max"===s)throw o();const c=e(t,{...l,channelCount:1,channelCountMode:s,numberOfInputs:2}),d=i(t,{...l,channelCount:n,channelCountMode:s,gain:1}),h=i(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:a});let{connectGraph:p,disconnectGraph:m}=u(t,n,d,h,c);Object.defineProperty(h.gain,"defaultValue",{get:()=>0}),Object.defineProperty(h.gain,"maxValue",{get:()=>1}),Object.defineProperty(h.gain,"minValue",{get:()=>-1});const f={get bufferSize(){},get channelCount(){return d.channelCount},set channelCount(e){d.channelCount!==e&&(g&&m(),({connectGraph:p,disconnectGraph:m}=u(t,e,d,h,c)),g&&p()),d.channelCount=e},get channelCountMode(){return d.channelCountMode},set channelCountMode(e){if("clamped-max"===e||"max"===e)throw o();d.channelCountMode=e},get channelInterpretation(){return d.channelInterpretation},set channelInterpretation(e){d.channelInterpretation=e},get context(){return d.context},get inputs(){return[d]},get numberOfInputs(){return d.numberOfInputs},get numberOfOutputs(){return d.numberOfOutputs},get pan(){return h.gain},addEventListener:(...e)=>d.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>d.dispatchEvent(e[0]),removeEventListener:(...e)=>d.removeEventListener(e[0],e[1],e[2])};let g=!1;return r(interceptConnections(f,c),(()=>{p(),g=!0}),(()=>{m(),g=!1}))}},createNativeWaveShaperNodeFactory=(e,t,i,n,o,r,s)=>(a,l)=>{const c=a.createWaveShaper();if(null!==r&&"webkitAudioContext"===r.name&&void 0===a.createGain().gain.automationRate)return i(a,l);assignNativeAudioNodeOptions(c,l);const d=null===l.curve||l.curve instanceof Float32Array?l.curve:new Float32Array(l.curve);if(null!==d&&d.length<2)throw t();assignNativeAudioNodeOption(c,{curve:d},"curve"),assignNativeAudioNodeOption(c,l,"oversample");let u=null,h=!1;s(c,"curve",(e=>()=>e.call(c)),(t=>i=>(t.call(c,i),h&&(n(i)&&null===u?u=e(a,c):n(i)||null===u||(u(),u=null)),i)));return o(c,(()=>{h=!0,n(c.curve)&&(u=e(a,c))}),(()=>{h=!1,null!==u&&(u(),u=null)}))},createNativeWaveShaperNodeFakerFactory=(e,t,i,n,o)=>(r,{curve:s,oversample:a,...l})=>{const c=r.createWaveShaper(),d=r.createWaveShaper();assignNativeAudioNodeOptions(c,l),assignNativeAudioNodeOptions(d,l);const u=i(r,{...l,gain:1}),h=i(r,{...l,gain:-1}),p=i(r,{...l,gain:1}),m=i(r,{...l,gain:-1});let f=null,g=!1,v=null;const _={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(e){u.channelCount=e,h.channelCount=e,c.channelCount=e,p.channelCount=e,d.channelCount=e,m.channelCount=e},get channelCountMode(){return c.channelCountMode},set channelCountMode(e){u.channelCountMode=e,h.channelCountMode=e,c.channelCountMode=e,p.channelCountMode=e,d.channelCountMode=e,m.channelCountMode=e},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(e){u.channelInterpretation=e,h.channelInterpretation=e,c.channelInterpretation=e,p.channelInterpretation=e,d.channelInterpretation=e,m.channelInterpretation=e},get context(){return c.context},get curve(){return v},set curve(i){if(null!==i&&i.length<2)throw t();if(null===i)c.curve=i,d.curve=i;else{const e=i.length,t=new Float32Array(e+2-e%2),n=new Float32Array(e+2-e%2);t[0]=i[0],n[0]=-i[e-1];const o=Math.ceil((e+1)/2),r=(e+1)/2-1;for(let s=1;s<o;s+=1){const a=s/o*r,l=Math.floor(a),c=Math.ceil(a);t[s]=l===c?i[l]:(1-(a-l))*i[l]+(1-(c-a))*i[c],n[s]=l===c?-i[e-1-l]:-(1-(a-l))*i[e-1-l]-(1-(c-a))*i[e-1-c]}t[o]=e%2==1?i[o-1]:(i[o-2]+i[o-1])/2,c.curve=t,d.curve=n}v=i,g&&(n(v)&&null===f?f=e(r,u):null!==f&&(f(),f=null))},get inputs(){return[u]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get oversample(){return c.oversample},set oversample(e){c.oversample=e,d.oversample=e},addEventListener:(...e)=>u.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>u.dispatchEvent(e[0]),removeEventListener:(...e)=>u.removeEventListener(e[0],e[1],e[2])};null!==s&&(_.curve=s instanceof Float32Array?s:new Float32Array(s)),a!==_.oversample&&(_.oversample=a);return o(interceptConnections(_,p),(()=>{u.connect(c).connect(p),u.connect(h).connect(d).connect(m).connect(p),g=!0,n(v)&&(f=e(r,u))}),(()=>{u.disconnect(c),c.disconnect(p),u.disconnect(h),h.disconnect(d),d.disconnect(m),m.disconnect(p),g=!1,null!==f&&(f(),f=null)}))},createNotSupportedError=()=>new DOMException("","NotSupportedError"),DEFAULT_OPTIONS$f={numberOfChannels:1},createOfflineAudioContextConstructor=(e,t,i,n,o)=>class extends e{constructor(e,i,o){let r;if("number"==typeof e&&void 0!==i&&void 0!==o)r={length:i,numberOfChannels:e,sampleRate:o};else{if("object"!=typeof e)throw new Error("The given parameters are not valid.");r=e}const{length:s,numberOfChannels:a,sampleRate:l}={...DEFAULT_OPTIONS$f,...r},c=n(a,s,l);t(testPromiseSupport,(()=>testPromiseSupport(c)))||c.addEventListener("statechange",(()=>{let e=0;const t=i=>{"running"===this._state&&(e>0?(c.removeEventListener("statechange",t),i.stopImmediatePropagation(),this._waitForThePromiseToSettle(i)):e+=1)};return t})()),super(c,a),this._length=s,this._nativeOfflineAudioContext=c,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(i()):(this._state="running",o(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,deactivateAudioGraph(this)})))}_waitForThePromiseToSettle(e){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(e):setTimeout((()=>this._waitForThePromiseToSettle(e)))}},DEFAULT_OPTIONS$g={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},createOscillatorNodeConstructor=(e,t,i,n,o,r,s)=>class extends e{constructor(e,s){const a=o(e),l={...DEFAULT_OPTIONS$g,...s},c=i(a,l),d=r(a),u=d?n():null,h=e.sampleRate/2;super(e,!1,c,u),this._detune=t(this,d,c.detune,153600,-153600),this._frequency=t(this,d,c.frequency,h,-h),this._nativeOscillatorNode=c,this._onended=null,this._oscillatorNodeRenderer=u,null!==this._oscillatorNodeRenderer&&void 0!==l.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=l.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(e){const t="function"==typeof e?s(this,e):null;this._nativeOscillatorNode.onended=t;const i=this._nativeOscillatorNode.onended;this._onended=null!==i&&i===t?e:i}get type(){return this._nativeOscillatorNode.type}set type(e){this._nativeOscillatorNode.type=e,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(e){this._nativeOscillatorNode.setPeriodicWave(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=e)}start(e=0){if(this._nativeOscillatorNode.start(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=e),"closed"!==this.context.state){setInternalStateToActive(this);const e=()=>{this._nativeOscillatorNode.removeEventListener("ended",e),isActiveAudioNode(this)&&setInternalStateToPassive(this)};this._nativeOscillatorNode.addEventListener("ended",e)}}stop(e=0){this._nativeOscillatorNode.stop(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=e)}},createOscillatorNodeRendererFactory=(e,t,i,n,o)=>()=>{const r=new WeakMap;let s=null,a=null,l=null;return{set periodicWave(e){s=e},set start(e){a=e},set stop(e){l=e},render(c,d,u){const h=r.get(d);return void 0!==h?Promise.resolve(h):(async(c,d,u)=>{let h=i(c);const p=isOwnedByContext(h,d);if(!p){const e={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,detune:h.detune.value,frequency:h.frequency.value,periodicWave:null===s?void 0:s,type:h.type};h=t(d,e),null!==a&&h.start(a),null!==l&&h.stop(l)}return r.set(d,h),p?(await e(d,c.detune,h.detune,u),await e(d,c.frequency,h.frequency,u)):(await n(d,c.detune,h.detune,u),await n(d,c.frequency,h.frequency,u)),await o(c,d,h,u),h})(c,d,u)}}},DEFAULT_OPTIONS$h={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},createPannerNodeConstructor=(e,t,i,n,o,r,s)=>class extends e{constructor(e,a){const l=o(e),c={...DEFAULT_OPTIONS$h,...a},d=i(l,c),u=r(l);super(e,!1,d,u?n():null),this._nativePannerNode=d,this._orientationX=t(this,u,d.orientationX,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._orientationY=t(this,u,d.orientationY,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._orientationZ=t(this,u,d.orientationZ,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionX=t(this,u,d.positionX,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionY=t(this,u,d.positionY,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),this._positionZ=t(this,u,d.positionZ,MOST_POSITIVE_SINGLE_FLOAT,MOST_NEGATIVE_SINGLE_FLOAT),s(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(e){this._nativePannerNode.coneInnerAngle=e}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(e){this._nativePannerNode.coneOuterAngle=e}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(e){this._nativePannerNode.coneOuterGain=e}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(e){this._nativePannerNode.distanceModel=e}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(e){this._nativePannerNode.maxDistance=e}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(e){this._nativePannerNode.panningModel=e}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(e){this._nativePannerNode.refDistance=e}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(e){this._nativePannerNode.rolloffFactor=e}},createPannerNodeRendererFactory=(e,t,i,n,o,r,s,a,l,c)=>()=>{const d=new WeakMap;let u=null;return{render(h,p,m){const f=d.get(p);return void 0!==f?Promise.resolve(f):(async(h,p,m)=>{let f=null,g=r(h);const v={channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation},_={...v,coneInnerAngle:g.coneInnerAngle,coneOuterAngle:g.coneOuterAngle,coneOuterGain:g.coneOuterGain,distanceModel:g.distanceModel,maxDistance:g.maxDistance,panningModel:g.panningModel,refDistance:g.refDistance,rolloffFactor:g.rolloffFactor},y=isOwnedByContext(g,p);if("bufferSize"in g)f=n(p,{...v,gain:1});else if(!y){const e={..._,orientationX:g.orientationX.value,orientationY:g.orientationY.value,orientationZ:g.orientationZ.value,positionX:g.positionX.value,positionY:g.positionY.value,positionZ:g.positionZ.value};g=o(p,e)}if(d.set(p,null===f?g:f),null!==f){if(null===u){if(null===s)throw new Error("Missing the native OfflineAudioContext constructor.");const e=new s(6,h.context.length,p.sampleRate),n=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});n.connect(e.destination),u=(async()=>{const t=await Promise.all([h.orientationX,h.orientationY,h.orientationZ,h.positionX,h.positionY,h.positionZ].map((async(t,n)=>{const o=i(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===n?1:0});return await a(e,t,o.offset,m),o})));for(let e=0;e<6;e+=1)t[e].connect(n,0,e),t[e].start(0);return c(e)})()}const e=await u,r=n(p,{...v,gain:1});await l(h,p,r,m);const d=[];for(let t=0;t<e.numberOfChannels;t+=1)d.push(e.getChannelData(t));let g=[d[0][0],d[1][0],d[2][0]],y=[d[3][0],d[4][0],d[5][0]],w=n(p,{...v,gain:1}),b=o(p,{..._,orientationX:g[0],orientationY:g[1],orientationZ:g[2],positionX:y[0],positionY:y[1],positionZ:y[2]});r.connect(w).connect(b.inputs[0]),b.connect(f);for(let t=128;t<e.length;t+=128){const e=[d[0][t],d[1][t],d[2][t]],i=[d[3][t],d[4][t],d[5][t]];if(e.some(((e,t)=>e!==g[t]))||i.some(((e,t)=>e!==y[t]))){g=e,y=i;const s=t/p.sampleRate;w.gain.setValueAtTime(0,s),w=n(p,{...v,gain:0}),b=o(p,{..._,orientationX:g[0],orientationY:g[1],orientationZ:g[2],positionX:y[0],positionY:y[1],positionZ:y[2]}),w.gain.setValueAtTime(1,s),r.connect(w).connect(b.inputs[0]),b.connect(f)}}return f}return y?(await e(p,h.orientationX,g.orientationX,m),await e(p,h.orientationY,g.orientationY,m),await e(p,h.orientationZ,g.orientationZ,m),await e(p,h.positionX,g.positionX,m),await e(p,h.positionY,g.positionY,m),await e(p,h.positionZ,g.positionZ,m)):(await a(p,h.orientationX,g.orientationX,m),await a(p,h.orientationY,g.orientationY,m),await a(p,h.orientationZ,g.orientationZ,m),await a(p,h.positionX,g.positionX,m),await a(p,h.positionY,g.positionY,m),await a(p,h.positionZ,g.positionZ,m)),isNativeAudioNodeFaker(g)?await l(h,p,g.inputs[0],m):await l(h,p,g,m),g})(h,p,m)}}},DEFAULT_OPTIONS$i={disableNormalization:!1},createPeriodicWaveConstructor=(e,t,i,n)=>class o{constructor(o,r){const s=t(o),a=n({...DEFAULT_OPTIONS$i,...r}),l=e(s,a);return i.add(l),l}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===o.prototype||i.has(e)}},createRenderAutomation=(e,t)=>(i,n,o,r)=>(e(n).replay(o),t(n,i,o,r)),createRenderInputsOfAudioNode=(e,t,i)=>async(n,o,r,s)=>{const a=e(n),l=[...s,n];await Promise.all(a.activeInputs.map(((e,s)=>Array.from(e).filter((([e])=>!l.includes(e))).map((async([e,a])=>{const c=t(e),d=await c.render(e,o,l),u=n.context.destination;i(e)||n===u&&i(n)||d.connect(r,a,s)})))).reduce(((e,t)=>[...e,...t]),[]))},createRenderInputsOfAudioParam=(e,t,i)=>async(n,o,r,s)=>{const a=t(n);await Promise.all(Array.from(a.activeInputs).map((async([t,n])=>{const a=e(t),l=await a.render(t,o,s);i(t)||l.connect(r,n)})))},createRenderNativeOfflineAudioContext=(e,t,i,n)=>o=>e(testPromiseSupport,(()=>testPromiseSupport(o)))?Promise.resolve(e(n,n)).then((e=>{if(!e){const e=i(o,512,0,1);o.oncomplete=()=>{e.onaudioprocess=null,e.disconnect()},e.onaudioprocess=()=>o.currentTime,e.connect(o.destination)}return o.startRendering()})):new Promise((e=>{const i=t(o,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});o.oncomplete=t=>{i.disconnect(),e(t.renderedBuffer)},i.connect(o.destination),o.startRendering()})),createSetActiveAudioWorkletNodeInputs=e=>(t,i)=>{e.set(t,i)},createSetAudioNodeTailTime=e=>(t,i)=>e.set(t,i),createStartRendering=(e,t,i,n,o,r,s,a)=>{const l=[];return(c,d)=>i(c).render(c,d,l).then((()=>Promise.all(Array.from(n(d)).map((e=>i(e).render(e,d,l)))))).then((()=>o(d))).then((i=>("function"!=typeof i.copyFromChannel?(s(i),wrapAudioBufferGetChannelDataMethod(i)):t(r,(()=>r(i)))||a(i),e.add(i),i)))},DEFAULT_OPTIONS$j={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},createStereoPannerNodeConstructor=(e,t,i,n,o,r)=>class extends e{constructor(e,s){const a=o(e),l={...DEFAULT_OPTIONS$j,...s},c=i(a,l),d=r(a);super(e,!1,c,d?n():null),this._pan=t(this,d,c.pan)}get pan(){return this._pan}},createStereoPannerNodeRendererFactory=(e,t,i,n,o)=>()=>{const r=new WeakMap;return{render(s,a,l){const c=r.get(a);return void 0!==c?Promise.resolve(c):(async(s,a,l)=>{let c=i(s);const d=isOwnedByContext(c,a);if(!d){const e={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value};c=t(a,e)}return r.set(a,c),d?await e(a,s.pan,c.pan,l):await n(a,s.pan,c.pan,l),isNativeAudioNodeFaker(c)?await o(s,a,c.inputs[0],l):await o(s,a,c,l),c})(s,a,l)}}},createTestAudioBufferConstructorSupport=e=>()=>{if(null===e)return!1;try{new e({length:1,sampleRate:44100})}catch{return!1}return!0},createTestAudioWorkletProcessorPostMessageSupport=(e,t)=>async()=>{if(null===e)return!0;if(null===t)return!1;const i=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new t(1,128,44100),o=URL.createObjectURL(i);let r=!1,s=!1;try{await n.audioWorklet.addModule(o);const t=new e(n,"a",{numberOfOutputs:0}),i=n.createOscillator();t.port.onmessage=()=>r=!0,t.onprocessorerror=()=>s=!0,i.connect(t),i.start(0),await n.startRendering()}catch{}finally{URL.revokeObjectURL(o)}return r&&!s},createTestOfflineAudioContextCurrentTimeSupport=(e,t)=>()=>{if(null===t)return Promise.resolve(!1);const i=new t(1,1,44100),n=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((e=>{i.oncomplete=()=>{n.disconnect(),e(0!==i.currentTime)},i.startRendering()}))},createUnknownError=()=>new DOMException("","UnknownError"),DEFAULT_OPTIONS$k={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},createWaveShaperNodeConstructor=(e,t,i,n,o,r,s)=>class extends e{constructor(e,t){const a=o(e),l={...DEFAULT_OPTIONS$k,...t},c=i(a,l);super(e,!0,c,r(a)?n():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=c,s(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(e){if(null===e)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(e.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=e}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(e){this._nativeWaveShaperNode.oversample=e}},createWaveShaperNodeRendererFactory=(e,t,i)=>()=>{const n=new WeakMap;return{render(o,r,s){const a=n.get(r);return void 0!==a?Promise.resolve(a):(async(o,r,s)=>{let a=t(o);if(!isOwnedByContext(a,r)){const t={channelCount:a.channelCount,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,curve:a.curve,oversample:a.oversample};a=e(r,t)}return n.set(r,a),isNativeAudioNodeFaker(a)?await i(o,r,a.inputs[0],s):await i(o,r,a,s),a})(o,r,s)}}},createWindow=()=>"undefined"==typeof window?null:window,createWrapAudioBufferCopyChannelMethods=(e,t)=>i=>{i.copyFromChannel=(n,o,r=0)=>{const s=e(r),a=e(o);if(a>=i.numberOfChannels)throw t();const l=i.length,c=i.getChannelData(a),d=n.length;for(let e=s<0?-s:0;e+s<l&&e<d;e+=1)n[e]=c[e+s]},i.copyToChannel=(n,o,r=0)=>{const s=e(r),a=e(o);if(a>=i.numberOfChannels)throw t();const l=i.length,c=i.getChannelData(a),d=n.length;for(let e=s<0?-s:0;e+s<l&&e<d;e+=1)c[e+s]=n[e]}},createWrapAudioBufferCopyChannelMethodsOutOfBounds=e=>t=>{t.copyFromChannel=(i=>(n,o,r=0)=>{const s=e(r),a=e(o);if(s<t.length)return i.call(t,n,a,s)})(t.copyFromChannel),t.copyToChannel=(i=>(n,o,r=0)=>{const s=e(r),a=e(o);if(s<t.length)return i.call(t,n,a,s)})(t.copyToChannel)},createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer=e=>(t,i)=>{const n=i.createBuffer(1,1,44100);null===t.buffer&&(t.buffer=n),e(t,"buffer",(e=>()=>{const i=e.call(t);return i===n?null:i}),(e=>i=>e.call(t,null===i?n:i)))},createWrapChannelMergerNode=(e,t)=>(i,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw e()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw e()}});const o=i.createBufferSource();t(n,(()=>{const e=n.numberOfInputs;for(let t=0;t<e;t+=1)o.connect(n,0,t)}),(()=>o.disconnect(n)))},getFirstSample=(e,t,i)=>void 0===e.copyFromChannel?e.getChannelData(i)[0]:(e.copyFromChannel(t,i),t[0]),isDCCurve=e=>{if(null===e)return!1;const t=e.length;return t%2!=0?0!==e[Math.floor(t/2)]:e[t/2-1]+e[t/2]!==0},overwriteAccessors=(e,t,i,n)=>{let o=e;for(;!o.hasOwnProperty(t);)o=Object.getPrototypeOf(o);const{get:r,set:s}=Object.getOwnPropertyDescriptor(o,t);Object.defineProperty(e,t,{get:i(r),set:n(s)})},sanitizeAudioWorkletNodeOptions=e=>({...e,outputChannelCount:void 0!==e.outputChannelCount?e.outputChannelCount:1===e.numberOfInputs&&1===e.numberOfOutputs?[e.channelCount]:Array.from({length:e.numberOfOutputs},(()=>1))}),sanitizeChannelSplitterOptions=e=>({...e,channelCount:e.numberOfOutputs}),sanitizePeriodicWaveOptions=e=>{const{imag:t,real:i}=e;return void 0===t?void 0===i?{...e,imag:[0,0],real:[0,0]}:{...e,imag:Array.from(i,(()=>0)),real:i}:void 0===i?{...e,imag:t,real:Array.from(t,(()=>0))}:{...e,imag:t,real:i}},setValueAtTimeUntilPossible=(e,t,i)=>{try{e.setValueAtTime(t,i)}catch(n){if(9!==n.code)throw n;setValueAtTimeUntilPossible(e,t,i+1e-7)}},testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport=e=>{const t=e.createBufferSource();t.start();try{t.start()}catch{return!0}return!1},testAudioBufferSourceNodeStartMethodOffsetClampingSupport=e=>{const t=e.createBufferSource(),i=e.createBuffer(1,1,44100);t.buffer=i;try{t.start(0,1)}catch{return!1}return!0},testAudioBufferSourceNodeStopMethodNullifiedBufferSupport=e=>{const t=e.createBufferSource();t.start();try{t.stop()}catch{return!1}return!0},testAudioScheduledSourceNodeStartMethodNegativeParametersSupport=e=>{const t=e.createOscillator();try{t.start(-1)}catch(e){return e instanceof RangeError}return!1},testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport=e=>{const t=e.createBuffer(1,1,44100),i=e.createBufferSource();i.buffer=t,i.start(),i.stop();try{return i.stop(),!0}catch{return!1}},testAudioScheduledSourceNodeStopMethodNegativeParametersSupport=e=>{const t=e.createOscillator();try{t.stop(-1)}catch(e){return e instanceof RangeError}return!1},testAudioWorkletNodeOptionsClonability=e=>{const{port1:t,port2:i}=new MessageChannel;try{t.postMessage(e)}finally{t.close(),i.close()}},wrapAudioBufferSourceNodeStartMethodOffsetClamping=e=>{e.start=(t=>(i=0,n=0,o)=>{const r=e.buffer,s=null===r?n:Math.min(r.duration,n);null!==r&&s>r.duration-.5/e.context.sampleRate?t.call(e,i,0,0):t.call(e,i,s,o)})(e.start)},wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls=(e,t)=>{const i=t.createGain();e.connect(i);const n=(t=>()=>{t.call(e,i),e.removeEventListener("ended",n)})(e.disconnect);e.addEventListener("ended",n),interceptConnections(e,i),e.stop=(t=>{let n=!1;return(o=0)=>{if(n)try{t.call(e,o)}catch{i.gain.setValueAtTime(0,o)}else t.call(e,o),n=!0}})(e.stop)},wrapEventListener=(e,t)=>i=>{const n={value:e};return Object.defineProperties(i,{currentTarget:n,target:n}),"function"==typeof t?t.call(e,i):t.handleEvent.call(e,i)},addActiveInputConnectionToAudioNode=createAddActiveInputConnectionToAudioNode(insertElementInSet),addPassiveInputConnectionToAudioNode=createAddPassiveInputConnectionToAudioNode(insertElementInSet),deleteActiveInputConnectionToAudioNode=createDeleteActiveInputConnectionToAudioNode(pickElementFromSet),audioNodeTailTimeStore=new WeakMap,getAudioNodeTailTime=createGetAudioNodeTailTime(audioNodeTailTimeStore),cacheTestResult=createCacheTestResult(new Map,new WeakMap),window$1=createWindow(),createNativeAnalyserNode=createNativeAnalyserNodeFactory(cacheTestResult,createIndexSizeError),getAudioNodeRenderer=createGetAudioNodeRenderer(getAudioNodeConnections),renderInputsOfAudioNode=createRenderInputsOfAudioNode(getAudioNodeConnections,getAudioNodeRenderer,isPartOfACycle),createAnalyserNodeRenderer=createAnalyserNodeRendererFactory(createNativeAnalyserNode,getNativeAudioNode,renderInputsOfAudioNode),getNativeContext=createGetNativeContext(CONTEXT_STORE),nativeOfflineAudioContextConstructor=createNativeOfflineAudioContextConstructor(window$1),isNativeOfflineAudioContext=createIsNativeOfflineAudioContext(nativeOfflineAudioContextConstructor),audioParamAudioNodeStore=new WeakMap,eventTargetConstructor=createEventTargetConstructor(wrapEventListener),nativeAudioContextConstructor=createNativeAudioContextConstructor(window$1),isNativeAudioContext=createIsNativeAudioContext(nativeAudioContextConstructor),isNativeAudioNode$1=createIsNativeAudioNode(window$1),isNativeAudioParam=createIsNativeAudioParam(window$1),audioNodeConstructor=createAudioNodeConstructor(createAddAudioNodeConnections(AUDIO_NODE_CONNECTIONS_STORE),createAddConnectionToAudioNode(addActiveInputConnectionToAudioNode,addPassiveInputConnectionToAudioNode,connectNativeAudioNodeToNativeAudioNode,deleteActiveInputConnectionToAudioNode,disconnectNativeAudioNodeFromNativeAudioNode,getAudioNodeConnections,getAudioNodeTailTime,getEventListenersOfAudioNode,getNativeAudioNode,insertElementInSet,isActiveAudioNode,isPartOfACycle,isPassiveAudioNode),cacheTestResult,createIncrementCycleCounterFactory(CYCLE_COUNTERS,disconnectNativeAudioNodeFromNativeAudioNode,getAudioNodeConnections,getNativeAudioNode,getNativeAudioParam,isActiveAudioNode),createIndexSizeError,createInvalidAccessError,createNotSupportedError,createDecrementCycleCounter(connectNativeAudioNodeToNativeAudioNode,CYCLE_COUNTERS,getAudioNodeConnections,getNativeAudioNode,getNativeAudioParam,getNativeContext,isActiveAudioNode,isNativeOfflineAudioContext),createDetectCycles(audioParamAudioNodeStore,getAudioNodeConnections,getValueForKey),eventTargetConstructor,getNativeContext,isNativeAudioContext,isNativeAudioNode$1,isNativeAudioParam,isNativeOfflineAudioContext),analyserNodeConstructor=createAnalyserNodeConstructor(audioNodeConstructor,createAnalyserNodeRenderer,createIndexSizeError,createNativeAnalyserNode,getNativeContext,isNativeOfflineAudioContext),audioBufferStore=new WeakSet,nativeAudioBufferConstructor=createNativeAudioBufferConstructor(window$1),convertNumberToUnsignedLong=createConvertNumberToUnsignedLong(new Uint32Array(1)),wrapAudioBufferCopyChannelMethods=createWrapAudioBufferCopyChannelMethods(convertNumberToUnsignedLong,createIndexSizeError),wrapAudioBufferCopyChannelMethodsOutOfBounds=createWrapAudioBufferCopyChannelMethodsOutOfBounds(convertNumberToUnsignedLong),audioBufferConstructor=createAudioBufferConstructor(audioBufferStore,cacheTestResult,createNotSupportedError,nativeAudioBufferConstructor,nativeOfflineAudioContextConstructor,createTestAudioBufferConstructorSupport(nativeAudioBufferConstructor),wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),addSilentConnection=createAddSilentConnection(createNativeGainNode),renderInputsOfAudioParam=createRenderInputsOfAudioParam(getAudioNodeRenderer,getAudioParamConnections,isPartOfACycle),connectAudioParam=createConnectAudioParam(renderInputsOfAudioParam),createNativeAudioBufferSourceNode=createNativeAudioBufferSourceNodeFactory(addSilentConnection,cacheTestResult,testAudioBufferSourceNodeStartMethodConsecutiveCallsSupport,testAudioBufferSourceNodeStartMethodOffsetClampingSupport,testAudioBufferSourceNodeStopMethodNullifiedBufferSupport,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport,wrapAudioBufferSourceNodeStartMethodOffsetClamping,createWrapAudioBufferSourceNodeStopMethodNullifiedBuffer(overwriteAccessors),wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls),renderAutomation=createRenderAutomation(createGetAudioParamRenderer(getAudioParamConnections),renderInputsOfAudioParam),createAudioBufferSourceNodeRenderer=createAudioBufferSourceNodeRendererFactory(connectAudioParam,createNativeAudioBufferSourceNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),createAudioParam=createAudioParamFactory(createAddAudioParamConnections(AUDIO_PARAM_CONNECTIONS_STORE),audioParamAudioNodeStore,AUDIO_PARAM_STORE,createAudioParamRenderer,createCancelAndHoldAutomationEvent,createCancelScheduledValuesAutomationEvent,createExponentialRampToValueAutomationEvent,createLinearRampToValueAutomationEvent,createSetTargetAutomationEvent,createSetValueAutomationEvent,createSetValueCurveAutomationEvent,nativeAudioContextConstructor,setValueAtTimeUntilPossible),audioBufferSourceNodeConstructor=createAudioBufferSourceNodeConstructor(audioNodeConstructor,createAudioBufferSourceNodeRenderer,createAudioParam,createInvalidStateError,createNativeAudioBufferSourceNode,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),audioDestinationNodeConstructor=createAudioDestinationNodeConstructor(audioNodeConstructor,createAudioDestinationNodeRenderer,createIndexSizeError,createInvalidStateError,createNativeAudioDestinationNodeFactory(createNativeGainNode,overwriteAccessors),getNativeContext,isNativeOfflineAudioContext,renderInputsOfAudioNode),createBiquadFilterNodeRenderer=createBiquadFilterNodeRendererFactory(connectAudioParam,createNativeBiquadFilterNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),setAudioNodeTailTime=createSetAudioNodeTailTime(audioNodeTailTimeStore),biquadFilterNodeConstructor=createBiquadFilterNodeConstructor(audioNodeConstructor,createAudioParam,createBiquadFilterNodeRenderer,createInvalidAccessError,createNativeBiquadFilterNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),monitorConnections=createMonitorConnections(insertElementInSet,isNativeAudioNode$1),wrapChannelMergerNode=createWrapChannelMergerNode(createInvalidStateError,monitorConnections),createNativeChannelMergerNode=createNativeChannelMergerNodeFactory(nativeAudioContextConstructor,wrapChannelMergerNode),createChannelMergerNodeRenderer=createChannelMergerNodeRendererFactory(createNativeChannelMergerNode,getNativeAudioNode,renderInputsOfAudioNode),channelMergerNodeConstructor=createChannelMergerNodeConstructor(audioNodeConstructor,createChannelMergerNodeRenderer,createNativeChannelMergerNode,getNativeContext,isNativeOfflineAudioContext),createChannelSplitterNodeRenderer=createChannelSplitterNodeRendererFactory(createNativeChannelSplitterNode,getNativeAudioNode,renderInputsOfAudioNode),channelSplitterNodeConstructor=createChannelSplitterNodeConstructor(audioNodeConstructor,createChannelSplitterNodeRenderer,createNativeChannelSplitterNode,getNativeContext,isNativeOfflineAudioContext,sanitizeChannelSplitterOptions),createNativeConstantSourceNodeFaker=createNativeConstantSourceNodeFakerFactory(addSilentConnection,createNativeAudioBufferSourceNode,createNativeGainNode,monitorConnections),createNativeConstantSourceNode=createNativeConstantSourceNodeFactory(addSilentConnection,cacheTestResult,createNativeConstantSourceNodeFaker,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport),createConstantSourceNodeRenderer=createConstantSourceNodeRendererFactory(connectAudioParam,createNativeConstantSourceNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),constantSourceNodeConstructor=createConstantSourceNodeConstructor(audioNodeConstructor,createAudioParam,createConstantSourceNodeRenderer,createNativeConstantSourceNode,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),createNativeConvolverNode=createNativeConvolverNodeFactory(createNotSupportedError,overwriteAccessors),createConvolverNodeRenderer=createConvolverNodeRendererFactory(createNativeConvolverNode,getNativeAudioNode,renderInputsOfAudioNode),convolverNodeConstructor=createConvolverNodeConstructor(audioNodeConstructor,createConvolverNodeRenderer,createNativeConvolverNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createDelayNodeRenderer=createDelayNodeRendererFactory(connectAudioParam,createNativeDelayNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),delayNodeConstructor=createDelayNodeConstructor(audioNodeConstructor,createAudioParam,createDelayNodeRenderer,createNativeDelayNode,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createNativeDynamicsCompressorNode=createNativeDynamicsCompressorNodeFactory(createNotSupportedError),createDynamicsCompressorNodeRenderer=createDynamicsCompressorNodeRendererFactory(connectAudioParam,createNativeDynamicsCompressorNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),dynamicsCompressorNodeConstructor=createDynamicsCompressorNodeConstructor(audioNodeConstructor,createAudioParam,createDynamicsCompressorNodeRenderer,createNativeDynamicsCompressorNode,createNotSupportedError,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createGainNodeRenderer=createGainNodeRendererFactory(connectAudioParam,createNativeGainNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),gainNodeConstructor=createGainNodeConstructor(audioNodeConstructor,createAudioParam,createGainNodeRenderer,createNativeGainNode,getNativeContext,isNativeOfflineAudioContext),createNativeIIRFilterNodeFaker=createNativeIIRFilterNodeFakerFactory(createInvalidAccessError,createInvalidStateError,createNativeScriptProcessorNode,createNotSupportedError),renderNativeOfflineAudioContext=createRenderNativeOfflineAudioContext(cacheTestResult,createNativeGainNode,createNativeScriptProcessorNode,createTestOfflineAudioContextCurrentTimeSupport(createNativeGainNode,nativeOfflineAudioContextConstructor)),createIIRFilterNodeRenderer=createIIRFilterNodeRendererFactory(createNativeAudioBufferSourceNode,getNativeAudioNode,nativeOfflineAudioContextConstructor,renderInputsOfAudioNode,renderNativeOfflineAudioContext),createNativeIIRFilterNode=createNativeIIRFilterNodeFactory(createNativeIIRFilterNodeFaker),iIRFilterNodeConstructor=createIIRFilterNodeConstructor(audioNodeConstructor,createNativeIIRFilterNode,createIIRFilterNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createAudioListener=createAudioListenerFactory(createAudioParam,createNativeChannelMergerNode,createNativeConstantSourceNode,createNativeScriptProcessorNode,createNotSupportedError,getFirstSample,isNativeOfflineAudioContext,overwriteAccessors),unrenderedAudioWorkletNodeStore=new WeakMap,minimalBaseAudioContextConstructor=createMinimalBaseAudioContextConstructor(audioDestinationNodeConstructor,createAudioListener,eventTargetConstructor,isNativeOfflineAudioContext,unrenderedAudioWorkletNodeStore,wrapEventListener),createNativeOscillatorNode=createNativeOscillatorNodeFactory(addSilentConnection,cacheTestResult,testAudioScheduledSourceNodeStartMethodNegativeParametersSupport,testAudioScheduledSourceNodeStopMethodConsecutiveCallsSupport,testAudioScheduledSourceNodeStopMethodNegativeParametersSupport,wrapAudioScheduledSourceNodeStopMethodConsecutiveCalls),createOscillatorNodeRenderer=createOscillatorNodeRendererFactory(connectAudioParam,createNativeOscillatorNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),oscillatorNodeConstructor=createOscillatorNodeConstructor(audioNodeConstructor,createAudioParam,createNativeOscillatorNode,createOscillatorNodeRenderer,getNativeContext,isNativeOfflineAudioContext,wrapEventListener),createConnectedNativeAudioBufferSourceNode=createConnectedNativeAudioBufferSourceNodeFactory(createNativeAudioBufferSourceNode),createNativeWaveShaperNodeFaker=createNativeWaveShaperNodeFakerFactory(createConnectedNativeAudioBufferSourceNode,createInvalidStateError,createNativeGainNode,isDCCurve,monitorConnections),createNativeWaveShaperNode=createNativeWaveShaperNodeFactory(createConnectedNativeAudioBufferSourceNode,createInvalidStateError,createNativeWaveShaperNodeFaker,isDCCurve,monitorConnections,nativeAudioContextConstructor,overwriteAccessors),createNativePannerNodeFaker=createNativePannerNodeFakerFactory(connectNativeAudioNodeToNativeAudioNode,createInvalidStateError,createNativeChannelMergerNode,createNativeGainNode,createNativeScriptProcessorNode,createNativeWaveShaperNode,createNotSupportedError,disconnectNativeAudioNodeFromNativeAudioNode,getFirstSample,monitorConnections),createNativePannerNode=createNativePannerNodeFactory(createNativePannerNodeFaker),createPannerNodeRenderer=createPannerNodeRendererFactory(connectAudioParam,createNativeChannelMergerNode,createNativeConstantSourceNode,createNativeGainNode,createNativePannerNode,getNativeAudioNode,nativeOfflineAudioContextConstructor,renderAutomation,renderInputsOfAudioNode,renderNativeOfflineAudioContext),pannerNodeConstructor=createPannerNodeConstructor(audioNodeConstructor,createAudioParam,createNativePannerNode,createPannerNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),createNativePeriodicWave=createNativePeriodicWaveFactory(createIndexSizeError),periodicWaveConstructor=createPeriodicWaveConstructor(createNativePeriodicWave,getNativeContext,new WeakSet,sanitizePeriodicWaveOptions),nativeStereoPannerNodeFakerFactory=createNativeStereoPannerNodeFakerFactory(createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeGainNode,createNativeWaveShaperNode,createNotSupportedError,monitorConnections),createNativeStereoPannerNode=createNativeStereoPannerNodeFactory(nativeStereoPannerNodeFakerFactory,createNotSupportedError),createStereoPannerNodeRenderer=createStereoPannerNodeRendererFactory(connectAudioParam,createNativeStereoPannerNode,getNativeAudioNode,renderAutomation,renderInputsOfAudioNode),stereoPannerNodeConstructor=createStereoPannerNodeConstructor(audioNodeConstructor,createAudioParam,createNativeStereoPannerNode,createStereoPannerNodeRenderer,getNativeContext,isNativeOfflineAudioContext),createWaveShaperNodeRenderer=createWaveShaperNodeRendererFactory(createNativeWaveShaperNode,getNativeAudioNode,renderInputsOfAudioNode),waveShaperNodeConstructor=createWaveShaperNodeConstructor(audioNodeConstructor,createInvalidStateError,createNativeWaveShaperNode,createWaveShaperNodeRenderer,getNativeContext,isNativeOfflineAudioContext,setAudioNodeTailTime),isSecureContext=createIsSecureContext(window$1),exposeCurrentFrameAndCurrentTime=createExposeCurrentFrameAndCurrentTime(window$1),backupOfflineAudioContextStore=new WeakMap,getOrCreateBackupOfflineAudioContext=createGetOrCreateBackupOfflineAudioContext(backupOfflineAudioContextStore,nativeOfflineAudioContextConstructor),nativeAudioWorkletNodeConstructor=createNativeAudioWorkletNodeConstructor(window$1),addAudioWorkletModule=isSecureContext?createAddAudioWorkletModule(cacheTestResult,createNotSupportedError,createEvaluateSource(window$1),exposeCurrentFrameAndCurrentTime,createFetchSource(createAbortError),getNativeContext,getOrCreateBackupOfflineAudioContext,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor,new WeakMap,new WeakMap,createTestAudioWorkletProcessorPostMessageSupport(nativeAudioWorkletNodeConstructor,nativeOfflineAudioContextConstructor),window$1):void 0,isNativeContext=createIsNativeContext(isNativeAudioContext,isNativeOfflineAudioContext),decodeAudioData=createDecodeAudioData(audioBufferStore,cacheTestResult,createDataCloneError,createEncodingError,new WeakSet,getNativeContext,isNativeContext,testAudioBufferCopyChannelMethodsOutOfBoundsSupport,testPromiseSupport,wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),baseAudioContextConstructor=createBaseAudioContextConstructor(addAudioWorkletModule,analyserNodeConstructor,audioBufferConstructor,audioBufferSourceNodeConstructor,biquadFilterNodeConstructor,channelMergerNodeConstructor,channelSplitterNodeConstructor,constantSourceNodeConstructor,convolverNodeConstructor,decodeAudioData,delayNodeConstructor,dynamicsCompressorNodeConstructor,gainNodeConstructor,iIRFilterNodeConstructor,minimalBaseAudioContextConstructor,oscillatorNodeConstructor,pannerNodeConstructor,periodicWaveConstructor,stereoPannerNodeConstructor,waveShaperNodeConstructor),mediaElementAudioSourceNodeConstructor=createMediaElementAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaElementAudioSourceNode,getNativeContext,isNativeOfflineAudioContext),mediaStreamAudioDestinationNodeConstructor=createMediaStreamAudioDestinationNodeConstructor(audioNodeConstructor,createNativeMediaStreamAudioDestinationNode,getNativeContext,isNativeOfflineAudioContext),mediaStreamAudioSourceNodeConstructor=createMediaStreamAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaStreamAudioSourceNode,getNativeContext,isNativeOfflineAudioContext),createNativeMediaStreamTrackAudioSourceNode=createNativeMediaStreamTrackAudioSourceNodeFactory(createInvalidStateError,isNativeOfflineAudioContext),mediaStreamTrackAudioSourceNodeConstructor=createMediaStreamTrackAudioSourceNodeConstructor(audioNodeConstructor,createNativeMediaStreamTrackAudioSourceNode,getNativeContext),audioContextConstructor=createAudioContextConstructor(baseAudioContextConstructor,createInvalidStateError,createNotSupportedError,createUnknownError,mediaElementAudioSourceNodeConstructor,mediaStreamAudioDestinationNodeConstructor,mediaStreamAudioSourceNodeConstructor,mediaStreamTrackAudioSourceNodeConstructor,nativeAudioContextConstructor),getUnrenderedAudioWorkletNodes=createGetUnrenderedAudioWorkletNodes(unrenderedAudioWorkletNodeStore),addUnrenderedAudioWorkletNode=createAddUnrenderedAudioWorkletNode(getUnrenderedAudioWorkletNodes),connectMultipleOutputs=createConnectMultipleOutputs(createIndexSizeError),deleteUnrenderedAudioWorkletNode=createDeleteUnrenderedAudioWorkletNode(getUnrenderedAudioWorkletNodes),disconnectMultipleOutputs=createDisconnectMultipleOutputs(createIndexSizeError),activeAudioWorkletNodeInputsStore=new WeakMap,getActiveAudioWorkletNodeInputs=createGetActiveAudioWorkletNodeInputs(activeAudioWorkletNodeInputsStore,getValueForKey),createNativeAudioWorkletNodeFaker=createNativeAudioWorkletNodeFakerFactory(connectMultipleOutputs,createIndexSizeError,createInvalidStateError,createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeConstantSourceNode,createNativeGainNode,createNativeScriptProcessorNode,createNotSupportedError,disconnectMultipleOutputs,exposeCurrentFrameAndCurrentTime,getActiveAudioWorkletNodeInputs,monitorConnections),createNativeAudioWorkletNode=createNativeAudioWorkletNodeFactory(createInvalidStateError,createNativeAudioWorkletNodeFaker,createNativeGainNode,createNotSupportedError,monitorConnections),createAudioWorkletNodeRenderer=createAudioWorkletNodeRendererFactory(connectAudioParam,connectMultipleOutputs,createNativeAudioBufferSourceNode,createNativeChannelMergerNode,createNativeChannelSplitterNode,createNativeConstantSourceNode,createNativeGainNode,deleteUnrenderedAudioWorkletNode,disconnectMultipleOutputs,exposeCurrentFrameAndCurrentTime,getNativeAudioNode,nativeAudioWorkletNodeConstructor,nativeOfflineAudioContextConstructor,renderAutomation,renderInputsOfAudioNode,renderNativeOfflineAudioContext),getBackupOfflineAudioContext=createGetBackupOfflineAudioContext(backupOfflineAudioContextStore),setActiveAudioWorkletNodeInputs=createSetActiveAudioWorkletNodeInputs(activeAudioWorkletNodeInputsStore),audioWorkletNodeConstructor=isSecureContext?createAudioWorkletNodeConstructor(addUnrenderedAudioWorkletNode,audioNodeConstructor,createAudioParam,createAudioWorkletNodeRenderer,createNativeAudioWorkletNode,getAudioNodeConnections,getBackupOfflineAudioContext,getNativeContext,isNativeOfflineAudioContext,nativeAudioWorkletNodeConstructor,sanitizeAudioWorkletNodeOptions,setActiveAudioWorkletNodeInputs,testAudioWorkletNodeOptionsClonability,wrapEventListener):void 0,createNativeOfflineAudioContext=createCreateNativeOfflineAudioContext(createNotSupportedError,nativeOfflineAudioContextConstructor),startRendering=createStartRendering(audioBufferStore,cacheTestResult,getAudioNodeRenderer,getUnrenderedAudioWorkletNodes,renderNativeOfflineAudioContext,testAudioBufferCopyChannelMethodsOutOfBoundsSupport,wrapAudioBufferCopyChannelMethods,wrapAudioBufferCopyChannelMethodsOutOfBounds),offlineAudioContextConstructor=createOfflineAudioContextConstructor(baseAudioContextConstructor,cacheTestResult,createInvalidStateError,createNativeOfflineAudioContext,startRendering),isAnyAudioContext=createIsAnyAudioContext(CONTEXT_STORE,isNativeAudioContext),isAnyAudioNode=createIsAnyAudioNode(AUDIO_NODE_STORE,isNativeAudioNode$1),isAnyAudioParam=createIsAnyAudioParam(AUDIO_PARAM_STORE,isNativeAudioParam),isAnyOfflineAudioContext=createIsAnyOfflineAudioContext(CONTEXT_STORE,isNativeOfflineAudioContext),version="14.7.77";function assert(e,t){if(!e)throw new Error(t)}function assertRange(e,t,i=1/0){if(!(t<=e&&e<=i))throw new RangeError(`Value must be within [${t}, ${i}], got: ${e}`)}function assertContextRunning(e){e.isOffline||"running"===e.state||warn('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let defaultLogger=console;function log(...e){defaultLogger.log(...e)}function warn(...e){defaultLogger.warn(...e)}function isUndef(e){return void 0===e}function isDefined(e){return!isUndef(e)}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"[object Object]"===Object.prototype.toString.call(e)&&e.constructor===Object}function isBoolean(e){return"boolean"==typeof e}function isArray(e){return Array.isArray(e)}function isString(e){return"string"==typeof e}function isNote(e){return isString(e)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(e)}function createAudioContext(e){return new audioContextConstructor(e)}function createOfflineAudioContext(e,t,i){return new offlineAudioContextConstructor(e,t,i)}const theWindow="object"==typeof self?self:null,hasAudioContext=theWindow&&(theWindow.hasOwnProperty("AudioContext")||theWindow.hasOwnProperty("webkitAudioContext"));function createAudioWorkletNode(e,t,i){return assert(isDefined(audioWorkletNodeConstructor),"This node only works in a secure context (https or localhost)"),new audioWorkletNodeConstructor(e,t,i)}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function __decorate(e,t,i,n){var o,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,i,s):o(t,i))||s);return r>3&&s&&Object.defineProperty(t,i,s),s}function __awaiter$1(e,t,i,n){return new(i||(i=Promise))((function(o,r){function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}))}class Ticker{constructor(e,t,i){this._callback=e,this._type=t,this._updateInterval=i,this._createClock()}_createWorker(){const e=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),t=URL.createObjectURL(e),i=new Worker(t);i.onmessage=this._callback.bind(this),this._worker=i}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(e){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){this._updateInterval=Math.max(e,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*e,1))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function isAudioParam(e){return isAnyAudioParam(e)}function isAudioNode(e){return isAnyAudioNode(e)}function isOfflineAudioContext(e){return isAnyOfflineAudioContext(e)}function isAudioContext(e){return isAnyAudioContext(e)}function isAudioBuffer(e){return e instanceof AudioBuffer}function noCopy(e,t){return"value"===e||isAudioParam(t)||isAudioNode(t)||isAudioBuffer(t)}function deepMerge(e,...t){if(!t.length)return e;const i=t.shift();if(isObject(e)&&isObject(i))for(const t in i)noCopy(t,i[t])?e[t]=i[t]:isObject(i[t])?(e[t]||Object.assign(e,{[t]:{}}),deepMerge(e[t],i[t])):Object.assign(e,{[t]:i[t]});return deepMerge(e,...t)}function deepEquals(e,t){return e.length===t.length&&e.every(((e,i)=>t[i]===e))}function optionsFromArguments(e,t,i=[],n){const o={},r=Array.from(t);if(isObject(r[0])&&n&&!Reflect.has(r[0],n)){Object.keys(r[0]).some((t=>Reflect.has(e,t)))||(deepMerge(o,{[n]:r[0]}),i.splice(i.indexOf(n),1),r.shift())}if(1===r.length&&isObject(r[0]))deepMerge(o,r[0]);else for(let e=0;e<i.length;e++)isDefined(r[e])&&(o[i[e]]=r[e]);return deepMerge(e,o)}function getDefaultsFromInstance(e){return e.constructor.getDefaults()}function defaultArg(e,t){return isUndef(e)?t:e}function omitFromObject(e,t){return t.forEach((t=>{Reflect.has(e,t)&&delete e[t]})),e}
/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class Tone{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||theWindow&&this.toString()===theWindow.TONE_DEBUG_CLASS)&&log(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Tone.version=version;const EPSILON=1e-6;function GT(e,t){return e>t+EPSILON}function GTE(e,t){return GT(e,t)||EQ(e,t)}function LT(e,t){return e+EPSILON<t}function EQ(e,t){return Math.abs(e-t)<EPSILON}function clamp(e,t,i){return Math.max(Math.min(e,i),t)}class Timeline extends Tone{constructor(){super(),this.name="Timeline",this._timeline=[];const e=optionsFromArguments(Timeline.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(assert(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];assert(GTE(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const e=this.length-this.memory;this._timeline.splice(0,e)}return this}remove(e){const t=this._timeline.indexOf(e);return-1!==t&&this._timeline.splice(t,1),this}get(e,t="time"){const i=this._search(e,t);return-1!==i?this._timeline[i]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const i=this._search(e,t);return i+1<this._timeline.length?this._timeline[i+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const i=this._search(e);return i-1>=0?this._timeline[i-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(EQ(this._timeline[t].time,e)){for(let i=t;i>=0&&EQ(this._timeline[i].time,e);i--)t=i;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else 1===this._timeline.length&&GTE(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(0===this._timeline.length)return-1;let i=0;const n=this._timeline.length;let o=n;if(n>0&&this._timeline[n-1][t]<=e)return n-1;for(;i<o;){let n=Math.floor(i+(o-i)/2);const r=this._timeline[n],s=this._timeline[n+1];if(EQ(r[t],e)){for(let i=n;i<this._timeline.length;i++){if(!EQ(this._timeline[i][t],e))break;n=i}return n}if(LT(r[t],e)&&GT(s[t],e))return n;GT(r[t],e)?o=n:i=n+1}return-1}_iterate(e,t=0,i=this._timeline.length-1){this._timeline.slice(t,i+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const i=this._search(e);return-1!==i&&this._iterate(t,0,i),this}forEachAfter(e,t){const i=this._search(e);return this._iterate(t,i+1),this}forEachBetween(e,t,i){let n=this._search(e),o=this._search(t);return-1!==n&&-1!==o?(this._timeline[n].time!==e&&(n+=1),this._timeline[o].time===t&&(o-=1),this._iterate(i,n,o)):-1===n&&this._iterate(i,0,o),this}forEachFrom(e,t){let i=this._search(e);for(;i>=0&&this._timeline[i].time>=e;)i--;return this._iterate(t,i+1),this}forEachAtTime(e,t){const i=this._search(e);if(-1!==i&&EQ(this._timeline[i].time,e)){let n=i;for(let t=i;t>=0&&EQ(this._timeline[t].time,e);t--)n=t;this._iterate((e=>{t(e)}),n,i)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const notifyNewContext=[];function onContextInit(e){notifyNewContext.push(e)}function initializeContext(e){notifyNewContext.forEach((t=>t(e)))}const notifyCloseContext=[];function onContextClose(e){notifyCloseContext.push(e)}function closeContext(e){notifyCloseContext.forEach((t=>t(e)))}class Emitter extends Tone{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach((e=>{isUndef(this._events)&&(this._events={}),this._events.hasOwnProperty(e)||(this._events[e]=[]),this._events[e].push(t)})),this}once(e,t){const i=(...n)=>{t(...n),this.off(e,i)};return this.on(e,i),this}off(e,t){return e.split(/\W+/).forEach((i=>{if(isUndef(this._events)&&(this._events={}),this._events.hasOwnProperty(e))if(isUndef(t))this._events[e]=[];else{const i=this._events[e];for(let e=i.length-1;e>=0;e--)i[e]===t&&i.splice(e,1)}})),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const i=this._events[e].slice(0);for(let e=0,n=i.length;e<n;e++)i[e].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach((t=>{const i=Object.getOwnPropertyDescriptor(Emitter.prototype,t);Object.defineProperty(e.prototype,t,i)}))}dispose(){return super.dispose(),this._events=void 0,this}}class BaseContext extends Emitter{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Context extends BaseContext{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Timeline,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const e=optionsFromArguments(Context.getDefaults(),arguments,["context"]);e.context?this._context=e.context:this._context=createAudioContext({latencyHint:e.latencyHint}),this._ticker=new Ticker(this.emit.bind(this,"tick"),e.clockSource,e.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(e.latencyHint),this.lookAhead=e.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(initializeContext(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,i){return this._context.createBuffer(e,t,i)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,i){return this._context.createPeriodicWave(e,t,i)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){assert(isAudioContext(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(e)}createMediaElementSource(e){assert(isAudioContext(this._context),"Not available if OfflineAudioContext");return this._context.createMediaElementSource(e)}createMediaStreamDestination(){assert(isAudioContext(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){assert(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){assert(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){assert(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){assert(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return createAudioWorkletNode(this.rawContext,e,t)}addAudioWorkletModule(e,t){return __awaiter$1(this,void 0,void 0,(function*(){assert(isDefined(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(t)||this._workletModules.set(t,this.rawContext.audioWorklet.addModule(e)),yield this._workletModules.get(t)}))}workletsAreReady(){return __awaiter$1(this,void 0,void 0,(function*(){const e=[];this._workletModules.forEach((t=>e.push(t))),yield Promise.all(e)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get latencyHint(){return this._latencyHint}_setLatencyHint(e){let t=0;if(this._latencyHint=e,isString(e))switch(e){case"interactive":t=.1;break;case"playback":t=.5;break;case"balanced":t=.25}this.lookAhead=t,this.updateInterval=t/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return isAudioContext(this._context)?this._context.resume():Promise.resolve()}close(){return __awaiter$1(this,void 0,void 0,(function*(){isAudioContext(this._context)&&(yield this._context.close()),this._initialized&&closeContext(this)}))}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),i=t.getChannelData(0);for(let t=0;t<i.length;t++)i[t]=e;const n=this._context.createBufferSource();return n.channelCount=1,n.channelCountMode="explicit",n.buffer=t,n.loop=!0,n.start(0),this._constants.set(e,n),n}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((e=>this._constants[e].disconnect())),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const i=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:i+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach((t=>{t.id===e&&this._timeouts.remove(t)})),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const i=++this._timeoutIds,n=()=>{const o=this.now();this._timeouts.add({callback:()=>{e(),n()},id:i,time:o+t})};return n(),i}}class DummyContext extends BaseContext{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,i){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,i){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e,t){return __awaiter$1(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function readOnly(e,t){isArray(t)?t.forEach((t=>readOnly(e,t))):Object.defineProperty(e,t,{enumerable:!0,writable:!1})}function writable(e,t){isArray(t)?t.forEach((t=>writable(e,t))):Object.defineProperty(e,t,{writable:!0})}const noOp=()=>{};class ToneAudioBuffer extends Tone{constructor(){super(),this.name="ToneAudioBuffer",this.onload=noOp;const e=optionsFromArguments(ToneAudioBuffer.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,e.url&&isAudioBuffer(e.url)||e.url instanceof ToneAudioBuffer?this.set(e.url):isString(e.url)&&this.load(e.url).catch(e.onerror)}static getDefaults(){return{onerror:noOp,onload:noOp,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:getContext().sampleRate}set(e){return e instanceof ToneAudioBuffer?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return __awaiter$1(this,void 0,void 0,(function*(){const t=ToneAudioBuffer.load(e).then((e=>{this.set(e),this.onload(this)}));ToneAudioBuffer.downloads.push(t);try{yield t}finally{const e=ToneAudioBuffer.downloads.indexOf(t);ToneAudioBuffer.downloads.splice(e,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=isArray(e)&&e[0].length>0,i=t?e.length:1,n=t?e[0].length:e.length,o=getContext(),r=o.createBuffer(i,n,o.sampleRate),s=t||1!==i?e:[e];for(let e=0;e<i;e++)r.copyToChannel(s[e],e);return this._buffer=r,this}toMono(e){if(isNumber(e))this.fromArray(this.toArray(e));else{let e=new Float32Array(this.length);const t=this.numberOfChannels;for(let i=0;i<t;i++){const t=this.toArray(i);for(let i=0;i<t.length;i++)e[i]+=t[i]}e=e.map((e=>e/t)),this.fromArray(e)}return this}toArray(e){if(isNumber(e))return this.getChannelData(e);if(1===this.numberOfChannels)return this.toArray(0);{const e=[];for(let t=0;t<this.numberOfChannels;t++)e[t]=this.getChannelData(t);return e}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){const i=Math.floor(e*this.sampleRate),n=Math.floor(t*this.sampleRate);assert(i<n,"The start time must be less than the end time");const o=n-i,r=getContext().createBuffer(this.numberOfChannels,o,this.sampleRate);for(let e=0;e<this.numberOfChannels;e++)r.copyToChannel(this.getChannelData(e).subarray(i,n),e);return new ToneAudioBuffer(r)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return(new ToneAudioBuffer).fromArray(e)}static fromUrl(e){return __awaiter$1(this,void 0,void 0,(function*(){const t=new ToneAudioBuffer;return yield t.load(e)}))}static load(e){return __awaiter$1(this,void 0,void 0,(function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const i=t[1].split("|");let n=i[0];for(const e of i)if(ToneAudioBuffer.supportsType(e)){n=e;break}e=e.replace(t[0],n)}const i=""===ToneAudioBuffer.baseUrl||ToneAudioBuffer.baseUrl.endsWith("/")?ToneAudioBuffer.baseUrl:ToneAudioBuffer.baseUrl+"/",n=yield fetch(i+e);if(!n.ok)throw new Error(`could not load url: ${e}`);const o=yield n.arrayBuffer();return yield getContext().decodeAudioData(o)}))}static supportsType(e){const t=e.split("."),i=t[t.length-1];return""!==document.createElement("audio").canPlayType("audio/"+i)}static loaded(){return __awaiter$1(this,void 0,void 0,(function*(){for(yield Promise.resolve();ToneAudioBuffer.downloads.length;)yield ToneAudioBuffer.downloads[0]}))}}ToneAudioBuffer.baseUrl="",ToneAudioBuffer.downloads=[];class OfflineContext extends Context{constructor(){super({clockSource:"offline",context:isOfflineAudioContext(arguments[0])?arguments[0]:createOfflineAudioContext(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:isOfflineAudioContext(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=isOfflineAudioContext(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return __awaiter$1(this,void 0,void 0,(function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const i=Math.floor(this.sampleRate/128);e&&t%i==0&&(yield new Promise((e=>setTimeout(e,1))))}}))}render(e=!0){return __awaiter$1(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new ToneAudioBuffer(t)}))}close(){return Promise.resolve()}}const dummyContext=new DummyContext;let globalContext=dummyContext;function getContext(){return globalContext===dummyContext&&hasAudioContext&&setContext(new Context),globalContext}function setContext(e){globalContext=isAudioContext(e)?new Context(e):isOfflineAudioContext(e)?new OfflineContext(e):e}if(theWindow&&!theWindow.TONE_SILENCE_LOGGING){let e="v";const t=` * Tone.js ${e}${version} * `;console.log(`%c${t}`,"background: #000; color: #fff")}function dbToGain(e){return Math.pow(10,e/20)}function gainToDb(e){return Math.log(e)/Math.LN10*20}function intervalToFrequencyRatio(e){return Math.pow(2,e/12)}let A4=440;function getA4(){return A4}function setA4(e){A4=e}function ftom(e){return Math.round(ftomf(e))}function ftomf(e){return 69+12*Math.log2(e/A4)}function mtof(e){return A4*Math.pow(2,(e-69)/12)}class TimeBaseClass extends Tone{constructor(e,t,i){super(),this.defaultUnits="s",this._val=t,this._units=i,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const i=parseInt(e,10),n="."===t?1.5:1;return 1===i?this._beatsToUnits(this._getTimeSignature())*n:this._beatsToUnits(4/i)*n},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(3*Math.floor(t)))},regexp:/^(\d+)t$/i},tr:{method:(e,t,i)=>{let n=0;return e&&"0"!==e&&(n+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(n+=this._beatsToUnits(parseFloat(t))),i&&"0"!==i&&(n+=this._beatsToUnits(parseFloat(i)/4)),n},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof TimeBaseClass&&this.fromType(this._val),isUndef(this._val))return this._noArg();if(isString(this._val)&&isUndef(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(isObject(this._val)){let e=0;for(const t in this._val)if(isDefined(this._val[t])){const i=this._val[t];e+=new this.constructor(this.context,t).valueOf()*i}return e}if(isDefined(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}return isString(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class TimeClass extends TimeBaseClass{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new TimeClass(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const i=new this.constructor(this.context,e).valueOf(),n=this.valueOf();return n+(Math.round(n/i)*i-n)*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let e=1;e<9;e++){const i=Math.pow(2,e);t.push(i+"n."),t.push(i+"n"),t.push(i+"t")}t.push("0");let i=t[0],n=new TimeClass(this.context,t[0]).toSeconds();return t.forEach((t=>{const o=new TimeClass(this.context,t).toSeconds();Math.abs(o-e)<Math.abs(n-e)&&(i=t,n=o)})),i}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const i=Math.floor(t/this._getTimeSignature());let n=t%1*4;t=Math.floor(t)%this._getTimeSignature();const o=n.toString();o.length>3&&(n=parseFloat(parseFloat(o).toFixed(3)));return[i,t,n].join(":")}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.round(t*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return ftom(this.toFrequency())}_now(){return this.context.now()}}class FrequencyClass extends TimeClass{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return getA4()}static set A4(e){setA4(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return"midi"===this.defaultUnits?e:FrequencyClass.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(e,t){const i=noteToScaleIndex[e.toLowerCase()]+12*(parseInt(t,10)+1);return"midi"===this.defaultUnits?i:FrequencyClass.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,i){let n=1;return e&&"0"!==e&&(n*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(n*=this._beatsToUnits(parseFloat(t))),i&&"0"!==i&&(n*=this._beatsToUnits(parseFloat(i)/4)),n}}})}transpose(e){return new FrequencyClass(this.context,this.valueOf()*intervalToFrequencyRatio(e))}harmonize(e){return e.map((e=>this.transpose(e)))}toMidi(){return ftom(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/FrequencyClass.A4);let i=Math.round(12*t)+57;const n=Math.floor(i/12);n<0&&(i+=-12*n);return scaleIndexToNote[i%12]+n.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(60*e/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return mtof(e)}static ftom(e){return ftom(e)}}const noteToScaleIndex={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function Frequency(e,t){return new FrequencyClass(getContext(),e,t)}class TransportTimeClass extends TimeClass{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class ToneWithContext extends Tone{constructor(){super();const e=optionsFromArguments(ToneWithContext.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:getContext()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return new TimeClass(this.context,e).toSeconds()}toFrequency(e){return new FrequencyClass(this.context,e).toFrequency()}toTicks(e){return new TransportTimeClass(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach((i=>{isUndef(e[i])&&delete t[i]})),t}get(){const e=getDefaultsFromInstance(this);return Object.keys(e).forEach((t=>{if(Reflect.has(this,t)){const i=this[t];isDefined(i)&&isDefined(i.value)&&isDefined(i.setValueAtTime)?e[t]=i.value:i instanceof ToneWithContext?e[t]=i._getPartialProperties(e[t]):isArray(i)||isNumber(i)||isString(i)||isBoolean(i)?e[t]=i:delete e[t]}})),e}set(e){return Object.keys(e).forEach((t=>{Reflect.has(this,t)&&isDefined(this[t])&&(this[t]&&isDefined(this[t].value)&&isDefined(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof ToneWithContext?this[t].set(e[t]):this[t]=e[t])})),this}}class StateTimeline extends Timeline{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return null!==t?t.state:this._initial}setStateAtTime(e,t,i){return assertRange(t,0),this.add(Object.assign({},i,{state:e,time:t})),this}getLastState(e,t){for(let i=this._search(t);i>=0;i--){const t=this._timeline[i];if(t.state===e)return t}}getNextState(e,t){const i=this._search(t);if(-1!==i)for(let t=i;t<this._timeline.length;t++){const i=this._timeline[t];if(i.state===e)return i}}}class Param extends ToneWithContext{constructor(){super(optionsFromArguments(Param.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const e=optionsFromArguments(Param.getDefaults(),arguments,["param","units","convert"]);for(assert(isDefined(e.param)&&(isAudioParam(e.param)||e.param instanceof Param),"param must be an AudioParam");!isAudioParam(e.param);)e.param=e.param._param;this._swappable=!!isDefined(e.swappable)&&e.swappable,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Timeline(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,isDefined(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return isDefined(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return isDefined(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return isDefined(this.maxValue)&&isDefined(this.minValue)&&assertRange(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?dbToGain(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&"decibels"===this.units?gainToDb(e):e}setValueAtTime(e,t){const i=this.toSeconds(t),n=this._fromType(e);return assert(isFinite(n)&&isFinite(i),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(n),this.log(this.units,"setValueAtTime",e,i),this._events.add({time:i,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,i),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),i=this._events.getAfter(t),n=this._events.get(t);let o=this._initialValue;if(null===n)o=this._initialValue;else if("setTargetAtTime"!==n.type||null!==i&&"setValueAtTime"!==i.type)if(null===i)o=n.value;else if("linearRampToValueAtTime"===i.type||"exponentialRampToValueAtTime"===i.type){let e=n.value;if("setTargetAtTime"===n.type){const t=this._events.getBefore(n.time);e=null===t?this._initialValue:t.value}o="linearRampToValueAtTime"===i.type?this._linearInterpolate(n.time,e,i.time,i.value,t):this._exponentialInterpolate(n.time,e,i.time,i.value,t)}else o=n.value;else{const e=this._events.getBefore(n.time);let i;i=null===e?this._initialValue:e.value,"setTargetAtTime"===n.type&&(o=this._exponentialApproach(n.time,i,n.value,n.constant,t))}return this._toType(o)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),0===this._fromType(t)&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const i=this._fromType(e),n=this.toSeconds(t);return assert(isFinite(i)&&isFinite(n),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(i),this._events.add({time:n,type:"linearRampToValueAtTime",value:i}),this.log(this.units,"linearRampToValueAtTime",e,n),this._param.linearRampToValueAtTime(i,n),this}exponentialRampToValueAtTime(e,t){let i=this._fromType(e);i=EQ(i,0)?this._minOutput:i,this._assertRange(i);const n=this.toSeconds(t);return assert(isFinite(i)&&isFinite(n),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:n,type:"exponentialRampToValueAtTime",value:i}),this.log(this.units,"exponentialRampToValueAtTime",e,n),this._param.exponentialRampToValueAtTime(i,n),this}exponentialRampTo(e,t,i){return i=this.toSeconds(i),this.setRampPoint(i),this.exponentialRampToValueAtTime(e,i+this.toSeconds(t)),this}linearRampTo(e,t,i){return i=this.toSeconds(i),this.setRampPoint(i),this.linearRampToValueAtTime(e,i+this.toSeconds(t)),this}targetRampTo(e,t,i){return i=this.toSeconds(i),this.setRampPoint(i),this.exponentialApproachValueAtTime(e,i,t),this}exponentialApproachValueAtTime(e,t,i){t=this.toSeconds(t),i=this.toSeconds(i);const n=Math.log(i+1)/Math.log(200);return this.setTargetAtTime(e,t,n),this.cancelAndHoldAtTime(t+.9*i),this.linearRampToValueAtTime(e,t+i),this}setTargetAtTime(e,t,i){const n=this._fromType(e);assert(isFinite(i)&&i>0,"timeConstant must be a number greater than 0");const o=this.toSeconds(t);return this._assertRange(n),assert(isFinite(n)&&isFinite(o),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:i,time:o,type:"setTargetAtTime",value:n}),this.log(this.units,"setTargetAtTime",e,o,i),this._param.setTargetAtTime(n,o,i),this}setValueCurveAtTime(e,t,i,n=1){i=this.toSeconds(i),t=this.toSeconds(t);const o=this._fromType(e[0])*n;this.setValueAtTime(this._toType(o),t);const r=i/(e.length-1);for(let i=1;i<e.length;i++){const o=this._fromType(e[i])*n;this.linearRampToValueAtTime(this._toType(o),t+i*r)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return assert(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),i=this._fromType(this.getValueAtTime(t));assert(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+i);const n=this._events.get(t),o=this._events.getAfter(t);return n&&EQ(n.time,t)?o?(this._param.cancelScheduledValues(o.time),this._events.cancel(o.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):o&&(this._param.cancelScheduledValues(o.time),this._events.cancel(o.time),"linearRampToValueAtTime"===o.type?this.linearRampToValueAtTime(this._toType(i),t):"exponentialRampToValueAtTime"===o.type&&this.exponentialRampToValueAtTime(this._toType(i),t)),this._events.add({time:t,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,t),this}rampTo(e,t=.1,i){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(e,t,i):this.linearRampTo(e,t,i),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const i=this._events.get(t);if(i&&"setTargetAtTime"===i.type){const n=this._events.getAfter(i.time),o=n?n.time:t+2,r=(o-t)/10;for(let i=t;i<o;i+=r)e.linearRampToValueAtTime(this.getValueAtTime(i),i)}return this._events.forEachAfter(this.context.currentTime,(t=>{"cancelScheduledValues"===t.type?e.cancelScheduledValues(t.time):"setTargetAtTime"===t.type?e.setTargetAtTime(t.value,t.time,t.constant):e[t.type](t.value,t.time)})),this}setParam(e){assert(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,i,n,o){return i+(t-i)*Math.exp(-(o-e)/n)}_linearInterpolate(e,t,i,n,o){return t+(o-e)/(i-e)*(n-t)}_exponentialInterpolate(e,t,i,n,o){return t*Math.pow(n/t,(o-e)/(i-e))}}class ToneAudioNode extends ToneWithContext{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return isDefined(this.input)?isAudioParam(this.input)||this.input instanceof Param?1:this.input.numberOfInputs:0}get numberOfOutputs(){return isDefined(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return isDefined(e)&&(e instanceof ToneAudioNode||isAudioNode(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach((t=>{t.channelCount=e.channelCount,t.channelCountMode=e.channelCountMode,t.channelInterpretation=e.channelInterpretation}))}_getChannelProperties(){const e=this._getInternalNodes();assert(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,i=0){return connect(this,e,t,i),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return warn("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,i=0){return disconnect(this,e,t,i),this}chain(...e){return connectSeries(this,...e),this}fan(...e){return e.forEach((e=>this.connect(e))),this}dispose(){return super.dispose(),isDefined(this.input)&&(this.input instanceof ToneAudioNode?this.input.dispose():isAudioNode(this.input)&&this.input.disconnect()),isDefined(this.output)&&(this.output instanceof ToneAudioNode?this.output.dispose():isAudioNode(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function connectSeries(...e){const t=e.shift();e.reduce(((e,t)=>(e instanceof ToneAudioNode?e.connect(t):isAudioNode(e)&&connect(e,t),t)),t)}function connect(e,t,i=0,n=0){for(assert(isDefined(e),"Cannot connect from undefined node"),assert(isDefined(t),"Cannot connect to undefined node"),(t instanceof ToneAudioNode||isAudioNode(t))&&assert(t.numberOfInputs>0,"Cannot connect to node with no inputs"),assert(e.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof ToneAudioNode||t instanceof Param;)isDefined(t.input)&&(t=t.input);for(;e instanceof ToneAudioNode;)isDefined(e.output)&&(e=e.output);isAudioParam(t)?e.connect(t,i):e.connect(t,i,n)}function disconnect(e,t,i=0,n=0){if(isDefined(t))for(;t instanceof ToneAudioNode;)t=t.input;for(;!isAudioNode(e);)isDefined(e.output)&&(e=e.output);isAudioParam(t)?e.disconnect(t,i):isAudioNode(t)?e.disconnect(t,i,n):e.disconnect()}class Gain extends ToneAudioNode{constructor(){super(optionsFromArguments(Gain.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const e=optionsFromArguments(Gain.getDefaults(),arguments,["gain","units"]);this.gain=new Param({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),readOnly(this,"gain")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class OneShotSource extends ToneAudioNode{constructor(e){super(e),this.onended=noOp,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Gain({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(e){const t=this.toSeconds(e);return-1!==this._startTime&&t>=this._startTime&&(-1===this._stopTime||t<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:noOp})}_startGain(e,t=1){assert(-1===this._startTime,"Source cannot be started more than once");const i=this.toSeconds(this._fadeIn);return this._startTime=e+i,this._startTime=Math.max(this._startTime,this.context.currentTime),i>0?(this._gainNode.gain.setValueAtTime(0,e),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(t,e+i):this._gainNode.gain.exponentialApproachValueAtTime(t,e,i)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){assert(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.context.currentTime),t>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const e="exponential"===this._curve?2*t:0;this._stopSource(this.now()+e),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==noOp&&(this.onended(this),this.onended=noOp,!this.context.isOffline)){const e=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),assert(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class ToneConstantSource extends OneShotSource{constructor(){super(optionsFromArguments(ToneConstantSource.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const e=optionsFromArguments(ToneConstantSource.getDefaults(),arguments,["offset"]);connect(this._source,this._gainNode),this.offset=new Param({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Signal extends ToneAudioNode{constructor(){super(optionsFromArguments(Signal.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const e=optionsFromArguments(Signal.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new ToneConstantSource({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,i=0){return connectSignal(this,e,t,i),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,i){return this._param.exponentialRampTo(e,t,i),this}linearRampTo(e,t,i){return this._param.linearRampTo(e,t,i),this}targetRampTo(e,t,i){return this._param.targetRampTo(e,t,i),this}exponentialApproachValueAtTime(e,t,i){return this._param.exponentialApproachValueAtTime(e,t,i),this}setTargetAtTime(e,t,i){return this._param.setTargetAtTime(e,t,i),this}setValueCurveAtTime(e,t,i,n){return this._param.setValueCurveAtTime(e,t,i,n),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,i){return this._param.rampTo(e,t,i),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function connectSignal(e,t,i,n){(t instanceof Param||isAudioParam(t)||t instanceof Signal&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof Signal&&(t.overridden=!0)),connect(e,t,i,n)}class TickParam extends Param{constructor(){super(optionsFromArguments(TickParam.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Timeline(1/0),this._multiplier=1;const e=optionsFromArguments(TickParam.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Param.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,i){t=this.toSeconds(t),this.setRampPoint(t);const n=this._fromType(e),o=this._events.get(t),r=Math.round(Math.max(1/i,1));for(let e=0;e<=r;e++){const r=i*e+t,s=this._exponentialApproach(o.time,o.value,n,i,r);this.linearRampToValueAtTime(this._toType(s),r)}return this}setValueAtTime(e,t){const i=this.toSeconds(t);super.setValueAtTime(e,t);const n=this._events.get(i),o=this._events.previousEvent(n),r=this._getTicksUntilEvent(o,i);return n.ticks=Math.max(r,0),this}linearRampToValueAtTime(e,t){const i=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const n=this._events.get(i),o=this._events.previousEvent(n),r=this._getTicksUntilEvent(o,i);return n.ticks=Math.max(r,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const i=this._fromType(e),n=this._events.get(t),o=Math.round(Math.max(10*(t-n.time),1)),r=(t-n.time)/o;for(let e=0;e<=o;e++){const o=r*e+n.time,s=this._exponentialInterpolate(n.time,n.value,t,i,o);this.linearRampToValueAtTime(this._toType(s),o)}return this}_getTicksUntilEvent(e,t){if(null===e)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(isUndef(e.ticks)){const t=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(t,e.time)}const i=this._fromType(this.getValueAtTime(e.time));let n=this._fromType(this.getValueAtTime(t));const o=this._events.get(t);return o&&o.time===t&&"setValueAtTime"===o.type&&(n=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(i+n)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),i=this._events.get(t);return Math.max(this._getTicksUntilEvent(i,t),0)}getDurationOfTicks(e,t){const i=this.toSeconds(t),n=this.getTicksAtTime(t);return this.getTimeOfTick(n+e)-i}getTimeOfTick(e){const t=this._events.get(e,"ticks"),i=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&i&&"linearRampToValueAtTime"===i.type&&t.value!==i.value){const n=this._fromType(this.getValueAtTime(t.time)),o=(this._fromType(this.getValueAtTime(i.time))-n)/(i.time-t.time),r=Math.sqrt(Math.pow(n,2)-2*o*(t.ticks-e)),s=(-n+r)/o,a=(-n-r)/o;return(s>0?s:a)+t.time}return t?0===t.value?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const i=this.toSeconds(t),n=this.toSeconds(e),o=this.getTicksAtTime(i);return this.getTicksAtTime(i+n)-o}_fromType(e){return"bpm"===this.units&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return"bpm"===this.units&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class TickSignal extends Signal{constructor(){super(optionsFromArguments(TickSignal.getDefaults(),arguments,["value"])),this.name="TickSignal";const e=optionsFromArguments(TickSignal.getDefaults(),arguments,["value"]);this.input=this._param=new TickParam({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(Signal.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class TickSource extends ToneWithContext{constructor(){super(optionsFromArguments(TickSource.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new StateTimeline,this._tickOffset=new Timeline;const e=optionsFromArguments(TickSource.getDefaults(),arguments,["frequency"]);this.frequency=new TickSignal({context:this.context,units:e.units,value:e.frequency}),readOnly(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},ToneWithContext.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const i=this.toSeconds(e);return"started"!==this._state.getValueAtTime(i)&&(this._state.setStateAtTime("started",i),isDefined(t)&&this.setTicksAtTime(t,i)),this}stop(e){const t=this.toSeconds(e);if("stopped"===this._state.getValueAtTime(t)){const e=this._state.get(t);e&&e.time>0&&(this._tickOffset.cancel(e.time),this._state.cancel(e.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this}pause(e){const t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&this._state.setStateAtTime("paused",t),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),i=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let o=i,r=0;return this._state.forEachBetween(i.time,t+this.sampleTime,(e=>{let t=o.time;const i=this._tickOffset.get(e.time);i&&i.time>=o.time&&(r=i.ticks,t=i.time),"started"===o.state&&"started"!==e.state&&(r+=this.frequency.getTicksAtTime(e.time)-this.frequency.getTicksAtTime(t)),o=e})),this._state.remove(n),r}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),i=this.frequency.timeToTicks(e,t);this.setTicksAtTime(i,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),i={state:"paused",time:e};this._state.add(i);let n=t,o=0;return this._state.forEachBetween(t.time,e+this.sampleTime,(e=>{let t=n.time;const i=this._tickOffset.get(e.time);i&&i.time>=n.time&&(o=i.seconds,t=i.time),"started"===n.state&&"started"!==e.state&&(o+=e.time-t),n=e})),this._state.remove(i),o}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const i=this._tickOffset.get(t),n=this._state.get(t),o=Math.max(i.time,n.time),r=this.frequency.getTicksAtTime(o)+e-i.ticks;return this.frequency.getTimeOfTick(r)}forEachTickBetween(e,t,i){let n=this._state.get(e);this._state.forEachBetween(e,t,(t=>{n&&"started"===n.state&&"started"!==t.state&&this.forEachTickBetween(Math.max(n.time,e),t.time-this.sampleTime,i),n=t}));let o=null;if(n&&"started"===n.state){const r=Math.max(n.time,e),s=this.frequency.getTicksAtTime(r),a=s-this.frequency.getTicksAtTime(n.time);let l=Math.ceil(a)-a;l=EQ(l,1)?0:l;let c=this.frequency.getTimeOfTick(s+l);for(;c<t;){try{i(c,Math.round(this.getTicksAtTime(c)))}catch(e){o=e;break}c+=this.frequency.getDurationOfTicks(1,c)}}if(o)throw o;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class Clock extends ToneWithContext{constructor(){super(optionsFromArguments(Clock.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=noOp,this._lastUpdate=0,this._state=new StateTimeline("stopped"),this._boundLoop=this._loop.bind(this);const e=optionsFromArguments(Clock.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new TickSource({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,readOnly(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{callback:noOp,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){assertContextRunning(this.context);const i=this.toSeconds(e);return this.log("start",i),"started"!==this._state.getValueAtTime(i)&&(this._state.setStateAtTime("started",i),this._tickSource.start(i,t),i<this._lastUpdate&&this.emit("start",i,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const i=this.toSeconds(t),n=this.getTicksAtTime(i);return this._tickSource.getTimeOfTick(n+e,i)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,(e=>{switch(e.state){case"started":const t=this._tickSource.getTicksAtTime(e.time);this.emit("start",e.time,t);break;case"stopped":0!==e.time&&this.emit("stop",e.time);break;case"paused":this.emit("pause",e.time)}})),this._tickSource.forEachTickBetween(e,t,((e,t)=>{this.callback(e,t)})))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}Emitter.mixin(Clock);class ToneAudioBuffers extends Tone{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=optionsFromArguments(ToneAudioBuffers.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach((t=>{this._loadingCount++;const i=e.urls[t];this.add(t,i,this._bufferLoaded.bind(this,e.onload),e.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:noOp,onload:noOp,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return assert(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,0===this._loadingCount&&e&&e()}get loaded(){return Array.from(this._buffers).every((([e,t])=>t.loaded))}add(e,t,i=noOp,n=noOp){return isString(t)?this._buffers.set(e.toString(),new ToneAudioBuffer(this.baseUrl+t,i,n)):this._buffers.set(e.toString(),new ToneAudioBuffer(t,i,n)),this}dispose(){return super.dispose(),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this}}class MidiClass extends FrequencyClass{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return ftom(super._frequencyToUnits(e))}_ticksToUnits(e){return ftom(super._ticksToUnits(e))}_beatsToUnits(e){return ftom(super._beatsToUnits(e))}_secondsToUnits(e){return ftom(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return mtof(this.toMidi())}transpose(e){return new MidiClass(this.context,this.toMidi()+e)}}function Midi(e,t){return new MidiClass(getContext(),e,t)}class TicksClass extends TransportTimeClass{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Draw extends ToneWithContext{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Timeline,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}onContextInit((e=>{e.draw=new Draw({context:e})})),onContextClose((e=>{e.draw.dispose()}));class IntervalTimeline extends Tone{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){assert(isDefined(e.time),"Events must have a time property"),assert(isDefined(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new IntervalNode(e.time,e.time+e.duration,e);for(null===this._root?this._root=t:this._root.insert(t),this._length++;null!==t;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(null!==this._root){const t=[];this._root.search(e.time,t);for(const i of t)if(i.event===e){this._removeNode(i),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,(e=>this.remove(e))),this}_setRoot(e){this._root=e,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(e,t){null!==e.parent?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(null===e.left&&null===e.right)this._replaceNodeInParent(e,null);else if(null===e.right)this._replaceNodeInParent(e,e.left);else if(null===e.left)this._replaceNodeInParent(e,e.right);else{let t,i=null;if(e.getBalance()>0)if(null===e.left.right)t=e.left,t.right=e.right,i=t;else{for(t=e.left.right;null!==t.right;)t=t.right;t.parent&&(t.parent.right=t.left,i=t.parent,t.left=e.left,t.right=e.right)}else if(null===e.right.left)t=e.right,t.left=e.left,i=t;else{for(t=e.right.left;null!==t.left;)t=t.left;t.parent&&(t.parent.left=t.right,i=t.parent,t.left=e.left,t.right=e.right)}null!==e.parent?e.isLeftChild()?e.parent.left=t:e.parent.right=t:this._setRoot(t),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const t=e.parent,i=e.isLeftChild(),n=e.right;n&&(e.right=n.left,n.left=e),null!==t?i?t.left=n:t.right=n:this._setRoot(n)}_rotateRight(e){const t=e.parent,i=e.isLeftChild(),n=e.left;n&&(e.left=n.right,n.right=e),null!==t?i?t.left=n:t.right=n:this._setRoot(n)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(null!==this._root){const t=[];if(this._root.search(e,t),t.length>0){let e=t[0];for(let i=1;i<t.length;i++)t[i].low>e.low&&(e=t[i]);return e.event}}return null}forEach(e){if(null!==this._root){const t=[];this._root.traverse((e=>t.push(e))),t.forEach((t=>{t.event&&e(t.event)}))}return this}forEachAtTime(e,t){if(null!==this._root){const i=[];this._root.search(e,i),i.forEach((e=>{e.event&&t(e.event)}))}return this}forEachFrom(e,t){if(null!==this._root){const i=[];this._root.searchAfter(e,i),i.forEach((e=>{e.event&&t(e.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((e=>e.dispose())),this._root=null,this}}class IntervalNode{constructor(e,t,i){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=i,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?null===this.left?this.left=e:this.left.insert(e):null===this.right?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(null!==this.left&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),this.low>e||null!==this.right&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),null!==this.left&&this.left.searchAfter(e,t)),null!==this.right&&this.right.searchAfter(e,t)}traverse(e){e(this),null!==this.left&&this.left.traverse(e),null!==this.right&&this.right.traverse(e)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return null!==this.left&&null!==this.right?e=this.left.height-this.right.height:null!==this.left?e=this.left.height+1:null!==this.right&&(e=-(this.right.height+1)),e}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Volume extends ToneAudioNode{constructor(){super(optionsFromArguments(Volume.getDefaults(),arguments,["volume"])),this.name="Volume";const e=optionsFromArguments(Volume.getDefaults(),arguments,["volume"]);this.input=this.output=new Gain({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,readOnly(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Destination extends ToneAudioNode{constructor(){super(optionsFromArguments(Destination.getDefaults(),arguments)),this.name="Destination",this.input=new Volume({context:this.context}),this.output=new Gain({context:this.context}),this.volume=this.input.volume;const e=optionsFromArguments(Destination.getDefaults(),arguments);connectSeries(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),connectSeries(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}onContextInit((e=>{e.destination=new Destination({context:e})})),onContextClose((e=>{e.destination.dispose()}));class TimelineValue extends Tone{constructor(e){super(),this.name="TimelineValue",this._timeline=new Timeline({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class TransportEvent{constructor(e,t){this.id=TransportEvent._eventId++;const i=Object.assign(TransportEvent.getDefaults(),t);this.transport=e,this.callback=i.callback,this._once=i.once,this.time=i.time}static getDefaults(){return{callback:noOp,once:!1,time:0}}invoke(e){this.callback&&(this.callback(e),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}TransportEvent._eventId=0;class TransportRepeatEvent extends TransportEvent{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const i=Object.assign(TransportRepeatEvent.getDefaults(),t);this.duration=new TicksClass(e.context,i.duration).valueOf(),this._interval=new TicksClass(e.context,i.interval).valueOf(),this._nextTick=i.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},TransportEvent.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvents(e){const t=this.transport.getTicksAtTime(e);t>=this.time&&t>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const t=this.transport.getTicksAtTime(e);t>this.time&&(this._nextTick=this.time+Math.ceil((t-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new TicksClass(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class Transport extends ToneWithContext{constructor(){super(optionsFromArguments(Transport.getDefaults(),arguments)),this.name="Transport",this._loop=new TimelineValue(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Timeline,this._repeatedEvents=new IntervalTimeline,this._syncedSignals=[],this._swingAmount=0;const e=optionsFromArguments(Transport.getDefaults(),arguments);this._ppq=e.ppq,this._clock=new Clock({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),readOnly(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(ToneWithContext.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!=0&&t%(2*this._swingTicks)!=0){const i=t%(2*this._swingTicks)/(2*this._swingTicks),n=Math.sin(i*Math.PI)*this._swingAmount;e+=new TicksClass(this.context,2*this._swingTicks/3).toSeconds()*n}this._timeline.forEachAtTime(t,(t=>t.invoke(e)))}schedule(e,t){const i=new TransportEvent(this,{callback:e,time:new TransportTimeClass(this.context,t).toTicks()});return this._addEvent(i,this._timeline)}scheduleRepeat(e,t,i,n=1/0){const o=new TransportRepeatEvent(this,{callback:e,duration:new TimeClass(this.context,n).toTicks(),interval:new TimeClass(this.context,t).toTicks(),time:new TransportTimeClass(this.context,i).toTicks()});return this._addEvent(o,this._repeatedEvents)}scheduleOnce(e,t){const i=new TransportEvent(this,{callback:e,once:!0,time:new TransportTimeClass(this.context,t).toTicks()});return this._addEvent(i,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,(e=>this.clear(e.id))),this._repeatedEvents.forEachFrom(t,(e=>this.clear(e.id))),this}_bindClockEvents(){this._clock.on("start",((e,t)=>{t=new TicksClass(this.context,t).toSeconds(),this.emit("start",e,t)})),this._clock.on("stop",(e=>{this.emit("stop",e)})),this._clock.on("pause",(e=>{this.emit("pause",e)}))}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){let i;return isDefined(t)&&(i=this.toTicks(t)),this._clock.start(e,i),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),"started"!==this._clock.getStateAtTime(e)?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){isArray(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new TimeClass(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new TimeClass(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new TicksClass(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new TicksClass(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),i=this._clock.frequency.timeToTicks(e,t);this.ticks=i}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if("started"===this.state){const i=this._clock.getTicksAtTime(t),n=t+this._clock.frequency.getDurationOfTicks(Math.ceil(i)-i,t);this.emit("stop",n),this._clock.setTicksAtTime(e,n),this.emit("start",n,this._clock.getSecondsAtTime(n))}else this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return Math.round(this._clock.getTicksAtTime(e))}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),"started"!==this.state)return 0;{const t=this.now(),i=e-this.getTicksAtTime(t)%e;return this._clock.nextTickTime(i,t)}}syncSignal(e,t){if(!t){const i=this.now();if(0!==e.getValueAtTime(i)){const n=1/(60/this.bpm.getValueAtTime(i)/this.PPQ);t=e.getValueAtTime(i)/n}else t=0}const i=new Gain(t);return this.bpm.connect(i),i.connect(e._param),this._syncedSignals.push({initial:e.value,ratio:i,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const i=this._syncedSignals[t];i.signal===e&&(i.ratio.dispose(),i.signal.value=i.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),writable(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Emitter.mixin(Transport),onContextInit((e=>{e.transport=new Transport({context:e})})),onContextClose((e=>{e.transport.dispose()}));class Source extends ToneAudioNode{constructor(e){super(e),this.input=void 0,this._state=new StateTimeline("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=noOp,this._syncedStop=noOp,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Volume({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,readOnly(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,onstop:noOp,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,i){let n=isUndef(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(n=this._clampToCurrentTime(n),this._synced||"started"!==this._state.getValueAtTime(n))if(this.log("start",n),this._state.setStateAtTime("started",n),this._synced){const e=this._state.get(n);e&&(e.offset=this.toSeconds(defaultArg(t,0)),e.duration=i?this.toSeconds(i):void 0);const o=this.context.transport.schedule((e=>{this._start(e,t,i)}),n);this._scheduled.push(o),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>n&&this._syncedStart(this.now(),this.context.transport.seconds)}else assertContextRunning(this.context),this._start(n,t,i);else assert(GT(n,this._state.get(n).time),"Start time must be strictly greater than previous start time"),this._state.cancel(n),this._state.setStateAtTime("started",n),this.log("restart",n),this.restart(n,t,i);return this}stop(e){let t=isUndef(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),"started"===this._state.getValueAtTime(t)||isDefined(this._state.getNextState("started",t))){if(this.log("stop",t),this._synced){const e=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(e)}else this._stop(t);this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,i){return e=this.toSeconds(e),"started"===this._state.getValueAtTime(e)&&(this._state.cancel(e),this._restart(e,t,i)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(t>0){const i=this._state.get(t);if(i&&"started"===i.state&&i.time!==t){const n=t-this.toSeconds(i.time);let o;i.duration&&(o=this.toSeconds(i.duration)-n),this._start(e,this.toSeconds(i.offset)+n,o)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));"started"===this._state.getValueAtTime(t)&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((e=>this.context.transport.clear(e))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=noOp,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class ToneBufferSource extends OneShotSource{constructor(){super(optionsFromArguments(ToneBufferSource.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const e=optionsFromArguments(ToneBufferSource.getDefaults(),arguments,["url","onload"]);connect(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Param({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new ToneAudioBuffer(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{url:new ToneAudioBuffer,loop:!1,loopEnd:0,loopStart:0,onload:noOp,onerror:noOp,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,i,n=1){assert(this.buffer.loaded,"buffer is either not set or not loaded");const o=this.toSeconds(e);this._startGain(o,n),t=this.loop?defaultArg(t,this.loopStart):defaultArg(t,0);let r=Math.max(this.toSeconds(t),0);if(this.loop){const e=this.toSeconds(this.loopEnd)||this.buffer.duration,t=this.toSeconds(this.loopStart),i=e-t;GTE(r,e)&&(r=(r-t)%i+t),EQ(r,this.buffer.duration)&&(r=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,LT(r,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(o,r)),isDefined(i)){let e=this.toSeconds(i);e=Math.max(e,0),this.stop(o+e)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class Noise extends Source{constructor(){super(optionsFromArguments(Noise.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const e=optionsFromArguments(Noise.getDefaults(),arguments,["type"]);this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Source.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(assert(e in _noiseBuffers,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,"started"===this.state)){const e=this.now();this._stop(e),this._start(e)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const t=_noiseBuffers[this._type];this._source=new ToneBufferSource({url:t,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(t.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const BUFFER_LENGTH=220500,NUM_CHANNELS=2,_noiseCache={brown:null,pink:null,white:null},_noiseBuffers={get brown(){if(!_noiseCache.brown){const e=[];for(let t=0;t<NUM_CHANNELS;t++){const i=new Float32Array(BUFFER_LENGTH);e[t]=i;let n=0;for(let e=0;e<BUFFER_LENGTH;e++){const t=2*Math.random()-1;i[e]=(n+.02*t)/1.02,n=i[e],i[e]*=3.5}}_noiseCache.brown=(new ToneAudioBuffer).fromArray(e)}return _noiseCache.brown},get pink(){if(!_noiseCache.pink){const e=[];for(let t=0;t<NUM_CHANNELS;t++){const i=new Float32Array(BUFFER_LENGTH);let n,o,r,s,a,l,c;e[t]=i,n=o=r=s=a=l=c=0;for(let e=0;e<BUFFER_LENGTH;e++){const t=2*Math.random()-1;n=.99886*n+.0555179*t,o=.99332*o+.0750759*t,r=.969*r+.153852*t,s=.8665*s+.3104856*t,a=.55*a+.5329522*t,l=-.7616*l-.016898*t,i[e]=n+o+r+s+a+l+c+.5362*t,i[e]*=.11,c=.115926*t}}_noiseCache.pink=(new ToneAudioBuffer).fromArray(e)}return _noiseCache.pink},get white(){if(!_noiseCache.white){const e=[];for(let t=0;t<NUM_CHANNELS;t++){const i=new Float32Array(BUFFER_LENGTH);e[t]=i;for(let e=0;e<BUFFER_LENGTH;e++)i[e]=2*Math.random()-1}_noiseCache.white=(new ToneAudioBuffer).fromArray(e)}return _noiseCache.white}};function generateWaveform(e,t){return __awaiter$1(this,void 0,void 0,(function*(){const i=t/e.context.sampleRate,n=new OfflineContext(1,i,e.context.sampleRate);new e.constructor(Object.assign(e.get(),{frequency:2/i,detune:0,context:n})).toDestination().start(0);return(yield n.render()).getChannelData(0)}))}class ToneOscillatorNode extends OneShotSource{constructor(){super(optionsFromArguments(ToneOscillatorNode.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const e=optionsFromArguments(ToneOscillatorNode.getDefaults(),arguments,["frequency","type"]);connect(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Param({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Param({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),readOnly(this,["frequency","detune"])}static getDefaults(){return Object.assign(OneShotSource.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Oscillator extends Source{constructor(){super(optionsFromArguments(Oscillator.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const e=optionsFromArguments(Oscillator.getDefaults(),arguments,["frequency","type"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),readOnly(this,"frequency"),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),readOnly(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&"custom"!==e.type&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),i=new ToneOscillatorNode({context:this.context,onended:()=>this.onstop(this)});this._oscillator=i,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){return Oscillator._periodicWaveCache.find((e=>e.phase===this._phase&&deepEquals(e.partials,this._partials)))}{const e=Oscillator._periodicWaveCache.find((e=>e.type===this._type&&e.phase===this._phase));return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=-1!==["sine","square","sawtooth","triangle"].indexOf(e);if(0===this._phase&&t)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=e);else{const t=this._getCachedPeriodicWave();if(isDefined(t)){const{partials:e,wave:i}=t;this._wave=i,this._partials=e,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[t,i]=this._getRealImaginary(e,this._phase),n=this.context.createPeriodicWave(t,i);this._wave=n,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),Oscillator._periodicWaveCache.push({imag:i,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:t,type:this._type,wave:this._wave}),Oscillator._periodicWaveCache.length>100&&Oscillator._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&"custom"!==this._type&&"custom"!==e?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){assertRange(e,0);let t=this._type;const i=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(i&&(t=i[1]),"custom"!==this._type)this.type=0===e?t:t+e.toString();else{const t=new Float32Array(e);this._partials.forEach(((e,i)=>t[i]=e)),this._partials=Array.from(t),this.type=this._type}}_getRealImaginary(e,t){let i=2048;const n=new Float32Array(i),o=new Float32Array(i);let r=1;if("custom"===e){if(r=this._partials.length+1,this._partialCount=this._partials.length,i=r,0===this._partials.length)return[n,o]}else{const t=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);t?(r=parseInt(t[2],10)+1,this._partialCount=parseInt(t[2],10),e=t[1],r=Math.max(r,2),i=r):this._partialCount=0,this._partials=[]}for(let s=1;s<i;++s){const i=2/(s*Math.PI);let a;switch(e){case"sine":a=s<=r?1:0,this._partials[s-1]=a;break;case"square":a=1&s?2*i:0,this._partials[s-1]=a;break;case"sawtooth":a=i*(1&s?1:-1),this._partials[s-1]=a;break;case"triangle":a=1&s?i*i*2*(s-1>>1&1?-1:1):0,this._partials[s-1]=a;break;case"custom":a=this._partials[s-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}0!==a?(n[s]=-a*Math.sin(t*s),o[s]=a*Math.cos(t*s)):(n[s]=0,o[s]=0)}return[n,o]}_inverseFFT(e,t,i){let n=0;const o=e.length;for(let r=0;r<o;r++)n+=e[r]*Math.cos(r*i)+t[r]*Math.sin(r*i);return n}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let i=0;const n=2*Math.PI;for(let o=0;o<32;o++)i=Math.max(this._inverseFFT(e,t,o/32*n),i);return clamp(-this._inverseFFT(e,t,this._phase)/i,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(e=1024){return __awaiter$1(this,void 0,void 0,(function*(){return generateWaveform(this,e)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Oscillator._periodicWaveCache=[];class SignalOperator extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(SignalOperator.getDefaults(),arguments,["context"])))}connect(e,t=0,i=0){return connectSignal(this,e,t,i),this}}class WaveShaper extends SignalOperator{constructor(){super(Object.assign(optionsFromArguments(WaveShaper.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const e=optionsFromArguments(WaveShaper.getDefaults(),arguments,["mapping","length"]);isArray(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):isFunction(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(Signal.getDefaults(),{length:1024})}setMap(e,t=1024){const i=new Float32Array(t);for(let n=0,o=t;n<o;n++){const t=n/(o-1)*2-1;i[n]=e(t,n)}return this.curve=i,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){assert(["none","2x","4x"].some((t=>t.includes(e))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class AudioToGain extends SignalOperator{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new WaveShaper({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Multiply extends Signal{constructor(){super(Object.assign(optionsFromArguments(Multiply.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const e=optionsFromArguments(Multiply.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Gain({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Signal.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class AMOscillator extends Source{constructor(){super(optionsFromArguments(AMOscillator.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new AudioToGain({context:this.context}),this._modulationNode=new Gain({context:this.context});const e=optionsFromArguments(AMOscillator.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Oscillator({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Multiply({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),readOnly(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return __awaiter$1(this,void 0,void 0,(function*(){return generateWaveform(this,e)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class FMOscillator extends Source{constructor(){super(optionsFromArguments(FMOscillator.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new Gain({context:this.context,gain:0});const e=optionsFromArguments(FMOscillator.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new Oscillator({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Oscillator({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new Multiply({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new Multiply({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),readOnly(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(e=1024){return __awaiter$1(this,void 0,void 0,(function*(){return generateWaveform(this,e)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class PulseOscillator extends Source{constructor(){super(optionsFromArguments(PulseOscillator.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new Gain({context:this.context,gain:0}),this._thresh=new WaveShaper({context:this.context,mapping:e=>e<=0?-1:1});const e=optionsFromArguments(PulseOscillator.getDefaults(),arguments,["frequency","width"]);this.width=new Signal({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),readOnly(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(e=1024){return __awaiter$1(this,void 0,void 0,(function*(){return generateWaveform(this,e)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class FatOscillator extends Source{constructor(){super(optionsFromArguments(FatOscillator.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const e=optionsFromArguments(FatOscillator.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,readOnly(this,["frequency","detune"])}static getDefaults(){return Object.assign(Oscillator.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach((t=>t.start(e)))}_stop(e){e=this.toSeconds(e),this._forEach((t=>t.stop(e)))}_restart(e){this._forEach((t=>t.restart(e)))}_forEach(e){for(let t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}get type(){return this._type}set type(e){this._type=e,this._forEach((t=>t.type=e))}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const t=-e/2,i=e/(this._oscillators.length-1);this._forEach(((e,n)=>e.detune.value=t+i*n))}}get count(){return this._oscillators.length}set count(e){if(assertRange(e,1),this._oscillators.length!==e){this._forEach((e=>e.dispose())),this._oscillators=[];for(let t=0;t<e;t++){const i=new Oscillator({context:this.context,volume:-6-1.1*e,type:this._type,phase:this._phase+t/e*360,partialCount:this._partialCount,onstop:0===t?()=>this.onstop(this):noOp});"custom"===this.type&&(i.partials=this._partials),this.frequency.connect(i.frequency),this.detune.connect(i.detune),i.detune.overridden=!1,i.connect(this.output),this._oscillators[t]=i}this.spread=this._spread,"started"===this.state&&this._forEach((e=>e.start()))}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach(((e,t)=>e.phase=this._phase+t/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach((t=>t.baseType=e)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach((t=>t.partials=e)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach((t=>t.partialCount=e)),this._type=this._oscillators[0].type}asArray(e=1024){return __awaiter$1(this,void 0,void 0,(function*(){return generateWaveform(this,e)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((e=>e.dispose())),this}}class PWMOscillator extends Source{constructor(){super(optionsFromArguments(PWMOscillator.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new Multiply({context:this.context,value:2});const e=optionsFromArguments(PWMOscillator.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new PulseOscillator({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Oscillator({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),readOnly(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(Source.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(e=1024){return __awaiter$1(this,void 0,void 0,(function*(){return generateWaveform(this,e)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const OmniOscillatorSourceMap={am:AMOscillator,fat:FatOscillator,fm:FMOscillator,oscillator:Oscillator,pulse:PulseOscillator,pwm:PWMOscillator};class OmniOscillator extends Source{constructor(){super(optionsFromArguments(OmniOscillator.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const e=optionsFromArguments(OmniOscillator.getDefaults(),arguments,["frequency","type"]);this.frequency=new Signal({context:this.context,units:"frequency",value:e.frequency}),this.detune=new Signal({context:this.context,units:"cents",value:e.detune}),readOnly(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Oscillator.getDefaults(),FMOscillator.getDefaults(),AMOscillator.getDefaults(),FatOscillator.getDefaults(),PulseOscillator.getDefaults(),PWMOscillator.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some((e=>this._sourceType===e))&&(e=this._sourceType),e+this._oscillator.type}set type(e){"fm"===e.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):"am"===e.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):"fat"===e.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):"pwm"===e?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===e?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const t=OmniOscillatorSourceMap[e],i=this.now();if(this._oscillator){const e=this._oscillator;e.stop(i),this.context.setTimeout((()=>e.dispose()),this.blockTime)}this._oscillator=new t({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(i)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let t="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(t=this._oscillator.type),"fm"===e?this.type="fm"+t:"am"===e?this.type="am"+t:"fat"===e?this.type="fat"+t:"oscillator"===e?this.type=t:"pulse"===e?this.type="pulse":"pwm"===e&&(this.type="pwm")}_getOscType(e,t){return e instanceof OmniOscillatorSourceMap[t]}get baseType(){return this._oscillator.baseType}set baseType(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===e||"pwm"===e||(this._oscillator.baseType=e)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(e){this._getOscType(this._oscillator,"fat")&&isNumber(e)&&(this._oscillator.count=e)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(e){this._getOscType(this._oscillator,"fat")&&isNumber(e)&&(this._oscillator.spread=e)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&isString(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(e=1024){return __awaiter$1(this,void 0,void 0,(function*(){return generateWaveform(this,e)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}function range(e,t=1/0){const i=new WeakMap;return function(n,o){Reflect.defineProperty(n,o,{configurable:!0,enumerable:!0,get:function(){return i.get(this)},set:function(n){assertRange(n,e,t),i.set(this,n)}})}}function timeRange(e,t=1/0){const i=new WeakMap;return function(n,o){Reflect.defineProperty(n,o,{configurable:!0,enumerable:!0,get:function(){return i.get(this)},set:function(n){assertRange(this.toSeconds(n),e,t),i.set(this,n)}})}}class Player extends Source{constructor(){super(optionsFromArguments(Player.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const e=optionsFromArguments(Player.getDefaults(),arguments,["url","onload"]);this._buffer=new ToneAudioBuffer({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(Source.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:noOp,onerror:noOp,playbackRate:1,reverse:!1})}load(e){return __awaiter$1(this,void 0,void 0,(function*(){return yield this._buffer.load(e),this._onload(),this}))}_onload(e=noOp){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,i){return super.start(e,t,i),this}_start(e,t,i){t=this._loop?defaultArg(t,this._loopStart):defaultArg(t,0);const n=this.toSeconds(t),o=i;i=defaultArg(i,Math.max(this._buffer.duration-n,0));let r=this.toSeconds(i);r/=this._playbackRate,e=this.toSeconds(e);const s=new ToneBufferSource({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(e+r),this._state.setStateAtTime("stopped",e+r,{implicitEnd:!0})),this._activeSources.add(s),this._loop&&isUndef(o)?s.start(e,n):s.start(e,n,r-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach((e=>e.stop(t)))}restart(e,t,i){return super.restart(e,t,i),this}_restart(e,t,i){this._stop(e),this._start(e,t,i)}seek(e,t){const i=this.toSeconds(t);if("started"===this._state.getValueAtTime(i)){const t=this.toSeconds(e);this._stop(i),this._start(i,t)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&assertRange(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach((t=>{t.loopStart=e}))}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&assertRange(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach((t=>{t.loopEnd=e}))}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach((t=>{t.loop=e})),e)){const e=this._state.getNextState("stopped",this.now());e&&this._state.cancel(e.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),i=this._state.getNextState("stopped",t);i&&i.implicitEnd&&(this._state.cancel(i.time),this._activeSources.forEach((e=>e.cancelStop()))),this._activeSources.forEach((i=>{i.playbackRate.setValueAtTime(e,t)}))}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((e=>e.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}__decorate([timeRange(0)],Player.prototype,"fadeIn",void 0),__decorate([timeRange(0)],Player.prototype,"fadeOut",void 0);class GainToAudio extends SignalOperator{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new WaveShaper({context:this.context,mapping:e=>2*Math.abs(e)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Envelope extends ToneAudioNode{constructor(){super(optionsFromArguments(Envelope.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Signal({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const e=optionsFromArguments(Envelope.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(isString(e))return e;{let i;for(i in EnvelopeCurves)if(EnvelopeCurves[i][t]===e)return i;return e}}_setCurve(e,t,i){if(isString(i)&&Reflect.has(EnvelopeCurves,i)){const n=EnvelopeCurves[i];isObject(n)?"_decayCurve"!==e&&(this[e]=n[t]):this[e]=n}else{if(!isArray(i)||"_decayCurve"===e)throw new Error("Envelope: invalid curve: "+i);this[e]=i}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._decayCurve}set decayCurve(e){assert(["linear","exponential"].some((t=>t===e)),`Invalid envelope curve: ${e}`),this._decayCurve=e}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const n=this.toSeconds(this.decay),o=this.getValueAtTime(e);if(o>0){i=(1-o)/(1/i)}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if("linear"===this._attackCurve)this._sig.linearRampTo(t,i,e);else if("exponential"===this._attackCurve)this._sig.targetRampTo(t,i,e);else{this._sig.cancelAndHoldAtTime(e);let n=this._attackCurve;for(let e=1;e<n.length;e++)if(n[e-1]<=o&&o<=n[e]){n=this._attackCurve.slice(e),n[0]=o;break}this._sig.setValueCurveAtTime(n,e,i,t)}if(n&&this.sustain<1){const o=t*this.sustain,r=e+i;this.log("decay",r),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(o,n+r):this._sig.exponentialApproachValueAtTime(o,r,n)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const i=this.toSeconds(this.release);i<this.sampleTime?this._sig.setValueAtTime(0,e):"linear"===this._releaseCurve?this._sig.linearRampTo(0,i,e):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,i,e):(assert(isArray(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,i,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,i=1){return t=this.toSeconds(t),this.triggerAttack(t,i),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,i=0){return connectSignal(this,e,t,i),this}asArray(e=1024){return __awaiter$1(this,void 0,void 0,(function*(){const t=e/this.context.sampleRate,i=new OfflineContext(1,t,this.context.sampleRate),n=this.toSeconds(this.attack)+this.toSeconds(this.decay),o=n+this.toSeconds(this.release),r=.1*o,s=o+r,a=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/s,decay:t*this.toSeconds(this.decay)/s,release:t*this.toSeconds(this.release)/s,context:i}));a._sig.toDestination(),a.triggerAttackRelease(t*(n+r)/s,0);return(yield i.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}__decorate([timeRange(0)],Envelope.prototype,"attack",void 0),__decorate([timeRange(0)],Envelope.prototype,"decay",void 0),__decorate([range(0,1)],Envelope.prototype,"sustain",void 0),__decorate([timeRange(0)],Envelope.prototype,"release",void 0);const EnvelopeCurves=(()=>{const e=128;let t,i;const n=[];for(t=0;t<e;t++)n[t]=Math.sin(t/127*(Math.PI/2));const o=[];for(t=0;t<127;t++){i=t/127;const e=Math.sin(i*(2*Math.PI)*6.4-Math.PI/2)+1;o[t]=e/10+.83*i}o[127]=1;const r=[];for(t=0;t<e;t++)r[t]=Math.ceil(t/127*5)/5;const s=[];for(t=0;t<e;t++)i=t/127,s[t]=.5*(1-Math.cos(Math.PI*i));const a=[];for(t=0;t<e;t++){i=t/127;const e=4*Math.pow(i,3)+.2,n=Math.cos(e*Math.PI*2*i);a[t]=Math.abs(n*(1-i))}function l(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=1-e[i];return t}return{bounce:{In:l(a),Out:a},cosine:{In:n,Out:(c=n,c.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:o,Out:l(o)},sine:{In:s,Out:l(s)},step:{In:r,Out:l(r)}};var c})();class Instrument extends ToneAudioNode{constructor(){super(optionsFromArguments(Instrument.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const e=optionsFromArguments(Instrument.getDefaults(),arguments);this._volume=this.output=new Volume({context:this.context,volume:e.volume}),this.volume=this._volume.volume,readOnly(this,"volume")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const i=this["_original_"+e]=this[e];this[e]=(...e)=>{const n=e[t],o=this.context.transport.schedule((n=>{e[t]=n,i.apply(this,e)}),n);this._scheduledEvents.push(o)}}unsync(){return this._scheduledEvents.forEach((e=>this.context.transport.clear(e))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(e,t,i,n){const o=this.toSeconds(i),r=this.toSeconds(t);return this.triggerAttack(e,o,n),this.triggerRelease(o+r),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Monophonic extends Instrument{constructor(){super(optionsFromArguments(Monophonic.getDefaults(),arguments));const e=optionsFromArguments(Monophonic.getDefaults(),arguments);this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(Instrument.getDefaults(),{detune:0,onsilence:noOp,portamento:0})}triggerAttack(e,t,i=1){this.log("triggerAttack",e,t,i);const n=this.toSeconds(t);return this._triggerEnvelopeAttack(n,i),this.setNote(e,n),this}triggerRelease(e){this.log("triggerRelease",e);const t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}setNote(e,t){const i=this.toSeconds(t),n=e instanceof FrequencyClass?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(i)>.05){const e=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(n,e,i)}else this.frequency.setValueAtTime(n,i);return this}}__decorate([timeRange(0)],Monophonic.prototype,"portamento",void 0);class AmplitudeEnvelope extends Envelope{constructor(){super(optionsFromArguments(AmplitudeEnvelope.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Gain({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Synth extends Monophonic{constructor(){super(optionsFromArguments(Synth.getDefaults(),arguments)),this.name="Synth";const e=optionsFromArguments(Synth.getDefaults(),arguments);this.oscillator=new OmniOscillator(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new AmplitudeEnvelope(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),readOnly(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Monophonic.getDefaults(),{envelope:Object.assign(omitFromObject(Envelope.getDefaults(),Object.keys(ToneAudioNode.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(omitFromObject(OmniOscillator.getDefaults(),[...Object.keys(Source.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),0===this.envelope.sustain){const t=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+t+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class MembraneSynth extends Synth{constructor(){super(optionsFromArguments(MembraneSynth.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const e=optionsFromArguments(MembraneSynth.getDefaults(),arguments);this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,readOnly(this,["oscillator","envelope"])}static getDefaults(){return deepMerge(Monophonic.getDefaults(),Synth.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,t){const i=this.toSeconds(t),n=this.toFrequency(e instanceof FrequencyClass?e.toFrequency():e),o=n*this.octaves;return this.oscillator.frequency.setValueAtTime(o,i),this.oscillator.frequency.exponentialRampToValueAtTime(n,i+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}__decorate([range(0)],MembraneSynth.prototype,"octaves",void 0),__decorate([timeRange(0)],MembraneSynth.prototype,"pitchDecay",void 0);const workletContext=new Set;function addToWorklet(e){workletContext.add(e)}function registerProcessor(e,t){const i=`registerProcessor("${e}", ${t})`;workletContext.add(i)}const toneAudioWorkletProcessor='\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n';addToWorklet(toneAudioWorkletProcessor);const singleIOProcess="\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n";addToWorklet(singleIOProcess);const delayLine="\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n";addToWorklet(delayLine);const workletName="feedback-comb-filter",feedbackCombFilter='\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n';registerProcessor(workletName,feedbackCombFilter);class Sampler extends Instrument{constructor(){super(optionsFromArguments(Sampler.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const e=optionsFromArguments(Sampler.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),t={};Object.keys(e.urls).forEach((i=>{const n=parseInt(i,10);if(assert(isNote(i)||isNumber(n)&&isFinite(n),`url key is neither a note or midi pitch: ${i}`),isNote(i)){const n=new FrequencyClass(this.context,i).toMidi();t[n]=e.urls[i]}else isNumber(n)&&isFinite(n)&&(t[n]=e.urls[n])})),this._buffers=new ToneAudioBuffers({urls:t,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(Instrument.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:noOp,onerror:noOp,release:.1,urls:{}})}_findClosest(e){let t=0;for(;t<96;){if(this._buffers.has(e+t))return-t;if(this._buffers.has(e-t))return t;t++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,i=1){return this.log("triggerAttack",e,t,i),Array.isArray(e)||(e=[e]),e.forEach((e=>{const n=ftomf(new FrequencyClass(this.context,e).toFrequency()),o=Math.round(n),r=n-o,s=this._findClosest(o),a=o-s,l=this._buffers.get(a),c=intervalToFrequencyRatio(s+r),d=new ToneBufferSource({url:l,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:c}).connect(this.output);d.start(t,0,l.duration/c,i),isArray(this._activeSources.get(o))||this._activeSources.set(o,[]),this._activeSources.get(o).push(d),d.onended=()=>{if(this._activeSources&&this._activeSources.has(o)){const e=this._activeSources.get(o),t=e.indexOf(d);-1!==t&&e.splice(t,1)}}})),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach((e=>{const i=new FrequencyClass(this.context,e).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const e=this._activeSources.get(i);t=this.toSeconds(t),e.forEach((e=>{e.stop(t)})),this._activeSources.set(i,[])}})),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach((e=>{for(;e.length;){e.shift().stop(t)}})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,i,n=1){const o=this.toSeconds(i);return this.triggerAttack(e,o,n),isArray(t)?(assert(isArray(e),"notes must be an array when duration is array"),e.forEach(((e,i)=>{const n=t[Math.min(i,t.length-1)];this.triggerRelease(e,o+this.toSeconds(n))}))):this.triggerRelease(e,o+this.toSeconds(t)),this}add(e,t,i){if(assert(isNote(e)||isFinite(e),`note must be a pitch or midi: ${e}`),isNote(e)){const n=new FrequencyClass(this.context,e).toMidi();this._buffers.add(n,t,i)}else this._buffers.add(e,t,i);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((e=>{e.forEach((e=>e.dispose()))})),this._activeSources.clear(),this}}__decorate([timeRange(0)],Sampler.prototype,"attack",void 0),__decorate([timeRange(0)],Sampler.prototype,"release",void 0);class CrossFade extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(CrossFade.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new GainToAudio({context:this.context}),this.a=new Gain({context:this.context,gain:0}),this.b=new Gain({context:this.context,gain:0}),this.output=new Gain({context:this.context}),this._internalChannels=[this.a,this.b];const e=optionsFromArguments(CrossFade.getDefaults(),arguments,["fade"]);this.fade=new Signal({context:this.context,units:"normalRange",value:e.fade}),readOnly(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",connect(this._split,this.a.gain,0),connect(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class Effect extends ToneAudioNode{constructor(e){super(e),this.name="Effect",this._dryWet=new CrossFade({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new Gain({context:this.context}),this.effectReturn=new Gain({context:this.context}),this.input=new Gain({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],readOnly(this,"wet")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class Panner extends ToneAudioNode{constructor(){super(Object.assign(optionsFromArguments(Panner.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const e=optionsFromArguments(Panner.getDefaults(),arguments,["pan"]);this.pan=new Param({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",readOnly(this,"pan")}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const workletName$1="bit-crusher",bitCrusherWorklet="\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n";registerProcessor(workletName$1,bitCrusherWorklet);class Merge extends ToneAudioNode{constructor(){super(optionsFromArguments(Merge.getDefaults(),arguments,["channels"])),this.name="Merge";const e=optionsFromArguments(Merge.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Reverb extends Effect{constructor(){super(optionsFromArguments(Reverb.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const e=optionsFromArguments(Reverb.getDefaults(),arguments,["decay"]);this._decay=e.decay,this._preDelay=e.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(Effect.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){assertRange(e=this.toSeconds(e),.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){assertRange(e=this.toSeconds(e),0),this._preDelay=e,this.generate()}generate(){return __awaiter$1(this,void 0,void 0,(function*(){const e=this.ready,t=new OfflineContext(2,this._decay+this._preDelay,this.context.sampleRate),i=new Noise({context:t}),n=new Noise({context:t}),o=new Merge({context:t});i.connect(o,0,0),n.connect(o,0,1);const r=new Gain({context:t}).toDestination();o.connect(r),i.start(0),n.start(0),r.gain.setValueAtTime(0,0),r.gain.setValueAtTime(1,this._preDelay),r.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const s=t.render();return this.ready=s.then(noOp),yield e,this._convolver.buffer=(yield s).get(),this}))}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Solo extends ToneAudioNode{constructor(){super(optionsFromArguments(Solo.getDefaults(),arguments,["solo"])),this.name="Solo";const e=optionsFromArguments(Solo.getDefaults(),arguments,["solo"]);this.input=this.output=new Gain({context:this.context}),Solo._allSolos.has(this.context)||Solo._allSolos.set(this.context,new Set),Solo._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),Solo._allSolos.get(this.context).forEach((e=>e._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){Solo._soloed.has(this.context)||Solo._soloed.set(this.context,new Set),Solo._soloed.get(this.context).add(this)}_removeSolo(){Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).delete(this)}_isSoloed(){return Solo._soloed.has(this.context)&&Solo._soloed.get(this.context).has(this)}_noSolos(){return!Solo._soloed.has(this.context)||Solo._soloed.has(this.context)&&0===Solo._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Solo._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Solo._allSolos=new Map,Solo._soloed=new Map;class PanVol extends ToneAudioNode{constructor(){super(optionsFromArguments(PanVol.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const e=optionsFromArguments(PanVol.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new Panner({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Volume({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,readOnly(this,["pan","volume"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Channel extends ToneAudioNode{constructor(){super(optionsFromArguments(Channel.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const e=optionsFromArguments(Channel.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Solo({solo:e.solo,context:this.context}),this._panVol=this.output=new PanVol({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),readOnly(this,["pan","volume"])}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return Channel.buses.has(e)||Channel.buses.set(e,new Gain({context:this.context})),Channel.buses.get(e)}send(e,t=0){const i=this._getBus(e),n=new Gain({context:this.context,units:"decibels",gain:t});return this.connect(n),n.connect(i),n}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Channel.buses=new Map;class Listener extends ToneAudioNode{constructor(){super(...arguments),this.name="Listener",this.positionX=new Param({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Param({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Param({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Param({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Param({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Param({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Param({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Param({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Param({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}function midiToNote(e){return Frequency(e,"midi").toNote()}function randomBetween(e,t){return Math.random()*(t-e)+e}function getReleasesUrl(e){return`rel${e-20}.[mp3|ogg]`}function getHarmonicsUrl(e){return`harmS${midiToNote(e).replace("#","s")}.[mp3|ogg]`}function getNotesUrl(e,t){return`${midiToNote(e).replace("#","s")}v${t}.[mp3|ogg]`}onContextInit((e=>{e.listener=new Listener({context:e})})),onContextClose((e=>{e.listener.dispose()})),getContext().transport,getContext().destination,getContext().destination,getContext().listener,getContext().draw,getContext();const velocitiesMap={1:[8],2:[6,12],3:[1,7,15],4:[1,5,10,15],5:[1,4,8,12,16],6:[1,3,7,10,13,16],7:[1,3,6,9,11,13,16],8:[1,3,5,7,9,11,13,16],9:[1,3,5,7,9,11,13,15,16],10:[1,2,3,5,7,9,11,13,15,16],11:[1,2,3,5,7,9,11,13,14,15,16],12:[1,2,3,4,5,7,9,11,13,14,15,16],13:[1,2,3,4,5,7,9,11,12,13,14,15,16],14:[1,2,3,4,5,6,7,9,11,12,13,14,15,16],15:[1,2,3,4,5,6,7,9,10,11,12,13,14,15,16],16:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},allNotes=[21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87,90,93,96,99,102,105,108];function getNotesInRange(e,t){return allNotes.filter((i=>e<=i&&i<=t))}const harmonics=[21,24,27,30,33,36,39,42,45,48,51,54,57,60,63,66,69,72,75,78,81,84,87];function getHarmonicsInRange(e,t){return harmonics.filter((i=>e<=i&&i<=t))}function inHarmonicsRange(e){return harmonics[0]<=e&&e<=harmonics[harmonics.length-1]}const __awaiter=(e,t,i,n)=>new(i||(i=Promise))(((o,r)=>{function s(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((e=>{e(t)}))).then(s,a)}l((n=n.apply(e,t||[])).next())}));class PianoComponent extends ToneAudioNode{constructor(e){super(e),this.name="PianoComponent",this.input=void 0,this.output=new Volume({context:this.context}),this._enabled=!1,this.volume=this.output.volume,this._loaded=!1,this.volume.value=e.volume,this._enabled=e.enabled,this.samples=e.samples}get loaded(){return this._loaded}load(){return __awaiter(this,void 0,void 0,(function*(){if(!this._enabled)return Promise.resolve();yield this._internalLoad(),this._loaded=!0}))}}class Harmonics extends PianoComponent{constructor(e){super(e),this._urls={};getHarmonicsInRange(e.minNote,e.maxNote).forEach((e=>this._urls[e]=getHarmonicsUrl(e)))}triggerAttack(e,t,i){this._enabled&&inHarmonicsRange(e)&&this._sampler.triggerAttack(Midi(e).toNote(),t,i*randomBetween(.5,1))}_internalLoad(){return new Promise((e=>{this._sampler=new Sampler({baseUrl:this.samples,onload:e,urls:this._urls}).connect(this.output)}))}}class Keybed extends PianoComponent{constructor(e){super(e),this._urls={};for(let t=e.minNote;t<=e.maxNote;t+=1)this._urls[t]=getReleasesUrl(t)}_internalLoad(){return new Promise((e=>{this._buffers=new ToneAudioBuffers(this._urls,e,this.samples)}))}start(e,t,i){if(this._enabled&&this._buffers.has(e)){new ToneBufferSource({url:this._buffers.get(e),context:this.context}).connect(this.output).start(t,0,void 0,.015*i*randomBetween(.5,1))}}}class Pedal extends PianoComponent{constructor(e){super(e),this._downTime=1/0,this._currentSound=null,this._downTime=1/0}_internalLoad(){return new Promise((e=>{this._buffers=new ToneAudioBuffers({down1:"pedalD1.mp3",down2:"pedalD2.mp3",up1:"pedalU1.mp3",up2:"pedalU2.mp3"},e,this.samples)}))}_squash(e){this._currentSound&&"stopped"!==this._currentSound.state&&this._currentSound.stop(e),this._currentSound=null}_playSample(e,t){this._enabled&&(this._currentSound=new ToneBufferSource({url:this._buffers.get(`${t}${Math.random()>.5?1:2}`),context:this.context,curve:"exponential",fadeIn:.05,fadeOut:.1}).connect(this.output),this._currentSound.start(e,randomBetween(0,.01),void 0,.1*randomBetween(.5,1)))}down(e){this._squash(e),this._downTime=e,this._playSample(e,"down")}up(e){this._squash(e),this._downTime=1/0,this._playSample(e,"up")}isDown(e){return e>=this._downTime}}class PianoString extends ToneAudioNode{constructor(e){super(e),this.name="PianoString",this._urls={},e.notes.forEach((t=>this._urls[t]=getNotesUrl(t,e.velocity))),this.samples=e.samples}load(){return new Promise((e=>{this._sampler=new Sampler({attack:0,baseUrl:this.samples,curve:"exponential",onload:e,release:.4,urls:this._urls,volume:3}),this.output=this._sampler}))}triggerAttack(e,t,i){this._sampler.triggerAttack(e,t,i)}triggerRelease(e,t){this._sampler.triggerRelease(e,t)}}class PianoStrings extends PianoComponent{constructor(e){super(e);const t=getNotesInRange(e.minNote,e.maxNote),i=velocitiesMap[e.velocities].slice();this._strings=i.map((i=>new PianoString(Object.assign(e,{notes:t,velocity:i})))),this._activeNotes=new Map}scale(e,t,i,n,o){return(e-t)/(i-t)*(o-n)+n}triggerAttack(e,t,i){const n=this.scale(i,0,1,-.5,this._strings.length-.51),o=Math.max(Math.round(n),0);let r=1+n-o;1===this._strings.length&&(r=i);const s=this._strings[o];this._activeNotes.has(e)&&this.triggerRelease(e,t),this._activeNotes.set(e,s),s.triggerAttack(Midi(e).toNote(),t,r)}triggerRelease(e,t){this._activeNotes.has(e)&&(this._activeNotes.get(e).triggerRelease(Midi(e).toNote(),t),this._activeNotes.delete(e))}_internalLoad(){return __awaiter(this,void 0,void 0,(function*(){yield Promise.all(this._strings.map((e=>__awaiter(this,void 0,void 0,(function*(){yield e.load(),e.connect(this.output)})))))}))}}class Piano$1 extends ToneAudioNode{constructor(){super(optionsFromArguments(Piano$1.getDefaults(),arguments)),this.name="Piano",this.input=void 0,this.output=new Gain({context:this.context}),this._heldNotes=new Map,this._loaded=!1;const e=optionsFromArguments(Piano$1.getDefaults(),arguments);e.url.endsWith("/")||(e.url+="/"),this.maxPolyphony=e.maxPolyphony,this._heldNotes=new Map,this._sustainedNotes=new Map,this._strings=new PianoStrings({...e,enabled:!0,samples:e.url,volume:e.volume.strings}).connect(this.output),this.strings=this._strings.volume,this._pedal=new Pedal({...e,enabled:e.pedal,samples:e.url,volume:e.volume.pedal}).connect(this.output),this.pedal=this._pedal.volume,this._keybed=new Keybed({...e,enabled:e.release,samples:e.url,volume:e.volume.keybed}).connect(this.output),this.keybed=this._keybed.volume,this._harmonics=new Harmonics({...e,enabled:e.release,samples:e.url,volume:e.volume.harmonics}).connect(this.output),this.harmonics=this._harmonics.volume}static getDefaults(){return Object.assign(ToneAudioNode.getDefaults(),{maxNote:108,minNote:21,pedal:!0,release:!1,url:"https://tambien.github.io/Piano/audio/",velocities:1,maxPolyphony:32,volume:{harmonics:0,keybed:0,pedal:0,strings:0}})}load(){return __awaiter(this,void 0,void 0,(function*(){yield Promise.all([this._strings.load(),this._pedal.load(),this._keybed.load(),this._harmonics.load()]),this._loaded=!0}))}get loaded(){return this._loaded}pedalDown({time:e=this.immediate()}={}){return this.loaded&&(e=this.toSeconds(e),this._pedal.isDown(e)||this._pedal.down(e)),this}pedalUp({time:e=this.immediate()}={}){if(this.loaded){const t=this.toSeconds(e);this._pedal.isDown(t)&&(this._pedal.up(t),this._sustainedNotes.forEach(((e,i)=>{this._heldNotes.has(i)||this._strings.triggerRelease(i,t)})),this._sustainedNotes.clear())}return this}keyDown({note:e,midi:t,time:i=this.immediate(),velocity:n=.8}){return this.loaded&&this.maxPolyphony>this._heldNotes.size+this._sustainedNotes.size?(i=this.toSeconds(i),isString(e)&&(t=Math.round(Midi(e).toMidi())),this._heldNotes.has(t)||(this._heldNotes.set(t,{time:i,velocity:n}),this._strings.triggerAttack(t,i,n))):console.warn("samples not loaded"),this}keyUp({note:e,midi:t,time:i=this.immediate(),velocity:n=.8}){if(this.loaded&&(i=this.toSeconds(i),isString(e)&&(t=Math.round(Midi(e).toMidi())),this._heldNotes.has(t))){const e=this._heldNotes.get(t);this._heldNotes.delete(t);let o=3/Math.max(i-e.time,.1)**.7*e.velocity*n;o=Math.max(o,.4),o=Math.min(o,4),this._pedal.isDown(i)?this._sustainedNotes.has(t)||this._sustainedNotes.set(t,i):(this._strings.triggerRelease(t,i),this._harmonics.triggerAttack(t,i,o)),this._keybed.start(t,i,n)}return this}stopAll(){return this.pedalUp(),this._heldNotes.forEach(((e,t)=>{this.keyUp({midi:t})})),this}}class Piano extends Piano$1{constructor(...e){const t=optionsFromArguments(Piano.getDefaults(),e);super(t),this.options=t,this.reverb=new Reverb({wet:t.reverbWet}).toDestination(),this.connect(this.reverb)}get loadedVelocities(){return this._strings._strings.length}updateReverb(e){this.reverb.dispose(),this.reverb=new Reverb({wet:e}).toDestination(),this.connect(this.reverb)}updateVelocities(e){return this._strings.loaded?(this._strings.dispose(),this._strings=new PianoStrings({...this.options,velocities:e,enabled:!0,samples:this.options.url,volume:this.options.volume.strings}).connect(this.output),this.strings=this._strings.volume,this._strings.load()):Promise.reject({loadedVelocities:this.loadedVelocities})}updateVolumes({strings:e,harmonics:t,pedal:i,keybed:n}){this.strings.value=e,this.harmonics.value=t,this.pedal.value=i,this.keybed.value=n}}if("undefined"!=typeof document){const e=":root{--navigator-width:40px}.notification.svelte-156g60m.svelte-156g60m{border-radius:4px;box-shadow:0 1px 3px 0 rgba(0, 0, 0, 0.12), 0 1px 2px 0 rgba(0, 0, 0, 0.24);display:flex;justify-content:space-between;left:50%;min-width:400px;position:absolute;top:10vh;transform:translate(-50%);z-index:10;border-left-width:6px;color:white}.notification.svelte-156g60m a{color:white;font-weight:bold}.notification.default.svelte-156g60m.svelte-156g60m{background:white;border:1px solid var(--primary-accent);color:black}.notification.default.svelte-156g60m header.svelte-156g60m{color:var(--primary-accent)}.notification.default.svelte-156g60m .close.svelte-156g60m{color:var(--primary-accent);border-left-color:var(--primary-accent-semiopaque)}.notification.success.svelte-156g60m.svelte-156g60m{background:#8bc34a;border:1px solid #6b923e}.notification.error.svelte-156g60m.svelte-156g60m{background:#ff4848;border:1px solid #eb0f0f}section.svelte-156g60m.svelte-156g60m{display:flex;flex-direction:column;padding:0.75em 0.5em;width:100%}header.svelte-156g60m.svelte-156g60m{font-size:1.25em;font-weight:bold;padding:0 0.25em 0.25em;margin-bottom:0.5em}p.svelte-156g60m.svelte-156g60m{margin:0;padding:0.25em}.close.svelte-156g60m.svelte-156g60m{align-items:center;border-left:1px solid rgba(0, 0, 0, 0.2);cursor:pointer;display:flex;font-weight:bold;padding:0 6px}button.svelte-156g60m.svelte-156g60m{background-color:var(--primary-accent);border-radius:0.25em;border:0.1em solid #ffffff;color:#ffffff;cursor:pointer;display:inline-block;margin:0;padding:0.35em 0.8em;transition:all 0.2s;margin-left:1em;margin-right:1em}button.svelte-156g60m.svelte-156g60m:hover{color:var(--primary-accent);border-color:var(--primary-accent);background-color:#ffffff}button.svelte-156g60m.svelte-156g60m:first-of-type{margin-top:1em}.modal-screen.svelte-156g60m.svelte-156g60m{background-color:rgba(0, 0, 0, 0.6);height:100vh;left:0;position:absolute;top:0;width:100vw;z-index:9}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function get_each_context$6(e,t,i){const n=e.slice();return n[2]=t[i],n}function create_if_block$9(e){let t,i,n,o,r,s,a,l,c,d,u=e[0].message+"",h=e[0].modal&&create_if_block_3$1(),p=e[0].title&&create_if_block_2$3(e),m=e[0].actions||[],f=[];for(let t=0;t<m.length;t+=1)f[t]=create_each_block$6(get_each_context$6(e,m,t));let g=!1!==e[0].closable&&create_if_block_1$6();return{c(){h&&h.c(),t=space(),i=element("div"),n=element("section"),p&&p.c(),o=space(),r=element("p"),s=space();for(let e=0;e<f.length;e+=1)f[e].c();a=space(),g&&g.c(),this.h()},l(e){h&&h.l(e),t=claim_space(e),i=claim_element(e,"DIV",{class:!0});var l=children(i);n=claim_element(l,"SECTION",{class:!0});var c=children(n);p&&p.l(c),o=claim_space(c),r=claim_element(c,"P",{class:!0}),children(r).forEach(detach),s=claim_space(c);for(let e=0;e<f.length;e+=1)f[e].l(c);c.forEach(detach),a=claim_space(l),g&&g.l(l),l.forEach(detach),this.h()},h(){attr(r,"class","svelte-156g60m"),attr(n,"class","svelte-156g60m"),attr(i,"class",l="notification "+(e[0].type||"default")+" svelte-156g60m")},m(e,l){h&&h.m(e,l),insert_hydration(e,t,l),insert_hydration(e,i,l),append_hydration(i,n),p&&p.m(n,null),append_hydration(n,o),append_hydration(n,r),r.innerHTML=u,append_hydration(n,s);for(let e=0;e<f.length;e+=1)f[e].m(n,null);append_hydration(i,a),g&&g.m(i,null),d=!0},p(s,a){if((e=s)[0].modal?h?1&a&&transition_in(h,1):(h=create_if_block_3$1(),h.c(),transition_in(h,1),h.m(t.parentNode,t)):h&&(group_outros(),transition_out(h,1,1,(()=>{h=null})),check_outros()),e[0].title?p?p.p(e,a):(p=create_if_block_2$3(e),p.c(),p.m(n,o)):p&&(p.d(1),p=null),(!d||1&a)&&u!==(u=e[0].message+"")&&(r.innerHTML=u),1&a){let t;for(m=e[0].actions||[],t=0;t<m.length;t+=1){const i=get_each_context$6(e,m,t);f[t]?f[t].p(i,a):(f[t]=create_each_block$6(i),f[t].c(),f[t].m(n,null))}for(;t<f.length;t+=1)f[t].d(1);f.length=m.length}!1!==e[0].closable?g?g.p(e,a):(g=create_if_block_1$6(),g.c(),g.m(i,null)):g&&(g.d(1),g=null),(!d||1&a&&l!==(l="notification "+(e[0].type||"default")+" svelte-156g60m"))&&attr(i,"class",l)},i(t){d||(transition_in(h),add_render_callback((()=>{c||(c=create_bidirectional_transition(i,fly,{y:-200,duration:e[0].timeout?1e3:400},!0)),c.run(1)})),d=!0)},o(t){transition_out(h),c||(c=create_bidirectional_transition(i,fly,{y:-200,duration:e[0].timeout?1e3:400},!1)),c.run(0),d=!1},d(e){h&&h.d(e),e&&detach(t),e&&detach(i),p&&p.d(),destroy_each(f,e),g&&g.d(),e&&c&&c.end()}}}function create_if_block_3$1(e){let t,i,n;return{c(){t=element("div"),this.h()},l(e){t=claim_element(e,"DIV",{class:!0}),children(t).forEach(detach),this.h()},h(){attr(t,"class","modal-screen svelte-156g60m")},m(e,i){insert_hydration(e,t,i),n=!0},i(e){n||(add_render_callback((()=>{i||(i=create_bidirectional_transition(t,fade,{},!0)),i.run(1)})),n=!0)},o(e){i||(i=create_bidirectional_transition(t,fade,{},!1)),i.run(0),n=!1},d(e){e&&detach(t),e&&i&&i.end()}}}function create_if_block_2$3(e){let t,i,n=e[0].title+"";return{c(){t=element("header"),i=text(n),this.h()},l(e){t=claim_element(e,"HEADER",{class:!0});var o=children(t);i=claim_text(o,n),o.forEach(detach),this.h()},h(){attr(t,"class","svelte-156g60m")},m(e,n){insert_hydration(e,t,n),append_hydration(t,i)},p(e,t){1&t&&n!==(n=e[0].title+"")&&set_data(i,n)},d(e){e&&detach(t)}}}function create_each_block$6(e){let t,i,n,o,r=e[2].label+"";function s(){return e[1](e[2])}return{c(){t=element("button"),i=text(r),this.h()},l(e){t=claim_element(e,"BUTTON",{class:!0});var n=children(t);i=claim_text(n,r),n.forEach(detach),this.h()},h(){attr(t,"class","svelte-156g60m")},m(e,r){insert_hydration(e,t,r),append_hydration(t,i),n||(o=listen(t,"click",s),n=!0)},p(t,n){e=t,1&n&&r!==(r=e[2].label+"")&&set_data(i,r)},d(e){e&&detach(t),n=!1,o()}}}function create_if_block_1$6(e){let t,i,n,o;return{c(){t=element("div"),i=text("×"),this.h()},l(e){t=claim_element(e,"DIV",{class:!0});var n=children(t);i=claim_text(n,"×"),n.forEach(detach),this.h()},h(){attr(t,"class","close svelte-156g60m")},m(e,r){insert_hydration(e,t,r),append_hydration(t,i),n||(o=listen(t,"click",clearNotification),n=!0)},p:noop,d(e){e&&detach(t),n=!1,o()}}}function create_fragment$o(e){let t,i,n=e[0]&&create_if_block$9(e);return{c(){n&&n.c(),t=empty()},l(e){n&&n.l(e),t=empty()},m(e,o){n&&n.m(e,o),insert_hydration(e,t,o),i=!0},p(e,[i]){e[0]?n?(n.p(e,i),1&i&&transition_in(n,1)):(n=create_if_block$9(e),n.c(),transition_in(n,1),n.m(t.parentNode,t)):n&&(group_outros(),transition_out(n,1,1,(()=>{n=null})),check_outros())},i(e){i||(transition_in(n),i=!0)},o(e){transition_out(n),i=!1},d(e){n&&n.d(e),e&&detach(t)}}}const NotificationStore=writable$1();let timeout;const notify=e=>NotificationStore.set(e),clearNotification=()=>{clearTimeout(timeout),NotificationStore.set()};function instance$p(e,t,i){let n;component_subscribe(e,NotificationStore,(e=>i(0,n=e)));return e.$$.update=()=>{1&e.$$.dirty&&n?.timeout&&(timeout=setTimeout(NotificationStore.set,n?.timeout))},[n,e=>{clearNotification(),e.fn()}]}class Notification extends SvelteComponent{constructor(e){super(),init(this,e,instance$p,create_fragment$o,safe_not_equal,{})}}const SOFT_PEDAL=67,SUSTAIN_PEDAL=64,DEFAULT_NOTE_VELOCITY=50,DEFAULT_TEMPO=60,SOFT_PEDAL_RATIO=.67,HALF_BOUNDARY=66,ACCENT_BUMP=1.5;function instance$o(e,t,i){let n,o,r,s,a,l,c,d,u,h,p,m,f,g,v,_,y,w;component_subscribe(e,sampleVelocities,(e=>i(8,n=e))),component_subscribe(e,reverbWetDry,(e=>i(9,o=e))),component_subscribe(e,sampleVolumes,(e=>i(10,r=e))),component_subscribe(e,rollPedalingOnOff,(e=>i(11,s=e))),component_subscribe(e,useMidiTempoEventsOnOff,(e=>i(12,a=e))),component_subscribe(e,tempoCoefficient,(e=>i(13,l=e))),component_subscribe(e,sustainOnOff,(e=>i(14,c=e))),component_subscribe(e,currentTick,(e=>i(18,d=e))),component_subscribe(e,activeNotes,(e=>i(19,u=e))),component_subscribe(e,trebleVolumeCoefficient,(e=>i(20,h=e))),component_subscribe(e,bassVolumeCoefficient,(e=>i(21,p=e))),component_subscribe(e,volumeCoefficient,(e=>i(22,m=e))),component_subscribe(e,accentOnOff,(e=>i(23,f=e))),component_subscribe(e,softOnOff,(e=>i(24,g=e))),component_subscribe(e,playExpressionsOnOff,(e=>i(25,v=e)));const b=createEventDispatcher(),x=new index.Player,T=new Piano({url:"samples/",velocities:n,release:!0,pedal:!0,maxPolyphony:1/0,volume:{strings:r.strings,harmonics:r.harmonics,pedal:r.pedal,keybed:r.keybed},reverbWet:o}),S=T.load(),k=(e=d)=>{if(x.tracks[0]&&i(0,x.tracks[0].enabled=a,x),x.setTempo((e=>{if(!_||!a)return DEFAULT_TEMPO;let t,i=0;for(;_[i][0]<=e&&([,t]=_[i],i+=1,!(i>=_.length)););return t})(e)*l),y&&s){const e=y.search(d,d);sustainOnOff.set(e.includes(SUSTAIN_PEDAL)),softOnOff.set(e.includes(SOFT_PEDAL))}else sustainOnOff.set(!1),softOnOff.set(!1);w&&activeNotes.reset(w.search(d,d))},C=(e=(()=>{}))=>x.isPlaying()?(x.pause(),Promise.resolve(e()).then((()=>{k(d),x.play()}))):Promise.resolve(e()).then((()=>k(d))).catch((()=>{})),A=()=>{n!==T.loadedVelocities&&C((()=>{const e=T.updateVelocities(n);return b("loading",e),e.then((()=>set_store_value(sampleVelocities,n=T.loadedVelocities,n))).catch((({loadedVelocities:e})=>set_store_value(sampleVelocities,n=e,n))),e}))},E=(e,t)=>{const i=(v&&t||DEFAULT_NOTE_VELOCITY)/100*(g&&SOFT_PEDAL_RATIO||1)*(f&&ACCENT_BUMP||1)*m*(e<HALF_BOUNDARY?p:h);i&&T.keyDown({midi:e,velocity:Math.min(i,1)})},N=e=>T.keyUp({midi:e}),O=()=>{currentTick.reset(),x.stop(),activeNotes.reset(),softOnOff.reset(),sustainOnOff.reset(),accentOnOff.reset()},P=()=>{x.pause(),T.pedalUp(),c&&T.pedalDown(),u.forEach(N)};return x.on("fileLoaded",(()=>{const e=e=>e.replace(/&#(\d+);/g,((e,t)=>String.fromCodePoint(t))).replace(/&#x([A-Za-z0-9]+);/g,((e,t)=>String.fromCodePoint(parseInt(t,16)))),[t,...i]=x.events;rollMetadata.set(Object.fromEntries(t.filter((e=>"Text Event"===e.name)).map((t=>t.string.match(/^@([^:]*):[\t\s]*(.*)$/).slice(1,3).map(e))))),_=(e=>e.filter((e=>"Set Tempo"===e.name)).reduce(((e,{tick:t,data:i})=>(e.map((([,e])=>e)).includes(i)||e.push([t,i]),e)),[]))(t),y=(e=>{const t=new __pika_web_default_export_for_treeshaking__,i=e.filter((e=>"Controller Change"===e.name)),n=e=>{let n=!1;i.filter((({number:t})=>t===e)).forEach((({value:i,tick:o})=>{0===i?(n&&t.insert(n,o,e),n=!1):127===i&&(n||(n=o))}))};return n(SOFT_PEDAL),n(SUSTAIN_PEDAL),t})(i[0]),w=(e=>{const t=new __pika_web_default_export_for_treeshaking__;return e.forEach((e=>{const i={};e.filter((e=>"Note on"===e.name)).forEach((({noteNumber:e,velocity:n,tick:o})=>{0===n?e in i&&(t.insert(i[e],o,e),delete i[e]):e in i||(i[e]=o)}))})),t})(i)})),x.on("playing",(({tick:e})=>{e<=x.totalTicks&&currentTick.set(e)})),x.on("midiEvent",(({name:e,value:t,number:i,noteNumber:n,velocity:o,data:r})=>{"Note on"===e?0===o?(N(n),activeNotes.delete(n)):(E(n,o),activeNotes.add(n)):"Controller Change"===e&&s?i===SUSTAIN_PEDAL?sustainOnOff.set(!!t):i===SOFT_PEDAL&&softOnOff.set(!!t):"Set Tempo"===e&&a&&x.setTempo(r*l)})),x.on("endOfFile",P),e.$$.update=()=>{16384&e.$$.dirty[0]&&(c?T.pedalDown():T.pedalUp()),8192&e.$$.dirty[0]&&C(),4096&e.$$.dirty[0]&&C(),2048&e.$$.dirty[0]&&C(),1024&e.$$.dirty[0]&&T.updateVolumes(r),512&e.$$.dirty[0]&&T.updateReverb(o),256&e.$$.dirty[0]&&(n>4&&n>T.loadedVelocities?notify({modal:!0,title:"Please confirm your choice",message:"Increasing the sample count beyond four will consume large amounts of your system's memory, and could result in crashing the browser or even the entire system.  If you experience issues, please lower the count to four or lower.",closable:!1,actions:[{label:"okay",fn:A},{label:"cancel",fn:()=>set_store_value(sampleVelocities,n=T.loadedVelocities,n)}]}):A())},[x,S,C,E,N,O,P,()=>{d<0&&O(),C(),x.play()},n,o,r,s,a,l,c]}class SamplePlayer extends SvelteComponent{constructor(e){super(),init(this,e,instance$o,null,safe_not_equal,{midiSamplePlayer:0,pianoReady:1,updatePlayer:2,startNote:3,stopNote:4,resetPlayback:5,pausePlayback:6,startPlayback:7},null,[-1,-1])}get midiSamplePlayer(){return this.$$.ctx[0]}get pianoReady(){return this.$$.ctx[1]}get updatePlayer(){return this.$$.ctx[2]}get startNote(){return this.$$.ctx[3]}get stopNote(){return this.$$.ctx[4]}get resetPlayback(){return this.$$.ctx[5]}get pausePlayback(){return this.$$.ctx[6]}get startPlayback(){return this.$$.ctx[7]}}if("undefined"!=typeof document){const e=":root{--navigator-width:40px}small{color:grey;display:inline-block;text-align:right;margin-right:1ch}small:first-child{width:5ch}.place-holder{color:grey}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}if("undefined"!=typeof document){const e=':root{--navigator-width:40px}.filtered-select.svelte-w994nu.svelte-w994nu{height:2.25em;position:relative;width:100%}.filtered-select.svelte-w994nu.svelte-w994nu::after{border:3px solid var(--primary-accent);border-right:0;border-top:0;border-radius:2px;content:" ";display:block;height:0.625em;margin-top:-0.4375em;pointer-events:none;position:absolute;right:1.125em;top:50%;transform:rotate(-45deg);transform-origin:center;width:0.625em}span.input.svelte-w994nu.svelte-w994nu{background:white;cursor:pointer;display:inline-block;height:100%;line-height:calc(2.25em - 10px);overflow:hidden;padding:5px 2.5em 5px 11px;text-overflow:ellipsis;white-space:nowrap;width:100%}div.dropdown.svelte-w994nu.svelte-w994nu{display:none;background:#fff;border:1px solid #999;position:relative;width:-webkit-max-content;width:-moz-max-content;width:max-content;z-index:7}div.dropdown.open.svelte-w994nu.svelte-w994nu{display:block}div.facets.svelte-w994nu.svelte-w994nu{text-align:right;padding:5px 15px;display:flex;align-items:flex-end;gap:15px}div.facets.svelte-w994nu ul.svelte-w994nu{flex:1 0 auto;margin:0;text-align:left;padding:0}div.facets.svelte-w994nu li.svelte-w994nu{display:inline-block;border-radius:6px;background-color:grey;color:white;padding:1px 8px;margin:0 4px;cursor:pointer}div.facets.svelte-w994nu li.active.svelte-w994nu{background-color:var(--primary-accent)}ul.items.svelte-w994nu.svelte-w994nu{margin:0;max-height:calc(15 * (1rem + 10px) + 15px);min-width:100%;overflow-y:auto;padding:10px 0;position:relative;top:0px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:99}ul.items.svelte-w994nu li.svelte-w994nu{color:#333;cursor:pointer;line-height:1;padding:5px 15px;white-space:nowrap;width:100%}ul.items.svelte-w994nu li.selected.svelte-w994nu{background-color:var(--primary-accent);color:#fff}ul.items.svelte-w994nu li.selected.svelte-w994nu mark{color:#fff}ul.items.svelte-w994nu li.svelte-w994nu mark{background-color:unset;color:green;font-weight:700}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function get_each_context$5(e,t,i){const n=e.slice();return n[41]=t[i],n[43]=i,n}function get_each_context_1$1(e,t,i){const n=e.slice();return n[44]=t[i],n}function create_if_block_1$5(e){let t,i=e[4],n=[];for(let t=0;t<i.length;t+=1)n[t]=create_each_block_1$1(get_each_context_1$1(e,i,t));return{c(){t=element("ul");for(let e=0;e<n.length;e+=1)n[e].c();this.h()},l(e){t=claim_element(e,"UL",{class:!0});var i=children(t);for(let e=0;e<n.length;e+=1)n[e].l(i);i.forEach(detach),this.h()},h(){attr(t,"class","svelte-w994nu")},m(e,i){insert_hydration(e,t,i);for(let e=0;e<n.length;e+=1)n[e].m(t,null)},p(e,o){if(8592&o[0]){let r;for(i=e[4],r=0;r<i.length;r+=1){const s=get_each_context_1$1(e,i,r);n[r]?n[r].p(s,o):(n[r]=create_each_block_1$1(s),n[r].c(),n[r].m(t,null))}for(;r<n.length;r+=1)n[r].d(1);n.length=i.length}},d(e){e&&detach(t),destroy_each(n,e)}}}function create_each_block_1$1(e){let t,i,n,o,r,s=e[44]+"";function a(){return e[27](e[44])}return{c(){t=element("li"),i=text(s),n=space(),this.h()},l(e){t=claim_element(e,"LI",{class:!0});var o=children(t);i=claim_text(o,s),n=claim_space(o),o.forEach(detach),this.h()},h(){attr(t,"class","svelte-w994nu"),toggle_class(t,"active",e[44]===e[7])},m(e,s){insert_hydration(e,t,s),append_hydration(t,i),append_hydration(t,n),o||(r=listen(t,"click",a),o=!0)},p(n,o){e=n,16&o[0]&&s!==(s=e[44]+"")&&set_data(i,s),144&o[0]&&toggle_class(t,"active",e[44]===e[7])},d(e){e&&detach(t),o=!1,r()}}}function create_else_block$2(e){let t,i;return{c(){t=element("li"),i=text("No results found"),this.h()},l(e){t=claim_element(e,"LI",{class:!0});var n=children(t);i=claim_text(n,"No results found"),n.forEach(detach),this.h()},h(){attr(t,"class","svelte-w994nu")},m(e,n){insert_hydration(e,t,n),append_hydration(t,i)},p:noop,d(e){e&&detach(t)}}}function create_if_block$8(e){let t,i=e[3],n=[];for(let t=0;t<i.length;t+=1)n[t]=create_each_block$5(get_each_context$5(e,i,t));return{c(){for(let e=0;e<n.length;e+=1)n[e].c();t=empty()},l(e){for(let t=0;t<n.length;t+=1)n[t].l(e);t=empty()},m(e,i){for(let t=0;t<n.length;t+=1)n[t].m(e,i);insert_hydration(e,t,i)},p(e,o){if(131146&o[0]){let r;for(i=e[3],r=0;r<i.length;r+=1){const s=get_each_context$5(e,i,r);n[r]?n[r].p(s,o):(n[r]=create_each_block$5(s),n[r].c(),n[r].m(t.parentNode,t))}for(;r<n.length;r+=1)n[r].d(1);n.length=i.length}},d(e){destroy_each(n,e),e&&detach(t)}}}function create_each_block$5(e){let t,i,n,o,r,s=e[1](e[41].markedUp||e[41].label)+"";function a(){return e[28](e[41])}function l(){return e[29](e[43])}return{c(){t=element("li"),i=new HtmlTagHydration,n=space(),this.h()},l(e){t=claim_element(e,"LI",{class:!0});var o=children(t);i=claim_html_tag(o),n=claim_space(o),o.forEach(detach),this.h()},h(){i.a=n,attr(t,"class","svelte-w994nu"),toggle_class(t,"selected",e[43]===e[6])},m(e,c){insert_hydration(e,t,c),i.m(s,t),append_hydration(t,n),o||(r=[listen(t,"click",a),listen(t,"pointerenter",l)],o=!0)},p(n,o){e=n,10&o[0]&&s!==(s=e[1](e[41].markedUp||e[41].label)+"")&&i.p(s),64&o[0]&&toggle_class(t,"selected",e[43]===e[6])},d(e){e&&detach(t),o=!1,run_all(r)}}}function create_fragment$n(e){let t,i,n,o,r,s,a,l,c,d,u,h,p,m=e[3]?.length+"",f=e[2].length+"",g=e[4]&&create_if_block_1$5(e);function v(e,t){return e[3]?.length?create_if_block$8:create_else_block$2}let _=v(e),y=_(e);return{c(){t=element("div"),i=element("span"),n=space(),o=element("div"),r=element("div"),g&&g.c(),s=text("\n      Filtered: "),a=text(m),l=text(" / "),c=text(f),d=space(),u=element("ul"),y.c(),this.h()},l(e){t=claim_element(e,"DIV",{class:!0});var h=children(t);i=claim_element(h,"SPAN",{class:!0,spellcheck:!0,contenteditable:!0}),children(i).forEach(detach),n=claim_space(h),o=claim_element(h,"DIV",{class:!0});var p=children(o);r=claim_element(p,"DIV",{class:!0});var v=children(r);g&&g.l(v),s=claim_text(v,"\n      Filtered: "),a=claim_text(v,m),l=claim_text(v," / "),c=claim_text(v,f),v.forEach(detach),d=claim_space(p),u=claim_element(p,"UL",{class:!0});var _=children(u);y.l(_),_.forEach(detach),p.forEach(detach),h.forEach(detach),this.h()},h(){attr(i,"class","input svelte-w994nu"),attr(i,"spellcheck","false"),attr(i,"contenteditable","true"),attr(r,"class","facets svelte-w994nu"),attr(u,"class","items svelte-w994nu"),toggle_class(u,"open",e[5]),attr(o,"class","dropdown svelte-w994nu"),toggle_class(o,"open",e[5]),attr(t,"class","filtered-select svelte-w994nu")},m(m,f){insert_hydration(m,t,f),append_hydration(t,i),i.innerHTML=e[0],e[25](i),append_hydration(t,n),append_hydration(t,o),append_hydration(o,r),g&&g.m(r,null),append_hydration(r,s),append_hydration(r,a),append_hydration(r,l),append_hydration(r,c),append_hydration(o,d),append_hydration(o,u),y.m(u,null),e[30](u),e[31](o),h||(p=[listen(window,"click",e[23]),listen(window,"keydown",stop_propagation(e[24])),listen(i,"input",e[12]),listen(i,"focus",e[14]),listen(i,"mousedown",prevent_default(e[16])),listen(i,"keydown",stop_propagation(e[26]))],h=!0)},p(e,t){1&t[0]&&(i.innerHTML=e[0]),e[4]?g?g.p(e,t):(g=create_if_block_1$5(e),g.c(),g.m(r,s)):g&&(g.d(1),g=null),8&t[0]&&m!==(m=e[3]?.length+"")&&set_data(a,m),4&t[0]&&f!==(f=e[2].length+"")&&set_data(c,f),_===(_=v(e))&&y?y.p(e,t):(y.d(1),y=_(e),y&&(y.c(),y.m(u,null))),32&t[0]&&toggle_class(u,"open",e[5]),32&t[0]&&toggle_class(o,"open",e[5])},i:noop,o:noop,d(i){i&&detach(t),e[25](null),g&&g.d(),y.d(),e[30](null),e[31](null),h=!1,run_all(p)}}}function instance$n(e,t,i){let n,o,r,s,a,l,{items:c=[]}=t,{selectedItem:d}=t,{labelFieldName:u}=t,{searchFieldName:h=u}=t,{facetFieldName:p}=t,{placeHolder:m="Select an item..."}=t,{postMarkup:f=(e=>e)}=t,g=[],v=!1,_=-1;const y={"ł":"l","ß":"ss","æ":"ae","ø":"o"},w=new RegExp(Object.keys(y).join("|"),"g"),b=new RegExp(Object.keys(y).filter((e=>y[e].length>1)).join("|"),"gi"),x=e=>e.toLowerCase().replace(/\s+/g," ").replace(w,(e=>y[e])).normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim(),T=(e,t)=>(e.toLowerCase().substring(0,t).match(b)||[]).length,S=(e,t)=>(e.toLowerCase().substring(0,t).match(b)||[]).reduce(((e,t)=>e+(y[t].length-t.length)),0),k=(e,t,i)=>{const n=[],o=[];let r=e;return i.forEach((i=>{let o=-1;for(;(o=t.indexOf(i,o+1))>-1;){const t=o-T(e,o-1),r=o+i.length-S(e,t+i.length-1);n.push([t,r])}})),n.sort(((e,t)=>e[0]-t[0])).forEach((([e,t])=>{const i=o[o.length-1];i&&i[1]>=e?i[1]=Math.max(i[1],t):o.push([e,t])})),o.sort(((e,t)=>t[0]-e[0])).forEach((([e,t])=>{r=`${r.substring(0,e)}<mark>${r.substring(e,t)}</mark>${r.substring(t)}`})),r},C=async e=>{i(6,_=clamp$1(e,0,n.length-1)),await tick();const t=l.querySelector(".selected");if(t){const{top:e,bottom:i}=t.getBoundingClientRect(),{top:n,bottom:o}=l.getBoundingClientRect();i>o&&t.scrollIntoView(!1),e<n&&t.scrollIntoView()}},A=async()=>{if(i(5,v=!0),i(3,n=g),i(6,_=0),i(3,n=g),r&&i(3,n=g.filter((e=>e.item[p]===r))),!s.innerHTML)return;const e=x(s.innerHTML.replace(/<br>|[&/\\#,+()$~%.'":*?<>{}]|nbsp;/g," "));if(e){const t=e.split(" ").slice(0,8);i(3,n=n.filter((e=>t.every((t=>e.searchContent.includes(t))))).map((e=>({...e,markedUp:k(e.label,e.searchContent,t)}))))}},E=async e=>{i(7,r=e===r?void 0:e),A()},N=()=>{s&&i(8,s.innerHTML=d?f(u?d[u]:d):m,s)},O=async()=>{v||(i(5,v=!0),await tick(),i(8,s.innerHTML="",s),i(3,n=r?g.filter((e=>e.item[p]===r)):g),C(c.indexOf(d)),s.focus())},P=()=>{i(5,v=!1),N(),s.blur()},M=(e=n[_])=>{i(18,d=e.item),P()};return e.$$set=e=>{"items"in e&&i(19,c=e.items),"selectedItem"in e&&i(18,d=e.selectedItem),"labelFieldName"in e&&i(20,u=e.labelFieldName),"searchFieldName"in e&&i(21,h=e.searchFieldName),"facetFieldName"in e&&i(22,p=e.facetFieldName),"placeHolder"in e&&i(0,m=e.placeHolder),"postMarkup"in e&&i(1,f=e.postMarkup)},e.$$.update=()=>{524288&e.$$.dirty[0]&&(i(2,g=c.map((e=>({searchContent:x(h?e[h]:e),label:u?e[u]:e,item:e})))),p&&i(4,o=[...new Set(c.map((e=>e[p])))])),262144&e.$$.dirty[0]&&N()},[m,f,g,n,o,v,_,r,s,a,l,C,A,E,O,P,()=>v?P():O(),M,d,c,u,h,p,({target:e})=>{!v||a.contains(e)||s.contains(e)||P()},({key:e})=>{v&&"Escape"===e&&P()},function(e){binding_callbacks[e?"unshift":"push"]((()=>{s=e,i(8,s)}))},({key:e})=>{switch(e){case"ArrowDown":O(),C(_+1);break;case"ArrowUp":O(),C(_-1);break;case"PageDown":O(),C(_+15);break;case"PageUp":O(),C(_-15);break;case"Escape":P();break;case"Enter":M(),P()}},e=>{E(e),s.focus()},e=>M(e),e=>i(6,_=e),function(e){binding_callbacks[e?"unshift":"push"]((()=>{l=e,i(10,l)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{a=e,i(9,a)}))}]}class FilteredSelect extends SvelteComponent{constructor(e){super(),init(this,e,instance$n,create_fragment$n,safe_not_equal,{items:19,selectedItem:18,labelFieldName:20,searchFieldName:21,facetFieldName:22,placeHolder:0,postMarkup:1},null,[-1,-1])}}function create_fragment$m(e){let t,i,n;function o(t){e[2](t)}let r={items:e[1],labelFieldName:"_label",searchFieldName:"_label",facetFieldName:"type",placeHolder:"<span class='place-holder'>Select a roll...</span>",postMarkup:func$1};return void 0!==e[0]&&(r.selectedItem=e[0]),t=new FilteredSelect({props:r}),binding_callbacks.push((()=>bind(t,"selectedItem",o))),{c(){create_component(t.$$.fragment)},l(e){claim_component(t.$$.fragment,e)},m(e,i){mount_component(t,e,i),n=!0},p(e,[n]){const o={};2&n&&(o.items=e[1]),!i&&1&n&&(i=!0,o.selectedItem=e[0],add_flush_callback((()=>i=!1))),t.$set(o)},i(e){n||(transition_in(t.$$.fragment,e),n=!0)},o(e){transition_out(t.$$.fragment,e),n=!1},d(e){destroy_component(t,e)}}}const func$1=e=>e.replace(/^(?:[\d.]|<\/?mark>)+|\[[^\]]+\]$/g,"<small>$&</small>");function instance$m(e,t,i){let{rollListItems:n}=t,{currentRoll:o}=t;return e.$$set=e=>{"rollListItems"in e&&i(1,n=e.rollListItems),"currentRoll"in e&&i(0,o=e.currentRoll)},[o,n,function(e){o=e,i(0,o)}]}class RollSelector extends SvelteComponent{constructor(e){super(),init(this,e,instance$m,create_fragment$m,safe_not_equal,{rollListItems:1,currentRoll:0})}}if("undefined"!=typeof document){const e=":root{--navigator-width:40px}dl.svelte-1f9e132{display:block;overflow:auto;padding:0.5em 1em}dt.svelte-1f9e132{font-family:serif;font-size:1.4em;margin-top:0.5em;margin-bottom:0.2em}dd.svelte-1f9e132:not(:has(a)){text-transform:capitalize}dd.svelte-1f9e132 span{opacity:0.5}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function create_fragment$l(e){let t,i,n,o,r,s,a,l,c,d,u,h,p,m,f,g,v,_,y,w,b,x,T,S,k,C,A,E,N,O,P=(e[0].title||unavailable)+"",M=(e[0].performer||unavailable)+"",R=(e[0].composer||unavailable)+"",I=(e[0].label||unavailable)+"",F=(e[0].PURL||unavailable)+"",D=(e[0].CALLNUM||unavailable)+"";return{c(){t=element("dl"),i=element("dt"),n=text("Title"),o=element("dd"),r=new HtmlTagHydration,s=space(),a=element("dt"),l=text("Performer"),c=element("dd"),d=new HtmlTagHydration,u=space(),h=element("dt"),p=text("Composer"),m=element("dd"),f=new HtmlTagHydration,g=space(),v=element("dt"),_=text("Label"),y=element("dd"),w=new HtmlTagHydration,b=space(),x=element("dt"),T=text("PURL"),S=element("dd"),k=element("a"),A=space(),E=element("dt"),N=text("Call No"),O=element("dd"),this.h()},l(e){t=claim_element(e,"DL",{class:!0});var C=children(t);i=claim_element(C,"DT",{class:!0});var P=children(i);n=claim_text(P,"Title"),P.forEach(detach),o=claim_element(C,"DD",{class:!0});var M=children(o);r=claim_html_tag(M),s=claim_space(M),M.forEach(detach),a=claim_element(C,"DT",{class:!0});var R=children(a);l=claim_text(R,"Performer"),R.forEach(detach),c=claim_element(C,"DD",{class:!0});var I=children(c);d=claim_html_tag(I),u=claim_space(I),I.forEach(detach),h=claim_element(C,"DT",{class:!0});var F=children(h);p=claim_text(F,"Composer"),F.forEach(detach),m=claim_element(C,"DD",{class:!0});var D=children(m);f=claim_html_tag(D),g=claim_space(D),D.forEach(detach),v=claim_element(C,"DT",{class:!0});var j=children(v);_=claim_text(j,"Label"),j.forEach(detach),y=claim_element(C,"DD",{class:!0});var z=children(y);w=claim_html_tag(z),b=claim_space(z),z.forEach(detach),x=claim_element(C,"DT",{class:!0});var L=children(x);T=claim_text(L,"PURL"),L.forEach(detach),S=claim_element(C,"DD",{class:!0});var B=children(S);k=claim_element(B,"A",{href:!0}),children(k).forEach(detach),A=claim_space(B),B.forEach(detach),E=claim_element(C,"DT",{class:!0});var $=children(E);N=claim_text($,"Call No"),$.forEach(detach),O=claim_element(C,"DD",{class:!0}),children(O).forEach(detach),C.forEach(detach),this.h()},h(){attr(i,"class","svelte-1f9e132"),r.a=s,attr(o,"class","svelte-1f9e132"),attr(a,"class","svelte-1f9e132"),d.a=u,attr(c,"class","svelte-1f9e132"),attr(h,"class","svelte-1f9e132"),f.a=g,attr(m,"class","svelte-1f9e132"),attr(v,"class","svelte-1f9e132"),w.a=b,attr(y,"class","svelte-1f9e132"),attr(x,"class","svelte-1f9e132"),attr(k,"href",C=e[0].PURL),attr(S,"class","svelte-1f9e132"),attr(E,"class","svelte-1f9e132"),attr(O,"class","svelte-1f9e132"),attr(t,"class","svelte-1f9e132")},m(e,C){insert_hydration(e,t,C),append_hydration(t,i),append_hydration(i,n),append_hydration(t,o),r.m(P,o),append_hydration(o,s),append_hydration(t,a),append_hydration(a,l),append_hydration(t,c),d.m(M,c),append_hydration(c,u),append_hydration(t,h),append_hydration(h,p),append_hydration(t,m),f.m(R,m),append_hydration(m,g),append_hydration(t,v),append_hydration(v,_),append_hydration(t,y),w.m(I,y),append_hydration(y,b),append_hydration(t,x),append_hydration(x,T),append_hydration(t,S),append_hydration(S,k),k.innerHTML=F,append_hydration(S,A),append_hydration(t,E),append_hydration(E,N),append_hydration(t,O),O.innerHTML=D},p(e,[t]){1&t&&P!==(P=(e[0].title||unavailable)+"")&&r.p(P),1&t&&M!==(M=(e[0].performer||unavailable)+"")&&d.p(M),1&t&&R!==(R=(e[0].composer||unavailable)+"")&&f.p(R),1&t&&I!==(I=(e[0].label||unavailable)+"")&&w.p(I),1&t&&F!==(F=(e[0].PURL||unavailable)+"")&&(k.innerHTML=F),1&t&&C!==(C=e[0].PURL)&&attr(k,"href",C),1&t&&D!==(D=(e[0].CALLNUM||unavailable)+"")&&(O.innerHTML=D)},i:noop,o:noop,d(e){e&&detach(t)}}}const unavailable="<span>Unavailable</span>";function instance$l(e,t,i){let{metadata:n}=t;return e.$$set=e=>{"metadata"in e&&i(0,n=e.metadata)},[n]}class RollDetails extends SvelteComponent{constructor(e){super(),init(this,e,instance$l,create_fragment$l,safe_not_equal,{metadata:0})}}if("undefined"!=typeof document){const e=':root{--navigator-width:40px}#roll-viewer.svelte-zrkad9{position:relative;height:100%;width:100%}#roll-viewer.svelte-zrkad9::before{background:linear-gradient(180deg, var(--primary-accent-semiopaque) calc(50% - 1px), var(--primary-accent) 50%, var(--primary-accent-semiopaque) calc(50% + 1px));content:"";display:block;height:var(--trackerbar-height);pointer-events:none;position:absolute;top:calc(50% - var(--trackerbar-height) / 2);width:calc(100% - var(--navigator-width));z-index:1}#roll-viewer.svelte-zrkad9::after{background:linear-gradient(var(--background-angle), var(--background-darker) 0%, var(--background-color) 25%, var(--background-color) 75%, var(--background-darker) 100%);background-attachment:fixed;background-position:center;bottom:0;content:" ";left:0;mix-blend-mode:multiply;pointer-events:none;position:absolute;right:0;top:0}#roll-viewer.svelte-zrkad9 canvas{background:white !important}#roll-viewer.svelte-zrkad9 .openseadragon-canvas:focus{outline:none}#roll-viewer.svelte-zrkad9 .displayregion::after{content:attr(data-label);display:block;position:absolute;width:100%;font-size:16px;text-align:center;padding:8px 0;background:linear-gradient(180deg, transparent 0%, white 20%, white 80%, transparent 100%);top:calc(100% + 2px);transition:margin 0.5s ease}#roll-viewer.svelte-zrkad9 .displayregion.label-above::after{margin-top:-100%;top:0}.roll-loading.svelte-zrkad9{background:rgba(0, 0, 0, 0.4);border-radius:4px;color:white;left:1em;padding:4px 8px;position:absolute;top:1em;z-index:1}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(e,t,i){return e(i={path:t,exports:{},require:function(e,t){return commonjsRequire(e,null==t?i.path:t)}},i.exports),i.exports}function commonjsRequire(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var openseadragon=createCommonjsModule((function(module){
//! openseadragon 2.4.2
//! Built on 2020-03-05
//! Git commit: v2.4.2-0-c450749
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function OpenSeadragon(e){return new OpenSeadragon.Viewer(e)}var root,factory,$,fullScreenApi;!function(e){e.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var t,i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},n=Object.prototype.toString,o=Object.prototype.hasOwnProperty;e.isFunction=function(t){return"function"===e.type(t)},e.isArray=Array.isArray||function(t){return"array"===e.type(t)},e.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},e.type=function(e){return null==e?String(e):i[n.call(e)]||"object"},e.isPlainObject=function(t){if(!t||"object"!==OpenSeadragon.type(t)||t.nodeType||e.isWindow(t))return!1;if(t.constructor&&!o.call(t,"constructor")&&!o.call(t.constructor.prototype,"isPrototypeOf"))return!1;var i;for(var n in t)i=n;return void 0===i||o.call(t,i)},e.isEmptyObject=function(e){for(var t in e)return!1;return!0},e.freezeObject=function(t){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(e){return e},e.freezeObject(t)},e.supportsCanvas=(t=document.createElement("canvas"),!(!e.isFunction(t.getContext)||!t.getContext("2d"))),e.isCanvasTainted=function(e){var t=!1;try{e.getContext("2d").getImageData(0,0,1,1)}catch(e){t=!0}return t},e.pixelDensityRatio=function(){if(e.supportsCanvas){var t=document.createElement("canvas").getContext("2d"),i=window.devicePixelRatio||1,n=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return Math.max(i,1)/n}return 1}()}(OpenSeadragon),function($){$.extend=function(){var e,t,i,n,o,r,s=arguments[0]||{},a=arguments.length,l=!1,c=1;for("boolean"==typeof s&&(l=s,s=arguments[1]||{},c=2),"object"==typeof s||OpenSeadragon.isFunction(s)||(s={}),a===c&&(s=this,--c);c<a;c++)if(null!==(e=arguments[c])||void 0!==e)for(t in e)i=s[t],s!==(n=e[t])&&(l&&n&&(OpenSeadragon.isPlainObject(n)||(o=OpenSeadragon.isArray(n)))?(o?(o=!1,r=i&&OpenSeadragon.isArray(i)?i:[]):r=i&&OpenSeadragon.isPlainObject(i)?i:{},s[t]=OpenSeadragon.extend(l,r,n)):void 0!==n&&(s[t]=n));return s};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var e=navigator.userAgent;return"string"==typeof e&&(-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")||-1!==e.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(e,t){return function(){var i=arguments;return void 0===i&&(i=[]),t.apply(e,i)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},getElementPosition:function(e){var t,i,n=new $.Point;for(i=getOffsetParent(e=$.getElement(e),t="fixed"==$.getElementStyle(e).position);i;)n.x+=e.offsetLeft,n.y+=e.offsetTop,t&&(n=n.plus($.getPageScroll())),i=getOffsetParent(e=i,t="fixed"==$.getElementStyle(e).position);return n},getElementOffset:function(e){var t,i,n=(e=$.getElement(e))&&e.ownerDocument,o={top:0,left:0};return n?(t=n.documentElement,void 0!==e.getBoundingClientRect&&(o=e.getBoundingClientRect()),i=n==n.window?n:9===n.nodeType&&(n.defaultView||n.parentWindow),new $.Point(o.left+(i.pageXOffset||t.scrollLeft)-(t.clientLeft||0),o.top+(i.pageYOffset||t.scrollTop)-(t.clientTop||0))):new $.Point},getElementSize:function(e){return e=$.getElement(e),new $.Point(e.clientWidth,e.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(e){return(e=$.getElement(e)).currentStyle}:function(e){return e=$.getElement(e),window.getComputedStyle(e,"")},getCssPropertyWithVendorPrefix:function(e){var t={};return $.getCssPropertyWithVendorPrefix=function(e){if(void 0!==t[e])return t[e];var i=document.createElement("div").style,n=null;if(void 0!==i[e])n=e;else for(var o=["Webkit","Moz","MS","O","webkit","moz","ms","o"],r=$.capitalizeFirstLetter(e),s=0;s<o.length;s++){var a=o[s]+r;if(void 0!==i[a]){n=a;break}}return t[e]=n,n},$.getCssPropertyWithVendorPrefix(e)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},positiveModulo:function(e,t){var i=e%t;return i<0&&(i+=t),i},pointInElement:function(e,t){e=$.getElement(e);var i=$.getElementOffset(e),n=$.getElementSize(e);return t.x>=i.x&&t.x<i.x+n.x&&t.y<i.y+n.y&&t.y>=i.y},getEvent:function(e){return $.getEvent=e?function(e){return e}:function(){return window.event},$.getEvent(e)},getMousePosition:function(e){if("number"==typeof e.pageX)$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.pageX,t.y=e.pageY,t};else{if("number"!=typeof e.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop,t}}return $.getMousePosition(e)},getPageScroll:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(t.scrollLeft||t.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!e.scrollLeft&&!e.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(e){if(void 0!==window.scrollTo)$.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var t=$.getPageScroll();if(t.x===e.x&&t.y===e.y)return;document.body.scrollLeft=e.x,document.body.scrollTop=e.y;var i=$.getPageScroll();if(i.x!==t.x&&i.y!==t.y)return void($.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y});if(document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y,(i=$.getPageScroll()).x!==t.x&&i.y!==t.y)return void($.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y});$.setPageScroll=function(e){}}return $.setPageScroll(e)},getWindowSize:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(e.clientWidth||e.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!t.clientWidth&&!t.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(e){e=$.getElement(e);var t=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(t[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(t[1].style,{display:"table-row"}),$.extend(t[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),t[0].appendChild(t[1]),t[1].appendChild(t[2]),t[2].appendChild(e),t[0]},makeNeutralElement:function(e){var t=document.createElement(e),i=t.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",t},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(e){return $.makeTransparentImage=function(e){var t=$.makeNeutralElement("img");return t.src=e,t},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(e){var t=$.makeNeutralElement("img"),i=null;return(i=$.makeNeutralElement("span")).style.display="inline-block",t.onload=function(){i.style.width=i.style.width||t.width+"px",i.style.height=i.style.height||t.height+"px",t.onload=null,t=null},t.src=e,i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"', sizingMethod='scale')",i}),$.makeTransparentImage(e)},setElementOpacity:function(e,t,i){var n;e=$.getElement(e),i&&!$.Browser.alpha&&(t=Math.round(t)),$.Browser.opacity?e.style.opacity=t<1?t:"":t<1?(n="alpha(opacity="+Math.round(100*t)+")",e.style.filter=n):e.style.filter=""},setElementTouchActionNone:function(e){void 0!==(e=$.getElement(e)).style.touchAction?e.style.touchAction="none":void 0!==e.style.msTouchAction&&(e.style.msTouchAction="none")},addClass:function(e,t){(e=$.getElement(e)).className?-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=" "+t):e.className=t},indexOf:function(e,t,i){return Array.prototype.indexOf?this.indexOf=function(e,t,i){return e.indexOf(t,i)}:this.indexOf=function(e,t,i){var n,o,r=i||0;if(!e)throw new TypeError;if(0===(o=e.length)||r>=o)return-1;for(r<0&&(r=o-Math.abs(r)),n=r;n<o;n++)if(e[n]===t)return n;return-1},this.indexOf(e,t,i)},removeClass:function(e,t){var i,n,o=[];for(i=(e=$.getElement(e)).className.split(/\s+/),n=0;n<i.length;n++)i[n]&&i[n]!==t&&o.push(i[n]);e.className=o.join(" ")},addEvent:function(){if(window.addEventListener)return function(e,t,i,n){(e=$.getElement(e)).addEventListener(t,i,n)};if(window.attachEvent)return function(e,t,i,n){(e=$.getElement(e)).attachEvent("on"+t,i)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(e,t,i,n){(e=$.getElement(e)).removeEventListener(t,i,n)};if(window.detachEvent)return function(e,t,i,n){(e=$.getElement(e)).detachEvent("on"+t,i)};throw new Error("No known event model.")}(),cancelEvent:function(e){(e=$.getEvent(e)).preventDefault?$.cancelEvent=function(e){e.preventDefault()}:$.cancelEvent=function(e){(e=$.getEvent(e)).cancel=!0,e.returnValue=!1},$.cancelEvent(e)},stopEvent:function(e){(e=$.getEvent(e)).stopPropagation?$.stopEvent=function(e){e.stopPropagation()}:$.stopEvent=function(e){(e=$.getEvent(e)).cancelBubble=!0},$.stopEvent(e)},createCallback:function(e,t){var i,n=[];for(i=2;i<arguments.length;i++)n.push(arguments[i]);return function(){var i,o=n.concat([]);for(i=0;i<arguments.length;i++)o.push(arguments[i]);return t.apply(e,o)}},getUrlParameter:function(e){var t=URLPARAMS[e];return t||null},getUrlProtocol:function(e){var t=e.match(/^([a-z]+:)\/\//i);return null===t?window.location.protocol:t[1].toLowerCase()},createAjaxRequest:function(e){var t;try{t=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}if(t)window.XMLHttpRequest?$.createAjaxRequest=function(e){return e?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(e)},makeAjaxRequest:function(e,t,i){var n,o,r;$.isPlainObject(e)&&(t=e.success,i=e.error,n=e.withCredentials,o=e.headers,r=e.responseType||null,e=e.url);var s=$.getUrlProtocol(e),a=$.createAjaxRequest("file:"===s);if(!$.isFunction(t))throw new Error("makeAjaxRequest requires a success callback");a.onreadystatechange=function(){4==a.readyState&&(a.onreadystatechange=function(){},a.status>=200&&a.status<300||0===a.status&&"http:"!==s&&"https:"!==s?t(a):($.console.log("AJAX request returned %d: %s",a.status,e),$.isFunction(i)&&i(a)))};try{if(a.open("GET",e,!0),r&&(a.responseType=r),o)for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&o[l]&&a.setRequestHeader(l,o[l]);n&&(a.withCredentials=!0),a.send(null)}catch(n){var c=n.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&void 0!==n.number&&-2147024891==n.number&&(c+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",n.name,c),a.onreadystatechange=function(){},window.XDomainRequest){var d=new window.XDomainRequest;if(d){d.onload=function(e){$.isFunction(t)&&t({responseText:d.responseText,status:200,statusText:"OK"})},d.onerror=function(e){$.isFunction(i)&&i({responseText:d.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{d.open("GET",e),d.send()}catch(e){$.isFunction(i)&&i(a,n)}}}else $.isFunction(i)&&i(a,n)}return a},jsonp:function(e){var t,i=e.url,n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,o=e.callbackName||"openseadragon"+$.now(),r=window[o],s="$1"+o+"$2",a=e.param||"callback",l=e.callback;i=i.replace(/(\=)\?(&|$)|\?\?/i,s),i+=(/\?/.test(i)?"&":"?")+a+"="+o,window[o]=function(e){if(r)window[o]=r;else try{delete window[o]}catch(e){}l&&$.isFunction(l)&&l(e)},t=document.createElement("script"),void 0===e.async&&!1===e.async||(t.async="async"),e.scriptCharset&&(t.charset=e.scriptCharset),t.src=i,t.onload=t.onreadystatechange=function(e,i){(i||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,n&&t.parentNode&&n.removeChild(t),t=void 0)},n.insertBefore(t,n.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(e){if(window.DOMParser)$.parseXml=function(e){return(new DOMParser).parseFromString(e,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(e){var t=null;return(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e),t}}return $.parseXml(e)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(e){return!!FILEFORMATS[(e=e||"").toLowerCase()]}});var nullfunction=function(e){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};function getOffsetParent(e,t){return t&&e!=document.body?document.body:e.offsetParent}!function(){var e=navigator.appVersion,t=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(t.substring(t.indexOf("MSIE")+5,t.indexOf(";",t.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(t.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(t.substring(t.indexOf("Firefox")+8))):t.indexOf("Safari")>=0?($.Browser.vendor=t.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(t.substring(t.substring(0,t.indexOf("Safari")).lastIndexOf("/")+1,t.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(t)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(e)}var i,n,o,r=window.location.search.substring(1).split("&");for(o=0;o<r.length;o++)if((n=(i=r[o]).indexOf("="))>0){var s=i.substring(0,n),a=i.substring(n+1);try{URLPARAMS[s]=decodeURIComponent(a)}catch(e){$.console.error("Ignoring malformed URL parameter: %s=%s",s,a)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}(),function(e){var t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame,i=e.cancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelAnimationFrame||e.msCancelAnimationFrame;if(t&&i)$.requestAnimationFrame=function(){return t.apply(e,arguments)},$.cancelAnimationFrame=function(){return i.apply(e,arguments)};else{var n,o=[],r=[],s=0;$.requestAnimationFrame=function(e){return o.push([++s,e]),n||(n=setInterval((function(){if(o.length){var e=$.now(),t=r;for(r=o,o=t;r.length;)r.shift()[1](e)}else clearInterval(n),n=void 0}),20)),s},$.cancelAnimationFrame=function(e){var t,i;for(t=0,i=o.length;t<i;t+=1)if(o[t][0]===e)return void o.splice(t,1);for(t=0,i=r.length;t<i;t+=1)if(r[t][0]===e)return void r.splice(t,1)}}}(window)}(OpenSeadragon),root=commonjsGlobal,factory=function(){return OpenSeadragon},module.exports?module.exports=factory():root.OpenSeadragon=factory(),$=OpenSeadragon,fullScreenApi={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""},document.exitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.fullscreenElement},fullScreenApi.requestFullScreen=function(e){return e.requestFullscreen()},fullScreenApi.exitFullScreen=function(){document.exitFullscreen()},fullScreenApi.fullScreenEventName="fullscreenchange",fullScreenApi.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.msFullscreenElement},fullScreenApi.requestFullScreen=function(e){return e.msRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.msExitFullscreen()},fullScreenApi.fullScreenEventName="MSFullscreenChange",fullScreenApi.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitFullscreenElement},fullScreenApi.requestFullScreen=function(e){return e.webkitRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.webkitExitFullscreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},fullScreenApi.requestFullScreen=function(e){return e.webkitRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.webkitCancelFullScreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.mozFullScreenElement},fullScreenApi.requestFullScreen=function(e){return e.mozRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.mozCancelFullScreen()},fullScreenApi.fullScreenEventName="mozfullscreenchange",fullScreenApi.fullScreenErrorEventName="mozfullscreenerror"),fullScreenApi.isFullScreen=function(){return null!==fullScreenApi.getFullScreenElement()},fullScreenApi.cancelFullScreen=function(){$.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),fullScreenApi.exitFullScreen()},$.extend($,fullScreenApi),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(e,t,i,n){var o=this;n=n||1;var r=0,s=function(i){++r===n&&o.removeHandler(e,s),t(i)};this.addHandler(e,s,i)},addHandler:function(t,i,n){var o=this.events[t];o||(this.events[t]=o=[]),i&&e.isFunction(i)&&(o[o.length]={handler:i,userData:n||null})},removeHandler:function(t,i){var n,o=this.events[t],r=[];if(o&&e.isArray(o)){for(n=0;n<o.length;n++)o[n].handler!==i&&r.push(o[n]);this.events[t]=r}},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var t=this.events[e];return t&&t.length?(t=1===t.length?[t[0]]:Array.apply(null,t),function(e,i){var n,o=t.length;for(n=0;n<o;n++)t[n]&&(i.eventSource=e,i.userData=t[n].userData,t[n].handler(i))}):null},raiseEvent:function(e,t){var i=this.getHandler(e);i&&(t||(t={}),i(this,t))}}}(OpenSeadragon),function(e){var t,i,n,o,r,s,a=[],l={};function c(t){var i,n=l[t.hash],o=n.activePointersLists.length;for(i=0;i<o;i++)n.activePointersLists[i].captureCount>0&&(e.removeEvent(e.MouseTracker.captureElement,"mousemove",n.mousemovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"mouseup",n.mouseupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",n.pointermovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",n.pointerupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchmove",n.touchmovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchend",n.touchendcaptured,!0),n.activePointersLists[i].captureCount=0);for(i=0;i<o;i++)n.activePointersLists.pop()}function d(t){var i,n,o=l[t.hash];if(o.tracking){for(n=0;n<e.MouseTracker.subscribeEvents.length;n++)i=e.MouseTracker.subscribeEvents[n],e.removeEvent(t.element,i,o[i],!1);c(t),o.tracking=!1}}function u(t,i){var n=l[t.hash];if("pointerevent"===i)return{upName:e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:n.pointerupcaptured,moveName:e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:n.pointermovecaptured};if("mouse"===i)return{upName:"mouseup",upHandler:n.mouseupcaptured,moveName:"mousemove",moveHandler:n.mousemovecaptured};if("touch"===i)return{upName:"touchend",upHandler:n.touchendcaptured,moveName:"touchmove",moveHandler:n.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function h(t,i,n){var o,r=t.getActivePointersListByType(i);r.captureCount+=n||1,1===r.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?t.element.setCapture(!0):(o=u(t,e.MouseTracker.havePointerEvents?"pointerevent":i),_e&&ye(window.top)&&e.addEvent(window.top,o.upName,o.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,o.upName,o.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,o.moveName,o.moveHandler,!0)))}function p(t,i,n){var o,r=t.getActivePointersListByType(i);r.captureCount-=n||1,0===r.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?t.element.releaseCapture():(o=u(t,e.MouseTracker.havePointerEvents?"pointerevent":i),_e&&ye(window.top)&&e.removeEvent(window.top,o.upName,o.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,o.moveName,o.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,o.upName,o.upHandler,!0)))}function m(t){var i;if(e.MouseTracker.unprefixedPointerEvents)i=t.pointerType;else switch(t.pointerType){case 2:i="touch";break;case 3:i="pen";break;case 4:i="mouse";break;default:i=""}return i}function f(t){return e.getMousePosition(t)}function g(e,t){return v(f(e),t)}function v(t,i){var n=e.getElementOffset(i);return t.minus(n)}function _(t,i){return new e.Point((t.x+i.x)/2,(t.y+i.y)/2)}function y(t,i){t.clickHandler&&e.cancelEvent(i)}function w(t,i){t.dblClickHandler&&e.cancelEvent(i)}function b(t,i){t.keyDownHandler&&(i=e.getEvent(i),t.keyDownHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(i))}function x(t,i){t.keyUpHandler&&(i=e.getEvent(i),t.keyUpHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(i))}function T(t,i){t.keyHandler&&(i=e.getEvent(i),t.keyHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(i))}function S(t,i){t.focusHandler&&(i=e.getEvent(i),!1===t.focusHandler({eventSource:t,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i))}function k(t,i){t.blurHandler&&(i=e.getEvent(i),!1===t.blurHandler({eventSource:t,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i))}function C(e,t){E(e,t,t)}function A(t,i){var n={target:(i=e.getEvent(i)).target||i.srcElement,type:"wheel",shiftKey:i.shiftKey||!1,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX?i.pageX:i.clientX,pageY:i.pageY?i.pageY:i.clientY,deltaMode:"MozMousePixelScroll"==i.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==e.MouseTracker.wheelEventName?n.deltaY=-i.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:n.deltaY=i.detail,E(t,n,i)}function E(t,i,n){var o;o=i.deltaY<0?1:-1,t.scrollHandler&&!1===t.scrollHandler({eventSource:t,pointerType:"mouse",position:g(i,t.element),scroll:o,shift:i.shiftKey,isTouchEvent:!1,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)}function N(e,t){if(e===t)return!1;for(;t&&t!==e;)t=t.parentNode;return t===e}function O(t,i){M(t,i=e.getEvent(i))}function P(t,i){(i=e.getEvent(i)).currentTarget===i.relatedTarget||N(i.currentTarget,i.relatedTarget)||M(t,i)}function M(t,i){pe(t,i,[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:f(i),currentTime:e.now()}])}function R(t,i){F(t,i=e.getEvent(i))}function I(t,i){(i=e.getEvent(i)).currentTarget===i.relatedTarget||N(i.currentTarget,i.relatedTarget)||F(t,i)}function F(t,i){me(t,i,[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:f(i),currentTime:e.now()}])}function D(t){return e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?1===t?0:2===t?2:4===t?1:-1:t}function j(t,i){fe(t,i=e.getEvent(i),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:f(i),currentTime:e.now()}],D(i.button))&&(e.stopEvent(i),h(t,"mouse")),(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler)&&e.cancelEvent(i)}function z(e,t){B(e,t)}function L(t,i){B(t,i),e.stopEvent(i)}function B(t,i){ge(t,i=e.getEvent(i),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:f(i),currentTime:e.now()}],D(i.button))&&p(t,"mouse")}function $(e,t){V(e,t)}function W(t,i){V(t,i),e.stopEvent(i)}function V(t,i){ve(t,i=e.getEvent(i),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:f(i),currentTime:e.now()}])}function q(e,t,i){var n,o=i.getLength(),r=[];if("touch"===i.type||i.contacts>0){for(n=0;n<o;n++)r.push(i.getByIndex(n));r.length>0&&(ge(e,t,r,0),i.captureCount=1,p(e,i.type),me(e,t,r))}}function H(t,i){var n,o,r,s,l=i.changedTouches.length,c=[],d=t.getActivePointersListByType("touch");for(n=e.now(),d.getLength()>i.touches.length-l&&(e.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),q(t,i,d)),o=0;o<l;o++)c.push({id:i.changedTouches[o].identifier,type:"touch",currentPos:f(i.changedTouches[o]),currentTime:n});for(pe(t,i,c),o=0;o<a.length;o++)if(a[o]!==t&&a[o].isTracking()&&N(a[o].element,t.element)){for(s=[],r=0;r<l;r++)s.push({id:i.changedTouches[r].identifier,type:"touch",currentPos:f(i.changedTouches[r]),currentTime:n});pe(a[o],i,s)}fe(t,i,c,0)&&(e.stopEvent(i),h(t,"touch",l)),e.cancelEvent(i)}function U(e,t){Z(e,t)}function G(t,i){Z(t,i),e.stopEvent(i)}function Z(t,i){var n,o,r,s,l=i.changedTouches.length,c=[];for(n=e.now(),o=0;o<l;o++)c.push({id:i.changedTouches[o].identifier,type:"touch",currentPos:f(i.changedTouches[o]),currentTime:n});for(ge(t,i,c,0)&&p(t,"touch",l),me(t,i,c),o=0;o<a.length;o++)if(a[o]!==t&&a[o].isTracking()&&N(a[o].element,t.element)){for(s=[],r=0;r<l;r++)s.push({id:i.changedTouches[r].identifier,type:"touch",currentPos:f(i.changedTouches[r]),currentTime:n});me(a[o],i,s)}e.cancelEvent(i)}function X(e,t){Y(e,t)}function K(t,i){Y(t,i),e.stopEvent(i)}function Y(t,i){var n,o=i.changedTouches.length,r=[];for(n=0;n<o;n++)r.push({id:i.changedTouches[n].identifier,type:"touch",currentPos:f(i.changedTouches[n]),currentTime:e.now()});ve(t,i,r),e.cancelEvent(i)}function Q(e,t){var i=e.getActivePointersListByType("touch");q(e,t,i)}function J(e,t){return t.stopPropagation(),t.preventDefault(),!1}function ee(e,t){return t.stopPropagation(),t.preventDefault(),!1}function te(t,i){i.currentTarget===i.relatedTarget||N(i.currentTarget,i.relatedTarget)||pe(t,i,[{id:i.pointerId,type:m(i),isPrimary:i.isPrimary,currentPos:f(i),currentTime:e.now()}])}function ie(t,i){i.currentTarget===i.relatedTarget||N(i.currentTarget,i.relatedTarget)||me(t,i,[{id:i.pointerId,type:m(i),isPrimary:i.isPrimary,currentPos:f(i),currentTime:e.now()}])}function ne(t,i){var n;fe(t,i,[n={id:i.pointerId,type:m(i),isPrimary:i.isPrimary,currentPos:f(i),currentTime:e.now()}],i.button)&&(e.stopEvent(i),h(t,n.type)),(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.cancelEvent(i)}function oe(e,t){se(e,t)}function re(t,i){t.getActivePointersListByType(m(i)).getById(i.pointerId)&&se(t,i),e.stopEvent(i)}function se(t,i){var n;ge(t,i,[n={id:i.pointerId,type:m(i),isPrimary:i.isPrimary,currentPos:f(i),currentTime:e.now()}],i.button)&&p(t,n.type)}function ae(e,t){ce(e,t)}function le(t,i){t.getActivePointersListByType(m(i)).getById(i.pointerId)&&ce(t,i),e.stopEvent(i)}function ce(t,i){ve(t,i,[{id:i.pointerId,type:m(i),isPrimary:i.isPrimary,currentPos:f(i),currentTime:e.now()}])}function de(e,t){!function(e,t,i){ge(e,t,i,0),me(e,t,i)}(e,t,[{id:t.pointerId,type:m(t)}])}function ue(e,t){return Object.prototype.hasOwnProperty.call(t,"isPrimary")||(0===e.getLength()?t.isPrimary=!0:t.isPrimary=!1),t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function he(e,t){var i,n;return e.getById(t.id)?(i=e.removeById(t.id),Object.prototype.hasOwnProperty.call(t,"isPrimary")||(n=e.getPrimary())||(n=e.getByIndex(0))&&(n.isPrimary=!0)):i=e.getLength(),i}function pe(t,i,n){var o,r,s,a=t.getActivePointersListByType(n[0].type),l=n.length;for(o=0;o<l;o++)r=n[o],(s=a.getById(r.id))?(s.insideElement=!0,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=r.currentPos,s.currentTime=r.currentTime,r=s):(r.captured=!1,r.insideElementPressed=!1,r.insideElement=!0,ue(a,r)),t.enterHandler&&!1===t.enterHandler({eventSource:t,pointerType:r.type,position:v(r.currentPos,t.element),buttons:a.buttons,pointers:t.getActivePointerCount(),insideElementPressed:r.insideElementPressed,buttonDownAny:0!==a.buttons,isTouchEvent:"touch"===r.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)}function me(t,i,n){var o,r,s,a=t.getActivePointersListByType(n[0].type),l=n.length;for(o=0;o<l;o++)r=n[o],(s=a.getById(r.id))&&(s.captured?(s.insideElement=!1,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=r.currentPos,s.currentTime=r.currentTime):he(a,s),r=s),t.exitHandler&&!1===t.exitHandler({eventSource:t,pointerType:r.type,position:r.currentPos&&v(r.currentPos,t.element),buttons:a.buttons,pointers:t.getActivePointerCount(),insideElementPressed:!!s&&s.insideElementPressed,buttonDownAny:0!==a.buttons,isTouchEvent:"touch"===r.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)}function fe(t,i,n,o){var r,s,a,c=l[t.hash],d=t.getActivePointersListByType(n[0].type),u=n.length;void 0!==i.buttons?d.buttons=i.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===o?d.buttons+=1:1===o?d.buttons+=4:2===o?d.buttons+=2:3===o?d.buttons+=8:4===o?d.buttons+=16:5===o&&(d.buttons+=32):0===o?d.buttons|=1:1===o?d.buttons|=4:2===o?d.buttons|=2:3===o?d.buttons|=8:4===o?d.buttons|=16:5===o&&(d.buttons|=32);var h=t.getActivePointersListsExceptType(n[0].type);for(r=0;r<h.length;r++)q(t,i,h[r]);if(0!==o)return t.nonPrimaryPressHandler&&!1===t.nonPrimaryPressHandler({eventSource:t,pointerType:n[0].type,position:v(n[0].currentPos,t.element),button:o,buttons:d.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),!1;for(r=0;r<u;r++)s=n[r],(a=d.getById(s.id))?(a.captured=!0,a.insideElementPressed=!0,a.insideElement=!0,a.contactPos=s.currentPos,a.contactTime=s.currentTime,a.lastPos=a.currentPos,a.lastTime=a.currentTime,a.currentPos=s.currentPos,a.currentTime=s.currentTime,s=a):(s.captured=!0,s.insideElementPressed=!0,s.insideElement=!0,ue(d,s)),d.addContact(),(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(t,s),1===d.contacts?t.pressHandler&&!1===t.pressHandler({eventSource:t,pointerType:s.type,position:v(s.contactPos,t.element),buttons:d.buttons,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i):2===d.contacts&&t.pinchHandler&&"touch"===s.type&&(c.pinchGPoints=d.asArray(),c.lastPinchDist=c.currentPinchDist=c.pinchGPoints[0].currentPos.distanceTo(c.pinchGPoints[1].currentPos),c.lastPinchCenter=c.currentPinchCenter=_(c.pinchGPoints[0].currentPos,c.pinchGPoints[1].currentPos));return!0}function ge(t,i,n,o){var r,s,a,c,d,u,h=l[t.hash],p=t.getActivePointersListByType(n[0].type),m=n.length,f=!1,g=!1;if(void 0!==i.buttons?p.buttons=i.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===o?p.buttons-=1:1===o?p.buttons-=4:2===o?p.buttons-=2:3===o?p.buttons-=8:4===o?p.buttons-=16:5===o&&(p.buttons-=32):0===o?p.buttons^=-2:1===o?p.buttons^=-5:2===o?p.buttons^=-3:3===o?p.buttons^=-9:4===o?p.buttons^=-17:5===o&&(p.buttons^=-33),0!==o){t.nonPrimaryReleaseHandler&&!1===t.nonPrimaryReleaseHandler({eventSource:t,pointerType:n[0].type,position:v(n[0].currentPos,t.element),button:o,buttons:p.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i);var y=t.getActivePointersListByType("mouse");return q(t,i,y),!1}if(void 0===n[0].currentPos)return q(t,i,p),!1;for(a=0;a<m;a++)c=n[a],(d=p.getById(c.id))&&(d.captured&&(d.captured=!1,f=!0,g=!0),d.lastPos=d.currentPos,d.lastTime=d.currentTime,d.currentPos=c.currentPos,d.currentTime=c.currentTime,d.insideElement||he(p,d),r=d.currentPos,s=d.currentTime,g?(p.removeContact(),(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(t,d),0===p.contacts?(t.releaseHandler&&!1===t.releaseHandler({eventSource:t,pointerType:d.type,position:v(r,t.element),buttons:p.buttons,insideElementPressed:d.insideElementPressed,insideElementReleased:d.insideElement,isTouchEvent:"touch"===d.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),t.dragEndHandler&&!d.currentPos.equals(d.contactPos)&&!1===t.dragEndHandler({eventSource:t,pointerType:d.type,position:v(d.currentPos,t.element),speed:d.speed,direction:d.direction,shift:i.shiftKey,isTouchEvent:"touch"===d.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),(t.clickHandler||t.dblClickHandler)&&d.insideElement&&(u=s-d.contactTime<=t.clickTimeThreshold&&d.contactPos.distanceTo(r)<=t.clickDistThreshold,t.clickHandler&&!1===t.clickHandler({eventSource:t,pointerType:d.type,position:v(d.currentPos,t.element),quick:u,shift:i.shiftKey,isTouchEvent:"touch"===d.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),t.dblClickHandler&&u&&(p.clicks++,1===p.clicks?(h.lastClickPos=r,h.dblClickTimeOut=setTimeout((function(){p.clicks=0}),t.dblClickTimeThreshold)):2===p.clicks&&(clearTimeout(h.dblClickTimeOut),p.clicks=0,h.lastClickPos.distanceTo(r)<=t.dblClickDistThreshold&&!1===t.dblClickHandler({eventSource:t,pointerType:d.type,position:v(d.currentPos,t.element),shift:i.shiftKey,isTouchEvent:"touch"===d.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),h.lastClickPos=null)))):2===p.contacts&&t.pinchHandler&&"touch"===d.type&&(h.pinchGPoints=p.asArray(),h.lastPinchDist=h.currentPinchDist=h.pinchGPoints[0].currentPos.distanceTo(h.pinchGPoints[1].currentPos),h.lastPinchCenter=h.currentPinchCenter=_(h.pinchGPoints[0].currentPos,h.pinchGPoints[1].currentPos))):t.releaseHandler&&!1===t.releaseHandler({eventSource:t,pointerType:d.type,position:v(r,t.element),buttons:p.buttons,insideElementPressed:d.insideElementPressed,insideElementReleased:d.insideElement,isTouchEvent:"touch"===d.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i));return f}function ve(t,i,n){var o,r,s,a,c,d=l[t.hash],u=t.getActivePointersListByType(n[0].type),h=n.length;for(void 0!==i.buttons&&(u.buttons=i.buttons),o=0;o<h;o++)r=n[o],(s=u.getById(r.id))?(Object.prototype.hasOwnProperty.call(r,"isPrimary")&&(s.isPrimary=r.isPrimary),s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=r.currentPos,s.currentTime=r.currentTime):(r.captured=!1,r.insideElementPressed=!1,r.insideElement=!0,ue(u,r));t.stopHandler&&"mouse"===n[0].type&&(clearTimeout(t.stopTimeOut),t.stopTimeOut=setTimeout((function(){!function(e,t,i){e.stopHandler&&e.stopHandler({eventSource:e,pointerType:i,position:g(t,e.element),buttons:e.getActivePointersListByType(i).buttons,isTouchEvent:"touch"===i,originalEvent:t,preventDefaultAction:!1,userData:e.userData})}(t,i,n[0].type)}),t.stopDelay)),0===u.contacts?t.moveHandler&&!1===t.moveHandler({eventSource:t,pointerType:n[0].type,position:v(n[0].currentPos,t.element),buttons:u.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i):1===u.contacts?(t.moveHandler&&(s=u.asArray()[0],!1===t.moveHandler({eventSource:t,pointerType:s.type,position:v(s.currentPos,t.element),buttons:u.buttons,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)),t.dragHandler&&(c=(s=u.asArray()[0]).currentPos.minus(s.lastPos),!1===t.dragHandler({eventSource:t,pointerType:s.type,position:v(s.currentPos,t.element),buttons:u.buttons,delta:c,speed:s.speed,direction:s.direction,shift:i.shiftKey,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i))):2===u.contacts&&(t.moveHandler&&(a=u.asArray(),!1===t.moveHandler({eventSource:t,pointerType:a[0].type,position:v(_(a[0].currentPos,a[1].currentPos),t.element),buttons:u.buttons,isTouchEvent:"touch"===a[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)),t.pinchHandler&&"touch"===n[0].type&&(c=d.pinchGPoints[0].currentPos.distanceTo(d.pinchGPoints[1].currentPos))!=d.currentPinchDist&&(d.lastPinchDist=d.currentPinchDist,d.currentPinchDist=c,d.lastPinchCenter=d.currentPinchCenter,d.currentPinchCenter=_(d.pinchGPoints[0].currentPos,d.pinchGPoints[1].currentPos),!1===t.pinchHandler({eventSource:t,pointerType:"touch",gesturePoints:d.pinchGPoints,lastCenter:v(d.lastPinchCenter,t.element),center:v(d.currentPinchCenter,t.element),lastDistance:d.lastPinchDist,distance:d.currentPinchDist,shift:i.shiftKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)))}e.MouseTracker=function(t){a.push(this);var i=arguments;e.isPlainObject(t)||(t={element:i[0],clickTimeThreshold:i[1],clickDistThreshold:i[2]}),this.hash=Math.random(),this.element=e.getElement(t.element),this.clickTimeThreshold=t.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=t.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=t.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=t.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=t.userData||null,this.stopDelay=t.stopDelay||50,this.enterHandler=t.enterHandler||null,this.exitHandler=t.exitHandler||null,this.pressHandler=t.pressHandler||null,this.nonPrimaryPressHandler=t.nonPrimaryPressHandler||null,this.releaseHandler=t.releaseHandler||null,this.nonPrimaryReleaseHandler=t.nonPrimaryReleaseHandler||null,this.moveHandler=t.moveHandler||null,this.scrollHandler=t.scrollHandler||null,this.clickHandler=t.clickHandler||null,this.dblClickHandler=t.dblClickHandler||null,this.dragHandler=t.dragHandler||null,this.dragEndHandler=t.dragEndHandler||null,this.pinchHandler=t.pinchHandler||null,this.stopHandler=t.stopHandler||null,this.keyDownHandler=t.keyDownHandler||null,this.keyUpHandler=t.keyUpHandler||null,this.keyHandler=t.keyHandler||null,this.focusHandler=t.focusHandler||null,this.blurHandler=t.blurHandler||null;var n=this;l[this.hash]={click:function(e){y(n,e)},dblclick:function(e){w(n,e)},keydown:function(e){b(n,e)},keyup:function(e){x(n,e)},keypress:function(e){T(n,e)},focus:function(e){S(n,e)},blur:function(e){k(n,e)},wheel:function(e){C(n,e)},mousewheel:function(e){A(n,e)},DOMMouseScroll:function(e){A(n,e)},MozMousePixelScroll:function(e){A(n,e)},mouseenter:function(e){O(n,e)},mouseleave:function(e){R(n,e)},mouseover:function(e){P(n,e)},mouseout:function(e){I(n,e)},mousedown:function(e){j(n,e)},mouseup:function(e){z(n,e)},mouseupcaptured:function(e){L(n,e)},mousemove:function(e){$(n,e)},mousemovecaptured:function(e){W(n,e)},touchstart:function(e){H(n,e)},touchend:function(e){U(n,e)},touchendcaptured:function(e){G(n,e)},touchmove:function(e){X(n,e)},touchmovecaptured:function(e){K(n,e)},touchcancel:function(e){Q(n,e)},gesturestart:function(e){J(n,e)},gesturechange:function(e){ee(n,e)},pointerover:function(e){te(n,e)},MSPointerOver:function(e){te(n,e)},pointerout:function(e){ie(n,e)},MSPointerOut:function(e){ie(n,e)},pointerdown:function(e){ne(n,e)},MSPointerDown:function(e){ne(n,e)},pointerup:function(e){oe(n,e)},MSPointerUp:function(e){oe(n,e)},pointermove:function(e){ae(n,e)},MSPointerMove:function(e){ae(n,e)},pointercancel:function(e){de(n,e)},MSPointerCancel:function(e){de(n,e)},pointerupcaptured:function(e){re(n,e)},pointermovecaptured:function(e){le(n,e)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},t.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){var e;for(d(this),this.element=null,e=0;e<a.length;e++)if(a[e]===this){a.splice(e,1);break}l[this.hash]=null,delete l[this.hash]},isTracking:function(){return l[this.hash].tracking},setTracking:function(t){return t?function(t){var i,n,o=l[t.hash];if(!o.tracking){for(n=0;n<e.MouseTracker.subscribeEvents.length;n++)i=e.MouseTracker.subscribeEvents[n],e.addEvent(t.element,i,o[i],!1);c(t),o.tracking=!0}}(this):d(this),this},getActivePointersListsExceptType:function(e){for(var t=l[this.hash],i=[],n=0;n<t.activePointersLists.length;++n)t.activePointersLists[n].type!==e&&i.push(t.activePointersLists[n]);return i},getActivePointersListByType:function(t){var i,n,o=l[this.hash],r=o.activePointersLists.length;for(i=0;i<r;i++)if(o.activePointersLists[i].type===t)return o.activePointersLists[i];return n=new e.MouseTracker.GesturePointList(t),o.activePointersLists.push(n),n},getActivePointerCount:function(){var e,t=l[this.hash],i=t.activePointersLists.length,n=0;for(e=0;e<i;e++)n+=t.activePointersLists[e].getLength();return n},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},e.MouseTracker.resetAllMouseTrackers=function(){for(var e=0;e<a.length;e++)a[e].isTracking()&&(a[e].setTracking(!1),a[e].setTracking(!0))},e.MouseTracker.gesturePointVelocityTracker=(t=[],i=0,n=0,o=function(e,t){return e.hash.toString()+t.type+t.id.toString()},r=function(){var i,o,r,s,a,l,c=t.length,d=e.now();for(s=d-n,n=d,i=0;i<c;i++)(r=(o=t[i]).gPoint).direction=Math.atan2(r.currentPos.y-o.lastPos.y,r.currentPos.x-o.lastPos.x),a=o.lastPos.distanceTo(r.currentPos),o.lastPos=r.currentPos,l=1e3*a/(s+1),r.speed=.75*l+.25*r.speed},{addPoint:function(s,a){var l=o(s,a);t.push({guid:l,gPoint:a,lastPos:a.currentPos}),1===t.length&&(n=e.now(),i=window.setInterval(r,50))},removePoint:function(e,n){var r,s=o(e,n),a=t.length;for(r=0;r<a;r++)if(t[r].guid===s){t.splice(r,1),0==--a&&window.clearInterval(i);break}}}),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e.MouseTracker.supportsMouseCapture=(s=document.createElement("div"),e.isFunction(s.setCapture)&&e.isFunction(s.releaseCapture)),e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",e.MouseTracker.wheelEventName],"DOMMouseScroll"==e.MouseTracker.wheelEventName&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||e.Browser.vendor!==e.BROWSERS.IE)?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?e.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:e.MouseTracker.maxTouchPoints=0,e.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),e.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?e.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:e.MouseTracker.maxTouchPoints=0,e.MouseTracker.haveMouseEnter=!1):(e.MouseTracker.havePointerEvents=!1,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?(e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),e.MouseTracker.haveMouseEnter=!0):(e.MouseTracker.subscribeEvents.push("mouseover","mouseout"),e.MouseTracker.haveMouseEnter=!1),e.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.maxTouchPoints=10),e.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].id===e){this._gPoints.splice(t,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].id===e)return this._gPoints[t];return null},getPrimary:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].isPrimary)return this._gPoints[t];return null},addContact:function(){++this.contacts,this.contacts>1&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var _e=function(){try{return window.self!==window.top}catch(e){return!0}}();function ye(e){try{return e.addEventListener&&e.removeEventListener}catch(e){return!1}}}(OpenSeadragon),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(t,i,n){var o=t.parentNode;"number"==typeof i&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer=void 0===i.attachToViewer||i.attachToViewer,this.autoFade=void 0===i.autoFade||i.autoFade,this.element=t,this.anchor=i.anchor,this.container=n,this.anchor==e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof i.top?i.top+"px":i.top,this.wrapper.style.left="number"==typeof i.left?i.left+"px":i.left,this.wrapper.style.height="number"==typeof i.height?i.height+"px":i.height,this.wrapper.style.width="number"==typeof i.width?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor==e.ControlAnchor.TOP_RIGHT||this.anchor==e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):o.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(t){this.wrapper.style.display=t?this.anchor==e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(t){this.element[e.SIGNAL]&&e.Browser.vendor==e.BROWSERS.IE?e.setElementOpacity(this.element,t,!0):e.setElementOpacity(this.wrapper,t,!0)}}}(OpenSeadragon),function(e){function t(e,t){var i,n=e.controls;for(i=n.length-1;i>=0;i--)if(n[i].element==t)return i;return-1}e.ControlDock=function(t){var i,n,o=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(1e6*Math.random()),container:e.makeNeutralElement("div"),controls:[]},t),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),n=0;n<o.length;n++)i=o[n],this.controls[i]=e.makeNeutralElement("div"),this.controls[i].style.position="absolute",i.match("left")&&(this.controls[i].style.left="0px"),i.match("right")&&(this.controls[i].style.right="0px"),i.match("top")&&(this.controls[i].style.top="0px"),i.match("bottom")&&(this.controls[i].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(i,n){var o=null;if(!(t(this,i=e.getElement(i))>=0)){switch(n.anchor){case e.ControlAnchor.TOP_RIGHT:o=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:o=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:o=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:o=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:o=this.container,i.style.margin="0px",i.style.padding="0px";break;default:case e.ControlAnchor.NONE:o=this.container,i.style.margin="0px",i.style.padding="0px"}this.controls.push(new e.Control(i,n,o)),i.style.display="inline-block"}},removeControl:function(i){var n=t(this,i=e.getElement(i));return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;e>=0;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;t>=0;t--)this.controls[t].setVisible(e);return this}}}(OpenSeadragon),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(e){var t={},i=1;function n(t){return t=e.getElement(t),new e.Point(0===t.clientWidth?1:t.clientWidth,0===t.clientHeight?1:t.clientHeight)}function o(t,i){if(i instanceof e.Overlay)return i;var n=null;if(i.element)n=e.getElement(i.element);else{var o=i.id?i.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());(n=e.getElement(i.id))||((n=document.createElement("a")).href="#/overlay/"+o),n.id=o,e.addClass(n,i.className?i.className:"openseadragon-overlay")}var r=i.location,s=i.width,a=i.height;if(!r){var l=i.x,c=i.y;if(void 0!==i.px){var d=t.viewport.imageToViewportRectangle(new e.Rect(i.px,i.py,s||0,a||0));l=d.x,c=d.y,s=void 0!==s?d.width:void 0,a=void 0!==a?d.height:void 0}r=new e.Point(l,c)}var u=i.placement;return u&&"string"===e.type(u)&&(u=e.Placement[i.placement.toUpperCase()]),new e.Overlay({element:n,location:r,placement:u,onDraw:i.onDraw,checkResize:i.checkResize,width:s,height:a,rotationMode:i.rotationMode})}function r(e,t){var i;for(i=e.length-1;i>=0;i--)if(e[i].element===t)return i;return-1}function s(t,i){return e.requestAnimationFrame((function(){i(t)}))}function a(t){e.requestAnimationFrame((function(){!function(t){var i,n;if(t.controlsShouldFade){for(i=1-(e.now()-t.controlsFadeBeginTime)/t.controlsFadeLength,i=Math.min(1,i),i=Math.max(0,i),n=t.controls.length-1;n>=0;n--)t.controls[n].autoFade&&t.controls[n].setOpacity(i);i>0&&a(t)}}(t)}))}function l(t){t.autoHideControls&&(t.controlsShouldFade=!0,t.controlsFadeBeginTime=e.now()+t.controlsFadeDelay,window.setTimeout((function(){a(t)}),t.controlsFadeDelay))}function c(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;t>=0;t--)e.controls[t].setOpacity(1)}function d(){c(this)}function u(){l(this)}function h(t){var i={originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction,preventVerticalPan:t.preventVerticalPan,preventHorizontalPan:t.preventHorizontalPan};if(this.raiseEvent("canvas-key",i),i.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 38:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}}function p(t){var i={originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction,preventVerticalPan:t.preventVerticalPan,preventHorizontalPan:t.preventHorizontalPan};if(this.raiseEvent("canvas-key",i),i.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(e.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(e.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}}function m(e){var t;document.activeElement==this.canvas||this.canvas.focus(),this.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var i={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-click",i),!i.preventDefaultAction&&this.viewport&&e.quick&&(t=this.gestureSettingsByDeviceType(e.pointerType)).clickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function f(e){var t,i={tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-double-click",i),!i.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function g(e){var t,i={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};if(this.raiseEvent("canvas-drag",i),!i.preventDefaultAction&&this.viewport){if(t=this.gestureSettingsByDeviceType(e.pointerType),this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.flipped&&(e.delta.x=-e.delta.x),this.constrainDuringPan){var n=this.viewport.deltaPointsFromPixels(e.delta.negate());this.viewport.centerSpringX.target.value+=n.x,this.viewport.centerSpringY.target.value+=n.y;var o=this.viewport.getBounds(),r=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=n.x,this.viewport.centerSpringY.target.value-=n.y,o.x!=r.x&&(e.delta.x=0),o.y!=r.y&&(e.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),t.flickEnabled&&!this.constrainDuringPan)}}function v(t){if(!t.preventDefaultAction&&this.viewport){var i=this.gestureSettingsByDeviceType(t.pointerType);if(i.flickEnabled&&t.speed>=i.flickMinSpeed){var n=0;this.panHorizontal&&(n=i.flickMomentum*t.speed*Math.cos(t.direction));var o=0;this.panVertical&&(o=i.flickMomentum*t.speed*Math.sin(t.direction));var r=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),s=this.viewport.pointFromPixel(new e.Point(r.x-n,r.y-o));this.viewport.panTo(s,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:t.eventSource,position:t.position,speed:t.speed,direction:t.direction,shift:t.shift,originalEvent:t.originalEvent})}function _(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function y(t){window.location!=window.parent.location&&e.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function w(e){this.raiseEvent("canvas-press",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function b(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function x(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function T(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function S(e){var t,i,n;if(!e.preventDefaultAction&&this.viewport&&((t=this.gestureSettingsByDeviceType(e.pointerType)).pinchToZoom&&(i=this.viewport.pointFromPixel(e.center,!0),n=this.viewport.pointFromPixel(e.lastCenter,!0).minus(i),this.panHorizontal||(n.x=0),this.panVertical||(n.y=0),this.viewport.zoomBy(e.distance/e.lastDistance,i,!0),t.zoomToRefPoint&&this.viewport.panBy(n,!0),this.viewport.applyConstraints()),t.pinchRotate)){var o=Math.atan2(e.gesturePoints[0].currentPos.y-e.gesturePoints[1].currentPos.y,e.gesturePoints[0].currentPos.x-e.gesturePoints[1].currentPos.x),r=Math.atan2(e.gesturePoints[0].lastPos.y-e.gesturePoints[1].lastPos.y,e.gesturePoints[0].lastPos.x-e.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(o-r)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:e.eventSource,gesturePoints:e.gesturePoints,lastCenter:e.lastCenter,center:e.center,lastDistance:e.lastDistance,distance:e.distance,shift:e.shift,originalEvent:e.originalEvent}),!1}function k(t){var i,n,o;if((o=e.now())-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=o,this.viewport.flipped&&(t.position.x=this.viewport.getContainerSize().x-t.position.x),!t.preventDefaultAction&&this.viewport&&(i=this.gestureSettingsByDeviceType(t.pointerType)).scrollToZoom&&(n=Math.pow(this.zoomPerScroll,t.scroll),this.viewport.zoomBy(n,i.zoomToRefPoint?this.viewport.pointFromPixel(t.position,!0):null),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:t.eventSource,position:t.position,scroll:t.scroll,shift:t.shift,originalEvent:t.originalEvent}),i&&i.scrollToZoom)return!1}else if((i=this.gestureSettingsByDeviceType(t.pointerType))&&i.scrollToZoom)return!1}function C(e){t[this.hash].mouseInside=!0,c(this),this.raiseEvent("container-enter",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function A(e){e.pointers<1&&(t[this.hash].mouseInside=!1,t[this.hash].animating||l(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function E(e){!function(e){if(e._opening)return;if(e.autoResize){var i=n(e.container),o=t[e.hash].prevContainerSize;if(!i.equals(o)){var r=e.viewport;if(e.preserveImageSizeOnResize){var s=o.x/i.x,a=r.getZoom()*s,d=r.getCenter();r.resize(i,!1),r.zoomTo(a,null,!0),r.panTo(d,!0)}else{var u=r.getBounds();r.resize(i,!0),r.fitBoundsWithConstraints(u,!0)}t[e.hash].prevContainerSize=i,t[e.hash].forceRedraw=!0}}var h=e.viewport.update(),p=e.world.update()||h;h&&e.raiseEvent("viewport-change");e.referenceStrip&&(p=e.referenceStrip.update(e.viewport)||p);!t[e.hash].animating&&p&&(e.raiseEvent("animation-start"),c(e));(p||t[e.hash].forceRedraw||e.world.needsDraw())&&(!function(e){e.imageLoader.clear(),e.drawer.clear(),e.world.draw(),e.raiseEvent("update-viewport",{})}(e),e._drawOverlays(),e.navigator&&e.navigator.update(e.viewport),t[e.hash].forceRedraw=!1,p&&e.raiseEvent("animation"));t[e.hash].animating&&!p&&(e.raiseEvent("animation-finish"),t[e.hash].mouseInside||l(e));t[e.hash].animating=p}(e),e.isOpen()?e._updateRequestId=s(e,E):e._updateRequestId=!1}function N(e,t){return e?e+t:t}function O(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=this.zoomPerSecond,t[this.hash].zooming=!0,R(this)}function P(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=1/this.zoomPerSecond,t[this.hash].zooming=!0,R(this)}function M(){t[this.hash].zooming=!1}function R(t){e.requestAnimationFrame(e.delegate(t,I))}function I(){var i,n,o;t[this.hash].zooming&&this.viewport&&(n=(i=e.now())-t[this.hash].lastZoomTime,o=Math.pow(t[this.hash].zoomFactor,n/1e3),this.viewport.zoomBy(o),this.viewport.applyConstraints(),t[this.hash].lastZoomTime=i,R(this))}function F(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function D(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function j(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function z(){this.viewport&&this.viewport.goHome()}function L(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function B(){if(this.viewport){var t=this.viewport.getRotation();t=this.viewport.flipped?e.positiveModulo(t+this.rotationIncrement,360):e.positiveModulo(t-this.rotationIncrement,360),this.viewport.setRotation(t)}}function $(){if(this.viewport){var t=this.viewport.getRotation();t=this.viewport.flipped?e.positiveModulo(t-this.rotationIncrement,360):e.positiveModulo(t+this.rotationIncrement,360),this.viewport.setRotation(t)}}function W(){this.viewport.toggleFlip()}function V(){var e=this._sequenceIndex-1;this.navPrevNextWrap&&e<0&&(e+=this.tileSources.length),this.goToPage(e)}function q(){var e=this._sequenceIndex+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)}e.Viewer=function(o){var r,a,c=arguments,d=this;if(e.isPlainObject(o)||(o={id:c[0],xmlPath:c.length>1?c[1]:void 0,prefixUrl:c.length>2?c[2]:void 0,controls:c.length>3?c[3]:void 0,overlays:c.length>4?c[4]:void 0}),o.config&&(e.extend(!0,o,o.config),delete o.config),e.extend(!0,this,{id:o.id,hash:o.hash||i++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,o),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==t[this.hash]&&e.console.warn("Hash "+this.hash+" has already been used."),t[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",(function(t){var i=e.getString("Errors.OpenFailed",t.eventSource,t.message);d._showMessage(i)})),e.ControlDock.call(this,o),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(a=this.canvas.style).width="100%",a.height="100%",a.overflow="hidden",a.position="absolute",a.top="0px",a.left="0px",e.setElementTouchActionNone(this.canvas),""!==o.tabIndex&&(this.canvas.tabIndex=void 0===o.tabIndex?0:o.tabIndex),this.container.className="openseadragon-container",function(e){e.width="100%",e.height="100%",e.position="relative",e.overflow="hidden",e.left="0px",e.top="0px",e.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:e.delegate(this,h),keyHandler:e.delegate(this,p),clickHandler:e.delegate(this,m),dblClickHandler:e.delegate(this,f),dragHandler:e.delegate(this,g),dragEndHandler:e.delegate(this,v),enterHandler:e.delegate(this,_),exitHandler:e.delegate(this,y),pressHandler:e.delegate(this,w),releaseHandler:e.delegate(this,b),nonPrimaryPressHandler:e.delegate(this,x),nonPrimaryReleaseHandler:e.delegate(this,T),scrollHandler:e.delegate(this,k),pinchHandler:e.delegate(this,S)}),this.outerTracker=new e.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,C),exitHandler:e.delegate(this,A)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),t[this.hash].prevContainerSize=n(this.container),this.world=new e.World({viewer:this}),this.world.addHandler("add-item",(function(e){d.source=d.world.getItemAt(0).source,t[d.hash].forceRedraw=!0,d._updateRequestId||(d._updateRequestId=s(d,E))})),this.world.addHandler("remove-item",(function(e){d.world.getItemCount()?d.source=d.world.getItemAt(0).source:d.source=null,t[d.hash].forceRedraw=!0})),this.world.addHandler("metrics-change",(function(e){d.viewport&&d.viewport._setContentBounds(d.world.getHomeBounds(),d.world.getContentFactor())})),this.world.addHandler("item-index-change",(function(e){d.source=d.world.getItemAt(0).source})),this.viewport=new e.Viewport({containerSize:t[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:o.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(r=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(r,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(r=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(r,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new e.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),r=0;r<this.customControls.length;r++)this.addControl(this.customControls[r].id,{anchor:this.customControls[r].anchor});e.requestAnimationFrame((function(){l(d)})),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(t){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(t)},openTileSource:function(t){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(t)},open:function(t,i){var n=this;if(this.close(),t){if(this.sequenceMode&&e.isArray(t))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===i||isNaN(i)||(this.initialPage=i),this.tileSources=t,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),void this._updateSequenceButtons(this._sequenceIndex);if(e.isArray(t)||(t=[t]),t.length){this._opening=!0;for(var r,s=t.length,a=0,l=0,c=function(){if(a+l===s)if(a){!n._firstOpen&&n.preserveViewport||(n.viewport.goHome(!0),n.viewport.update()),n._firstOpen=!1;var e=t[0];if(e.tileSource&&(e=e.tileSource),n.overlays&&!n.preserveOverlays)for(var i=0;i<n.overlays.length;i++)n.currentOverlays[i]=o(n,n.overlays[i]);n._drawOverlays(),n._opening=!1,n.raiseEvent("open",{source:e})}else n._opening=!1,n.raiseEvent("open-failed",r)},d=function(t){e.isPlainObject(t)&&t.tileSource||(t={tileSource:t}),void 0!==t.index&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete t.index),void 0===t.collectionImmediately&&(t.collectionImmediately=!0);var i=t.success;t.success=function(e){if(a++,t.tileSource.overlays)for(var o=0;o<t.tileSource.overlays.length;o++)n.addOverlay(t.tileSource.overlays[o]);i&&i(e),c()};var o=t.error;t.error=function(e){l++,r||(r=e),o&&o(e),c()},n.addTiledImage(t)},u=0;u<t.length;u++)d(t[u]);return this}}},close:function(){return t[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),t[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(t[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),t[this.hash]=null,delete t[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.outerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){var e,t=this.controls.length;for(e=0;e<this.controls.length;e++)t=t&&this.controls[e].isVisible();return t},setControlsEnabled:function(e){return e?c(this):l(this),this.raiseEvent("controls-enabled",{enabled:e}),this},setDebugMode:function(e){for(var t=0;t<this.world.getItemCount();t++)this.world.getItemAt(t).debugMode=e;this.debugMode=e,this.forceRedraw()},isFullPage:function(){return t[this.hash].fullPage},setFullPage:function(i){var n,o,r=document.body,s=r.style,a=document.documentElement.style,l=this;if(i==this.isFullPage())return this;var c={fullPage:i,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",c),c.preventDefaultAction)return this;if(i){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=s.margin,this.docMargin=a.margin,s.margin="0",a.margin="0",this.bodyPadding=s.padding,this.docPadding=a.padding,s.padding="0",a.padding="0",this.bodyWidth=s.width,this.docWidth=a.width,s.width="100%",a.width="100%",this.bodyHeight=s.height,this.docHeight=a.height,s.height="100%",a.height="100%",this.previousBody=[],t[this.hash].prevElementParent=this.element.parentNode,t[this.hash].prevNextSibling=this.element.nextSibling,t[this.hash].prevElementWidth=this.element.style.width,t[this.hash].prevElementHeight=this.element.style.height,n=r.childNodes.length,o=0;o<n;o++)this.previousBody.push(r.childNodes[0]),r.removeChild(r.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,r.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),r.appendChild(this.element),this.element.style.height=e.getWindowSize().y+"px",this.element.style.width=e.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),t[this.hash].fullPage=!0,e.delegate(this,C)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,s.margin=this.bodyMargin,a.margin=this.docMargin,s.padding=this.bodyPadding,a.padding=this.docPadding,s.width=this.bodyWidth,a.width=this.docWidth,s.height=this.bodyHeight,a.height=this.docHeight,r.removeChild(this.element),n=this.previousBody.length,o=0;o<n;o++)r.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),t[this.hash].prevElementParent.insertBefore(this.element,t[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(r.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=t[this.hash].prevElementWidth,this.element.style.height=t[this.hash].prevElementHeight;var d=0,u=function(){e.setPageScroll(l.pageScroll);var t=e.getPageScroll();++d<10&&(t.x!==l.pageScroll.x||t.y!==l.pageScroll.y)&&e.requestAnimationFrame(u)};e.requestAnimationFrame(u),t[this.hash].fullPage=!1,e.delegate(this,A)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:i}),this},setFullScreen:function(t){var i=this;if(!e.supportsFullScreen)return this.setFullPage(t);if(e.isFullScreen()===t)return this;var n={fullScreen:t,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",n),n.preventDefaultAction)return this;if(t){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var o=function(){var t=e.isFullScreen();t||(e.removeEvent(document,e.fullScreenEventName,o),e.removeEvent(document,e.fullScreenErrorEventName,o),i.setFullPage(!1),i.isFullPage()&&(i.element.style.width=i.fullPageStyleWidth,i.element.style.height=i.fullPageStyleHeight)),i.navigator&&i.viewport&&setTimeout((function(){i.navigator.update(i.viewport)})),i.raiseEvent("full-screen",{fullScreen:t})};e.addEvent(document,e.fullScreenEventName,o),e.addEvent(document,e.fullScreenErrorEventName,o),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addTiledImage:function(t){e.console.assert(t,"[Viewer.addTiledImage] options is required"),e.console.assert(t.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!t.replace||t.index>-1&&t.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var i=this;t.replace&&(t.replaceItem=i.world.getItemAt(t.index)),this._hideMessage(),void 0===t.placeholderFillStyle&&(t.placeholderFillStyle=this.placeholderFillStyle),void 0===t.opacity&&(t.opacity=this.opacity),void 0===t.preload&&(t.preload=this.preload),void 0===t.compositeOperation&&(t.compositeOperation=this.compositeOperation),void 0===t.crossOriginPolicy&&(t.crossOriginPolicy=void 0!==t.tileSource.crossOriginPolicy?t.tileSource.crossOriginPolicy:this.crossOriginPolicy),void 0===t.ajaxWithCredentials&&(t.ajaxWithCredentials=this.ajaxWithCredentials),void 0===t.loadTilesWithAjax&&(t.loadTilesWithAjax=this.loadTilesWithAjax),void 0===t.ajaxHeaders||null===t.ajaxHeaders?t.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(t.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(t.ajaxHeaders=e.extend({},this.ajaxHeaders,t.ajaxHeaders));var n={options:t};function o(e){for(var o=0;o<i._loadQueue.length;o++)if(i._loadQueue[o]===n){i._loadQueue.splice(o,1);break}0===i._loadQueue.length&&r(n),i.raiseEvent("add-item-failed",e),t.error&&t.error(e)}function r(e){i.collectionMode&&(i.world.arrange({immediately:e.options.collectionImmediately,rows:i.collectionRows,columns:i.collectionColumns,layout:i.collectionLayout,tileSize:i.collectionTileSize,tileMargin:i.collectionTileMargin}),i.world.setAutoRefigureSizes(!0))}function s(){for(var t,n,o;i._loadQueue.length&&(t=i._loadQueue[0]).tileSource;){if(i._loadQueue.splice(0,1),t.options.replace){var s=i.world.getIndexOfItem(t.options.replaceItem);-1!=s&&(t.options.index=s),i.world.removeItem(t.options.replaceItem)}n=new e.TiledImage({viewer:i,source:t.tileSource,viewport:i.viewport,drawer:i.drawer,tileCache:i.tileCache,imageLoader:i.imageLoader,x:t.options.x,y:t.options.y,width:t.options.width,height:t.options.height,fitBounds:t.options.fitBounds,fitBoundsPlacement:t.options.fitBoundsPlacement,clip:t.options.clip,placeholderFillStyle:t.options.placeholderFillStyle,opacity:t.options.opacity,preload:t.options.preload,degrees:t.options.degrees,compositeOperation:t.options.compositeOperation,springStiffness:i.springStiffness,animationTime:i.animationTime,minZoomImageRatio:i.minZoomImageRatio,wrapHorizontal:i.wrapHorizontal,wrapVertical:i.wrapVertical,immediateRender:i.immediateRender,blendTime:i.blendTime,alwaysBlend:i.alwaysBlend,minPixelRatio:i.minPixelRatio,smoothTileEdgesMinZoom:i.smoothTileEdgesMinZoom,iOSDevice:i.iOSDevice,crossOriginPolicy:t.options.crossOriginPolicy,ajaxWithCredentials:t.options.ajaxWithCredentials,loadTilesWithAjax:t.options.loadTilesWithAjax,ajaxHeaders:t.options.ajaxHeaders,debugMode:i.debugMode}),i.collectionMode&&i.world.setAutoRefigureSizes(!1),i.world.addItem(n,{index:t.options.index}),0===i._loadQueue.length&&r(t),1!==i.world.getItemCount()||i.preserveViewport||i.viewport.goHome(!0),i.navigator&&(o=e.extend({},t.options,{replace:!1,originalTiledImage:n,tileSource:t.tileSource}),i.navigator.addTiledImage(o)),t.options.success&&t.options.success({item:n})}}e.isArray(t.tileSource)?setTimeout((function(){o({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:t.tileSource,options:t})})):(this._loadQueue.push(n),function(t,i,n,o,r){var s=t;if("string"==e.type(i))if(i.match(/^\s*<.*>\s*$/))i=e.parseXml(i);else if(i.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var a=e.parseJSON(i);i=a}catch(e){}function l(e,t){e.ready?o(e):(e.addHandler("ready",(function(){o(e)})),e.addHandler("open-failed",(function(e){r({message:e.message,source:t})})))}setTimeout((function(){if("string"==e.type(i))(i=new e.TileSource({url:i,crossOriginPolicy:void 0!==n.crossOriginPolicy?n.crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,ajaxHeaders:t.ajaxHeaders,useCanvas:t.useCanvas,success:function(e){o(e.tileSource)}})).addHandler("open-failed",(function(e){r(e)}));else if(e.isPlainObject(i)||i.nodeType)if(void 0!==i.crossOriginPolicy||void 0===n.crossOriginPolicy&&void 0===t.crossOriginPolicy||(i.crossOriginPolicy=void 0!==n.crossOriginPolicy?n.crossOriginPolicy:t.crossOriginPolicy),void 0===i.ajaxWithCredentials&&(i.ajaxWithCredentials=t.ajaxWithCredentials),void 0===i.useCanvas&&(i.useCanvas=t.useCanvas),e.isFunction(i.getTileUrl)){var a=new e.TileSource(i);a.getTileUrl=i.getTileUrl,o(a)}else{var c=e.TileSource.determineType(s,i);if(!c)return void r({message:"Unable to load TileSource",source:i});var d=c.prototype.configure.apply(s,[i]);l(new c(d),i)}else l(i,i)}))}(this,t.tileSource,t,(function(e){n.tileSource=e,s()}),(function(e){e.options=t,o(e),s()})))},addSimpleImage:function(t){e.console.assert(t,"[Viewer.addSimpleImage] options is required"),e.console.assert(t.url,"[Viewer.addSimpleImage] options.url is required");var i=e.extend({},t,{tileSource:{type:"image",url:t.url}});delete i.url,this.addTiledImage(i)},addLayer:function(t){var i=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var n=e.extend({},t,{success:function(e){i.raiseEvent("add-layer",{options:t,drawer:e.item})},error:function(e){i.raiseEvent("add-layer-failed",e)}});return this.addTiledImage(n),this},getLayerAtLevel:function(t){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(t)},getLevelOfLayer:function(t){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(t)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(t,i){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(t,i)},removeLayer:function(t){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(t)},forceRedraw:function(){return t[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var t=e.delegate(this,d),i=e.delegate(this,u),n=e.delegate(this,q),o=e.delegate(this,V),r=this.navImages,s=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(s=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:N(this.prefixUrl,r.previous.REST),srcGroup:N(this.prefixUrl,r.previous.GROUP),srcHover:N(this.prefixUrl,r.previous.HOVER),srcDown:N(this.prefixUrl,r.previous.DOWN),onRelease:o,onFocus:t,onBlur:i}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:N(this.prefixUrl,r.next.REST),srcGroup:N(this.prefixUrl,r.next.GROUP),srcHover:N(this.prefixUrl,r.next.HOVER),srcDown:N(this.prefixUrl,r.next.DOWN),onRelease:n,onFocus:t,onBlur:i}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),s&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var t=e.delegate(this,O),i=e.delegate(this,M),n=e.delegate(this,F),o=e.delegate(this,P),r=e.delegate(this,D),s=e.delegate(this,z),a=e.delegate(this,L),l=e.delegate(this,B),c=e.delegate(this,$),h=e.delegate(this,W),p=e.delegate(this,d),m=e.delegate(this,u),f=this.navImages,g=[],v=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(v=!1),this.showZoomControl&&(g.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:N(this.prefixUrl,f.zoomIn.REST),srcGroup:N(this.prefixUrl,f.zoomIn.GROUP),srcHover:N(this.prefixUrl,f.zoomIn.HOVER),srcDown:N(this.prefixUrl,f.zoomIn.DOWN),onPress:t,onRelease:i,onClick:n,onEnter:t,onExit:i,onFocus:p,onBlur:m})),g.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:N(this.prefixUrl,f.zoomOut.REST),srcGroup:N(this.prefixUrl,f.zoomOut.GROUP),srcHover:N(this.prefixUrl,f.zoomOut.HOVER),srcDown:N(this.prefixUrl,f.zoomOut.DOWN),onPress:o,onRelease:i,onClick:r,onEnter:o,onExit:i,onFocus:p,onBlur:m}))),this.showHomeControl&&g.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:N(this.prefixUrl,f.home.REST),srcGroup:N(this.prefixUrl,f.home.GROUP),srcHover:N(this.prefixUrl,f.home.HOVER),srcDown:N(this.prefixUrl,f.home.DOWN),onRelease:s,onFocus:p,onBlur:m})),this.showFullPageControl&&g.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:N(this.prefixUrl,f.fullpage.REST),srcGroup:N(this.prefixUrl,f.fullpage.GROUP),srcHover:N(this.prefixUrl,f.fullpage.HOVER),srcDown:N(this.prefixUrl,f.fullpage.DOWN),onRelease:a,onFocus:p,onBlur:m})),this.showRotationControl&&(g.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:N(this.prefixUrl,f.rotateleft.REST),srcGroup:N(this.prefixUrl,f.rotateleft.GROUP),srcHover:N(this.prefixUrl,f.rotateleft.HOVER),srcDown:N(this.prefixUrl,f.rotateleft.DOWN),onRelease:l,onFocus:p,onBlur:m})),g.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:N(this.prefixUrl,f.rotateright.REST),srcGroup:N(this.prefixUrl,f.rotateright.GROUP),srcHover:N(this.prefixUrl,f.rotateright.HOVER),srcDown:N(this.prefixUrl,f.rotateright.DOWN),onRelease:c,onFocus:p,onBlur:m}))),this.showFlipControl&&g.push(this.flipButton=new e.Button({element:this.flipButton?e.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Flip"),srcRest:N(this.prefixUrl,f.flip.REST),srcGroup:N(this.prefixUrl,f.flip.GROUP),srcHover:N(this.prefixUrl,f.flip.HOVER),srcDown:N(this.prefixUrl,f.flip.DOWN),onRelease:h,onFocus:p,onBlur:m})),v&&(this.buttons=new e.ButtonGroup({buttons:g,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",e.delegate(this,j)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(e){return this.tileSources&&e>=0&&e<this.tileSources.length&&(this._sequenceIndex=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e),this.raiseEvent("page",{page:e})),this},addOverlay:function(t,i,n,s){var a;if(a=e.isPlainObject(t)?t:{element:t,location:i,placement:n,onDraw:s},t=e.getElement(a.element),r(this.currentOverlays,t)>=0)return this;var l=o(this,a);return this.currentOverlays.push(l),l.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:t,location:a.location,placement:a.placement}),this},updateOverlay:function(i,n,o){var s;return i=e.getElement(i),(s=r(this.currentOverlays,i))>=0&&(this.currentOverlays[s].update(n,o),t[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:i,location:n,placement:o})),this},removeOverlay:function(i){var n;return i=e.getElement(i),(n=r(this.currentOverlays,i))>=0&&(this.currentOverlays[n].destroy(),this.currentOverlays.splice(n,1),t[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:i})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return t[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(t){var i;return t=e.getElement(t),(i=r(this.currentOverlays,t))>=0?this.currentOverlays[i]:null},_updateSequenceButtons:function(e){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==e?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(e>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(t){this._hideMessage();var i=e.makeNeutralElement("div");i.appendChild(document.createTextNode(t)),this.messageDiv=e.makeCenteredNode(i),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){switch(e){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var e,t=this.currentOverlays.length;for(e=0;e<t;e++)this.currentOverlays[e].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function(e){function t(e){var t={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",t),!t.preventDefaultAction&&e.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(e.position.x=this.viewport.getContainerSize().x-e.position.x);var i=this.viewport.pointFromPixel(e.position);this.panVertical?this.panHorizontal||(i.x=this.viewer.viewport.getCenter(!0).x):i.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(i),this.viewer.viewport.applyConstraints()}}function i(e){var t={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",t),!t.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.flipped&&(e.delta.x=-e.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function o(e){return this.viewer.raiseEvent("navigator-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),!1}function r(e,t){s(e,"rotate("+t+"deg)")}function s(e,t){e.style.webkitTransform=t,e.style.mozTransform=t,e.style.msTransform=t,e.style.oTransform=t,e.style.transform=t}e.Navigator=function(s){var a,l,c,d,u=s.viewer,h=this;function p(e){r(h.displayRegionContainer,e),r(h.displayRegion,-e),h.viewport.setRotation(e)}(s.id?(this.element=document.getElementById(s.id),s.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(s.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),s.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:s.autoFade},s.position&&("BOTTOM_RIGHT"==s.position?s.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==s.position?s.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==s.position?s.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==s.position?s.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"==s.position&&(s.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,s.controlOptions.top=s.top,s.controlOptions.left=s.left,s.controlOptions.height=s.height,s.controlOptions.width=s.width))),this.element.id=s.id,this.element.className+=" navigator",(s=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},s,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:s.autoResize,minZoomImageRatio:1,background:s.background,opacity:s.opacity,borderColor:s.borderColor,displayRegionColor:s.displayRegionColor})).minPixelRatio=this.minPixelRatio=u.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),s.controlOptions.anchor!=e.ControlAnchor.NONE&&(c=this.element.style,d=this.borderWidth,c.margin="0px",c.border=d+"px solid "+s.borderColor,c.padding="0px",c.background=s.background,c.opacity=s.opacity,c.overflow="hidden"),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,t){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.overflow="hidden",e.border=t+"px solid "+s.displayRegionColor,e.margin="0px",e.padding="0px",e.background="transparent",e.float="left",e.cssFloat="left",e.styleFloat="left",e.zIndex=999999999,e.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",u.addControl(this.element,s.controlOptions),this._resizeWithViewer=s.controlOptions.anchor!=e.ControlAnchor.ABSOLUTE&&s.controlOptions.anchor!=e.ControlAnchor.NONE,s.width&&s.height?(this.setWidth(s.width),this.setHeight(s.height)):this._resizeWithViewer&&(a=e.getElementSize(u.element),this.element.style.height=Math.round(a.y*s.sizeRatio)+"px",this.element.style.width=Math.round(a.x*s.sizeRatio)+"px",this.oldViewerSize=a,l=e.getElementSize(this.element),this.elementArea=l.x*l.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[s]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),s.navigatorRotate)&&(p(s.viewer.viewport?s.viewer.viewport.getRotation():s.viewer.degrees||0),s.viewer.addHandler("rotate",(function(e){p(e.degrees)})));this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,i),clickHandler:e.delegate(this,t),releaseHandler:e.delegate(this,n),scrollHandler:e.delegate(this,o)}),this.addHandler("reset-size",(function(){h.viewport&&h.viewport.goHome(!0)})),u.world.addHandler("item-index-change",(function(e){window.setTimeout((function(){var t=h.world.getItemAt(e.previousIndex);h.world.setItemIndex(t,e.newIndex)}),1)})),u.world.addHandler("remove-item",(function(e){var t=e.item,i=h._getMatchingItem(t);i&&h.world.removeItem(i)})),this.update(u.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var t=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);t.equals(this.oldContainerSize)||(this.viewport.resize(t,!0),this.viewport.goHome(!0),this.oldContainerSize=t,this.drawer.clear(),this.world.draw())}},setWidth:function(e){this.width=e,this.element.style.width="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setHeight:function(e){this.height=e,this.element.style.height="number"==typeof e?e+"px":e,this._resizeWithViewer=!1},setFlip:function(e){return this.viewport.setFlip(e),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(e){s(this.displayRegion,e),s(this.canvas,e),s(this.element,e)},update:function(t){var i,n,o,r,s,a;if(i=e.getElementSize(this.viewer.element),this._resizeWithViewer&&i.x&&i.y&&!i.equals(this.oldViewerSize)&&(this.oldViewerSize=i,this.maintainSizeRatio||!this.elementArea?(n=i.x*this.sizeRatio,o=i.y*this.sizeRatio):(n=Math.sqrt(this.elementArea*(i.x/i.y)),o=this.elementArea/n),this.element.style.width=Math.round(n)+"px",this.element.style.height=Math.round(o)+"px",this.elementArea||(this.elementArea=n*o),this.updateSize()),t&&this.viewport){r=t.getBoundsNoRotate(!0),s=this.viewport.pixelFromPointNoRotate(r.getTopLeft(),!1),a=this.viewport.pixelFromPointNoRotate(r.getBottomRight(),!1).minus(this.totalBorderWidths);var l=this.displayRegion.style;l.display=this.world.getItemCount()?"block":"none",l.top=Math.round(s.y)+"px",l.left=Math.round(s.x)+"px";var c=Math.abs(s.x-a.x),d=Math.abs(s.y-a.y);l.width=Math.round(Math.max(c,0))+"px",l.height=Math.round(Math.max(d,0))+"px"}},addTiledImage:function(t){var i=this,n=t.originalTiledImage;delete t.original;var o=e.extend({},t,{success:function(e){var t=e.item;function o(){i._matchBounds(t,n)}t._originalForNavigator=n,i._matchBounds(t,n,!0),n.addHandler("bounds-change",o),n.addHandler("clip-change",o),n.addHandler("opacity-change",(function(){i._matchOpacity(t,n)})),n.addHandler("composite-operation-change",(function(){i._matchCompositeOperation(t,n)}))}});return e.Viewer.prototype.addTiledImage.apply(this,[o])},_getMatchingItem:function(e){for(var t,i=this.world.getItemCount(),n=0;n<i;n++)if((t=this.world.getItemAt(n))._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,i){var n=t.getBoundsNoRotate();e.setPosition(n.getTopLeft(),i),e.setWidth(n.width,i),e.setRotation(t.getRotation(),i),e.setClip(t.getClip())},_matchOpacity:function(e,t){e.setOpacity(t.opacity)},_matchCompositeOperation:function(e,t){e.setCompositeOperation(t.compositeOperation)}})}(OpenSeadragon),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};e.extend(e,{getString:function(i){var n,o=i.split("."),r=null,s=arguments,a=t;for(n=0;n<o.length-1;n++)a=a[o[n]]||{};return"string"!=typeof(r=a[o[n]])&&(e.console.log("Untranslated source string:",i),r=""),r.replace(/\{\d+\}/g,(function(e){var t=parseInt(e.match(/\d+/),10)+1;return t<s.length?s[t]:""}))},setString:function(e,i){var n,o=e.split("."),r=t;for(n=0;n<o.length-1;n++)r[o[n]]||(r[o[n]]={}),r=r[o[n]];r[o[n]]=i}})}(OpenSeadragon),function(e){e.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},squaredDistanceTo:function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,i){var n,o;if(i=i||new e.Point(0,0),t%90==0){switch(e.positiveModulo(t,360)){case 0:n=1,o=0;break;case 90:n=0,o=1;break;case 180:n=-1,o=0;break;case 270:n=0,o=-1}}else{var r=t*Math.PI/180;n=Math.cos(r),o=Math.sin(r)}var s=n*(this.x-i.x)-o*(this.y-i.y)+i.x,a=o*(this.x-i.x)+n*(this.y-i.y)+i.y;return new e.Point(s,a)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(e){e.TileSource=function(t,i,n,o,r,s){var a,l,c=this,d=arguments;if(a=e.isPlainObject(t)?t:{width:d[0],height:d[1],tileSize:d[2],tileOverlap:d[3],minLevel:d[4],maxLevel:d[5]},e.EventSource.call(this),e.extend(!0,this,a),!this.success)for(l=0;l<arguments.length;l++)if(e.isFunction(arguments[l])){this.success=arguments[l];break}this.success&&this.addHandler("ready",(function(e){c.success(e)})),"string"==e.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=a.width&&a.height?a.width/a.height:1,this.dimensions=new e.Point(a.width,a.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=a.tileOverlap?a.tileOverlap:0,this.minLevel=a.minLevel?a.minLevel:0,this.maxLevel=void 0!==a.maxLevel&&null!==a.maxLevel?a.maxLevel:a.width&&a.height?Math.ceil(Math.log(Math.max(a.width,a.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(t){return e.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth?this._tileWidth:this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight?this._tileHeight:this.getTileSize(e)},getLevelScale:function(e){var t,i={};for(t=0;t<=this.maxLevel;t++)i[t]=1/Math.pow(2,this.maxLevel-t);return this.getLevelScale=function(e){return i[e]},this.getLevelScale(e)},getNumTiles:function(t){var i=this.getLevelScale(t),n=Math.ceil(i*this.dimensions.x/this.getTileWidth(t)),o=Math.ceil(i*this.dimensions.y/this.getTileHeight(t));return new e.Point(n,o)},getPixelRatio:function(t){var i=this.dimensions.times(this.getLevelScale(t)),n=1/i.x,o=1/i.y;return new e.Point(n,o)},getClosestLevel:function(){var e,t;for(e=this.minLevel+1;e<=this.maxLevel&&!((t=this.getNumTiles(e)).x>1||t.y>1);e++);return e-1},getTileAtPoint:function(t,i){var n=i.x>=0&&i.x<=1&&i.y>=0&&i.y<=1/this.aspectRatio;e.console.assert(n,"[TileSource.getTileAtPoint] must be called with a valid point.");var o=this.dimensions.x*this.getLevelScale(t),r=i.x*o,s=i.y*o,a=Math.floor(r/this.getTileWidth(t)),l=Math.floor(s/this.getTileHeight(t));i.x>=1&&(a=this.getNumTiles(t).x-1);return i.y>=1/this.aspectRatio-1e-15&&(l=this.getNumTiles(t).y-1),new e.Point(a,l)},getTileBounds:function(t,i,n,o){var r=this.dimensions.times(this.getLevelScale(t)),s=this.getTileWidth(t),a=this.getTileHeight(t),l=0===i?0:s*i-this.tileOverlap,c=0===n?0:a*n-this.tileOverlap,d=s+(0===i?1:2)*this.tileOverlap,u=a+(0===n?1:2)*this.tileOverlap,h=1/r.x;return d=Math.min(d,r.x-l),u=Math.min(u,r.y-c),o?new e.Rect(0,0,d,u):new e.Rect(l*h,c*h,d*h,u*h)},getImageInfo:function(t){var i,n,o,r,s,a,l,c=this;t&&(l=(a=(s=t.split("/"))[s.length-1]).lastIndexOf("."))>-1&&(s[s.length-1]=a.slice(0,l)),n=function(i){"string"==typeof i&&(i=e.parseXml(i));var n=e.TileSource.determineType(c,i,t);n?(void 0===(r=n.prototype.configure.apply(c,[i,t])).ajaxWithCredentials&&(r.ajaxWithCredentials=c.ajaxWithCredentials),o=new n(r),c.ready=!0,c.raiseEvent("ready",{tileSource:o})):c.raiseEvent("open-failed",{message:"Unable to load TileSource",source:t})},t.match(/\.js$/)?(i=t.split("/").pop().replace(".js",""),e.jsonp({url:t,async:!1,callbackName:i,callback:n})):e.makeAjaxRequest({url:t,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(t){var i=function(t){var i,n,o=t.responseText,r=t.status;if(!t)throw new Error(e.getString("Errors.Security"));if(200!==t.status&&0!==t.status)throw i=404==(r=t.status)?"Not Found":t.statusText,new Error(e.getString("Errors.Status",r,i));if(o.match(/\s*<.*/))try{n=t.responseXML&&t.responseXML.documentElement?t.responseXML:e.parseXml(o)}catch(e){n=t.responseText}else if(o.match(/\s*[\{\[].*/))try{n=e.parseJSON(o)}catch(e){n=o}else n=o;return n}(t);n(i)},error:function(e,i){var n;try{n="HTTP "+e.status+" attempting to load TileSource"}catch(e){n=(void 0!==i&&i.toString?i.toString():"Unknown error")+" attempting to load TileSource"}c.raiseEvent("open-failed",{message:n,source:t})}})},supports:function(e,t){return!1},configure:function(e,t){throw new Error("Method not implemented.")},getTileUrl:function(e,t,i){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(e,t,i){return{}},tileExists:function(e,t,i){var n=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&t>=0&&i>=0&&t<n.x&&i<n.y}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype),e.TileSource.determineType=function(t,i,n){var o;for(o in OpenSeadragon)if(o.match(/.+TileSource$/)&&e.isFunction(OpenSeadragon[o])&&e.isFunction(OpenSeadragon[o].prototype.supports)&&OpenSeadragon[o].prototype.supports.call(t,i,n))return OpenSeadragon[o];e.console.error("No TileSource was able to open %s %s",n,i)}}(OpenSeadragon),function(e){function t(t,i){var n,o,r=i.Image,s=r.Url,a=r.Format,l=r.Size,c=r.DisplayRect||[],d=parseInt(l.Width,10),u=parseInt(l.Height,10),h=parseInt(r.TileSize,10),p=parseInt(r.Overlap,10),m=[];for(o=0;o<c.length;o++)n=c[o].Rect,m.push(new e.DisplayRect(parseInt(n.X,10),parseInt(n.Y,10),parseInt(n.Width,10),parseInt(n.Height,10),parseInt(n.MinLevel,10),parseInt(n.MaxLevel,10)));return e.extend(!0,{width:d,height:u,tileSize:h,tileOverlap:p,minLevel:null,maxLevel:null,tilesUrl:s,fileFormat:a,displayRects:m},i)}e.DziTileSource=function(t,i,n,o,r,s,a,l,c){var d,u,h,p;if(p=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=p.tilesUrl,this.fileFormat=p.fileFormat,this.displayRects=p.displayRects,this.displayRects)for(d=this.displayRects.length-1;d>=0;d--)for(h=(u=this.displayRects[d]).minLevel;h<=u.maxLevel;h++)this._levelRects[h]||(this._levelRects[h]=[]),this._levelRects[h].push(u);e.TileSource.apply(this,[p])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){var i;return e.Image?i=e.Image.xmlns:e.documentElement&&("Image"!=e.documentElement.localName&&"Image"!=e.documentElement.tagName||(i=e.documentElement.namespaceURI)),-1!==(i=(i||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==i.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(i,n){var o;return o=e.isPlainObject(i)?t(this,i):function(i,n){if(!n||!n.documentElement)throw new Error(e.getString("Errors.Xml"));var o,r,s,a,l,c=n.documentElement,d=c.localName||c.tagName,u=n.documentElement.namespaceURI,h=null,p=[];if("Image"==d)try{if(void 0===(a=c.getElementsByTagName("Size")[0])&&(a=c.getElementsByTagNameNS(u,"Size")[0]),h={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:c.getAttribute("Url"),Format:c.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(c.getAttribute("Overlap"),10),TileSize:parseInt(c.getAttribute("TileSize"),10),Size:{Height:parseInt(a.getAttribute("Height"),10),Width:parseInt(a.getAttribute("Width"),10)}}},!e.imageFormatSupported(h.Image.Format))throw new Error(e.getString("Errors.ImageFormat",h.Image.Format.toUpperCase()));for(void 0===(o=c.getElementsByTagName("DisplayRect"))&&(o=c.getElementsByTagNameNS(u,"DisplayRect")[0]),l=0;l<o.length;l++)void 0===(s=(r=o[l]).getElementsByTagName("Rect")[0])&&(s=r.getElementsByTagNameNS(u,"Rect")[0]),p.push({Rect:{X:parseInt(s.getAttribute("X"),10),Y:parseInt(s.getAttribute("Y"),10),Width:parseInt(s.getAttribute("Width"),10),Height:parseInt(s.getAttribute("Height"),10),MinLevel:parseInt(r.getAttribute("MinLevel"),10),MaxLevel:parseInt(r.getAttribute("MaxLevel"),10)}});return p.length&&(h.Image.DisplayRect=p),t(i,h)}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.Dzi"))}else{if("Collection"==d)throw new Error(e.getString("Errors.Dzc"));if("Error"==d){var m=c.getElementsByTagName("Message")[0].firstChild.nodeValue;throw new Error(m)}}throw new Error(e.getString("Errors.Dzi"))}(this,i),n&&!o.tilesUrl&&(o.tilesUrl=n.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=n.search(/\.(dzi|xml|js)\?/)?o.queryParams=n.match(/\?.*/):o.queryParams=""),o},getTileUrl:function(e,t,i){return[this.tilesUrl,e,"/",t,"_",i,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,t,i){var n,o,r,s,a,l,c,d=this._levelRects[e];if(this.minLevel&&e<this.minLevel||this.maxLevel&&e>this.maxLevel)return!1;if(!d||!d.length)return!0;for(c=d.length-1;c>=0;c--)if(!(e<(n=d[c]).minLevel||e>n.maxLevel)&&(o=this.getLevelScale(e),r=n.x*o,s=n.y*o,a=r+n.width*o,l=s+n.height*o,r=Math.floor(r/this._tileWidth),s=Math.floor(s/this._tileWidth),a=Math.ceil(a/this._tileWidth),l=Math.ceil(l/this._tileWidth),r<=t&&t<a&&s<=i&&i<l))return!0;return!1}})}(OpenSeadragon),function(e){function t(e){var t=Array.isArray(e.profile)?e.profile[0]:e.profile,i=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(t),n=!1;return 2===e.version&&e.profile.length>1&&e.profile[1].supports&&(n=-1!==e.profile[1].supports.indexOf("sizeByW")),3===e.version&&e.extraFeatures&&(n=-1!==e.extraFeatures.indexOf("sizeByWh")),!i||n}function i(e){for(var t=[],i=0;i<e.sizes.length;i++)t.push({url:e["@id"]+"/full/"+e.sizes[i].width+","+(3===e.version?e.sizes[i].height:"")+"/0/default."+e.tileFormat,width:e.sizes[i].width,height:e.sizes[i].height});return t.sort((function(e,t){return e.width-t.width}))}function n(t,i,o){var r,s;if(3==t.nodeType&&o)(s=t.nodeValue.trim()).match(/^\d*$/)&&(s=Number(s)),i[o]?(e.isArray(i[o])||(i[o]=[i[o]]),i[o].push(s)):i[o]=s;else if(1==t.nodeType)for(r=0;r<t.childNodes.length;r++)n(t.childNodes[r],i,t.nodeName)}e.IIIFTileSource=function(n){if(e.extend(!0,this,n),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(n.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=n.version,this.tile_width&&this.tile_height)n.tileWidth=this.tile_width,n.tileHeight=this.tile_height;else if(this.tile_width)n.tileSize=this.tile_width;else if(this.tile_height)n.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)n.tileWidth=this.tiles[0].width,n.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var o=0;o<this.tiles.length;o++)for(var r=0;r<this.tiles[o].scaleFactors.length;r++){var s=this.tiles[o].scaleFactors[r];this.scale_factors.push(s),n.tileSizePerScaleFactor[s]={width:this.tiles[o].width,height:this.tiles[o].height||this.tiles[o].width}}}else if(t(n)){for(var a=Math.min(this.height,this.width),l=[256,512,1024],c=[],d=0;d<l.length;d++)l[d]<=a&&c.push(l[d]);c.length>0?n.tileSize=Math.max.apply(null,c):n.tileSize=a}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,n.levels=i(this),e.extend(!0,n,{width:n.levels[n.levels.length-1].width,height:n.levels[n.levels.length-1].height,tileSize:Math.max(n.height,n.width),tileOverlap:0,minLevel:0,maxLevel:n.levels.length-1}),this.levels=n.levels):e.console.error("Nothing in the info.json to construct image pyramids from");if(!n.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var u=Math.max.apply(null,this.scale_factors);n.maxLevel=Math.round(Math.log(u)*Math.LOG2E)}else n.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));e.TileSource.apply(this,[n])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return!(!e.protocol||"http://iiif.io/api/image"!=e.protocol)||(!(!e["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"!=e["@context"]&&"http://iiif.io/api/image/1/context.json"!=e["@context"])||(!(!e.profile||0!==e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html"))||(!!(e.identifier&&e.width&&e.height)||!(!e.documentElement||"info"!=e.documentElement.tagName||"http://library.stanford.edu/iiif/image-api/ns/"!=e.documentElement.namespaceURI))))},configure:function(t,i){if(e.isPlainObject(t)){if(t["@context"]){var o=t["@context"];if(Array.isArray(o))for(var r=0;r<o.length;r++)if("string"==typeof o[r]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(o[r])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===o[r])){o=o[r];break}switch(o){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":t.version=1;break;case"http://iiif.io/api/image/2/context.json":t.version=2;break;case"http://iiif.io/api/image/3/context.json":t.version=3;break;default:e.console.error("Data has a @context property which contains no known IIIF context URI.")}}else t["@context"]="http://iiif.io/api/image/1.0/context.json",t["@id"]=i.replace("/info.json",""),t.version=1;if(!t["@id"]&&t.id&&(t["@id"]=t.id),t.preferredFormats)for(var s=0;s<t.preferredFormats.length;s++)if(OpenSeadragon.imageFormatSupported(t.preferredFormats[s])){t.tileFormat=t.preferredFormats[s];break}return t}var a=function(t){if(!t||!t.documentElement)throw new Error(e.getString("Errors.Xml"));var i=t.documentElement,o=i.tagName,r=null;if("info"==o)try{return n(i,r={}),r}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}(t);return a["@context"]="http://iiif.io/api/image/1.0/context.json",a["@id"]=i.replace("/info.xml",""),a.version=1,a},getTileWidth:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,t);var i=Math.pow(2,this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].width:this._tileWidth},getTileHeight:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,t);var i=Math.pow(2,this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].height:this._tileHeight},getLevelScale:function(t){if(this.emulateLegacyImagePyramid){var i=NaN;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(i=this.levels[t].width/this.levels[this.maxLevel].width),i}return e.TileSource.prototype.getLevelScale.call(this,t)},getNumTiles:function(t){return this.emulateLegacyImagePyramid?this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0):e.TileSource.prototype.getNumTiles.call(this,t)},getTileAtPoint:function(t,i){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,t,i)},getTileUrl:function(e,t,i){if(this.emulateLegacyImagePyramid){var n=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n}var o,r,s,a,l,c,d,u,h,p,m,f,g,v=Math.pow(.5,this.maxLevel-e),_=Math.ceil(this.width*v),y=Math.ceil(this.height*v);return o=this.getTileWidth(e),r=this.getTileHeight(e),s=Math.ceil(o/v),a=Math.ceil(r/v),g=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,_<o&&y<r?(p=2===this.version&&_===this.width||3===this.version&&_===this.width&&y===this.height?"max":3===this.version?_+","+y:_+",",l="full"):(c=t*s,d=i*a,u=Math.min(s,this.width-c),h=Math.min(a,this.height-d),l=0===t&&0===i&&u===this.width&&h===this.height?"full":[c,d,u,h].join(","),m=Math.ceil(u*v),f=Math.ceil(h*v),p=2===this.version&&m===this.width||3===this.version&&m===this.width&&f===this.height?"max":3===this.version?m+","+f:m+","),[this["@id"],l,p,"0",g].join("/")},__testonly__:{canBeTiled:t,constructLevels:i}})}(OpenSeadragon),function(e){e.OsmTileSource=function(t,i,n,o,r){var s;(s=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]}).width&&s.height||(s.width=65572864,s.height=65572864),s.tileSize||(s.tileSize=256,s.tileOverlap=0),s.tilesUrl||(s.tilesUrl="http://tile.openstreetmap.org/"),s.minLevel=8,e.TileSource.apply(this,[s])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"openstreetmaps"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){return this.tilesUrl+(e-8)+"/"+t+"/"+i+".png"}})}(OpenSeadragon),function(e){e.TmsTileSource=function(t,i,n,o,r){var s;s=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var a,l=256*Math.ceil(s.width/256),c=256*Math.ceil(s.height/256);a=l>c?l/256:c/256,s.maxLevel=Math.ceil(Math.log(a)/Math.log(2))-1,s.tileSize=256,s.width=l,s.height=c,e.TileSource.apply(this,[s])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"tiledmapservice"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){var n=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(n-i)+".png"}})}(OpenSeadragon),function(e){e.ZoomifyTileSource=function(e){e.tileSize=256;var t={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(t.x,10)>e.tileSize||parseInt(t.y,10)>e.tileSize;)t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),e.imageSizes.push({x:t.x,y:t.y}),e.gridSize.push(this._getGridSize(t.x,t.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[e])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(e,t,i){return{x:Math.ceil(e/i),y:Math.ceil(t/i)}},_calculateAbsoluteTileNumber:function(e,t,i){for(var n=0,o={},r=0;r<e;r++)n+=(o=this.gridSize[r]).x*o.y;return n+=(o=this.gridSize[e]).x*i+t},supports:function(e,t){return e.type&&"zoomifytileservice"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){var n,o=this._calculateAbsoluteTileNumber(e,t,i);return n=Math.floor(o/256),this.tilesUrl+"TileGroup"+n+"/"+e+"-"+t+"-"+i+".jpg"}})}(OpenSeadragon),function(e){function t(e,t){return t.levels}e.LegacyTileSource=function(t){var i,n,o;e.isArray(t)&&(i={type:"legacy-image-pyramid",levels:t}),i.levels=function(t){var i,n,o=[];for(n=0;n<t.length;n++)(i=t[n]).height&&i.width&&i.url?o.push({url:i.url,width:Number(i.width),height:Number(i.height)}):e.console.error("Unsupported image format: %s",i.url?i.url:"<no URL>");return o.sort((function(e,t){return e.height-t.height}))}(i.levels),i.levels.length>0?(n=i.levels[i.levels.length-1].width,o=i.levels[i.levels.length-1].height):(n=0,o=0,e.console.error("No supported image formats found")),e.extend(!0,i,{width:n,height:o,tileSize:Math.max(o,n),tileOverlap:0,minLevel:0,maxLevel:i.levels.length>0?i.levels.length-1:0}),e.TileSource.apply(this,[i]),this.levels=i.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"legacy-image-pyramid"==e.type||e.documentElement&&"legacy-image-pyramid"==e.documentElement.getAttribute("type")},configure:function(i,n){return e.isPlainObject(i)?t(this,i):function(i,n){if(!n||!n.documentElement)throw new Error(e.getString("Errors.Xml"));var o,r,s=n.documentElement,a=s.tagName,l=null,c=[];if("image"==a)try{for(l={type:s.getAttribute("type"),levels:[]},c=s.getElementsByTagName("level"),r=0;r<c.length;r++)o=c[r],l.levels.push({url:o.getAttribute("url"),width:parseInt(o.getAttribute("width"),10),height:parseInt(o.getAttribute("height"),10)});return t(i,l)}catch(e){throw e instanceof Error?e:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==a)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==a)throw new Error("Error: "+n)}throw new Error("Unknown element "+a)}(this,i)},getLevelScale:function(e){var t=NaN;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e,t,i){var n=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n}})}(OpenSeadragon),function(e){e.ImageTileSource=function(t){t=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},t),e.TileSource.apply(this,[t])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"image"===e.type},configure:function(e,t){return e},getImageInfo:function(t){var i=this._image=new Image,n=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),e.addEvent(i,"load",(function(){n.width=Object.prototype.hasOwnProperty.call(i,"naturalWidth")?i.naturalWidth:i.width,n.height=Object.prototype.hasOwnProperty.call(i,"naturalHeight")?i.naturalHeight:i.height,n.aspectRatio=n.width/n.height,n.dimensions=new e.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})})),e.addEvent(i,"error",(function(){n.raiseEvent("open-failed",{message:"Error loading image at "+t,source:t})})),i.src=t},getLevelScale:function(e){var t=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e,t,i){var n=null;return e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n},getContext2D:function(e,t,i){var n=null;return e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].context2D),n},_buildLevels:function(){var t=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,t;var i=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,n=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,o=document.createElement("canvas"),r=o.getContext("2d");if(o.width=i,o.height=n,r.drawImage(this._image,0,0,i,n),t[0].context2D=r,delete this._image,e.isCanvasTainted(o))return t;for(;i>=2&&n>=2;){i=Math.floor(i/2),n=Math.floor(n/2);var s=document.createElement("canvas"),a=s.getContext("2d");s.width=i,s.height=n,a.drawImage(o,0,0,i,n),t.splice(0,0,{context2D:a,width:i,height:n}),o=s,r=a}return t}})}(OpenSeadragon),function(e){e.TileSourceCollection=function(t,i,n,o){e.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(e){function t(i){e.requestAnimationFrame((function(){!function(i){var n;i.shouldFade&&(n=1-(e.now()-i.fadeBeginTime)/i.fadeLength,n=Math.min(1,n),n=Math.max(0,n),i.imgGroup&&e.setElementOpacity(i.imgGroup,n,!0),n>0&&t(i))}(i)}))}function i(t,i){t.element.disabled||(i>=e.ButtonState.GROUP&&t.currentState==e.ButtonState.REST&&(!function(t){t.shouldFade=!1,t.imgGroup&&e.setElementOpacity(t.imgGroup,1,!0)}(t),t.currentState=e.ButtonState.GROUP),i>=e.ButtonState.HOVER&&t.currentState==e.ButtonState.GROUP&&(t.imgHover&&(t.imgHover.style.visibility=""),t.currentState=e.ButtonState.HOVER),i>=e.ButtonState.DOWN&&t.currentState==e.ButtonState.HOVER&&(t.imgDown&&(t.imgDown.style.visibility=""),t.currentState=e.ButtonState.DOWN))}function n(i,n){i.element.disabled||(n<=e.ButtonState.HOVER&&i.currentState==e.ButtonState.DOWN&&(i.imgDown&&(i.imgDown.style.visibility="hidden"),i.currentState=e.ButtonState.HOVER),n<=e.ButtonState.GROUP&&i.currentState==e.ButtonState.HOVER&&(i.imgHover&&(i.imgHover.style.visibility="hidden"),i.currentState=e.ButtonState.GROUP),n<=e.ButtonState.REST&&i.currentState==e.ButtonState.GROUP&&(!function(i){i.shouldFade=!0,i.fadeBeginTime=e.now()+i.fadeDelay,window.setTimeout((function(){t(i)}),i.fadeDelay)}(i),i.currentState=e.ButtonState.REST))}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(t){var o=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},t),this.element=t.element||e.makeNeutralElement("div"),t.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor==e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(t){t.insideElementPressed?(i(o,e.ButtonState.DOWN),o.raiseEvent("enter",{originalEvent:t.originalEvent})):t.buttonDownAny||i(o,e.ButtonState.HOVER)},focusHandler:function(e){this.enterHandler(e),o.raiseEvent("focus",{originalEvent:e.originalEvent})},exitHandler:function(t){n(o,e.ButtonState.GROUP),t.insideElementPressed&&o.raiseEvent("exit",{originalEvent:t.originalEvent})},blurHandler:function(e){this.exitHandler(e),o.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(t){i(o,e.ButtonState.DOWN),o.raiseEvent("press",{originalEvent:t.originalEvent})},releaseHandler:function(t){t.insideElementPressed&&t.insideElementReleased?(n(o,e.ButtonState.HOVER),o.raiseEvent("release",{originalEvent:t.originalEvent})):t.insideElementPressed?n(o,e.ButtonState.GROUP):i(o,e.ButtonState.HOVER)},clickHandler:function(e){e.quick&&o.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){return 13!==e.keyCode||(o.raiseEvent("click",{originalEvent:e.originalEvent}),o.raiseEvent("release",{originalEvent:e.originalEvent}),!1)}}),n(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){i(this,e.ButtonState.GROUP)},notifyGroupExit:function(){n(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var i,n=this.buttons.concat([]),o=this;if(this.element=t.element||e.makeNeutralElement("div"),!t.group)for(this.element.style.display="inline-block",i=0;i<n.length;i++)this.element.appendChild(n[i].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){var t;for(t=0;t<o.buttons.length;t++)o.buttons[t].notifyGroupEnter()},exitHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<o.buttons.length;t++)o.buttons[t].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(e){e.Rect=function(t,i,n,o,r){var s,a;this.x="number"==typeof t?t:0,this.y="number"==typeof i?i:0,this.width="number"==typeof n?n:0,this.height="number"==typeof o?o:0,this.degrees="number"==typeof r?r:0,this.degrees=e.positiveModulo(this.degrees,360),this.degrees>=270?(s=this.getTopRight(),this.x=s.x,this.y=s.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=270):this.degrees>=180?(s=this.getBottomRight(),this.x=s.x,this.y=s.y,this.degrees-=180):this.degrees>=90&&(s=this.getBottomLeft(),this.x=s.x,this.y=s.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=90)},e.Rect.fromSummits=function(t,i,n){var o=t.distanceTo(i),r=t.distanceTo(n),s=i.minus(t),a=Math.atan(s.y/s.x);return s.x<0?a+=Math.PI:s.y<0&&(a+=2*Math.PI),new e.Rect(t.x,t.y,o,r,a/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.degrees===t.degrees},times:function(t){return new e.Rect(this.x*t,this.y*t,this.width*t,this.height*t,this.degrees)},translate:function(t){return new e.Rect(this.x+t.x,this.y+t.y,this.width,this.height,this.degrees)},union:function(t){var i=this.getBoundingBox(),n=t.getBoundingBox(),o=Math.min(i.x,n.x),r=Math.min(i.y,n.y),s=Math.max(i.x+i.width,n.x+n.width),a=Math.max(i.y+i.height,n.y+n.height);return new e.Rect(o,r,s-o,a-r)},intersection:function(t){var i=1e-10,n=[],o=this.getTopLeft();t.containsPoint(o,i)&&n.push(o);var r=this.getTopRight();t.containsPoint(r,i)&&n.push(r);var s=this.getBottomLeft();t.containsPoint(s,i)&&n.push(s);var a=this.getBottomRight();t.containsPoint(a,i)&&n.push(a);var l=t.getTopLeft();this.containsPoint(l,i)&&n.push(l);var c=t.getTopRight();this.containsPoint(c,i)&&n.push(c);var d=t.getBottomLeft();this.containsPoint(d,i)&&n.push(d);var u=t.getBottomRight();this.containsPoint(u,i)&&n.push(u);for(var h=this._getSegments(),p=t._getSegments(),m=0;m<h.length;m++)for(var f=h[m],g=0;g<p.length;g++){var v=p[g],_=y(f[0],f[1],v[0],v[1]);_&&n.push(_)}function y(t,n,o,r){var s=n.minus(t),a=r.minus(o),l=-a.x*s.y+s.x*a.y;if(0===l)return null;var c=(s.x*(t.y-o.y)-s.y*(t.x-o.x))/l,d=(a.x*(t.y-o.y)-a.y*(t.x-o.x))/l;return-1e-10<=c&&c<=1-i&&-1e-10<=d&&d<=1-i?new e.Point(t.x+d*s.x,t.y+d*s.y):null}if(0===n.length)return null;for(var w=n[0].x,b=n[0].x,x=n[0].y,T=n[0].y,S=1;S<n.length;S++){var k=n[S];k.x<w&&(w=k.x),k.x>b&&(b=k.x),k.y<x&&(x=k.y),k.y>T&&(T=k.y)}return new e.Rect(w,x,b-w,T-x)},_getSegments:function(){var e=this.getTopLeft(),t=this.getTopRight(),i=this.getBottomLeft(),n=this.getBottomRight();return[[e,t],[t,n],[n,i],[i,e]]},rotate:function(t,i){if(0===(t=e.positiveModulo(t,360)))return this.clone();i=i||this.getCenter();var n=this.getTopLeft().rotate(t,i),o=this.getTopRight().rotate(t,i).minus(n);o=o.apply((function(e){return Math.abs(e)<1e-15?0:e}));var r=Math.atan(o.y/o.x);return o.x<0?r+=Math.PI:o.y<0&&(r+=2*Math.PI),new e.Rect(n.x,n.y,this.width,this.height,r/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var t=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),o=this.getBottomRight(),r=Math.min(t.x,i.x,n.x,o.x),s=Math.max(t.x,i.x,n.x,o.x),a=Math.min(t.y,i.y,n.y,o.y),l=Math.max(t.y,i.y,n.y,o.y);return new e.Rect(r,a,s-r,l-a)},getIntegerBoundingBox:function(){var t=this.getBoundingBox(),i=Math.floor(t.x),n=Math.floor(t.y),o=Math.ceil(t.width+t.x-i),r=Math.ceil(t.height+t.y-n);return new e.Rect(i,n,o,r)},containsPoint:function(e,t){t=t||0;var i=this.getTopLeft(),n=this.getTopRight(),o=this.getBottomLeft(),r=n.minus(i),s=o.minus(i);return(e.x-i.x)*r.x+(e.y-i.y)*r.y>=-t&&(e.x-n.x)*r.x+(e.y-n.y)*r.y<=t&&(e.x-i.x)*s.x+(e.y-i.y)*s.y>=-t&&(e.x-o.x)*s.x+(e.y-o.y)*s.y<=t},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(e){var t={};function i(t){var i=Number(this.element.style.marginLeft.replace("px","")),n=Number(this.element.style.marginTop.replace("px","")),r=Number(this.element.style.width.replace("px","")),s=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-t.delta.x>0?i>-(r-a.x)&&(this.element.style.marginLeft=i+2*t.delta.x+"px",o(this,a.x,i+2*t.delta.x)):-t.delta.x<0&&i<0&&(this.element.style.marginLeft=i+2*t.delta.x+"px",o(this,a.x,i+2*t.delta.x)):-t.delta.y>0?n>-(s-a.y)&&(this.element.style.marginTop=n+2*t.delta.y+"px",o(this,a.y,n+2*t.delta.y)):-t.delta.y<0&&n<0&&(this.element.style.marginTop=n+2*t.delta.y+"px",o(this,a.y,n+2*t.delta.y))),!1}function n(t){var i=Number(this.element.style.marginLeft.replace("px","")),n=Number(this.element.style.marginTop.replace("px","")),r=Number(this.element.style.width.replace("px","")),s=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?t.scroll>0?i>-(r-a.x)&&(this.element.style.marginLeft=i-60*t.scroll+"px",o(this,a.x,i-60*t.scroll)):t.scroll<0&&i<0&&(this.element.style.marginLeft=i-60*t.scroll+"px",o(this,a.x,i-60*t.scroll)):t.scroll<0?n>a.y-s&&(this.element.style.marginTop=n+60*t.scroll+"px",o(this,a.y,n+60*t.scroll)):t.scroll>0&&n<0&&(this.element.style.marginTop=n+60*t.scroll+"px",o(this,a.y,n+60*t.scroll))),!1}function o(t,i,n){var o,r,s,a,l,c,d;for(o="horizontal"==t.scroll?t.panelWidth:t.panelHeight,r=Math.ceil(i/o)+5,c=r=(r=(s=Math.ceil((Math.abs(n)+i)/o)+1)-r)<0?0:r;c<s&&c<t.panels.length;c++)if(!(d=t.panels[c]).activePanel){var u,h=t.viewer.tileSources[c];u=h.referenceStripThumbnailUrl?{type:"image",url:h.referenceStripThumbnailUrl}:h,(a=new e.Viewer({id:d.id,tileSources:[u],element:d,navigatorSizeRatio:t.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:t.viewer.loadTilesWithAjax,ajaxHeaders:t.viewer.ajaxHeaders,useCanvas:t.useCanvas})).displayRegion=e.makeNeutralElement("div"),a.displayRegion.id=d.id+"-displayregion",a.displayRegion.className="displayregion",(l=a.displayRegion.style).position="relative",l.top="0px",l.left="0px",l.fontSize="0px",l.overflow="hidden",l.float="left",l.cssFloat="left",l.styleFloat="left",l.zIndex=999999999,l.cursor="default",l.width=t.panelWidth-4+"px",l.height=t.panelHeight-4+"px",a.displayRegion.innerTracker=new e.MouseTracker({element:a.displayRegion,startDisabled:!0}),d.getElementsByTagName("div")[0].appendChild(a.displayRegion),t.miniViewers[d.id]=a,d.activePanel=!0}}function r(e){var t=e.eventSource.element;return"horizontal"==this.scroll?t.style.marginBottom="0px":t.style.marginLeft="0px",!1}function s(t){var i=t.eventSource.element;return"horizontal"==this.scroll?i.style.marginBottom="-"+e.getElementSize(i).y/2+"px":i.style.marginLeft="-"+e.getElementSize(i).x/2+"px",!1}function a(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function l(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 61:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 97:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}e.ReferenceStrip=function(c){var d,u,h,p=c.viewer,m=e.getElementSize(p.element);for(c.id||(c.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=c.id,this.element.className="referencestrip"),c=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},c,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),e.extend(this,c),t[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(u=this.element.style).marginTop="0px",u.marginRight="0px",u.marginBottom="0px",u.marginLeft="0px",u.left="0px",u.bottom="0px",u.border="0px",u.background="#000",u.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=p,this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,i),scrollHandler:e.delegate(this,n),enterHandler:e.delegate(this,r),exitHandler:e.delegate(this,s),keyDownHandler:e.delegate(this,a),keyHandler:e.delegate(this,l)}),c.width&&c.height?(this.element.style.width=c.width+"px",this.element.style.height=c.height+"px",p.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):"horizontal"==c.scroll?(this.element.style.width=m.x*c.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.height=m.y*c.sizeRatio+"px",p.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=m.y*c.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.width=m.x*c.sizeRatio+"px",p.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=m.x*this.sizeRatio+8,this.panelHeight=m.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},h=0;h<p.tileSources.length;h++)(d=e.makeNeutralElement("div")).id=this.element.id+"-"+h,d.style.width=this.panelWidth+"px",d.style.height=this.panelHeight+"px",d.style.display="inline",d.style.float="left",d.style.cssFloat="left",d.style.styleFloat="left",d.style.padding="2px",e.setElementTouchActionNone(d),d.innerTracker=new e.MouseTracker({element:d,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(t){t.eventSource.dragging=e.now()},releaseHandler:function(t){var i=t.eventSource,n=i.element.id,o=Number(n.split("-")[2]),r=e.now();t.insideElementPressed&&t.insideElementReleased&&i.dragging&&r-i.dragging<i.clickTimeThreshold&&(i.dragging=null,p.goToPage(o))}}),this.element.appendChild(d),d.activePanel=!1,this.panels.push(d);o(this,"vertical"==this.scroll?m.y:m.x,0),this.setFocus(0)},e.extend(e.ReferenceStrip.prototype,e.EventSource.prototype,e.Viewer.prototype,{setFocus:function(t){var i,n=this.element.querySelector("#"+this.element.id+"-"+t),s=e.getElementSize(this.viewer.canvas),a=Number(this.element.style.width.replace("px","")),l=Number(this.element.style.height.replace("px","")),c=-Number(this.element.style.marginLeft.replace("px","")),d=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==n&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=n,this.currentSelected.style.background="#999","horizontal"==this.scroll?(i=Number(t)*(this.panelWidth+3))>c+s.x-this.panelWidth?(i=Math.min(i,a-s.x),this.element.style.marginLeft=-i+"px",o(this,s.x,-i)):i<c&&(i=Math.max(0,i-s.x/2),this.element.style.marginLeft=-i+"px",o(this,s.x,-i)):(i=Number(t)*(this.panelHeight+3))>d+s.y-this.panelHeight?(i=Math.min(i,l-s.y),this.element.style.marginTop=-i+"px",o(this,s.y,-i)):i<d&&(i=Math.max(0,i-s.y/2),this.element.style.marginTop=-i+"px",o(this,s.y,-i)),this.currentPage=t,r.call(this,{eventSource:this.innerTracker}))},update:function(){return!!t[this.id].animating&&(e.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var e in this.miniViewers)this.miniViewers[e].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(e){e.DisplayRect=function(t,i,n,o,r,s){e.Rect.apply(this,[t,i,n,o]),this.minLevel=r,this.maxLevel=s},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(OpenSeadragon),function(e){e.Spring=function(t){var i=arguments;"object"!=typeof t&&(t={initial:i.length&&"number"==typeof i[0]?i[0]:void 0,springStiffness:i.length>1?i[1].springStiffness:5,animationTime:i.length>1?i[1].animationTime:1.5}),e.console.assert("number"==typeof t.springStiffness&&0!==t.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert("number"==typeof t.animationTime&&t.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),t.exponential&&(this._exponential=!0,delete t.exponential),e.extend(!0,this,t),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=t,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=t,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(t){this.start.value+=t,this.target.value+=t,this._exponential&&(e.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(t){this._exponential=t,this._exponential&&(e.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var t,i;this.current.time=e.now(),this._exponential?(t=this.start._logValue,i=this.target._logValue):(t=this.start.value,i=this.target.value);var n,o,r=this.current.time>=this.target.time?i:t+(i-t)*(n=this.springStiffness,o=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(n*-o))/(1-Math.exp(-n))),s=this.current.value;return this._exponential?this.current.value=Math.exp(r):this.current.value=r,s!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(e){function t(t){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},t),this.image=null}t.prototype={errorMsg:null,start:function(){var t=this,i=this.abort;this.image=new Image,this.image.onload=function(){t.finish(!0)},this.image.onabort=this.image.onerror=function(){t.errorMsg="Image load aborted",t.finish(!1)},this.jobId=window.setTimeout((function(){t.errorMsg="Image load exceeded timeout ("+t.timeout+" ms)",t.finish(!1)}),this.timeout),this.loadWithAjax?(this.request=e.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(e){var i;try{i=new window.Blob([e.response])}catch(t){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===t.name&&n){var o=new n;o.append(e.response),i=o.getBlob()}}0===i.size&&(t.errorMsg="Empty image response.",t.finish(!1));var r=(window.URL||window.webkitURL).createObjectURL(i);t.image.src=r},error:function(e){t.errorMsg="Image load aborted - XHR error",t.finish(!1)}}),this.abort=function(){t.request.abort(),"function"==typeof i&&i()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(e){this.image.onload=this.image.onerror=this.image.onabort=null,e||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(t){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},t)},e.ImageLoader.prototype={addJob:function(e){var i=this,n=new t({src:e.src,loadWithAjax:e.loadWithAjax,ajaxHeaders:e.loadWithAjax?e.ajaxHeaders:null,crossOriginPolicy:e.crossOriginPolicy,ajaxWithCredentials:e.ajaxWithCredentials,callback:function(t){!function(e,t,i){e.jobsInProgress--,(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&e.jobQueue.length>0&&(e.jobQueue.shift().start(),e.jobsInProgress++);i(t.image,t.errorMsg,t.request)}(i,t,e.callback)},abort:e.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(n.start(),this.jobsInProgress++):this.jobQueue.push(n)},clear:function(){for(var e=0;e<this.jobQueue.length;e++){var t=this.jobQueue[e];"function"==typeof t.abort&&t.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(e){e.Tile=function(e,t,i,n,o,r,s,a,l,c){this.level=e,this.x=t,this.y=i,this.bounds=n,this.sourceBounds=c,this.exists=o,this.url=r,this.context2D=s,this.loadWithAjax=a,this.ajaxHeaders=l,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(t){this.cacheImageRecord?this.loaded?(this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=t&&t.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",e.setElementOpacity(this.element,this.opacity)):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(t,i,n,o){var r,s,a,l=this.position.times(e.pixelDensityRatio),c=this.size.times(e.pixelDensityRatio);this.context2D||this.cacheImageRecord?(r=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&r?(t.save(),t.globalAlpha=this.opacity,"number"==typeof n&&1!==n&&(l=l.times(n),c=c.times(n)),o instanceof e.Point&&(l=l.plus(o)),1===t.globalAlpha&&this._hasTransparencyChannel()&&t.clearRect(l.x,l.y,c.x,c.y),i({context:t,tile:this,rendered:r}),this.sourceBounds?(s=Math.min(this.sourceBounds.width,r.canvas.width),a=Math.min(this.sourceBounds.height,r.canvas.height)):(s=r.canvas.width,a=r.canvas.height),t.drawImage(r.canvas,0,0,s,a,l.x,l.y,c.x,c.y),t.restore()):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var t;if(this.cacheImageRecord)t=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;t=this.context2D}return t.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(t,i,n){var o=Math.max(1,Math.ceil((n.x-i.x)/2)),r=Math.max(1,Math.ceil((n.y-i.y)/2));return new e.Point(o,r).minus(this.position.times(e.pixelDensityRatio).times(t||1).apply((function(e){return e%1})))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(t,i,n){var o;o=e.isPlainObject(t)?t:{element:t,location:i,placement:n},this.element=o.element,this.style=o.element.style,this._init(o)},e.Overlay.prototype={_init:function(t){this.location=t.location,this.placement=void 0===t.placement?e.Placement.TOP_LEFT:t.placement,this.onDraw=t.onDraw,this.checkResize=void 0===t.checkResize||t.checkResize,this.width=void 0===t.width?null:t.width,this.height=void 0===t.height?null:t.height,this.rotationMode=t.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(t,i){var n=e.Placement.properties[this.placement];n&&(n.isHorizontallyCentered?t.x-=i.x/2:n.isRight&&(t.x-=i.x),n.isVerticallyCentered?t.y-=i.y/2:n.isBottom&&(t.y-=i.y))},destroy:function(){var t=this.element,i=this.style;t.parentNode&&(t.parentNode.removeChild(t),t.prevElementParent&&(i.display="none",document.body.appendChild(t))),this.onDraw=null,i.top="",i.left="",i.position="",null!==this.width&&(i.width=""),null!==this.height&&(i.height="");var n=e.getCssPropertyWithVendorPrefix("transformOrigin"),o=e.getCssPropertyWithVendorPrefix("transform");n&&o&&(i[n]="",i[o]="")},drawHTML:function(t,i){var n=this.element;n.parentNode!==t&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,t.appendChild(n),this.style.position="absolute",this.size=e.getElementSize(n));var o=this._getOverlayPositionAndSize(i),r=o.position,s=this.size=o.size,a=o.rotate;if(this.onDraw)this.onDraw(r,s,this.element);else{var l=this.style;l.left=r.x+"px",l.top=r.y+"px",null!==this.width&&(l.width=s.x+"px"),null!==this.height&&(l.height=s.y+"px");var c=e.getCssPropertyWithVendorPrefix("transformOrigin"),d=e.getCssPropertyWithVendorPrefix("transform");c&&d&&(a?(l[c]=this._getTransformOrigin(),l[d]="rotate("+a+"deg)"):(l[c]="",l[d]="")),"none"!==l.display&&(l.display="block")}},_getOverlayPositionAndSize:function(t){var i=t.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(t);this.adjust(i,n);var o=0;if(t.degrees&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var r=new e.Rect(i.x,i.y,n.x,n.y),s=this._getBoundingBox(r,t.degrees);i=s.getTopLeft(),n=s.getSize()}else o=t.degrees;return{position:i,size:n,rotate:o}},_getSizeInPixels:function(t){var i=this.size.x,n=this.size.y;if(null!==this.width||null!==this.height){var o=t.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);null!==this.width&&(i=o.x),null!==this.height&&(n=o.y)}if(this.checkResize&&(null===this.width||null===this.height)){var r=this.size=e.getElementSize(this.element);null===this.width&&(i=r.x),null===this.height&&(n=r.y)}return new e.Point(i,n)},_getBoundingBox:function(e,t){var i=this._getPlacementPoint(e);return e.rotate(t,i).getBoundingBox()},_getPlacementPoint:function(t){var i=new e.Point(t.x,t.y),n=e.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?i.x+=t.width/2:n.isRight&&(i.x+=t.width),n.isVerticallyCentered?i.y+=t.height/2:n.isBottom&&(i.y+=t.height)),i},_getTransformOrigin:function(){var t="",i=e.Placement.properties[this.placement];return i?(i.isLeft?t="left":i.isRight&&(t="right"),i.isTop?t+=" top":i.isBottom&&(t+=" bottom"),t):t},update:function(t,i){var n=e.isPlainObject(t)?t:{location:t,placement:i};this._init({location:n.location||this.location,placement:void 0!==n.placement?n.placement:this.placement,onDraw:n.onDraw||this.onDraw,checkResize:n.checkResize||this.checkResize,width:void 0!==n.width?n.width:this.width,height:void 0!==n.height?n.height:this.height,rotationMode:n.rotationMode||this.rotationMode})},getBounds:function(t){e.console.assert(t,"A viewport must now be passed to Overlay.getBounds.");var i=this.width,n=this.height;if(null===i||null===n){var o=t.deltaPointsFromPixelsNoRotate(this.size,!0);null===i&&(i=o.x),null===n&&(n=o.y)}var r=this.location.clone();return this.adjust(r,new e.Point(i,n)),this._adjustBoundsForRotation(t,new e.Rect(r.x,r.y,i,n))},_adjustBoundsForRotation:function(t,i){if(!t||0===t.degrees||this.rotationMode===e.OverlayRotationMode.EXACT)return i;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return i;var n=this._getOverlayPositionAndSize(t);return t.viewerElementToViewportRectangle(new e.Rect(n.position.x,n.position.y,n.size.x,n.size.y))}return i.rotate(-t.degrees,this._getPlacementPoint(i))}}}(OpenSeadragon),function(e){e.Drawer=function(t){e.console.assert(t.viewer,"[Drawer] options.viewer is required");var i=arguments;if(e.isPlainObject(t)||(t={source:i[0],viewport:i[1],element:i[2]}),e.console.assert(t.viewport,"[Drawer] options.viewport is required"),e.console.assert(t.element,"[Drawer] options.element is required"),t.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=t.viewer,this.viewport=t.viewport,this.debugGridColor="string"==typeof t.debugGridColor?[t.debugGridColor]:t.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,t.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=e.getElement(t.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var n=this._calculateCanvasSize();this.canvas.width=n.x,this.canvas.height=n.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},e.Drawer.prototype={addOverlay:function(t,i,n,o){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(t,i,n,o),this},updateOverlay:function(t,i,n){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(t,i,n),this},removeOverlay:function(t){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(t),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(t){var i=this.viewport.pixelFromPointNoRotate(t,!0);return new e.Point(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio)},clipWithPolygons:function(e,t){if(this.useCanvas){var i=this._getContext(t);i.beginPath(),e.forEach((function(e){e.forEach((function(e,t){i[0===t?"moveTo":"lineTo"](e.x,e.y)}))})),i.clip()}},setOpacity:function(t){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var i=this.viewer.world,n=0;n<i.getItemCount();n++)i.getItemAt(n).setOpacity(t);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var t=this.viewer.world,i=0,n=0;n<t.getItemCount();n++){var o=t.getItemAt(n).getOpacity();o>i&&(i=o)}return i},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var e=this._calculateCanvasSize();if((this.canvas.width!=e.x||this.canvas.height!=e.y)&&(this.canvas.width=e.x,this.canvas.height=e.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas)){var t=this._calculateSketchCanvasSize();this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(e,t){if(this.useCanvas){var i=this._getContext(e);if(t)i.clearRect(t.x,t.y,t.width,t.height);else{var n=i.canvas;i.clearRect(0,0,n.width,n.height)}}},viewportToDrawerRectangle:function(t){var i=this.viewport.pixelFromPointNoRotate(t.getTopLeft(),!0),n=this.viewport.deltaPixelsFromPointsNoRotate(t.getSize(),!0);return new e.Rect(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio,n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio)},drawTile:function(t,i,n,o,r){if(e.console.assert(t,"[Drawer.drawTile] tile is required"),e.console.assert(i,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var s=this._getContext(n);o=o||1,t.drawCanvas(s,i,o,r)}else t.drawHTML(this.canvas)},_getContext:function(e){var t=this.context;if(e){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var i=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=i.x,this.sketchCanvas.height=i.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var n=this;this.viewer.addHandler("rotate",(function e(){if(0!==n.viewport.getRotation()){n.viewer.removeHandler("rotate",e);var t=n._calculateSketchCanvasSize();n.sketchCanvas.width=t.x,n.sketchCanvas.height=t.y}}))}this._updateImageSmoothingEnabled(this.sketchContext)}t=this.sketchContext}return t},saveContext:function(e){this.useCanvas&&this._getContext(e).save()},restoreContext:function(e){this.useCanvas&&this._getContext(e).restore()},setClip:function(e,t){if(this.useCanvas){var i=this._getContext(t);i.beginPath(),i.rect(e.x,e.y,e.width,e.height),i.clip()}},drawRectangle:function(e,t,i){if(this.useCanvas){var n=this._getContext(i);n.save(),n.fillStyle=t,n.fillRect(e.x,e.y,e.width,e.height),n.restore()}},blendSketch:function(t,i,n,o){var r=t;if(e.isPlainObject(r)||(r={opacity:t,scale:i,translate:n,compositeOperation:o}),this.useCanvas&&this.sketchCanvas){t=r.opacity,o=r.compositeOperation;var s=r.bounds;if(this.context.save(),this.context.globalAlpha=t,o&&(this.context.globalCompositeOperation=o),s)s.x<0&&(s.width+=s.x,s.x=0),s.x+s.width>this.canvas.width&&(s.width=this.canvas.width-s.x),s.y<0&&(s.height+=s.y,s.y=0),s.y+s.height>this.canvas.height&&(s.height=this.canvas.height-s.y),this.context.drawImage(this.sketchCanvas,s.x,s.y,s.width,s.height,s.x,s.y,s.width,s.height);else{i=r.scale||1;var a=(n=r.translate)instanceof e.Point?n:new e.Point(0,0),l=0,c=0;if(n){var d=this.sketchCanvas.width-this.canvas.width,u=this.sketchCanvas.height-this.canvas.height;l=Math.round(d/2),c=Math.round(u/2)}this.context.drawImage(this.sketchCanvas,a.x-l*i,a.y-c*i,(this.canvas.width+2*l)*i,(this.canvas.height+2*c)*i,-l,-c,this.canvas.width+2*l,this.canvas.height+2*c)}this.context.restore()}},drawDebugInfo:function(t,i,n,o){if(this.useCanvas){var r=this.viewer.world.getIndexOfItem(o)%this.debugGridColor.length,s=this.context;s.save(),s.lineWidth=2*e.pixelDensityRatio,s.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",s.strokeStyle=this.debugGridColor[r],s.fillStyle=this.debugGridColor[r],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),o.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:o.getRotation(!0),point:o.viewport.pixelFromPointNoRotate(o._getRotationPoint(!0),!0)}),0===o.viewport.degrees&&o.getRotation(!0)%360==0&&o._drawer.viewer.viewport.getFlip()&&o._drawer._flip(),s.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio);var a=(t.position.x+t.size.x/2)*e.pixelDensityRatio,l=(t.position.y+t.size.y/2)*e.pixelDensityRatio;s.translate(a,l),s.rotate(Math.PI/180*-this.viewport.degrees),s.translate(-a,-l),0===t.x&&0===t.y&&(s.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),s.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),s.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),s.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),s.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),s.fillText("Order: "+n+" of "+i,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),s.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),s.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),o.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===o.viewport.degrees&&o.getRotation(!0)%360==0&&o._drawer.viewer.viewport.getFlip()&&o._drawer._flip(),s.restore()}},debugRect:function(t){if(this.useCanvas){var i=this.context;i.save(),i.lineWidth=2*e.pixelDensityRatio,i.strokeStyle=this.debugGridColor[0],i.fillStyle=this.debugGridColor[0],i.strokeRect(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio,t.width*e.pixelDensityRatio,t.height*e.pixelDensityRatio),i.restore()}},setImageSmoothingEnabled:function(e){this.useCanvas&&(this._imageSmoothingEnabled=e,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(e){e.msImageSmoothingEnabled=this._imageSmoothingEnabled,e.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(t){var i=this._getContext(t).canvas;return new e.Point(i.width,i.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(t){var i=t.point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(t.useSketch);n.save(),n.translate(i.x,i.y),this.viewer.viewport.flipped?(n.rotate(Math.PI/180*-t.degrees),n.scale(-1,1)):n.rotate(Math.PI/180*t.degrees),n.translate(-i.x,-i.y)},_flip:function(t){var i=(t=t||{}).point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(t.useSketch);n.translate(i.x,0),n.scale(-1,1),n.translate(-i.x,0)},_restoreRotationChanges:function(e){this._getContext(e).restore()},_calculateCanvasSize:function(){var t=e.pixelDensityRatio,i=this.viewport.getContainerSize();return{x:Math.round(i.x*t),y:Math.round(i.y*t)}},_calculateSketchCanvasSize:function(){var e=this._calculateCanvasSize();if(0===this.viewport.getRotation())return e;var t=Math.ceil(Math.sqrt(e.x*e.x+e.y*e.y));return{x:t,y:t}}}}(OpenSeadragon),function(e){e.Viewport=function(t){var i=arguments;i.length&&i[0]instanceof e.Point&&(t={containerSize:i[0],contentSize:i[1],config:i[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t.margins||{}),delete t.margins,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,flipped:e.DEFAULT_SETTINGS.flipped,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer},t),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){return e.console.assert(t,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(t instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(t.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(t.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,t.y/t.x),t.x),this},setHomeBounds:function(t,i){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(t,i)},_setContentBounds:function(t,i){e.console.assert(t,"[Viewport._setContentBounds] bounds is required"),e.console.assert(t instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(t.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(t.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=t.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=t.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?e>=1?e:1:e>=1?1:e)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var t=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new e.Rect(t.x-i/2,t.y-n/2,i,n)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(t){e.console.assert("object"===e.type(t),"[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation())},getBoundsNoRotate:function(t){var i=this.getCenter(t),n=1/this.getZoom(t),o=n/this.getAspectRatio();return new e.Rect(i.x-n/2,i.y-o/2,n,o)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var t=this.getBoundsNoRotate(e),i=this._containerInnerSize.x*this.getZoom(e);return t.x-=this._margins.left/i,t.y-=this._margins.top/i,t.width+=(this._margins.left+this._margins.right)/i,t.height+=(this._margins.top+this._margins.bottom)/i,t},getCenter:function(t){var i,n,o,r,s,a,l=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),c=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?l:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),r=(o=1/(n=this.getZoom()))/this.getAspectRatio(),s=new e.Rect(l.x-o/2,l.y-r/2,o,r),a=this._pixelFromPoint(this.zoomPoint,s).minus(i).divide(this._containerInnerSize.x*n),c.plus(a)):c},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(t){var i=new e.Rect(t.x,t.y,t.width,t.height);if(this.wrapHorizontal);else{var n=this.visibilityRatio*i.width,o=i.x+i.width,r=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,s=this._contentBoundsNoRotate.x-o+n,a=r-i.x-n;n>this._contentBoundsNoRotate.width?i.x+=(s+a)/2:a<0?i.x+=a:s>0&&(i.x+=s)}if(this.wrapVertical);else{var l=this.visibilityRatio*i.height,c=i.y+i.height,d=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,u=this._contentBoundsNoRotate.y-c+l,h=d-i.y-l;l>this._contentBoundsNoRotate.height?i.y+=(u+h)/2:h<0?i.y+=h:u>0&&(i.y+=u)}return i},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var t=this.getZoom(),i=this._applyZoomConstraints(t);t!==i&&this.zoomTo(i,this.zoomPoint,e);var n=this.getBoundsNoRotate(),o=this._applyBoundaryConstraints(n);return this._raiseConstraintsEvent(e),(n.x!==o.x||n.y!==o.y||e)&&this.fitBounds(o.rotate(-this.getRotation()),e),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(t,i){var n=(i=i||{}).immediately||!1,o=i.constraints||!1,r=this.getAspectRatio(),s=t.getCenter(),a=new e.Rect(t.x,t.y,t.width,t.height,t.degrees+this.getRotation()).getBoundingBox();a.getAspectRatio()>=r?a.height=a.width/r:a.width=a.height*r,a.x=s.x-a.width/2,a.y=s.y-a.height/2;var l=1/a.width;if(o){var c=a.getAspectRatio(),d=this._applyZoomConstraints(l);l!==d&&(l=d,a.width=1/l,a.x=s.x-a.width/2,a.height=a.width/c,a.y=s.y-a.height/2),s=(a=this._applyBoundaryConstraints(a)).getCenter(),this._raiseConstraintsEvent(n)}if(n)return this.panTo(s,!0),this.zoomTo(l,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var u=this.getBounds(),h=this.getZoom();if(0===h||Math.abs(l/h-1)<1e-8)return this.zoomTo(l,!0),this.panTo(s,n);var p=(a=a.rotate(-this.getRotation())).getTopLeft().times(l).minus(u.getTopLeft().times(h)).divide(l-h);return this.zoomTo(l,p,n)},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(t){var i=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,t)},fitHorizontally:function(t){var i=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,t)},getConstrainedBounds:function(e){var t;return t=this.getBounds(e),this._applyBoundaryConstraints(t)},panBy:function(t,i){var n=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(t),i)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(e,t,i){return this.zoomTo(this.zoomSpring.target.value*e,t,i)},zoomTo:function(t,i,n){var o=this;return this.zoomPoint=i instanceof e.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,n?this._adjustCenterSpringsForZoomPoint((function(){o.zoomSpring.resetTo(t)})):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:i,immediately:n}),this},setRotation:function(t){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=e.positiveModulo(t,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:t}),this):this},getRotation:function(){return this.degrees},resize:function(e,t){var i,n=this.getBoundsNoRotate(),o=n;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),t&&(i=e.x/this.containerSize.x,o.width=n.width*i,o.height=o.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:t}),this.fitBounds(o,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e=this;this._adjustCenterSpringsForZoomPoint((function(){e.zoomSpring.update()})),this.centerSpringX.update(),this.centerSpringY.update();var t=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,t},_adjustCenterSpringsForZoomPoint:function(e){if(this.zoomPoint){var t=this.pixelFromPoint(this.zoomPoint,!0);e();var i=this.pixelFromPoint(this.zoomPoint,!0).minus(t),n=this.deltaPointsFromPixels(i,!0);this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else e()},deltaPixelsFromPointsNoRotate:function(e,t){return e.times(this._containerInnerSize.x*this.getZoom(t))},deltaPixelsFromPoints:function(e,t){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()),t)},deltaPointsFromPixelsNoRotate:function(e,t){return e.divide(this._containerInnerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return this.deltaPointsFromPixelsNoRotate(e,t).rotate(-this.getRotation())},pixelFromPointNoRotate:function(e,t){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(t))},pixelFromPoint:function(e,t){return this._pixelFromPoint(e,this.getBoundsNoRotate(t))},_pixelFromPointNoRotate:function(t,i){return t.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,t){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(),this.getCenter(!0)),t)},pointFromPixelNoRotate:function(t,i){var n=this.getBoundsNoRotate(i);return t.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/n.width).plus(n.getTopLeft())},pointFromPixel:function(e,t){return this.pointFromPixelNoRotate(e,t).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(t,i){var n=this._contentBoundsNoRotate.width;return new e.Point(t*this._contentSizeNoRotate.x/n,i*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(t,i){if(t instanceof e.Point)return this.viewportToImageCoordinates(t.x,t.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===n){return this.viewer.world.getItemAt(0).viewportToImageCoordinates(t,i,!0)}}return this._viewportToImageDelta(t-this._contentBoundsNoRotate.x,i-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(t,i){var n=this._contentBoundsNoRotate.width;return new e.Point(t/this._contentSizeNoRotate.x*n,i/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(t,i){if(t instanceof e.Point)return this.imageToViewportCoordinates(t.x,t.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===n){return this.viewer.world.getItemAt(0).imageToViewportCoordinates(t,i,!0)}}var o=this._imageToViewportDelta(t,i);return o.x+=this._contentBoundsNoRotate.x,o.y+=this._contentBoundsNoRotate.y,o},imageToViewportRectangle:function(t,i,n,o){var r=t;if(r instanceof e.Rect||(r=new e.Rect(t,i,n,o)),this.viewer){var s=this.viewer.world.getItemCount();if(s>1)e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===s){return this.viewer.world.getItemAt(0).imageToViewportRectangle(t,i,n,o,!0)}}var a=this.imageToViewportCoordinates(r.x,r.y),l=this._imageToViewportDelta(r.width,r.height);return new e.Rect(a.x,a.y,l.x,l.y,r.degrees)},viewportToImageRectangle:function(t,i,n,o){var r=t;if(r instanceof e.Rect||(r=new e.Rect(t,i,n,o)),this.viewer){var s=this.viewer.world.getItemCount();if(s>1)e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===s){return this.viewer.world.getItemAt(0).viewportToImageRectangle(t,i,n,o,!0)}}var a=this.viewportToImageCoordinates(r.x,r.y),l=this._viewportToImageDelta(r.width,r.height);return new e.Rect(a.x,a.y,l.x,l.y,r.degrees)},viewerElementToImageCoordinates:function(e){var t=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var i=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(i)},imageToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(t){return e.Rect.fromSummits(this.pointFromPixel(t.getTopLeft(),!0),this.pointFromPixel(t.getTopRight(),!0),this.pointFromPixel(t.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(t){return e.Rect.fromSummits(this.pixelFromPoint(t.getTopLeft(),!0),this.pixelFromPoint(t.getTopRight(),!0),this.pixelFromPoint(t.getBottomLeft(),!0))},windowToViewportCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var i=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(i)},viewportToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===i){return this.viewer.world.getItemAt(0).viewportToImageZoom(t)}}var n=this._contentSizeNoRotate.x;return t*(this._containerInnerSize.x/n*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===i){return this.viewer.world.getItemAt(0).imageToViewportZoom(t)}}return t*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(e){return this.flipped===e||(this.flipped=e,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:e})),this}}}(OpenSeadragon),function(e){function t(e,t,n,o,r,s,l,c,d){var u=l.getBoundingBox().getTopLeft(),h=l.getBoundingBox().getBottomRight();e.viewer&&e.viewer.raiseEvent("update-level",{tiledImage:e,havedrawn:t,level:o,opacity:r,visibility:s,drawArea:l,topleft:u,bottomright:h,currenttime:c,best:d}),a(e.coverage,o),a(e.loadingCoverage,o);for(var p=e._getCornerTiles(o,u,h),m=p.topLeft,f=p.bottomRight,g=e.source.getNumTiles(o),v=e.viewport.pixelFromPoint(e.viewport.getCenter()),_=m.x;_<=f.x;_++)for(var y=m.y;y<=f.y;y++){if(!e.wrapHorizontal&&!e.wrapVertical){var w=e.source.getTileBounds(o,_,y);if(null===l.intersection(w))continue}d=i(e,n,t,_,y,o,r,s,v,g,c,d)}return d}function i(t,i,o,a,l,c,d,u,h,p,m,f){var g=function(t,i,n,o,r,s,a,l,c,d){var u,h,p,m,f,g,v,_,y;s[n]||(s[n]={});s[n][t]||(s[n][t]={});s[n][t][i]||(u=(l.x+t%l.x)%l.x,h=(l.y+i%l.y)%l.y,p=r.getTileBounds(n,u,h),m=r.getTileBounds(n,u,h,!0),f=r.tileExists(n,u,h),g=r.getTileUrl(n,u,h),o.loadTilesWithAjax?(v=r.getTileAjaxHeaders(n,u,h),e.isPlainObject(o.ajaxHeaders)&&(v=e.extend({},o.ajaxHeaders,v))):v=null,_=r.getContext2D?r.getContext2D(n,u,h):void 0,p.x+=(t-u)/l.x,p.y+=d/c*((i-h)/l.y),y=new e.Tile(n,t,i,p,f,g,_,o.loadTilesWithAjax,v,m),u===l.x-1&&(y.isRightMost=!0),h===l.y-1&&(y.isBottomMost=!0),s[n][t][i]=y);return(y=s[n][t][i]).lastTouchTime=a,y}(a,l,c,t,t.source,t.tilesMatrix,m,p,t._worldWidthCurrent,t._worldHeightCurrent),v=o;t.viewer&&t.viewer.raiseEvent("update-tile",{tiledImage:t,tile:g}),s(t.coverage,c,a,l,!1);var _=g.loaded||g.loading||r(t.loadingCoverage,c,a,l);if(s(t.loadingCoverage,c,a,l,_),!g.exists)return f;if(i&&!v&&(r(t.coverage,c,a,l)?s(t.coverage,c,a,l,!0):v=!0),!v)return f;if(function(t,i,n,o,r,s){var a=t.bounds.getTopLeft();a.x*=s._scaleSpring.current.value,a.y*=s._scaleSpring.current.value,a.x+=s._xSpring.current.value,a.y+=s._ySpring.current.value;var l=t.bounds.getSize();l.x*=s._scaleSpring.current.value,l.y*=s._scaleSpring.current.value;var c=n.pixelFromPointNoRotate(a,!0),d=n.pixelFromPointNoRotate(a,!1),u=n.deltaPixelsFromPointsNoRotate(l,!0),h=n.deltaPixelsFromPointsNoRotate(l,!1),p=d.plus(h.divide(2)),m=o.squaredDistanceTo(p);i||(u=u.plus(new e.Point(1,1)));t.isRightMost&&s.wrapHorizontal&&(u.x+=.75);t.isBottomMost&&s.wrapVertical&&(u.y+=.75);t.position=c,t.size=u,t.squaredDistance=m,t.visibility=r}(g,t.source.tileOverlap,t.viewport,h,u,t),!g.loaded)if(g.context2D)n(t,g);else{var y=t._tileCache.getImageRecord(g.cacheKey);if(y)n(t,g,y.getImage())}g.loaded?function(e,t,i,n,o,r,a){var l,c,d=1e3*e.blendTime;t.blendStart||(t.blendStart=a);l=a-t.blendStart,c=d?Math.min(1,l/d):1,e.alwaysBlend&&(c*=r);if(t.opacity=c,e.lastDrawn.push(t),1===c)s(e.coverage,o,i,n,!0),e._hasOpaqueTile=!0;else if(l<d)return!0;return!1}(t,g,a,l,c,d,m)&&(t._needsDraw=!0):g.loading?t._tilesLoading++:_||(f=function(e,t){if(!e)return t;if(t.visibility>e.visibility)return t;if(t.visibility==e.visibility&&t.squaredDistance<e.squaredDistance)return t;return e}(f,g));return f}function n(e,t,i,n,o){var r=0;function s(){return r++,a}function a(){0===--r&&(t.loading=!1,t.loaded=!0,t.context2D||e._tileCache.cacheTile({image:i,tile:t,cutoff:n,tiledImage:e}),e._needsDraw=!0)}e.viewer.raiseEvent("tile-loaded",{tile:t,tiledImage:e,tileRequest:o,image:i,getCompletionCallback:s}),s()()}function o(e,t,i,n){var o,r,s,a;if(!e[t])return!1;if(void 0===i||void 0===n){for(s in o=e[t])if(Object.prototype.hasOwnProperty.call(o,s))for(a in r=o[s])if(Object.prototype.hasOwnProperty.call(r,a)&&!r[a])return!1;return!0}return void 0===e[t][i]||void 0===e[t][i][n]||!0===e[t][i][n]}function r(e,t,i,n){return void 0===i||void 0===n?o(e,t+1):o(e,t+1,2*i,2*n)&&o(e,t+1,2*i,2*n+1)&&o(e,t+1,2*i+1,2*n)&&o(e,t+1,2*i+1,2*n+1)}function s(t,i,n,o,r){t[i]?(t[i][n]||(t[i][n]={}),t[i][n][o]=r):e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",i)}function a(e,t){e[t]={}}e.TiledImage=function(t){var i=this;e.console.assert(t.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(t.drawer,"[TiledImage] options.drawer is required"),e.console.assert(t.viewer,"[TiledImage] options.viewer is required"),e.console.assert(t.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(t.source,"[TiledImage] options.source is required"),e.console.assert(!t.clip||t.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=t.tileCache,delete t.tileCache,this._drawer=t.drawer,delete t.drawer,this._imageLoader=t.imageLoader,delete t.imageLoader,t.clip instanceof e.Rect&&(this._clip=t.clip.clone()),delete t.clip;var n=t.x||0;delete t.x;var o=t.y||0;delete t.y,this.normHeight=t.source.dimensions.y/t.source.dimensions.x,this.contentAspectX=t.source.dimensions.x/t.source.dimensions.y;var r=1;t.width?(r=t.width,delete t.width,t.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete t.height)):t.height&&(r=t.height/this.normHeight,delete t.height);var s=t.fitBounds;delete t.fitBounds;var a=t.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete t.fitBoundsPlacement;var l=t.degrees||0;delete t.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation},t),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:n,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:o,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),s&&this.fitBounds(s,a,!0),this._drawingHandler=function(t){i.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:i},t))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(e){e!==this._fullyLoaded&&(this._fullyLoaded=e,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var e=this._xSpring.update(),t=this._ySpring.update(),i=this._scaleSpring.update(),n=this._degreesSpring.update();return!!(e||t||i||n)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(this.getRotation(e),this._getRotationPoint(e))},getBoundsNoRotate:function(t){return t?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(t){var i=this.getBoundsNoRotate(t);if(this._clip){var n=(t?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,o=this._clip.times(n);i=new e.Rect(i.x+o.x,i.y+o.y,o.width,o.height)}return i.rotate(this.getRotation(t),this._getRotationPoint(t))},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(t,i,n){var o=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t*(this.source.dimensions.x/o),i*(this.source.dimensions.y*this.contentAspectX/o))},viewportToImageCoordinates:function(t,i,n){var o;return t instanceof e.Point?(n=i,o=t):o=new e.Point(t,i),o=o.rotate(-this.getRotation(n),this._getRotationPoint(n)),n?this._viewportToImageDelta(o.x-this._xSpring.current.value,o.y-this._ySpring.current.value):this._viewportToImageDelta(o.x-this._xSpring.target.value,o.y-this._ySpring.target.value)},_imageToViewportDelta:function(t,i,n){var o=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t/this.source.dimensions.x*o,i/this.source.dimensions.y/this.contentAspectX*o)},imageToViewportCoordinates:function(t,i,n){t instanceof e.Point&&(n=i,i=t.y,t=t.x);var o=this._imageToViewportDelta(t,i);return n?(o.x+=this._xSpring.current.value,o.y+=this._ySpring.current.value):(o.x+=this._xSpring.target.value,o.y+=this._ySpring.target.value),o.rotate(this.getRotation(n),this._getRotationPoint(n))},imageToViewportRectangle:function(t,i,n,o,r){var s=t;s instanceof e.Rect?r=i:s=new e.Rect(t,i,n,o);var a=this.imageToViewportCoordinates(s.getTopLeft(),r),l=this._imageToViewportDelta(s.width,s.height,r);return new e.Rect(a.x,a.y,l.x,l.y,s.degrees+this.getRotation(r))},viewportToImageRectangle:function(t,i,n,o,r){var s=t;t instanceof e.Rect?r=i:s=new e.Rect(t,i,n,o);var a=this.viewportToImageCoordinates(s.getTopLeft(),r),l=this._viewportToImageDelta(s.width,s.height,r);return new e.Rect(a.x,a.y,l.x,l.y,s.degrees-this.getRotation(r))},viewerElementToImageCoordinates:function(e){var t=this.viewport.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.viewport.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){var t=e.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(e){return this.imageToViewerElementCoordinates(e).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(t){var i=this._scaleSpring.current.value;return t=t.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((t.x-this._xSpring.current.value)/i,(t.y-this._ySpring.current.value)/i,t.width/i,t.height/i,t.degrees)},viewportToImageZoom:function(e){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*e},imageToViewportZoom:function(e){return e/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(e,t){var i=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(t){if(i&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y),this._needsDraw=!0}else{if(i)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y),this._needsDraw=!0}i||this._raiseBoundsChange()},setWidth:function(e,t){this._setScale(e,t)},setHeight:function(e,t){this._setScale(e/this.normHeight,t)},setCroppingPolygons:function(t){var i=function(t){return t.map((function(t){try{if(function(t){return t instanceof e.Point||"number"==typeof t.x&&"number"==typeof t.y}(t))return{x:t.x,y:t.y};throw new Error}catch(e){throw new Error("A Provided cropping polygon point is not supported")}}))};try{if(!e.isArray(t))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=t.map((function(e){return i(e)}))}catch(t){e.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),e.console.error(t),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(t,i,n){i=i||e.Placement.CENTER;var o=e.Placement.properties[i],r=this.contentAspectX,s=0,a=0,l=1,c=1;if(this._clip&&(r=this._clip.getAspectRatio(),l=this._clip.width/this.source.dimensions.x,c=this._clip.height/this.source.dimensions.y,t.getAspectRatio()>r?(s=this._clip.x/this._clip.height*t.height,a=this._clip.y/this._clip.height*t.height):(s=this._clip.x/this._clip.width*t.width,a=this._clip.y/this._clip.width*t.width)),t.getAspectRatio()>r){var d=t.height/c,u=0;o.isHorizontallyCentered?u=(t.width-t.height*r)/2:o.isRight&&(u=t.width-t.height*r),this.setPosition(new e.Point(t.x-s+u,t.y-a),n),this.setHeight(d,n)}else{var h=t.width/l,p=0;o.isVerticallyCentered?p=(t.height-t.width/r)/2:o.isBottom&&(p=t.height-t.width/r),this.setPosition(new e.Point(t.x-s,t.y-a+p),n),this.setWidth(h,n)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(t){e.console.assert(!t||t instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),t instanceof e.Rect?this._clip=t.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(e){e!==this.opacity&&(this.opacity=e,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(e){this._preload=!!e,this._needsDraw=!0},getRotation:function(e){return e?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(e,t){this._degreesSpring.target.value===e&&this._degreesSpring.isAtTargetValue()||(t?this._degreesSpring.resetTo(e):this._degreesSpring.springTo(e),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(e){return this.getBoundsNoRotate(e).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(e){e!==this.compositeOperation&&(this.compositeOperation=e,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(e,t){var i=this._scaleSpring.target.value===e;if(t){if(i&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e),this._updateForScale(),this._needsDraw=!0}else{if(i)return;this._scaleSpring.springTo(e),this._updateForScale(),this._needsDraw=!0}i||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var e=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),t=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,i=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(t/this.minPixelRatio)/Math.log(2))));return i=Math.max(i,this.source.minLevel||0),{lowestLevel:e=Math.min(e,i),highestLevel:i}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){this.lastDrawn.pop().beingDrawn=!1}var i=this.viewport,r=this._viewportToTiledImageRectangle(i.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var s=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(r=r.intersection(s)))return}for(var a=this._getLevelsInterval(),l=a.lowestLevel,c=a.highestLevel,d=null,u=!1,h=e.now(),p=c;p>=l;p--){var m=!1,f=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(p),!0).x*this._scaleSpring.current.value;if(p===l||!u&&f>=this.minPixelRatio)m=!0,u=!0;else if(!u)continue;var g=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(p),!1).x*this._scaleSpring.current.value,v=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,_=this.immediateRender?1:v;if(d=t(this,u,m,p,Math.min(1,(f-.5)/.5),_/Math.abs(_-g),r,h,d),o(this.coverage,p))break}!function(t,i){if(0===t.opacity||0===i.length&&!t.placeholderFillStyle)return;var n,o,r,s=i[0];s&&(n=t.opacity<1||t.compositeOperation&&"source-over"!==t.compositeOperation||!t._isBottomItem()&&s._hasTransparencyChannel());var a,l=t.viewport.getZoom(!0),c=t.viewportToImageZoom(l);i.length>1&&c>t.smoothTileEdgesMinZoom&&!t.iOSDevice&&t.getRotation(!0)%360==0&&e.supportsCanvas&&(n=!0,o=s.getScaleForEdgeSmoothing(),r=s.getTranslationForEdgeSmoothing(o,t._drawer.getCanvasSize(!1),t._drawer.getCanvasSize(!0)));n&&(o||(a=t.viewport.viewportToViewerElementRectangle(t.getClippedBounds(!0)).getIntegerBoundingBox(),t._drawer.viewer.viewport.getFlip()&&(0===t.viewport.degrees&&t.getRotation(!0)%360==0||(a.x=t._drawer.viewer.container.clientWidth-(a.x+a.width))),a=a.times(e.pixelDensityRatio)),t._drawer._clear(!0,a));o||(0!==t.viewport.degrees&&t._drawer._offsetForRotation({degrees:t.viewport.degrees,useSketch:n}),t.getRotation(!0)%360!=0&&t._drawer._offsetForRotation({degrees:t.getRotation(!0),point:t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0),!0),useSketch:n}),0===t.viewport.degrees&&t.getRotation(!0)%360==0&&t._drawer.viewer.viewport.getFlip()&&t._drawer._flip());var d=!1;if(t._clip){t._drawer.saveContext(n);var u=t.imageToViewportRectangle(t._clip,!0);u=u.rotate(-t.getRotation(!0),t._getRotationPoint(!0));var h=t._drawer.viewportToDrawerRectangle(u);o&&(h=h.times(o)),r&&(h=h.translate(r)),t._drawer.setClip(h,n),d=!0}if(t._croppingPolygons){t._drawer.saveContext(n);try{var p=t._croppingPolygons.map((function(e){return e.map((function(e){var i=t.imageToViewportCoordinates(e.x,e.y,!0).rotate(-t.getRotation(!0),t._getRotationPoint(!0)),n=t._drawer.viewportCoordToDrawerCoord(i);return o&&(n=n.times(o)),n}))}));t._drawer.clipWithPolygons(p,n)}catch(t){e.console.error(t)}d=!0}if(t.placeholderFillStyle&&!1===t._hasOpaqueTile){var m=t._drawer.viewportToDrawerRectangle(t.getBounds(!0));o&&(m=m.times(o)),r&&(m=m.translate(r));var f=null;f="function"==typeof t.placeholderFillStyle?t.placeholderFillStyle(t,t._drawer.context):t.placeholderFillStyle,t._drawer.drawRectangle(m,f,n)}for(var g=i.length-1;g>=0;g--)s=i[g],t._drawer.drawTile(s,t._drawingHandler,n,o,r),s.beingDrawn=!0,t.viewer&&t.viewer.raiseEvent("tile-drawn",{tiledImage:t,tile:s});d&&t._drawer.restoreContext(n);o||(t.getRotation(!0)%360!=0&&t._drawer._restoreRotationChanges(n),0!==t.viewport.degrees&&t._drawer._restoreRotationChanges(n));n&&(o&&(0!==t.viewport.degrees&&t._drawer._offsetForRotation({degrees:t.viewport.degrees,useSketch:!1}),t.getRotation(!0)%360!=0&&t._drawer._offsetForRotation({degrees:t.getRotation(!0),point:t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0),!0),useSketch:!1})),t._drawer.blendSketch({opacity:t.opacity,scale:o,translate:r,compositeOperation:t.compositeOperation,bounds:a}),o&&(t.getRotation(!0)%360!=0&&t._drawer._restoreRotationChanges(!1),0!==t.viewport.degrees&&t._drawer._restoreRotationChanges(!1)));o||0===t.viewport.degrees&&t.getRotation(!0)%360==0&&t._drawer.viewer.viewport.getFlip()&&t._drawer._flip();!function(t,i){if(t.debugMode)for(var n=i.length-1;n>=0;n--){var o=i[n];try{t._drawer.drawDebugInfo(o,i.length,n,t)}catch(t){e.console.error(t)}}}(t,i)}(this,this.lastDrawn),d&&!d.context2D?(!function(t,i,o){i.loading=!0,t._imageLoader.addJob({src:i.url,loadWithAjax:i.loadWithAjax,ajaxHeaders:i.ajaxHeaders,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,callback:function(r,s,a){!function(t,i,o,r,s,a){if(!r)return e.console.log("Tile %s failed to load: %s - error: %s",i,i.url,s),t.viewer.raiseEvent("tile-load-failed",{tile:i,tiledImage:t,time:o,message:s,tileRequest:a}),i.loading=!1,void(i.exists=!1);if(o<t.lastResetTime)return e.console.log("Ignoring tile %s loaded before reset: %s",i,i.url),void(i.loading=!1);var l=function(){var e=t.source.getClosestLevel();n(t,i,r,e,a)};t._midDraw?window.setTimeout(l,1):l()}(t,i,o,r,s,a)},abort:function(){i.loading=!1}})}(this,d,h),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(t,i,n){var o,r,s,a;this.wrapHorizontal?(o=e.positiveModulo(i.x,1),r=e.positiveModulo(n.x,1)):(o=Math.max(0,i.x),r=Math.min(1,n.x));var l=1/this.source.aspectRatio;this.wrapVertical?(s=e.positiveModulo(i.y,l),a=e.positiveModulo(n.y,l)):(s=Math.max(0,i.y),a=Math.min(l,n.y));var c=this.source.getTileAtPoint(t,new e.Point(o,s)),d=this.source.getTileAtPoint(t,new e.Point(r,a)),u=this.source.getNumTiles(t);return this.wrapHorizontal&&(c.x+=u.x*Math.floor(i.x),d.x+=u.x*Math.floor(n.x)),this.wrapVertical&&(c.y+=u.y*Math.floor(i.y/l),d.y+=u.y*Math.floor(n.y/l)),{topLeft:c,bottomRight:d}}})}(OpenSeadragon),function(e){var t=function(t){e.console.assert(t,"[TileCache.cacheTile] options is required"),e.console.assert(t.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(t.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=t.tile,this.tiledImage=t.tiledImage},i=function(t){e.console.assert(t,"[ImageRecord] options is required"),e.console.assert(t.image,"[ImageRecord] options.image is required"),this._image=t.image,this._tiles=[]};i.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var e=document.createElement("canvas");e.width=this._image.width,e.height=this._image.height,this._renderedContext=e.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(t){e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=t},addTile:function(t){e.console.assert(t,"[ImageRecord.addTile] tile is required"),this._tiles.push(t)},removeTile:function(t){for(var i=0;i<this._tiles.length;i++)if(this._tiles[i]===t)return void this._tiles.splice(i,1);e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",t)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(t){t=t||{},this._maxImageCacheCount=t.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(n){e.console.assert(n,"[TileCache.cacheTile] options is required"),e.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(n.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var o=n.cutoff||0,r=this._tilesLoaded.length,s=this._imagesLoaded[n.tile.cacheKey];if(s||(e.console.assert(n.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),s=this._imagesLoaded[n.tile.cacheKey]=new i({image:n.image}),this._imagesLoadedCount++),s.addTile(n.tile),n.tile.cacheImageRecord=s,this._imagesLoadedCount>this._maxImageCacheCount){for(var a,l,c,d,u,h,p=null,m=-1,f=null,g=this._tilesLoaded.length-1;g>=0;g--)(a=(h=this._tilesLoaded[g]).tile).level<=o||a.beingDrawn||(p?(d=a.lastTouchTime,l=p.lastTouchTime,u=a.level,c=p.level,(d<l||d==l&&u>c)&&(p=a,m=g,f=h)):(p=a,m=g,f=h));p&&m>=0&&(this._unloadTile(f),r=m)}this._tilesLoaded[r]=new t({tile:n.tile,tiledImage:n.tiledImage})},clearTilesFor:function(t){var i;e.console.assert(t,"[TileCache.clearTilesFor] tiledImage is required");for(var n=0;n<this._tilesLoaded.length;++n)(i=this._tilesLoaded[n]).tiledImage===t&&(this._unloadTile(i),this._tilesLoaded.splice(n,1),n--)},getImageRecord:function(t){return e.console.assert(t,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[t]},_unloadTile:function(t){e.console.assert(t,"[TileCache._unloadTile] tileRecord is required");var i=t.tile,n=t.tiledImage;i.unload(),i.cacheImageRecord=null;var o=this._imagesLoaded[i.cacheKey];o.removeTile(i),o.getTileCount()||(o.destroy(),delete this._imagesLoaded[i.cacheKey],this._imagesLoadedCount--),n.viewer.raiseEvent("tile-unloaded",{tile:i,tiledImage:n})}}}(OpenSeadragon),function(e){e.World=function(t){var i=this;e.console.assert(t.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=t.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(e){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(t,i){if(e.console.assert(t,"[World.addItem] item is required"),e.console.assert(t instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(i=i||{}).index){var n=Math.max(0,Math.min(this._items.length,i.index));this._items.splice(n,0,t)}else this._items.push(t);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,t.addHandler("bounds-change",this._delegatedFigureSizes),t.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:t})},getItemAt:function(t){return e.console.assert(void 0!==t,"[World.getItemAt] index is required"),this._items[t]},getIndexOfItem:function(t){return e.console.assert(t,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,t)},getItemCount:function(){return this._items.length},setItemIndex:function(t,i){e.console.assert(t,"[World.setItemIndex] item is required"),e.console.assert(void 0!==i,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(t);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i!==n&&-1!==n&&(this._items.splice(n,1),this._items.splice(i,0,t),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:t,previousIndex:n,newIndex:i}))},removeItem:function(t){e.console.assert(t,"[World.removeItem] item is required");var i=e.indexOf(this._items,t);-1!==i&&(t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(t))},removeAll:function(){var e,t;for(this.viewer._cancelPendingImages(),t=0;t<this._items.length;t++)(e=this._items[t]).removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy();var i=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,t=0;t<i.length;t++)e=i[t],this._raiseRemoveItem(e)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(){for(var e=!1,t=0;t<this._items.length;t++)e=this._items[t].update()||e;return e},draw:function(){for(var e=0;e<this._items.length;e++)this._items[e].draw();this._needsDraw=!1},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){this._autoRefigureSizes=e,e&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(t){var i,n=(t=t||{}).immediately||!1,o=t.layout||e.DEFAULT_SETTINGS.collectionLayout,r=t.rows||e.DEFAULT_SETTINGS.collectionRows,s=t.columns||e.DEFAULT_SETTINGS.collectionColumns,a=t.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,l=a+(t.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin);i=!t.rows&&s?s:Math.ceil(this._items.length/r);var c,d,u,h,p,m=0,f=0;this.setAutoRefigureSizes(!1);for(var g=0;g<this._items.length;g++)g&&g%i==0&&("horizontal"===o?(f+=l,m=0):(m+=l,f=0)),h=(u=(d=(c=this._items[g]).getBounds()).width>d.height?a:a*(d.width/d.height))*(d.height/d.width),p=new e.Point(m+(a-u)/2,f+(a-h)/2),c.setPosition(p,n),c.setWidth(u,n),"horizontal"===o?m+=l:f+=l;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var t=this._homeBounds?this._homeBounds.clone():null,i=this._contentSize?this._contentSize.clone():null,n=this._contentFactor||0;if(this._items.length){var o=this._items[0],r=o.getBounds();this._contentFactor=o.getContentSize().x/r.width;for(var s=o.getClippedBounds().getBoundingBox(),a=s.x,l=s.y,c=s.x+s.width,d=s.y+s.height,u=1;u<this._items.length;u++)r=(o=this._items[u]).getBounds(),this._contentFactor=Math.max(this._contentFactor,o.getContentSize().x/r.width),s=o.getClippedBounds().getBoundingBox(),a=Math.min(a,s.x),l=Math.min(l,s.y),c=Math.max(c,s.x+s.width),d=Math.max(d,s.y+s.height);this._homeBounds=new e.Rect(a,l,c-a,d-l),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;this._contentFactor===n&&this._homeBounds.equals(t)&&this._contentSize.equals(i)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})}(OpenSeadragon)}));function create_fragment$k(e){let t,i,n=[{class:i=e[6].class},{height:e[1]},{width:e[0]},e[3],e[4],e[2]],o={};for(let e=0;e<n.length;e+=1)o=assign(o,n[e]);return{c(){t=svg_element("svg"),this.h()},l(e){t=claim_svg_element(e,"svg",{class:!0,height:!0,width:!0}),children(t).forEach(detach),this.h()},h(){set_svg_attributes(t,o)},m(i,n){insert_hydration(i,t,n),t.innerHTML=e[5]},p(e,[r]){set_svg_attributes(t,o=get_spread_update(n,[64&r&&i!==(i=e[6].class)&&{class:i},2&r&&{height:e[1]},1&r&&{width:e[0]},e[3],e[4],4&r&&e[2]]))},i:noop,o:noop,d(e){e&&detach(t)}}}function instance$k(e,t,i){let{name:n}=t,{width:o="1rem"}=t,{height:r="1rem"}=t,{customAttribs:s={}}=t;const a={cog:{svg:'\n        <path\n            d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"\n          />\n        <circle cx="12" cy="12" r="3" />\n      ',attribs:{"stroke-width":1.5}},sliders:{svg:'\n        <circle cx="14" cy="6" r="2" />\n        <line x1="4" y1="6" x2="12" y2="6" />\n        <line x1="16" y1="6" x2="20" y2="6" />\n        <circle cx="8" cy="12" r="2" />\n        <line x1="4" y1="12" x2="6" y2="12" />\n        <line x1="10" y1="12" x2="20" y2="12" />\n        <circle cx="17" cy="18" r="2" />\n        <line x1="4" y1="18" x2="15" y2="18" />\n        <line x1="19" y1="18" x2="20" y2="18" />\n      ',attribs:{"stroke-width":1.5}},"arrow-down":{svg:'\n        <line x1="12" y1="5" x2="12" y2="19" />\n        <line x1="16" y1="15" x2="12" y2="19" />\n        <line x1="8" y1="15" x2="12" y2="19" />\n      '},"arrow-up":{svg:'\n        <line x1="12" y1="5" x2="12" y2="19" />\n        <line x1="16" y1="9" x2="12" y2="5" />\n        <line x1="8" y1="9" x2="12" y2="5" />\n      '},"fit-width":{svg:'\n        <polyline points="7 8 3 12 7 16" />\n        <polyline points="17 8 21 12 17 16" />\n        <line x1="3" y1="12" x2="9" y2="12" />\n        <line x1="14" y1="12" x2="20" y2="12" />\n      '},edit:{svg:'\n        <path d="M9 7h-3a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-3" />\n        <path d="M9 15h3l8.5 -8.5a1.5 1.5 0 0 0 -3 -3l-8.5 8.5v3" />\n        <line x1="16" y1="5" x2="19" y2="8" />\n      '},minus:{svg:'<line x1="5" y1="12" x2="19" y2="12" />'},plus:{svg:'\n        <line x1="12" y1="5" x2="12" y2="19" />\n        <line x1="5" y1="12" x2="19" y2="12" />\n      '},cross:{svg:'\n        <line x1="18" y1="6" x2="6" y2="18" />\n        <line x1="6" y1="6" x2="18" y2="18" />\n      '},reset:{svg:'<path d="m 10.953,20.006141 a 8,8 0 1 1 4,-0.5 m 5,0.5 h -5 v -5" />'},piano:{svg:'\n        <rect x="2" y="7" width="20" height="12" rx="2" />\n        <line\n          x1="7"\n          y1="9"\n          x2="7"\n          y2="13.5"\n          style="stroke-width:2.5;stroke-linecap:square"\n        />\n        <line\n          x1="12"\n          y1="9"\n          x2="12"\n          y2="13.5"\n          style="stroke-width:2.5;stroke-linecap:square"\n        />\n        <line\n          x1="17"\n          y1="9"\n          x2="17"\n          y2="13.5"\n          style="stroke-width:2.5;stroke-linecap:square"\n        />\n      '},"piano-out":{svg:'\n        <path d="M11 19h-6a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v4" />\n        <rect x="14" y="14" width="7" height="5" rx="1" />\n        <line x1="7" y1="9" x2="11" y2="13" />\n        <path d="M7 12v-3h3" />\n      '},"piano-in":{svg:'\n        <path d="M11 19h-6a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v4" />\n        <rect x="14" y="14" width="7" height="5" rx="1" />\n        <line x1="7" y1="9" x2="11" y2="13" />\n        <path d="M8 13h3v-3" />\n      '},"piano-down":{svg:'\n        <rect x="2" y="3" width="20" height="12" rx="2" />\n        <line x1="7" y1="5" x2="7" y2="9.5" style="stroke-width:2.5;stroke-linecap:square" />\n        <line x1="12" y1="5" x2="12" y2="9.5" style="stroke-width:2.5;stroke-linecap:square" />\n        <line x1="17" y1="5" x2="17" y2="9.5" style="stroke-width:2.5;stroke-linecap:square" />\n        <path d="m 10,19.000041 2,2 2,-2" />\n      '},"piano-up":{svg:'\n        <rect x="2" y="3" width="20" height="12" rx="2" />\n        <line x1="7" y1="5" x2="7" y2="9.5" style="stroke-width:2.5;stroke-linecap:square" />\n        <line x1="12" y1="5" x2="12" y2="9.5" style="stroke-width:2.5;stroke-linecap:square" />\n        <line x1="17" y1="5" x2="17" y2="9.5" style="stroke-width:2.5;stroke-linecap:square" />\n        <path d="M10 21l2 -2l2 2" />\n      '}},{attribs:l,svg:c}=a[n];return e.$$set=e=>{i(6,t=assign(assign({},t),exclude_internal_props(e))),"name"in e&&i(7,n=e.name),"width"in e&&i(0,o=e.width),"height"in e&&i(1,r=e.height),"customAttribs"in e&&i(2,s=e.customAttribs)},t=exclude_internal_props(t),[o,r,s,{viewBox:"0 0 24 24","stroke-width":2,stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},l,c,t,n]}class Icon extends SvelteComponent{constructor(e){super(),init(this,e,instance$k,create_fragment$k,safe_not_equal,{name:7,width:0,height:1,customAttribs:2})}}function create_fragment$j(e){let t,i,n,o,r,s,a,l,c,d,u,h,p,m,f,g,v,_,y,w,b,x;return n=new Icon({props:{name:"plus",height:"24",width:"24"}}),a=new Icon({props:{name:"minus",height:"24",width:"24"}}),u=new Icon({props:{name:"fit-width",height:"24",width:"24"}}),f=new Icon({props:{name:"arrow-up",height:"24",width:"24"}}),_=new Icon({props:{name:"arrow-down",height:"24",width:"24"}}),{c(){t=element("div"),i=element("button"),create_component(n.$$.fragment),r=space(),s=element("button"),create_component(a.$$.fragment),c=space(),d=element("button"),create_component(u.$$.fragment),p=space(),m=element("button"),create_component(f.$$.fragment),g=space(),v=element("button"),create_component(_.$$.fragment),this.h()},l(e){t=claim_element(e,"DIV",{class:!0});var o=children(t);i=claim_element(o,"BUTTON",{});var l=children(i);claim_component(n.$$.fragment,l),l.forEach(detach),r=claim_space(o),s=claim_element(o,"BUTTON",{});var h=children(s);claim_component(a.$$.fragment,h),h.forEach(detach),c=claim_space(o),d=claim_element(o,"BUTTON",{});var y=children(d);claim_component(u.$$.fragment,y),y.forEach(detach),p=claim_space(o),m=claim_element(o,"BUTTON",{});var w=children(m);claim_component(f.$$.fragment,w),w.forEach(detach),g=claim_space(o),v=claim_element(o,"BUTTON",{});var b=children(v);claim_component(_.$$.fragment,b),b.forEach(detach),o.forEach(detach),this.h()},h(){i.disabled=o=e[4]>=e[0],s.disabled=l=e[4]<=e[1],d.disabled=h=1===e[4],m.disabled=!1,v.disabled=!1,attr(t,"class","overlay-buttons top-center")},m(o,l){insert_hydration(o,t,l),append_hydration(t,i),mount_component(n,i,null),append_hydration(t,r),append_hydration(t,s),mount_component(a,s,null),append_hydration(t,c),append_hydration(t,d),mount_component(u,d,null),append_hydration(t,p),append_hydration(t,m),mount_component(f,m,null),append_hydration(t,g),append_hydration(t,v),mount_component(_,v,null),w=!0,b||(x=[listen(window,"mouseup",e[9]),listen(i,"mousedown",(function(){is_function(e[7](e[10]))&&e[7](e[10]).apply(this,arguments)})),listen(s,"mousedown",(function(){is_function(e[7](e[11]))&&e[7](e[11]).apply(this,arguments)})),listen(d,"click",e[12]),listen(m,"mousedown",(function(){is_function(e[7](e[13]))&&e[7](e[13]).apply(this,arguments)})),listen(v,"mousedown",(function(){is_function(e[7](e[14]))&&e[7](e[14]).apply(this,arguments)}))],b=!0)},p(t,[n]){e=t,(!w||17&n&&o!==(o=e[4]>=e[0]))&&(i.disabled=o),(!w||18&n&&l!==(l=e[4]<=e[1]))&&(s.disabled=l),(!w||16&n&&h!==(h=1===e[4]))&&(d.disabled=h)},i(e){w||(transition_in(n.$$.fragment,e),transition_in(a.$$.fragment,e),transition_in(u.$$.fragment,e),transition_in(f.$$.fragment,e),transition_in(_.$$.fragment,e),add_render_callback((()=>{y||(y=create_bidirectional_transition(t,fade,{},!0)),y.run(1)})),w=!0)},o(e){transition_out(n.$$.fragment,e),transition_out(a.$$.fragment,e),transition_out(u.$$.fragment,e),transition_out(f.$$.fragment,e),transition_out(_.$$.fragment,e),y||(y=create_bidirectional_transition(t,fade,{},!1)),y.run(0),w=!1},d(e){e&&detach(t),destroy_component(n),destroy_component(a),destroy_component(u),destroy_component(f),destroy_component(_),e&&y&&y.end(),b=!1,run_all(x)}}}function instance$j(e,t,i){let n,{openSeadragon:o}=t,{maxZoomLevel:r}=t,{minZoomLevel:s}=t,{updateTickByViewportIncrement:a}=t;const{viewport:l}=o;let c=l.getZoom();const d=()=>{const e=l.getBounds(),t=new openseadragon.Point(.5,e.y+e.height/2);l.panTo(t)},u=()=>i(4,c=l.getZoom());onMount((()=>(o.addHandler("zoom",u),()=>{o.removeHandler("zoom",u),n?.clear()})));return e.$$set=e=>{"openSeadragon"in e&&i(8,o=e.openSeadragon),"maxZoomLevel"in e&&i(0,r=e.maxZoomLevel),"minZoomLevel"in e&&i(1,s=e.minZoomLevel),"updateTickByViewportIncrement"in e&&i(2,a=e.updateTickByViewportIncrement)},[r,s,a,n,c,l,d,(e,t=!0)=>{n?.clear(),t&&e(),i(3,n=easingInterval(e))},o,()=>n?.clear(),()=>l.zoomTo(Math.min(1.1*l.getZoom(),r)),()=>l.zoomTo(Math.max(.9*l.getZoom(),s)),()=>{l.zoomTo(1),d()},()=>a(!0),()=>a(!1)]}class RollViewerControls extends SvelteComponent{constructor(e){super(),init(this,e,instance$j,create_fragment$j,safe_not_equal,{openSeadragon:8,maxZoomLevel:0,minZoomLevel:1,updateTickByViewportIncrement:2})}}if("undefined"!=typeof document){const e=":root{--navigator-width:40px}div.svelte-iu6njy.svelte-iu6njy{background-color:rgba(255, 255, 255, 0.5);color:black;font-size:12px;height:28px;transition:width 0.5s ease, transform 0.5s ease;position:absolute;left:1em;top:1em;z-index:1;display:flex;border:1px solid black;border-bottom:0;border-right:0;transform-origin:top left}div.svelte-iu6njy.svelte-iu6njy::before{background:rgba(255, 255, 255, 0.5);content:attr(data-label);display:block;padding:1px 4px;position:absolute;right:1px;top:calc(100% + 4px)}div.vertical.svelte-iu6njy.svelte-iu6njy{transform:rotate(-90deg) translate(-100%)}div.vertical.svelte-iu6njy.svelte-iu6njy::before{right:0;top:0;transform:rotate(-270deg) translate(100%)}div.vertical.svelte-iu6njy span.svelte-iu6njy::before{transform:rotate(-270deg)}span.svelte-iu6njy.svelte-iu6njy{background-repeat:no-repeat;border-radius:0;flex:1 0 auto;position:relative}span.svelte-iu6njy.svelte-iu6njy::before{bottom:-2px;content:attr(data-label);display:none;position:absolute}.us.svelte-iu6njy span.svelte-iu6njy{background-image:linear-gradient(black, black);background-position:100% top;background-size:1px 16px}.us.svelte-iu6njy span.svelte-iu6njy:last-child{background-size:1px 100%}.us.svelte-iu6njy span.svelte-iu6njy:nth-child(even)::before{display:block;right:1px}.us.halves.svelte-iu6njy span.svelte-iu6njy{background-image:linear-gradient(black, black), linear-gradient(black, black);background-position:50% top, 100% top;background-size:1px 12px, 1px 22px}.us.halves.svelte-iu6njy span.svelte-iu6njy:last-child{background-size:1px 12px, 1px 100%}.us.halves.svelte-iu6njy span.svelte-iu6njy::before{display:block;right:4px}.us.quarters.svelte-iu6njy span.svelte-iu6njy{background-image:linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black);background-position:25% top, 50% top, 75% top, 100% top;background-size:1px 12px, 1px 16px, 1px 12px, 1px 22px}.us.quarters.svelte-iu6njy span.svelte-iu6njy:last-child{background-size:1px 12px, 1px 16px, 1px 12px, 1px 100%}.us.quarters.svelte-iu6njy span.svelte-iu6njy::before{display:block;right:4px}.us.eighths.svelte-iu6njy span.svelte-iu6njy{background-image:linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black);background-position:12.5% top, 25% top, 37.5% top, 50% top, 62.5% top, 75% top, 87.5% top, 100% top;background-size:1px 8px, 1px 12px, 1px 8px, 1px 16px, 1px 8px, 1px 12px, 1px 8px, 1px 22px}.us.eighths.svelte-iu6njy span.svelte-iu6njy:last-child{background-size:1px 8px, 1px 12px, 1px 8px, 1px 16px, 1px 8px, 1px 12px, 1px 8px, 1px 100%}.us.eighths.svelte-iu6njy span.svelte-iu6njy::before{display:block;right:4px}.us.sixteenths.svelte-iu6njy span.svelte-iu6njy{background-image:linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black), linear-gradient(black, black);background-position:6.25% top, 12.5% top, 18.75% top, 25% top, 31.25% top, 37.5% top, 43.75% top, 50% top, 56.25% top, 62.5% top, 68.75% top, 75% top, 81.25% top, 87.5% top, 93.75% top, 100% top;background-size:1px 4px, 1px 8px, 1px 4px, 1px 12px, 1px 4px, 1px 8px, 1px 4px, 1px 16px, 1px 4px, 1px 8px, 1px 4px, 1px 12px, 1px 4px, 1px 8px, 1px 4px, 1px 22px}.us.sixteenths.svelte-iu6njy span.svelte-iu6njy:last-child{background-size:1px 4px, 1px 8px, 1px 4px, 1px 12px, 1px 4px, 1px 8px, 1px 4px, 1px 16px, 1px 4px, 1px 8px, 1px 4px, 1px 12px, 1px 4px, 1px 8px, 1px 4px, 1px 100%}.us.sixteenths.svelte-iu6njy span.svelte-iu6njy::before{display:block;right:4px}button.svelte-iu6njy.svelte-iu6njy{background:rgba(255, 255, 255, 0.5);border-radius:4px;border:none;cursor:pointer;position:absolute;top:calc(100% + 4px)}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}const draggable=(e,t=!1)=>{const{style:i}=e;let{top:n,left:o,width:r,height:s}=e.parentElement.getBoundingClientRect(),{left:a,top:l}=e.getBoundingClientRect(),c=!1;a-=o,l-=n,i.position="absolute",i.top=`${l}px`,i.left=`${a}px`,i.cursor="move",i.userSelect="none";const d=n=>{if(a+=n?.movementX||0,l+=n?.movementY||0,t){const{height:t,width:i}=e.getBoundingClientRect();a=clamp$1(a,0,r-i),l=clamp$1(l,0,s-t)}i.left=`${a}px`,i.top=`${l}px`},u=()=>{window.document.body.style.cursor="move",c=!0},h=()=>{window.document.body.style.cursor="unset",c=!1},p=e=>{c&&d(e)},m=new ResizeObserver((()=>{({top:n,left:o,width:r,height:s}=e.parentElement.getBoundingClientRect()),d()}));return m.observe(e.parentElement),e.addEventListener("mousedown",u),window.addEventListener("mousemove",p),window.addEventListener("mouseup",h),document.documentElement.addEventListener("mouseleave",h),{destroy(){m.disconnect(),e.removeEventListener("mousedown",u),window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",h),document.documentElement.removeEventListener("mouseleave",h)}}};function get_each_context$4(e,t,i){const n=e.slice();return n[7]=t[i],n[9]=i,n}function create_each_block$4(e){let t,i;return{c(){t=element("span"),this.h()},l(e){t=claim_element(e,"SPAN",{"data-label":!0,class:!0}),children(t).forEach(detach),this.h()},h(){attr(t,"data-label",i=e[9]+1),attr(t,"class","svelte-iu6njy")},m(e,i){insert_hydration(e,t,i)},d(e){e&&detach(t)}}}function create_fragment$i(e){let t,i,n,o,r,s,a,l,c=Array(e[0]),d=[];for(let t=0;t<c.length;t+=1)d[t]=create_each_block$4(get_each_context$4(e,c,t));return{c(){t=element("div");for(let e=0;e<d.length;e+=1)d[e].c();i=space(),n=element("button"),o=text("⟳"),this.h()},l(e){t=claim_element(e,"DIV",{class:!0,"data-label":!0});var r=children(t);for(let e=0;e<d.length;e+=1)d[e].l(r);i=claim_space(r),n=claim_element(r,"BUTTON",{class:!0});var s=children(n);o=claim_text(s,"⟳"),s.forEach(detach),r.forEach(detach),this.h()},h(){attr(n,"class","svelte-iu6njy"),attr(t,"class","us svelte-iu6njy"),attr(t,"data-label","inches"),toggle_class(t,"vertical",e[2]),toggle_class(t,"halves",e[0]<9),toggle_class(t,"quarters",e[0]<5),toggle_class(t,"eighths",e[0]<3),toggle_class(t,"sixteenths",1===e[0])},m(r,c){insert_hydration(r,t,c);for(let e=0;e<d.length;e+=1)d[e].m(t,null);append_hydration(t,i),append_hydration(t,n),append_hydration(n,o),e[5](t),s=!0,a||(l=[listen(n,"click",e[4]),action_destroyer(draggable.call(null,t,!0))],a=!0)},p(e,[n]){if(1&n){const n=c.length;let o;for(c=Array(e[0]),o=n;o<c.length;o+=1){const n=get_each_context$4(e,c,o);d[o]||(d[o]=create_each_block$4(n),d[o].c(),d[o].m(t,i))}for(o=c.length;o<n;o+=1)d[o].d(1);d.length=c.length}4&n&&toggle_class(t,"vertical",e[2]),1&n&&toggle_class(t,"halves",e[0]<9),1&n&&toggle_class(t,"quarters",e[0]<5),1&n&&toggle_class(t,"eighths",e[0]<3),1&n&&toggle_class(t,"sixteenths",1===e[0])},i(e){s||(add_render_callback((()=>{r||(r=create_bidirectional_transition(t,fade,{},!0)),r.run(1)})),s=!0)},o(e){r||(r=create_bidirectional_transition(t,fade,{},!1)),r.run(0),s=!1},d(i){i&&detach(t),destroy_each(d,i),e[5](null),i&&r&&r.end(),a=!1,run_all(l)}}}const minScaleBarWidth=100,maxMultiples=12;function instance$i(e,t,i){let n,o,{ppi:r}=t,s=!1;return e.$$set=e=>{"ppi"in e&&i(3,r=e.ppi)},e.$$.update=()=>{8&e.$$.dirty&&(()=>{for(i(0,n=1);r*n<minScaleBarWidth&&n<maxMultiples;)i(0,n+=1)})(),11&e.$$.dirty&&o&&i(1,o.style.width=r*n+"px",o)},[n,o,s,r,()=>i(2,s=!s),function(e){binding_callbacks[e?"unshift":"push"]((()=>{o=e,i(1,o),i(3,r),i(0,n)}))}]}class RollViewerScaleBar extends SvelteComponent{constructor(e){super(),init(this,e,instance$i,create_fragment$i,safe_not_equal,{ppi:3})}}function create_else_block$1(e){let t,i;return t=new RollViewerScaleBar({props:{ppi:e[6]}}),{c(){create_component(t.$$.fragment)},l(e){claim_component(t.$$.fragment,e)},m(e,n){mount_component(t,e,n),i=!0},p(e,i){const n={};64&i[0]&&(n.ppi=e[6]),t.$set(n)},i(e){i||(transition_in(t.$$.fragment,e),i=!0)},o(e){transition_out(t.$$.fragment,e),i=!1},d(e){destroy_component(t,e)}}}function create_if_block_1$4(e){let t,i,n,o;return{c(){t=element("span"),i=text("Downloading roll image..."),this.h()},l(e){t=claim_element(e,"SPAN",{class:!0});var n=children(t);i=claim_text(n,"Downloading roll image..."),n.forEach(detach),this.h()},h(){attr(t,"class","roll-loading svelte-zrkad9")},m(e,n){insert_hydration(e,t,n),append_hydration(t,i),o=!0},p:noop,i(e){o||(add_render_callback((()=>{n||(n=create_bidirectional_transition(t,fade,{},!0)),n.run(1)})),o=!0)},o(e){n||(n=create_bidirectional_transition(t,fade,{},!1)),n.run(0),o=!1},d(e){e&&detach(t),e&&n&&n.end()}}}function create_if_block$7(e){let t,i;return t=new RollViewerControls({props:{openSeadragon:e[1],minZoomLevel:minZoomLevel,maxZoomLevel:maxZoomLevel,updateTickByViewportIncrement:e[0]}}),{c(){create_component(t.$$.fragment)},l(e){claim_component(t.$$.fragment,e)},m(e,n){mount_component(t,e,n),i=!0},p(e,i){const n={};2&i[0]&&(n.openSeadragon=e[1]),t.$set(n)},i(e){i||(transition_in(t.$$.fragment,e),i=!0)},o(e){transition_out(t.$$.fragment,e),i=!1},d(e){destroy_component(t,e)}}}function create_fragment$h(e){let t,i,n,o,r,s,a,l;const c=[create_if_block_1$4,create_else_block$1],d=[];function u(e,t){return e[3]?1:0}i=u(e),n=d[i]=c[i](e);let h=e[4]&&create_if_block$7(e);return{c(){t=element("div"),n.c(),o=space(),h&&h.c(),this.h()},l(e){t=claim_element(e,"DIV",{id:!0,style:!0,class:!0});var i=children(t);n.l(i),o=claim_space(i),h&&h.l(i),i.forEach(detach),this.h()},h(){attr(t,"id","roll-viewer"),attr(t,"style",r=`--trackerbar-height: ${e[5]}px;`),attr(t,"class","svelte-zrkad9"),toggle_class(t,"active-note-details",e[7].activeNoteDetails),toggle_class(t,"highlight-enabled-holes",e[7].highlightEnabledHoles),toggle_class(t,"show-note-velocities",e[7].showNoteVelocities),toggle_class(t,"use-roll-pedaling",e[8]),toggle_class(t,"play-expressions",e[9])},m(n,r){insert_hydration(n,t,r),d[i].m(t,null),append_hydration(t,o),h&&h.m(t,null),s=!0,a||(l=[listen(t,"mouseenter",e[17]),listen(t,"mouseleave",e[18]),listen(t,"wheel",prevent_default(e[19]),!0)],a=!0)},p(e,a){let l=i;i=u(e),i===l?d[i].p(e,a):(group_outros(),transition_out(d[l],1,1,(()=>{d[l]=null})),check_outros(),n=d[i],n?n.p(e,a):(n=d[i]=c[i](e),n.c()),transition_in(n,1),n.m(t,o)),e[4]?h?(h.p(e,a),16&a[0]&&transition_in(h,1)):(h=create_if_block$7(e),h.c(),transition_in(h,1),h.m(t,null)):h&&(group_outros(),transition_out(h,1,1,(()=>{h=null})),check_outros()),(!s||32&a[0]&&r!==(r=`--trackerbar-height: ${e[5]}px;`))&&attr(t,"style",r),128&a[0]&&toggle_class(t,"active-note-details",e[7].activeNoteDetails),128&a[0]&&toggle_class(t,"highlight-enabled-holes",e[7].highlightEnabledHoles),128&a[0]&&toggle_class(t,"show-note-velocities",e[7].showNoteVelocities),256&a[0]&&toggle_class(t,"use-roll-pedaling",e[8]),512&a[0]&&toggle_class(t,"play-expressions",e[9])},i(e){s||(transition_in(n),transition_in(h),s=!0)},o(e){transition_out(n),transition_out(h),s=!1},d(e){e&&detach(t),d[i].d(),h&&h.d(),a=!1,run_all(l)}}}const defaultZoomLevel=1,minZoomLevel=.1,maxZoomLevel=4;function instance$h(e,t,i){let n,o,r,s,a,l,c,d;component_subscribe(e,rollMetadata,(e=>i(14,o=e))),component_subscribe(e,scrollDownwards,(e=>i(15,r=e))),component_subscribe(e,currentTick,(e=>i(16,s=e))),component_subscribe(e,playbackProgress,(e=>i(32,a=e))),component_subscribe(e,userSettings,(e=>i(7,l=e))),component_subscribe(e,rollPedalingOnOff,(e=>i(8,c=e))),component_subscribe(e,playExpressionsOnOff,(e=>i(9,d=e)));let u,h,p,m,f,g,v,_,y,w,b,x,T,S,k,{imageUrl:C}=t,{holeData:A}=t,{holesByTickInterval:E}=t,{skipToTick:N}=t,O=[],P=[];const M=e=>{const{x:t,startY:i,w:n,h:r,m:s,v:a,color:l,type:c}=e,d=document.createElement("mark"),u=getHoleLabel(s,o.ROLL_TYPE);d.dataset.holeLabel=u,"note"===c&&(d.dataset.noteVelocity=a||64),d.style.setProperty("--highlight-color",`hsl(${l})`),d.classList.add(c),d.addEventListener("mouseout",(()=>{O.map((([e])=>e)).includes(e)||h.viewer.removeOverlay(f)}));const p=h.viewportToImageRectangle(h.getBounds()),m=parseFloat(t+n/2-p.x)/parseFloat(p.width);d.classList.toggle("flag-left",m>.8);const g=h.imageToViewportRectangle(t-4,i-4,n+11,r+12);return h.viewer.addOverlay(d,g),d},R=e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","g");return t.setAttribute("width",_),t.setAttribute("height",v),t.setAttribute("viewBox",`0 0 ${_} ${v}`),t.setAttribute("style","pointer-events: none;"),t.appendChild(i),e.forEach((e=>{const{x:t,startY:n,w:o,h:r,color:s,type:a}=e,l=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("x",t-10),l.setAttribute("y",n-10),l.setAttribute("width",o+20),l.setAttribute("height",r+20),l.setAttribute("rx",10),l.setAttribute("ry",10),l.addEventListener("mouseover",(()=>{O.map((([e])=>e)).includes(e)||(h.viewer.removeOverlay(f),f=M(e))})),l.setAttribute("fill",`hsla(${s}, 0.8)`),l.setAttribute("class",a),i.appendChild(l)})),t},I=()=>{if(void 0===S)return;const{y:e,height:t}=h.viewportToImageRectangle(h.getBounds()),i=e+t,n=S.search(e,i);P=P.filter((e=>!!n.includes(e)||(h.viewer.removeOverlay(e),!1))),n.forEach((e=>{P.includes(e)||(P.push(e),h.viewer.addOverlay(e,k))}))},F=e=>{if(!u)return;const t=p+(r?e:-e),i=h.imageToViewportCoordinates(0,t);h.centerSpringY.springTo(i.y),x.dataset.label=(100*a).toFixed(1),x.classList.toggle("label-above",r?a>.5:a<.5),I()},D=(e=!0)=>{const t=h.getBounds(),i=h.viewportToImageRectangle(t),n=e?-i.height/200:i.height/200,o=i.y+i.height/2;N(r?clamp$1(o+n-p,-p,v-p):clamp$1(p-o-n,p-v,p))},j=e=>{if(clearInterval(b),e){const{centerSpringY:e}=h;e.animationTime=1.2,b=setInterval((()=>{e.animationTime=Math.max(e.animationTime-.1,0),e.animationTime<=0&&clearInterval(b)}),100)}const t=h.getCenter(!1),i=h.viewportToImageCoordinates(t);N(r?clamp$1(i.y-p,-p,v-p):clamp$1(p-i.y,p-v,p))};onMount((()=>{i(1,u=openseadragon({id:"roll-viewer",showNavigationControl:!1,panHorizontal:!0,visibilityRatio:1,defaultZoomLevel:defaultZoomLevel,minZoomLevel:minZoomLevel,maxZoomLevel:maxZoomLevel,constrainDuringPan:!0,preserveImageSizeOnResize:!0,gestureSettingsMouse:{clickToZoom:!1,scrollToZoom:!1},showNavigator:!0,navigatorAutoFade:!1,navigatorPosition:"ABSOLUTE",navigatorTop:"0px",navigatorLeft:"calc(100% - var(--navigator-width))",navigatorHeight:"100%",navigatorWidth:"var(--navigator-width)",navigatorDisplayRegionColor:"transparent",animationTime:0}));const{navigator:e}=u;i(2,({viewport:h}=u),h),({displayRegion:x}=e),i(2,h.zoomSpring.animationTime=1.2,h),i(2,h.centerSpringX.animationTime=1.2,h),i(2,h.centerSpringY.animationTime=0,h),e.panHorizontal=!1,e.element.style.border="none",e.element.parentElement.style.backgroundColor="#666",Object.assign(x.style,{display:"block",border:"none",overflow:"visible",left:"0",width:"100%",backgroundColor:"rgba(255 255 255 / .6)",boxShadow:"0 0 4px var(--primary-accent)"}),e.update=t=>{const{viewport:i,displayRegion:{style:n},totalBorderWidths:o}=e;if(t&&i){const e=h.getBoundsNoRotate(!0),t=i.pixelFromPointNoRotate(e.getTopLeft(),!1),r=i.pixelFromPointNoRotate(e.getBottomRight(),!1).minus(o);n.top=`${Math.round(t.y)}px`,n.height=`${Math.abs(t.y-r.y)}px`}},u.addHandler("open",(()=>{h.viewer.world.getItemAt(0).addOnceHandler("fully-loaded-change",(()=>i(3,m=!0)))})),u.addOnceHandler("update-viewport",(()=>{(()=>{if(!A)return;k=h.imageToViewportRectangle(0,0,_,v),S=new __pika_web_default_export_for_treeshaking__;const e=r?n:p;for(let t=r?p:n;t<=e;t+=1e3){const i=Math.min(t+1e3,e),n=A.filter((({startY:e})=>e>=t&&e<i));if(n.length){const e=Math.max(...n.map((({endY:e})=>e))),i=R(n);S.insert(t,e,i)}}})(),F(0)})),u.addHandler("zoom",(({zoom:e})=>{const t=h.viewportToImageZoom(e);i(5,w=Math.max(1,y*t)),i(6,T=300*t),I()})),u.addHandler("canvas-drag",(t=>{t.preventDefaultAction=!0;const n=new openseadragon.Point(h.centerSpringX.target.value,h.centerSpringY.target.value),o=e.viewport.imageToViewportCoordinates(new openseadragon.Point(0,v)),r=h.deltaPointsFromPixels(t.delta.negate());i(2,h.centerSpringX.target.value+=r.x,h),h.getBounds().x!==h.getConstrainedBounds().x&&(r.x=0);const s=n.plus(r);h.centerSpringX.springTo(s.x),h.centerSpringY.springTo(clamp$1(s.y,0,o.y)),j(!0)})),u.addHandler("navigator-click",(t=>{if(t.preventDefaultAction=!0,!t.quick)return;const i=e.viewport.pointFromPixel(t.position);h.centerSpringY.springTo(i.y),j(!0)})),u.addHandler("navigator-drag",(t=>{t.preventDefaultAction=!0;const i=new openseadragon.Point(0,h.centerSpringY.target.value).plus(e.viewport.deltaPointsFromPixels(t.delta)),n=e.viewport.imageToViewportCoordinates(new openseadragon.Point(0,v));h.centerSpringY.springTo(clamp$1(i.y,0,n.y)),j(!1)})),e.innerTracker.releaseHandler=()=>{},u.open(C)}));return e.$$set=e=>{"imageUrl"in e&&i(10,C=e.imageUrl),"holeData"in e&&i(11,A=e.holeData),"holesByTickInterval"in e&&i(12,E=e.holesByTickInterval),"skipToTick"in e&&i(13,N=e.skipToTick)},e.$$.update=()=>{65536&e.$$.dirty[0]&&F(s),65536&e.$$.dirty[0]&&(e=>{if(!u)return;const t=E.search(e,e);O=O.filter((([e,i])=>!!t.includes(e)||(h.viewer.removeOverlay(i),!1))),t.forEach((e=>{if(O.map((([e])=>e)).includes(e))return;const t=M(e);t.classList.add("active"),O.push([e,t])}))})(s),16384&e.$$.dirty[0]&&(v=parseInt(o.IMAGE_LENGTH,10)),16384&e.$$.dirty[0]&&(_=parseInt(o.IMAGE_WIDTH,10)),16384&e.$$.dirty[0]&&(y=parseInt(o.AVG_HOLE_WIDTH,10)),49152&e.$$.dirty[0]&&(p=r?parseInt(o.FIRST_HOLE,10):parseInt(o.IMAGE_LENGTH,10)-parseInt(o.FIRST_HOLE,10)),49152&e.$$.dirty[0]&&(n=r?parseInt(o.LAST_HOLE,10):parseInt(o.IMAGE_LENGTH,10)-parseInt(o.LAST_HOLE,10))},[D,u,h,m,g,w,T,l,c,d,C,A,E,N,o,r,s,()=>i(4,g=!0),()=>i(4,g=!1),e=>{if(e.ctrlKey)return D(e.deltaY<0),void e.stopPropagation();h.zoomTo(clamp$1(h.getZoom()*(e.deltaY>0?.9:1.1),minZoomLevel,maxZoomLevel))}]}class RollViewer extends SvelteComponent{constructor(e){super(),init(this,e,instance$h,create_fragment$h,safe_not_equal,{imageUrl:10,holeData:11,holesByTickInterval:12,skipToTick:13,updateTickByViewportIncrement:0},null,[-1,-1])}get updateTickByViewportIncrement(){return this.$$.ctx[0]}}if("undefined"!=typeof document){const e=':root{--navigator-width:40px}#keyboard.svelte-1uqku6d.svelte-1uqku6d.svelte-1uqku6d{display:flow-root;margin:1vh 1vw;aspect-ratio:10/1;z-index:3;position:relative}#keyboard.svelte-1uqku6d:hover .overlay-buttons{opacity:1}@supports not (aspect-ratio: 10/1){#keyboard.svelte-1uqku6d.svelte-1uqku6d.svelte-1uqku6d{padding-top:10%}div#keys.svelte-1uqku6d.svelte-1uqku6d.svelte-1uqku6d{top:0}}div#keys.svelte-1uqku6d.svelte-1uqku6d.svelte-1uqku6d{position:absolute;display:flex;padding:0;height:100%;width:100%}div#keys.svelte-1uqku6d.svelte-1uqku6d.svelte-1uqku6d::before{background-color:var(--primary-accent);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAICAYAAADeM14FAAAAfUlEQVQYVyXMoQ3AIBBG4f92qEIiLkyAqmQBBmAChmgXqOwO1GHOMQEOhWQBJqhqQu2XvEelFL7vG601hBBA3ntWSuG6LjjnQDFGft8XtVZYa0HGGB5jYN/3haS15m3bcBzHD713Timt/jxPkIhwzhlzTsQY/+nzPGsoIvgAaMAzN5CzOpMAAAAASUVORK5CYII=);content:"";position:absolute;top:0;height:2%;left:0;right:0;box-shadow:0 1px 1px rgba(0, 0, 0, 0.7), 1px 0 1px rgba(0, 0, 0, 0.7), -1px 0 1px rgba(0, 0, 0, 0.7);z-index:1}div#keys.svelte-1uqku6d div.svelte-1uqku6d.svelte-1uqku6d{position:relative;flex:1 0 auto}div#keys.svelte-1uqku6d div.svelte-1uqku6d .svelte-1uqku6d:first-child{background:linear-gradient(-30deg, #f5f5f5, #fff);border-radius:0 0 4% 4%;border:1px solid #ccc;box-shadow:inset 0 1px 0 #fff, inset 0 -1px 0 #fff, inset 1px 0 0 #fff, inset -1px 0 0 #fff, 0 4px 3px rgba(0, 0, 0, 0.7);display:block;height:100%}div#keys.svelte-1uqku6d div.svelte-1uqku6d :first-child.depressed{box-shadow:0 2px 2px rgba(0, 0, 0, 0.4);height:98%;position:relative;top:2px}div#keys.svelte-1uqku6d div.svelte-1uqku6d :first-child.depressed:before{background:rgba(0, 0, 0, 0.1);content:"";bottom:0;position:absolute;left:0;top:0;width:10%}div#keys.svelte-1uqku6d div.svelte-1uqku6d :first-child.depressed:after{background:rgba(0, 0, 0, 0.1);content:"";bottom:0;position:absolute;right:0;top:0;width:10%}div#keys.svelte-1uqku6d div.svelte-1uqku6d :first-child.depressed{background:#b5e2ff}div#keys.svelte-1uqku6d div.svelte-1uqku6d .svelte-1uqku6d:nth-child(2){background:linear-gradient(-20deg, #333, #000, #333);border-color:#666 #222 #111 #555;border-radius:0 0 3% 3%;border-style:solid;border-width:1px 2px 7px;box-shadow:inset 0 -1px 2px rgba(255, 255, 255, 0.4), 0 2px 3px rgba(0, 0, 0, 0.4);height:56%;left:100%;position:absolute;top:2%;width:50%;z-index:1;transform:translateX(-50%)}div#keys.svelte-1uqku6d div.svelte-1uqku6d :nth-child(2).depressed{background:#b5e2ff;border-bottom-width:2px;box-shadow:inset 0 -1px 1px rgba(255, 255, 255, 0.4), 0 1px 0 rgba(0, 0, 0, 0.8), 0 2px 2px rgba(0, 0, 0, 0.4), 0 -1px 0 #000;height:57%}div.pedal.svelte-1uqku6d.svelte-1uqku6d.svelte-1uqku6d{filter:drop-shadow(0px 8px 3px black) saturate(0.4);margin:0 4%;transform:rotate3d(1, 0, 0, 30deg);transform-origin:top;transition:all 0.1s ease;left:38%;position:relative;margin-top:-25px;cursor:pointer;width:3%;display:inline-block}div.pedal.depressed.svelte-1uqku6d.svelte-1uqku6d.svelte-1uqku6d{filter:drop-shadow(0px 4px 2px black) saturate(0.6);transform:rotate3d(0, 0, 0, 0)}div.pedal.svelte-1uqku6d svg.svelte-1uqku6d.svelte-1uqku6d{width:100%}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}if("undefined"!=typeof document){const e=":root{--navigator-width:40px}div.svelte-1o0e2kf{left:1em;top:0;transform:translateY(-100%);border-radius:4px 4px 0 0;padding:0;opacity:0;transition:all 0.3s ease}div.svelte-1o0e2kf:hover{opacity:1}div.outside.svelte-1o0e2kf{bottom:0;left:0;top:unset;opacity:1;border-radius:0 4px 4px 0}button.svelte-1o0e2kf{border-radius:4px 4px 0 0}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function create_if_block$6(e){let t,i,n,o,r;return i=new Icon({props:{name:e[1].overlayKeyboard?"piano-out":"piano-in",height:"24",width:"24"}}),{c(){t=element("button"),create_component(i.$$.fragment),this.h()},l(e){t=claim_element(e,"BUTTON",{class:!0});var n=children(t);claim_component(i.$$.fragment,n),n.forEach(detach),this.h()},h(){attr(t,"class","svelte-1o0e2kf")},m(s,a){insert_hydration(s,t,a),mount_component(i,t,null),n=!0,o||(r=listen(t,"click",e[3]),o=!0)},p(e,t){const n={};2&t&&(n.name=e[1].overlayKeyboard?"piano-out":"piano-in"),i.$set(n)},i(e){n||(transition_in(i.$$.fragment,e),n=!0)},o(e){transition_out(i.$$.fragment,e),n=!1},d(e){e&&detach(t),destroy_component(i),o=!1,r()}}}function create_fragment$g(e){let t,i,n,o,r,s,a,l;n=new Icon({props:{name:e[1].showKeyboard?"piano-down":"piano-up",height:"24",width:"24"}});let c=!e[0]&&create_if_block$6(e);return{c(){t=element("div"),i=element("button"),create_component(n.$$.fragment),o=space(),c&&c.c(),this.h()},l(e){t=claim_element(e,"DIV",{class:!0});var r=children(t);i=claim_element(r,"BUTTON",{class:!0});var s=children(i);claim_component(n.$$.fragment,s),s.forEach(detach),o=claim_space(r),c&&c.l(r),r.forEach(detach),this.h()},h(){attr(i,"class","svelte-1o0e2kf"),attr(t,"class","overlay-buttons svelte-1o0e2kf"),toggle_class(t,"outside",e[0])},m(r,d){insert_hydration(r,t,d),append_hydration(t,i),mount_component(n,i,null),append_hydration(t,o),c&&c.m(t,null),s=!0,a||(l=listen(i,"click",e[2]),a=!0)},p(e,[i]){const o={};2&i&&(o.name=e[1].showKeyboard?"piano-down":"piano-up"),n.$set(o),e[0]?c&&(group_outros(),transition_out(c,1,1,(()=>{c=null})),check_outros()):c?(c.p(e,i),1&i&&transition_in(c,1)):(c=create_if_block$6(e),c.c(),transition_in(c,1),c.m(t,null)),1&i&&toggle_class(t,"outside",e[0])},i(e){s||(transition_in(n.$$.fragment,e),transition_in(c),e&&add_render_callback((()=>{r||(r=create_bidirectional_transition(t,fade,{},!0)),r.run(1)})),s=!0)},o(e){transition_out(n.$$.fragment,e),transition_out(c),e&&(r||(r=create_bidirectional_transition(t,fade,{},!1)),r.run(0)),s=!1},d(e){e&&detach(t),destroy_component(n),c&&c.d(),e&&r&&r.end(),a=!1,l()}}}function instance$g(e,t,i){let n;component_subscribe(e,userSettings,(e=>i(1,n=e)));let{outside:o=!1}=t;return e.$$set=e=>{"outside"in e&&i(0,o=e.outside)},[o,n,()=>set_store_value(userSettings,n.showKeyboard=!n.showKeyboard,n),()=>set_store_value(userSettings,n.overlayKeyboard=!n.overlayKeyboard,n)]}class KeyboardControls extends SvelteComponent{constructor(e){super(),init(this,e,instance$g,create_fragment$g,safe_not_equal,{outside:0})}}function get_each_context$3(e,t,i){const n=e.slice();return n[26]=t[i],n}function get_each_context_1(e,t,i){const n=e.slice();return n[29]=t[i].title,n[30]=t[i].note,n}function create_each_block_1(e){let t;return{c(){t=element("span"),this.h()},l(e){t=claim_element(e,"SPAN",{title:!0,"data-key":!0,class:!0}),children(t).forEach(detach),this.h()},h(){attr(t,"title",e[29]),attr(t,"data-key",e[30]),attr(t,"class","svelte-1uqku6d"),toggle_class(t,"depressed",e[5].has(e[30])||e[4].has(e[30]))},m(e,i){insert_hydration(e,t,i)},p(e,i){304&i[0]&&toggle_class(t,"depressed",e[5].has(e[30])||e[4].has(e[30]))},d(e){e&&detach(t)}}}function create_each_block$3(e){let t,i,n=e[26],o=[];for(let t=0;t<n.length;t+=1)o[t]=create_each_block_1(get_each_context_1(e,n,t));return{c(){t=element("div");for(let e=0;e<o.length;e+=1)o[e].c();i=space(),this.h()},l(e){t=claim_element(e,"DIV",{class:!0});var n=children(t);for(let e=0;e<o.length;e+=1)o[e].l(n);i=claim_space(n),n.forEach(detach),this.h()},h(){attr(t,"class","svelte-1uqku6d")},m(e,n){insert_hydration(e,t,n);for(let e=0;e<o.length;e+=1)o[e].m(t,null);append_hydration(t,i)},p(e,r){if(304&r[0]){let s;for(n=e[26],s=0;s<n.length;s+=1){const a=get_each_context_1(e,n,s);o[s]?o[s].p(a,r):(o[s]=create_each_block_1(a),o[s].c(),o[s].m(t,i))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(e){e&&detach(t),destroy_each(o,e)}}}function create_fragment$f(e){let t,i,n,o,r,s,a,l,c,d,u,h,p,m,f,g,v,_,y,w,b,x,T,S=e[8],k=[];for(let t=0;t<S.length;t+=1)k[t]=create_each_block$3(get_each_context$3(e,S,t));return o=new KeyboardControls({}),{c(){t=element("div"),i=element("div");for(let e=0;e<k.length;e+=1)k[e].c();n=space(),create_component(o.$$.fragment),r=space(),s=svg_element("svg"),a=svg_element("symbol"),l=svg_element("path"),c=svg_element("path"),d=svg_element("path"),u=svg_element("path"),h=svg_element("path"),p=space(),m=element("div"),f=svg_element("svg"),g=svg_element("use"),v=space(),_=element("div"),y=svg_element("svg"),w=svg_element("use"),this.h()},l(e){t=claim_element(e,"DIV",{id:!0,class:!0});var b=children(t);i=claim_element(b,"DIV",{id:!0,class:!0});var x=children(i);for(let e=0;e<k.length;e+=1)k[e].l(x);x.forEach(detach),n=claim_space(b),claim_component(o.$$.fragment,b),b.forEach(detach),r=claim_space(e),s=claim_svg_element(e,"svg",{style:!0});var T=children(s);a=claim_svg_element(T,"symbol",{id:!0,viewBox:!0});var S=children(a);l=claim_svg_element(S,"path",{d:!0,style:!0}),children(l).forEach(detach),c=claim_svg_element(S,"path",{d:!0,style:!0}),children(c).forEach(detach),d=claim_svg_element(S,"path",{d:!0,style:!0}),children(d).forEach(detach),u=claim_svg_element(S,"path",{d:!0,style:!0}),children(u).forEach(detach),h=claim_svg_element(S,"path",{d:!0,style:!0}),children(h).forEach(detach),S.forEach(detach),T.forEach(detach),p=claim_space(e),m=claim_element(e,"DIV",{class:!0});var C=children(m);f=claim_svg_element(C,"svg",{xmlns:!0,width:!0,height:!0,class:!0});var A=children(f);g=claim_svg_element(A,"use",{href:!0,class:!0}),children(g).forEach(detach),A.forEach(detach),C.forEach(detach),v=claim_space(e),_=claim_element(e,"DIV",{class:!0});var E=children(_);y=claim_svg_element(E,"svg",{xmlns:!0,width:!0,height:!0,class:!0});var N=children(y);w=claim_svg_element(N,"use",{href:!0,class:!0}),children(w).forEach(detach),N.forEach(detach),E.forEach(detach),this.h()},h(){attr(i,"id","keys"),attr(i,"class","svelte-1uqku6d"),attr(t,"id","keyboard"),attr(t,"class","svelte-1uqku6d"),attr(l,"d","M10 0v5.7c0 .9.3 2.2 1 3.5.7 1.4 1.4 3.3 1.4 4.3 0 1.3-1.9 2.8-6.2 2.8-4.4 0-6.2-1.5-6.2-2.8 0-1 .6-2.9 1.4-4.3a28.2 14.1 0 0 0 1-3.5V0z"),set_style(l,"fill","#996a01"),attr(c,"d","m10.5 9-.7-1.7c-.2-.7-.2-1.3-.2-1.8V0h-7v5.5c0 .5 0 1.1-.2 1.8L1.7 9a43 21.5 0 0 0-1.3 4.3c0 1.3 1.7 2.9 5.6 2.9 4.1 0 5.8-1.6 5.8-3 0-1-.5-2.8-1.3-4.2"),set_style(c,"fill","#eed072"),attr(d,"d","M9.1 0v5.2a8 8 0 0 0 .8 4c.7 1.5 1 3.3 1 4.3 0 .8-.9 2.4-4.7 2.4-3.8 0-4.8-1.6-4.8-2.4 0-1 .4-2.8 1.1-4.2.7-1.6.7-3 .7-4V0z"),set_style(d,"fill","#d7a735"),attr(u,"d","M10.5 13.5v-.6c0-.6-.4-.4-.5 0-.2.3-1 1.9-3.8 1.9s-3.7-1.6-4-2c0-.3-.3-.5-.4 0v.7c0 .7.8 2.2 4.4 2.2 3.4 0 4.3-1.5 4.3-2.2"),set_style(u,"fill","#eed072"),attr(h,"d","M6.1 15.2c.5 0 1.3 0 1.7-.2.5 0 1 0 .6.2a3.1 1.6 0 0 1-2.3.4c-.9 0-1.8-.2-2.2-.4-.4-.3 0-.3.6-.2l1.6.2"),set_style(h,"fill","#fff"),attr(a,"id","pedal"),attr(a,"viewBox","0 0 12.4 16.3"),set_style(s,"display","none"),attr(g,"href","#pedal"),attr(g,"class","svelte-1uqku6d"),attr(f,"xmlns","http://www.w3.org/2000/svg"),attr(f,"width","46.9"),attr(f,"height","61.6"),attr(f,"class","svelte-1uqku6d"),attr(m,"class","pedal svelte-1uqku6d"),toggle_class(m,"depressed",e[6]),attr(w,"href","#pedal"),attr(w,"class","svelte-1uqku6d"),attr(y,"xmlns","http://www.w3.org/2000/svg"),attr(y,"width","46.9"),attr(y,"height","61.6"),attr(y,"class","svelte-1uqku6d"),attr(_,"class","pedal svelte-1uqku6d"),toggle_class(_,"depressed",e[7])},m(S,C){insert_hydration(S,t,C),append_hydration(t,i);for(let e=0;e<k.length;e+=1)k[e].m(i,null);append_hydration(t,n),mount_component(o,t,null),insert_hydration(S,r,C),insert_hydration(S,s,C),append_hydration(s,a),append_hydration(a,l),append_hydration(a,c),append_hydration(a,d),append_hydration(a,u),append_hydration(a,h),insert_hydration(S,p,C),insert_hydration(S,m,C),append_hydration(m,f),append_hydration(f,g),insert_hydration(S,v,C),insert_hydration(S,_,C),append_hydration(_,y),append_hydration(y,w),b=!0,x||(T=[listen(window,"mouseup",e[11]),listen(i,"mousedown",prevent_default(e[12])),listen(i,"mouseup",prevent_default(e[13])),listen(i,"mousemove",prevent_default(e[14])),listen(m,"mousedown",e[15]),listen(m,"mouseup",e[16]),listen(m,"mouseout",e[17]),listen(m,"blur",e[18]),listen(_,"mousedown",e[19]),listen(_,"mouseup",e[20]),listen(_,"mouseout",e[21]),listen(_,"blur",e[22])],x=!0)},p(e,t){if(304&t[0]){let n;for(S=e[8],n=0;n<S.length;n+=1){const o=get_each_context$3(e,S,n);k[n]?k[n].p(o,t):(k[n]=create_each_block$3(o),k[n].c(),k[n].m(i,null))}for(;n<k.length;n+=1)k[n].d(1);k.length=S.length}64&t[0]&&toggle_class(m,"depressed",e[6]),128&t[0]&&toggle_class(_,"depressed",e[7])},i(e){b||(transition_in(o.$$.fragment,e),b=!0)},o(e){transition_out(o.$$.fragment,e),b=!1},d(e){e&&detach(t),destroy_each(k,e),destroy_component(o),e&&detach(r),e&&detach(s),e&&detach(p),e&&detach(m),e&&detach(v),e&&detach(_),x=!1,run_all(T)}}}function instance$f(e,t,i){let n,o,r,s=noop,a=()=>(s(),s=subscribe(u,(e=>i(5,n=e))),u);component_subscribe(e,softOnOff,(e=>i(6,o=e))),component_subscribe(e,sustainOnOff,(e=>i(7,r=e))),e.$$.on_destroy.push((()=>s()));let{keyCount:l=88}=t,{startNote:c}=t,{stopNote:d}=t,{activeNotes:u}=t;a();const h=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],p=[];let m=1,f=0;for(;m<=l;)for(let e=0;e<h.length;e+=1){const t=h[e];if("C"===t&&(f+=1),m>l)break;t.endsWith("#")?p[p.length-1].push({note:m+20,title:`${t}${f}`}):p.push([{note:m+20,title:`${t}${f}`}]),m+=1}let g=!1,v=new Set;const _=()=>{v.forEach(d),i(4,v=new Set)};return e.$$set=e=>{"keyCount"in e&&i(10,l=e.keyCount),"startNote"in e&&i(0,c=e.startNote),"stopNote"in e&&i(1,d=e.stopNote),"activeNotes"in e&&a(i(2,u=e.activeNotes))},[c,d,u,g,v,n,o,r,p,_,l,()=>{_(),i(3,g=!1)},({target:e})=>{const t=parseInt(e.dataset.key,10);i(3,g=!0),i(4,v=v.add(t)),c(t)},({target:e})=>{const t=parseInt(e.dataset.key,10);v.delete(t),i(4,v),d(t)},({target:e})=>{if(g){const t=parseInt(e.dataset.key,10);t&&!v.has(t)&&(_(),i(4,v=v.add(t)),c(t))}},()=>set_store_value(softOnOff,o=!0,o),()=>set_store_value(softOnOff,o=!1,o),()=>set_store_value(softOnOff,o=!1,o),()=>set_store_value(softOnOff,o=!1,o),()=>set_store_value(sustainOnOff,r=!0,r),()=>set_store_value(sustainOnOff,r=!1,r),()=>set_store_value(sustainOnOff,r=!1,r),()=>set_store_value(sustainOnOff,r=!1,r)]}class Keyboard extends SvelteComponent{constructor(e){super(),init(this,e,instance$f,create_fragment$f,safe_not_equal,{keyCount:10,startNote:0,stopNote:1,activeNotes:2},null,[-1,-1])}}const defaultKeyMap={SOFT:{code:"KeyB",key:"b"},SUSTAIN:{code:"Space",key:"＿"},ACCENT:{code:"KeyN",key:"n"},VOLUME_UP:{code:"KeyO",key:"o"},VOLUME_DOWN:{code:"KeyI",key:"i"},BASS_VOLUME_UP:{code:"Digit4",key:"4"},BASS_VOLUME_DOWN:{code:"KeyE",key:"e"},TREBLE_VOLUME_UP:{code:"Digit0",key:"0"},TREBLE_VOLUME_DOWN:{code:"KeyP",key:"p"},TEMPO_UP:{code:"KeyT",key:"t"},TEMPO_DOWN:{code:"KeyR",key:"r"},PLAY_PAUSE:{code:"Digit7",key:"7"},REWIND:{code:"Backspace",key:"⌫"},FORWARD:{code:"Digit8",key:"8"},BACKWARD:{code:"Digit6",key:"6"},PAN_UP:{code:"ArrowUp",key:"↑"},PAN_DOWN:{code:"ArrowDown",key:"↓"}},keyMapMeta={SOFT:{description:"Soft Pedal",help:"Hold to apply the soft pedal"},SUSTAIN:{description:"Sustain Pedal",help:"Hold to apply the sustain pedal"},ACCENT:{description:"Accent Button",help:"Notes struck while this is held with be 50% louder"},VOLUME_UP:{description:"Volume Up",help:"Increase the main volume\n        Use SHIFT for a larger increment, and CTRL for finer-grained control"},VOLUME_DOWN:{description:"Volume Down",help:"Decrease the main volume\n        Use SHIFT for a larger increment, and CTRL for finer-grained control"},BASS_VOLUME_UP:{description:"Bass Volume Up",help:"Increase the bass volume\n        Use SHIFT for a larger increment, and CTRL for finer-grained control"},BASS_VOLUME_DOWN:{description:"Bass Volume Down",help:"Decrease the bass volume\n        Use SHIFT for a larger increment, and CTRL for finer-grained control"},TREBLE_VOLUME_UP:{description:"Treble Volume Up",help:"Increase the treble volume\n        Use SHIFT for a larger increment, and CTRL for finer-grained control"},TREBLE_VOLUME_DOWN:{description:"Treble Volume Down",help:"Decrease the treble volume\n        Use SHIFT for a larger increment, and CTRL for finer-grained control"},TEMPO_UP:{description:"Tempo Up",help:"Increase the tempo\n        Use SHIFT for a larger increment, and CTRL for finer-grained control"},TEMPO_DOWN:{description:"Tempo Down",help:"Decrease the tempo\n        Use SHIFT for a larger increment, and CTRL for finer-grained control"},PLAY_PAUSE:{description:"Play/Pause",help:"Play or pause the roll playback"},REWIND:{description:"Rewind Roll",help:"Rewind the roll to the beginning"},FORWARD:{description:"Scrub Forwards",help:"Advance the roll (hold to accelerate)"},BACKWARD:{description:"Scrub Backwards",help:"Back up (hold to accelerate)"},PAN_UP:{description:"Pan Upwards",help:"Pan the roll upwards (hold to accelerate)"},PAN_DOWN:{description:"Pan Downwards",help:"Pan the roll downwards (hold to accelerate)"}},unusableKeys=["Escape","ControlLeft","ControlRight","ShiftLeft","ShiftRight","CapsLock"],alternativeIndicatorText={Space:"＿",Backspace:"⌫",Delete:"⌦",NumpadEnter:"⏎",Enter:"⏎",ArrowUp:"↑",ArrowDown:"↓",ArrowLeft:"←",ArrowRight:"→"},controlsConfig={volume:{store:volumeCoefficient,min:0,max:4,delta:.1,shiftDelta:.4,ctrlDelta:.05,precision:2},bassVolume:{store:bassVolumeCoefficient,min:0,max:4,delta:.1,shiftDelta:.4,ctrlDelta:.05,precision:2},trebleVolume:{store:trebleVolumeCoefficient,min:0,max:4,delta:.1,shiftDelta:.4,ctrlDelta:.05,precision:2},tempo:{store:tempoCoefficient,min:.1,max:3,delta:.05,shiftDelta:.1,ctrlDelta:.01,precision:2}};function create_fragment$e(e){let t,i;return{c:noop,l:noop,m(n,o){t||(i=[listen(window,"keydown",e[7]),listen(window,"keyup",e[8])],t=!0)},p:noop,i:noop,o:noop,d(e){t=!1,run_all(i)}}}const keyMap=createPersistedStore("keyMap",JSON.parse(JSON.stringify(defaultKeyMap)));function instance$e(e,t,i){let n,o,r,s,a,l=noop;component_subscribe(e,accentOnOff,(e=>i(9,n=e))),component_subscribe(e,sustainOnOff,(e=>i(10,o=e))),component_subscribe(e,softOnOff,(e=>i(11,r=e))),component_subscribe(e,scrollDownwards,(e=>i(12,s=e))),component_subscribe(e,keyMap,(e=>i(1,a=e))),e.$$.on_destroy.push((()=>l()));let c,{playPauseApp:d}=t,{stopApp:u}=t,{updateTickByViewportIncrement:h}=t;const p=({store:e,min:t,max:i,delta:n,shiftDelta:o,ctrlDelta:r,precision:s},{shiftKey:a,ctrlKey:l},c)=>{const d=(c?1:-1)*(a&&o||l&&r||n);e.set(enforcePrecision(clamp$1(get_store_value(e)+d,t,i),s))},m=(...e)=>p(...e,!0),f=(...e)=>p(...e,!1),g=(e,t=!0)=>{c||(t&&e(),i(0,c=easingInterval(e)))},v={SOFT:()=>set_store_value(softOnOff,r=!0,r),SUSTAIN:()=>set_store_value(sustainOnOff,o=!0,o),ACCENT:()=>set_store_value(accentOnOff,n=!0,n),VOLUME_UP:e=>m(controlsConfig.volume,e),VOLUME_DOWN:e=>f(controlsConfig.volume,e),BASS_VOLUME_UP:e=>m(controlsConfig.bassVolume,e),BASS_VOLUME_DOWN:e=>f(controlsConfig.bassVolume,e),TREBLE_VOLUME_UP:e=>m(controlsConfig.trebleVolume,e),TREBLE_VOLUME_DOWN:e=>f(controlsConfig.trebleVolume,e),TEMPO_UP:e=>m(controlsConfig.tempo,e),TEMPO_DOWN:e=>f(controlsConfig.tempo,e),PLAY_PAUSE:d,REWIND:u,FORWARD:()=>g((()=>h(!s))),BACKWARD:()=>g((()=>h(s))),PAN_UP:()=>g((()=>h(!0))),PAN_DOWN:()=>g((()=>h(!1)))},_={SOFT:()=>set_store_value(softOnOff,r=!1,r),SUSTAIN:()=>set_store_value(sustainOnOff,o=!1,o),ACCENT:()=>set_store_value(accentOnOff,n=!1,n)};return e.$$set=e=>{"playPauseApp"in e&&i(4,d=e.playPauseApp),"stopApp"in e&&i(5,u=e.stopApp),"updateTickByViewportIncrement"in e&&i(6,h=e.updateTickByViewportIncrement)},[c,a,v,_,d,u,h,e=>{const t=Object.keys(a).find((t=>a[t].code===e.code));t&&(e.ctrlKey||e.shiftKey||e.preventDefault(),set_store_value(keyMap,a[t].active=!0,a),v[t]?.(e))},({code:e})=>{const t=Object.keys(a).find((t=>a[t].code===e));t&&(c?.clear(),i(0,c=void 0),set_store_value(keyMap,a[t].active=!1,a),_[t]?.())}]}class KeyboardShortcuts extends SvelteComponent{constructor(e){super(),init(this,e,instance$e,create_fragment$e,safe_not_equal,{playPauseApp:4,stopApp:5,updateTickByViewportIncrement:6})}}if("undefined"!=typeof document){const e=":root{--navigator-width:40px}div.svelte-1eamz7m{background-color:var(--background-color);border-radius:4px;box-shadow:0 3px 6px rgba(0, 0, 0, 0.3);left:50%;max-height:80%;max-width:100%;min-width:400px;padding:1em;position:absolute;top:42%;transform:translate(-50%, -50%);width:400px;z-index:10;display:flex;flex-direction:column}header.svelte-1eamz7m{display:flex;font-size:1.4em;font-weight:bold;justify-content:space-between;margin-bottom:0.5em;text-decoration:underline}p.svelte-1eamz7m{margin-bottom:1em}p.error-message.svelte-1eamz7m{border-radius:5px;border:1px solid red;color:red;padding:0.25em}dl.svelte-1eamz7m{display:grid;grid-template-columns:auto auto;justify-content:space-between;gap:0 0.25em;overflow-y:auto;overflow-x:hidden}p.reset.svelte-1eamz7m{display:flex;align-items:center;justify-content:flex-end;margin:1em 0}button.svelte-1eamz7m{background:none;border:none;cursor:pointer;margin:0;padding:0}button.svelte-1eamz7m svg{stroke:grey}button.svelte-1eamz7m:hover svg{stroke:black}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}if("undefined"!=typeof document){const e=":root{--navigator-width:40px}dt.svelte-8yzgie.svelte-8yzgie{display:flex;align-items:center}dd.svelte-8yzgie.svelte-8yzgie{display:flex;align-items:center;justify-content:flex-end;margin:0.2em 0}dd.svelte-8yzgie span.svelte-8yzgie{color:grey}button.svelte-8yzgie.svelte-8yzgie{background:none;border:none;cursor:pointer;margin:0;padding:0}button.svelte-8yzgie svg{stroke:grey}button.svelte-8yzgie:not([disabled]):hover svg{stroke:black}button[disabled].svelte-8yzgie.svelte-8yzgie{cursor:default;opacity:0.5}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}var top="top",bottom="bottom",right="right",left="left",auto="auto",start="start",end="end",beforeRead="beforeRead",read="read",afterRead="afterRead",beforeMain="beforeMain",main="main",afterMain="afterMain",beforeWrite="beforeWrite",write="write",afterWrite="afterWrite",modifierPhases=[beforeRead,read,afterRead,beforeMain,main,afterMain,beforeWrite,write,afterWrite];function getBasePlacement(e){return e.split("-")[0]}function getWindow(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function isElement(e){return e instanceof getWindow(e).Element||e instanceof Element}function isHTMLElement(e){return e instanceof getWindow(e).HTMLElement||e instanceof HTMLElement}function isShadowRoot(e){return"undefined"!=typeof ShadowRoot&&(e instanceof getWindow(e).ShadowRoot||e instanceof ShadowRoot)}var round=Math.round;function getBoundingClientRect(e,t){void 0===t&&(t=!1);var i=e.getBoundingClientRect(),n=1,o=1;if(isHTMLElement(e)&&t){var r=e.offsetHeight,s=e.offsetWidth;s>0&&(n=i.width/s||1),r>0&&(o=i.height/r||1)}return{width:round(i.width/n),height:round(i.height/o),top:round(i.top/o),right:round(i.right/n),bottom:round(i.bottom/o),left:round(i.left/n),x:round(i.left/n),y:round(i.top/o)}}function getLayoutRect(e){var t=getBoundingClientRect(e),i=e.offsetWidth,n=e.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-n)<=1&&(n=t.height),{x:e.offsetLeft,y:e.offsetTop,width:i,height:n}}function getNodeName(e){return e?(e.nodeName||"").toLowerCase():null}function getComputedStyle$1(e){return getWindow(e).getComputedStyle(e)}function isTableElement(e){return["table","td","th"].indexOf(getNodeName(e))>=0}function getDocumentElement(e){return((isElement(e)?e.ownerDocument:e.document)||window.document).documentElement}function getParentNode(e){return"html"===getNodeName(e)?e:e.assignedSlot||e.parentNode||(isShadowRoot(e)?e.host:null)||getDocumentElement(e)}function getTrueOffsetParent(e){return isHTMLElement(e)&&"fixed"!==getComputedStyle$1(e).position?e.offsetParent:null}function getContainingBlock(e){var t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&isHTMLElement(e)&&"fixed"===getComputedStyle$1(e).position)return null;for(var i=getParentNode(e);isHTMLElement(i)&&["html","body"].indexOf(getNodeName(i))<0;){var n=getComputedStyle$1(i);if("none"!==n.transform||"none"!==n.perspective||"paint"===n.contain||-1!==["transform","perspective"].indexOf(n.willChange)||t&&"filter"===n.willChange||t&&n.filter&&"none"!==n.filter)return i;i=i.parentNode}return null}function getOffsetParent(e){for(var t=getWindow(e),i=getTrueOffsetParent(e);i&&isTableElement(i)&&"static"===getComputedStyle$1(i).position;)i=getTrueOffsetParent(i);return i&&("html"===getNodeName(i)||"body"===getNodeName(i)&&"static"===getComputedStyle$1(i).position)?t:i||getContainingBlock(e)||t}function getMainAxisFromPlacement(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}var round$1=Math.round;function getWindowScroll(e){var t=getWindow(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function getWindowScrollBarX(e){return getBoundingClientRect(getDocumentElement(e)).left+getWindowScroll(e).scrollLeft}function isScrollParent(e){var t=getComputedStyle$1(e),i=t.overflow,n=t.overflowX,o=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+o+n)}function getScrollParent(e){return["html","body","#document"].indexOf(getNodeName(e))>=0?e.ownerDocument.body:isHTMLElement(e)&&isScrollParent(e)?e:getScrollParent(getParentNode(e))}function listScrollParents(e,t){var i;void 0===t&&(t=[]);var n=getScrollParent(e),o=n===(null==(i=e.ownerDocument)?void 0:i.body),r=getWindow(n),s=o?[r].concat(r.visualViewport||[],isScrollParent(n)?n:[]):n,a=t.concat(s);return o?a:a.concat(listScrollParents(getParentNode(s)))}function getVariation(e){return e.split("-")[1]}function computeOffsets(e){var t,i=e.reference,n=e.element,o=e.placement,r=o?getBasePlacement(o):null,s=o?getVariation(o):null,a=i.x+i.width/2-n.width/2,l=i.y+i.height/2-n.height/2;switch(r){case top:t={x:a,y:i.y-n.height};break;case bottom:t={x:a,y:i.y+i.height};break;case right:t={x:i.x+i.width,y:l};break;case left:t={x:i.x-n.width,y:l};break;default:t={x:i.x,y:i.y}}var c=r?getMainAxisFromPlacement(r):null;if(null!=c){var d="y"===c?"height":"width";switch(s){case start:t[c]=t[c]-(i[d]/2-n[d]/2);break;case end:t[c]=t[c]+(i[d]/2-n[d]/2)}}return t}function getHTMLElementScroll(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function getNodeScroll(e){return e!==getWindow(e)&&isHTMLElement(e)?getHTMLElementScroll(e):getWindowScroll(e)}function isElementScaled(e){var t=e.getBoundingClientRect(),i=t.width/e.offsetWidth||1,n=t.height/e.offsetHeight||1;return 1!==i||1!==n}function getCompositeRect(e,t,i){void 0===i&&(i=!1);var n=isHTMLElement(t),o=isHTMLElement(t)&&isElementScaled(t),r=getDocumentElement(t),s=getBoundingClientRect(e,o),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!i)&&(("body"!==getNodeName(t)||isScrollParent(r))&&(a=getNodeScroll(t)),isHTMLElement(t)?((l=getBoundingClientRect(t,!0)).x+=t.clientLeft,l.y+=t.clientTop):r&&(l.x=getWindowScrollBarX(r))),{x:s.left+a.scrollLeft-l.x,y:s.top+a.scrollTop-l.y,width:s.width,height:s.height}}function order(e){var t=new Map,i=new Set,n=[];function o(e){i.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!i.has(e)){var n=t.get(e);n&&o(n)}})),n.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){i.has(e.name)||o(e)})),n}function orderModifiers(e){var t=order(e);return modifierPhases.reduce((function(e,i){return e.concat(t.filter((function(e){return e.phase===i})))}),[])}function debounce(e){var t;return function(){return t||(t=new Promise((function(i){Promise.resolve().then((function(){t=void 0,i(e())}))}))),t}}function format(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return[].concat(i).reduce((function(e,t){return e.replace(/%s/,t)}),e)}var INVALID_MODIFIER_ERROR='Popper: modifier "%s" provided an invalid %s property, expected %s but got %s',MISSING_DEPENDENCY_ERROR='Popper: modifier "%s" requires "%s", but "%s" modifier is not available',VALID_PROPERTIES=["name","enabled","phase","fn","effect","requires","options"];function validateModifiers(e){e.forEach((function(t){[].concat(Object.keys(t),VALID_PROPERTIES).filter((function(e,t,i){return i.indexOf(e)===t})).forEach((function(i){switch(i){case"name":"string"!=typeof t.name&&console.error(format(INVALID_MODIFIER_ERROR,String(t.name),'"name"','"string"','"'+String(t.name)+'"'));break;case"enabled":"boolean"!=typeof t.enabled&&console.error(format(INVALID_MODIFIER_ERROR,t.name,'"enabled"','"boolean"','"'+String(t.enabled)+'"'));break;case"phase":modifierPhases.indexOf(t.phase)<0&&console.error(format(INVALID_MODIFIER_ERROR,t.name,'"phase"',"either "+modifierPhases.join(", "),'"'+String(t.phase)+'"'));break;case"fn":"function"!=typeof t.fn&&console.error(format(INVALID_MODIFIER_ERROR,t.name,'"fn"','"function"','"'+String(t.fn)+'"'));break;case"effect":null!=t.effect&&"function"!=typeof t.effect&&console.error(format(INVALID_MODIFIER_ERROR,t.name,'"effect"','"function"','"'+String(t.fn)+'"'));break;case"requires":null==t.requires||Array.isArray(t.requires)||console.error(format(INVALID_MODIFIER_ERROR,t.name,'"requires"','"array"','"'+String(t.requires)+'"'));break;case"requiresIfExists":Array.isArray(t.requiresIfExists)||console.error(format(INVALID_MODIFIER_ERROR,t.name,'"requiresIfExists"','"array"','"'+String(t.requiresIfExists)+'"'));break;case"options":case"data":break;default:console.error('PopperJS: an invalid property has been provided to the "'+t.name+'" modifier, valid properties are '+VALID_PROPERTIES.map((function(e){return'"'+e+'"'})).join(", ")+'; but "'+i+'" was provided.')}t.requires&&t.requires.forEach((function(i){null==e.find((function(e){return e.name===i}))&&console.error(format(MISSING_DEPENDENCY_ERROR,String(t.name),i,i))}))}))}))}function uniqueBy(e,t){var i=new Set;return e.filter((function(e){var n=t(e);if(!i.has(n))return i.add(n),!0}))}function mergeByName(e){var t=e.reduce((function(e,t){var i=e[t.name];return e[t.name]=i?Object.assign({},i,t,{options:Object.assign({},i.options,t.options),data:Object.assign({},i.data,t.data)}):t,e}),{});return Object.keys(t).map((function(e){return t[e]}))}var INVALID_ELEMENT_ERROR="Popper: Invalid reference or popper argument provided. They must be either a DOM element or virtual element.",INFINITE_LOOP_ERROR="Popper: An infinite loop in the modifiers cycle has been detected! The cycle has been interrupted to prevent a browser crash.",DEFAULT_OPTIONS={placement:"bottom",modifiers:[],strategy:"absolute"};function areValidElements(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function popperGenerator(e){void 0===e&&(e={});var t=e,i=t.defaultModifiers,n=void 0===i?[]:i,o=t.defaultOptions,r=void 0===o?DEFAULT_OPTIONS:o;return function(e,t,i){void 0===i&&(i=r);var o={placement:"bottom",orderedModifiers:[],options:Object.assign({},DEFAULT_OPTIONS,r),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},s=[],a=!1,l={state:o,setOptions:function(i){var a="function"==typeof i?i(o.options):i;c(),o.options=Object.assign({},r,o.options,a),o.scrollParents={reference:isElement(e)?listScrollParents(e):e.contextElement?listScrollParents(e.contextElement):[],popper:listScrollParents(t)};var d=orderModifiers(mergeByName([].concat(n,o.options.modifiers)));(o.orderedModifiers=d.filter((function(e){return e.enabled})),validateModifiers(uniqueBy([].concat(d,o.options.modifiers),(function(e){return e.name}))),getBasePlacement(o.options.placement)===auto)&&(o.orderedModifiers.find((function(e){return"flip"===e.name}))||console.error(['Popper: "auto" placements require the "flip" modifier be',"present and enabled to work."].join(" ")));var u=getComputedStyle$1(t);return[u.marginTop,u.marginRight,u.marginBottom,u.marginLeft].some((function(e){return parseFloat(e)}))&&console.warn(['Popper: CSS "margin" styles cannot be used to apply padding',"between the popper and its reference element or boundary.","To replicate margin, use the `offset` modifier, as well as","the `padding` option in the `preventOverflow` and `flip`","modifiers."].join(" ")),o.orderedModifiers.forEach((function(e){var t=e.name,i=e.options,n=void 0===i?{}:i,r=e.effect;if("function"==typeof r){var a=r({state:o,name:t,instance:l,options:n}),c=function(){};s.push(a||c)}})),l.update()},forceUpdate:function(){if(!a){var e=o.elements,t=e.reference,i=e.popper;if(areValidElements(t,i)){o.rects={reference:getCompositeRect(t,getOffsetParent(i),"fixed"===o.options.strategy),popper:getLayoutRect(i)},o.reset=!1,o.placement=o.options.placement,o.orderedModifiers.forEach((function(e){return o.modifiersData[e.name]=Object.assign({},e.data)}));for(var n=0,r=0;r<o.orderedModifiers.length;r++){if((n+=1)>100){console.error(INFINITE_LOOP_ERROR);break}if(!0!==o.reset){var s=o.orderedModifiers[r],c=s.fn,d=s.options,u=void 0===d?{}:d,h=s.name;"function"==typeof c&&(o=c({state:o,options:u,name:h,instance:l})||o)}else o.reset=!1,r=-1}}else console.error(INVALID_ELEMENT_ERROR)}},update:debounce((function(){return new Promise((function(e){l.forceUpdate(),e(o)}))})),destroy:function(){c(),a=!0}};if(!areValidElements(e,t))return console.error(INVALID_ELEMENT_ERROR),l;function c(){s.forEach((function(e){return e()})),s=[]}return l.setOptions(i).then((function(e){!a&&i.onFirstUpdate&&i.onFirstUpdate(e)})),l}}var passive={passive:!0};function effect(e){var t=e.state,i=e.instance,n=e.options,o=n.scroll,r=void 0===o||o,s=n.resize,a=void 0===s||s,l=getWindow(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return r&&c.forEach((function(e){e.addEventListener("scroll",i.update,passive)})),a&&l.addEventListener("resize",i.update,passive),function(){r&&c.forEach((function(e){e.removeEventListener("scroll",i.update,passive)})),a&&l.removeEventListener("resize",i.update,passive)}}var eventListeners={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:effect,data:{}};function popperOffsets(e){var t=e.state,i=e.name;t.modifiersData[i]=computeOffsets({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}var popperOffsets$1={name:"popperOffsets",enabled:!0,phase:"read",fn:popperOffsets,data:{}},unsetSides={top:"auto",right:"auto",bottom:"auto",left:"auto"};function roundOffsetsByDPR(e){var t=e.x,i=e.y,n=window.devicePixelRatio||1;return{x:round$1(round$1(t*n)/n)||0,y:round$1(round$1(i*n)/n)||0}}function mapToStyles(e){var t,i=e.popper,n=e.popperRect,o=e.placement,r=e.variation,s=e.offsets,a=e.position,l=e.gpuAcceleration,c=e.adaptive,d=e.roundOffsets,u=!0===d?roundOffsetsByDPR(s):"function"==typeof d?d(s):s,h=u.x,p=void 0===h?0:h,m=u.y,f=void 0===m?0:m,g=s.hasOwnProperty("x"),v=s.hasOwnProperty("y"),_=left,y=top,w=window;if(c){var b=getOffsetParent(i),x="clientHeight",T="clientWidth";b===getWindow(i)&&"static"!==getComputedStyle$1(b=getDocumentElement(i)).position&&"absolute"===a&&(x="scrollHeight",T="scrollWidth"),b=b,o!==top&&(o!==left&&o!==right||r!==end)||(y=bottom,f-=b[x]-n.height,f*=l?1:-1),o!==left&&(o!==top&&o!==bottom||r!==end)||(_=right,p-=b[T]-n.width,p*=l?1:-1)}var S,k=Object.assign({position:a},c&&unsetSides);return l?Object.assign({},k,((S={})[y]=v?"0":"",S[_]=g?"0":"",S.transform=(w.devicePixelRatio||1)<=1?"translate("+p+"px, "+f+"px)":"translate3d("+p+"px, "+f+"px, 0)",S)):Object.assign({},k,((t={})[y]=v?f+"px":"",t[_]=g?p+"px":"",t.transform="",t))}function computeStyles(e){var t=e.state,i=e.options,n=i.gpuAcceleration,o=void 0===n||n,r=i.adaptive,s=void 0===r||r,a=i.roundOffsets,l=void 0===a||a,c=getComputedStyle$1(t.elements.popper).transitionProperty||"";s&&["transform","top","right","bottom","left"].some((function(e){return c.indexOf(e)>=0}))&&console.warn(["Popper: Detected CSS transitions on at least one of the following",'CSS properties: "transform", "top", "right", "bottom", "left".',"\n\n",'Disable the "computeStyles" modifier\'s `adaptive` option to allow',"for smooth transitions, or remove these properties from the CSS","transition declaration on the popper element if only transitioning","opacity or background-color for example.","\n\n","We recommend using the popper element as a wrapper around an inner","element that can have any CSS property transitioned for animations."].join(" "));var d={placement:getBasePlacement(t.placement),variation:getVariation(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:o};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,mapToStyles(Object.assign({},d,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:s,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,mapToStyles(Object.assign({},d,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}var computeStyles$1={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:computeStyles,data:{}};function applyStyles(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var i=t.styles[e]||{},n=t.attributes[e]||{},o=t.elements[e];isHTMLElement(o)&&getNodeName(o)&&(Object.assign(o.style,i),Object.keys(n).forEach((function(e){var t=n[e];!1===t?o.removeAttribute(e):o.setAttribute(e,!0===t?"":t)})))}))}function effect$1(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach((function(e){var n=t.elements[e],o=t.attributes[e]||{},r=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:i[e]).reduce((function(e,t){return e[t]="",e}),{});isHTMLElement(n)&&getNodeName(n)&&(Object.assign(n.style,r),Object.keys(o).forEach((function(e){n.removeAttribute(e)})))}))}}var applyStyles$1={name:"applyStyles",enabled:!0,phase:"write",fn:applyStyles,effect:effect$1,requires:["computeStyles"]},defaultModifiers=[eventListeners,popperOffsets$1,computeStyles$1,applyStyles$1],createPopper=popperGenerator({defaultModifiers:defaultModifiers});if("undefined"!=typeof document){const e=':root{--navigator-width:40px}div.svelte-10gzhcz{z-index:11}span.svelte-10gzhcz{-webkit-animation:svelte-10gzhcz-tooltip 0.2s ease-out;animation:svelte-10gzhcz-tooltip 0.2s ease-out;background-color:rgba(51, 51, 51, 0.9);border-radius:3px;color:#fff;display:inline-block;line-height:1.2;max-width:250px;min-width:70px;padding:7px;position:relative;text-align:center;transform:translate(0, -5px);white-space:pre-line;width:-webkit-max-content;width:-moz-max-content;width:max-content}span.svelte-10gzhcz::after{border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid rgba(51, 51, 51, 0.9);top:100%;content:" ";font-size:0;left:50%;line-height:0;position:absolute;width:0}@-webkit-keyframes svelte-10gzhcz-tooltip{from{opacity:0;transform:translate(0, 0)}to{opacity:1;transform:translate(0, -5px)}}@keyframes svelte-10gzhcz-tooltip{from{opacity:0;transform:translate(0, 0)}to{opacity:1;transform:translate(0, -5px)}}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function create_fragment$d(e){let t,i,n;return{c(){t=element("div"),i=element("span"),n=text(e[1]),this.h()},l(o){t=claim_element(o,"DIV",{class:!0});var r=children(t);i=claim_element(r,"SPAN",{class:!0});var s=children(i);n=claim_text(s,e[1]),s.forEach(detach),r.forEach(detach),this.h()},h(){attr(i,"class","svelte-10gzhcz"),attr(t,"class","svelte-10gzhcz")},m(o,r){insert_hydration(o,t,r),append_hydration(t,i),append_hydration(i,n),e[2](t)},p(e,[t]){2&t&&set_data(n,e[1])},i:noop,o:noop,d(i){i&&detach(t),e[2](null)}}}function instance$d(e,t,i){let{text:n}=t,{element:o}=t;return e.$$set=e=>{"text"in e&&i(1,n=e.text),"element"in e&&i(0,o=e.element)},[o,n,function(e){binding_callbacks[e?"unshift":"push"]((()=>{o=e,i(0,o)}))}]}class Tooltip extends SvelteComponent{constructor(e){super(),init(this,e,instance$d,create_fragment$d,safe_not_equal,{text:1,element:0})}get text(){return this.$$.ctx[1]}set text(e){this.$$set({text:e}),flush()}get element(){return this.$$.ctx[0]}set element(e){this.$$set({element:e}),flush()}}const tooltip=(e,t)=>{if(!t)return{};let i,n;const o=()=>{n=new Tooltip({target:document.body,props:{text:t}}),i=createPopper(e,n.element,{placement:"top"})},r=()=>{i?.destroy(),i=null,n?.$destroy()};return e.addEventListener("mouseenter",o),e.addEventListener("mouseleave",r),{destroy(){r(),e.removeEventListener("mouseenter",o),e.removeEventListener("mouseleave",r)}}};function create_else_block(e){let t,i,n=e[0].key+"";return{c(){t=element("kbd"),i=text(n)},l(e){t=claim_element(e,"KBD",{});var o=children(t);i=claim_text(o,n),o.forEach(detach)},m(e,n){insert_hydration(e,t,n),append_hydration(t,i)},p(e,t){1&t&&n!==(n=e[0].key+"")&&set_data(i,n)},d(e){e&&detach(t)}}}function create_if_block$5(e){let t,i;return{c(){t=element("span"),i=text("Choose a new keystroke..."),this.h()},l(e){t=claim_element(e,"SPAN",{class:!0});var n=children(t);i=claim_text(n,"Choose a new keystroke..."),n.forEach(detach),this.h()},h(){attr(t,"class","svelte-8yzgie")},m(e,n){insert_hydration(e,t,n),append_hydration(t,i)},p:noop,d(e){e&&detach(t)}}}function create_key_block(e){let t,i,n,o,r,s,a;return i=new Icon({props:{name:"reset",height:"20",width:"20"}}),{c(){t=element("button"),create_component(i.$$.fragment),this.h()},l(e){t=claim_element(e,"BUTTON",{class:!0});var n=children(t);claim_component(i.$$.fragment,n),n.forEach(detach),this.h()},h(){t.disabled=n=!e[0].isChanged,attr(t,"class","svelte-8yzgie")},m(n,l){insert_hydration(n,t,l),mount_component(i,t,null),r=!0,s||(a=[action_destroyer(o=tooltip.call(null,t,e[0].isChanged?"Reset to Default":void 0)),listen(t,"click",e[5])],s=!0)},p(e,i){(!r||1&i&&n!==(n=!e[0].isChanged))&&(t.disabled=n),o&&is_function(o.update)&&1&i&&o.update.call(null,e[0].isChanged?"Reset to Default":void 0)},i(e){r||(transition_in(i.$$.fragment,e),r=!0)},o(e){transition_out(i.$$.fragment,e),r=!1},d(e){e&&detach(t),destroy_component(i),s=!1,run_all(a)}}}function create_fragment$c(e){let t,i,n,o,r,s,a,l,c,d,u,h,p=e[1].description+"",m=e[0].isChanged;function f(e,t){return e[2]?create_if_block$5:create_else_block}let g=f(e),v=g(e);l=new Icon({props:{name:"edit",height:"20",width:"20"}});let _=create_key_block(e);return{c(){t=element("dt"),i=text(p),o=space(),r=element("dd"),v.c(),s=space(),a=element("button"),create_component(l.$$.fragment),c=space(),_.c(),this.h()},l(e){t=claim_element(e,"DT",{class:!0});var n=children(t);i=claim_text(n,p),n.forEach(detach),o=claim_space(e),r=claim_element(e,"DD",{class:!0});var d=children(r);v.l(d),s=claim_space(d),a=claim_element(d,"BUTTON",{class:!0});var u=children(a);claim_component(l.$$.fragment,u),u.forEach(detach),c=claim_space(d),_.l(d),d.forEach(detach),this.h()},h(){attr(t,"class","svelte-8yzgie"),attr(a,"class","svelte-8yzgie"),attr(r,"class","svelte-8yzgie")},m(p,m){insert_hydration(p,t,m),append_hydration(t,i),insert_hydration(p,o,m),insert_hydration(p,r,m),v.m(r,null),append_hydration(r,s),append_hydration(r,a),mount_component(l,a,null),e[8](a),append_hydration(r,c),_.m(r,null),d=!0,u||(h=[listen(window,"keydown",prevent_default(e[6]),!0),listen(window,"keyup",prevent_default(e[7]),!0),action_destroyer(n=tooltip.call(null,t,e[1].help)),action_destroyer(tooltip.call(null,a,"Edit")),listen(a,"click",e[9])],u=!0)},p(e,[t]){(!d||2&t)&&p!==(p=e[1].description+"")&&set_data(i,p),n&&is_function(n.update)&&2&t&&n.update.call(null,e[1].help),g===(g=f(e))&&v?v.p(e,t):(v.d(1),v=g(e),v&&(v.c(),v.m(r,s))),1&t&&safe_not_equal(m,m=e[0].isChanged)?(group_outros(),transition_out(_,1,1,noop),check_outros(),_=create_key_block(e),_.c(),transition_in(_),_.m(r,null)):_.p(e,t)},i(e){d||(transition_in(l.$$.fragment,e),transition_in(_),d=!0)},o(e){transition_out(l.$$.fragment,e),transition_out(_),d=!1},d(i){i&&detach(t),i&&detach(o),i&&detach(r),v.d(),destroy_component(l),e[8](null),_.d(i),u=!1,run_all(h)}}}function instance$c(e,t,i){let n,{shortcut:o}=t,{meta:r}=t,s=!1;const a=createEventDispatcher(),l=e=>a("update",e);return e.$$set=e=>{"shortcut"in e&&i(0,o=e.shortcut),"meta"in e&&i(1,r=e.meta)},[o,r,s,n,l,()=>a("reset"),e=>s&&e.stopPropagation(),e=>{s&&(l(e),i(2,s=!1),n.blur(),e.stopPropagation())},function(e){binding_callbacks[e?"unshift":"push"]((()=>{n=e,i(3,n)}))},()=>i(2,s=!s)]}class KeyboardShortcutEditorRow extends SvelteComponent{constructor(e){super(),init(this,e,instance$c,create_fragment$c,safe_not_equal,{shortcut:0,meta:1})}}function get_each_context$2(e,t,i){const n=e.slice();return n[8]=t[i],n}function create_if_block$4(e){let t,i,n,o,r,s,a,l,c,d,u,h,p,m,f,g,v=Object.values(e[1]).some(func);r=new Icon({props:{name:"cross",height:"24",width:"24"}});let _=e[0]&&create_if_block_2$2(e),y=Object.keys(e[1]),w=[];for(let t=0;t<y.length;t+=1)w[t]=create_each_block$2(get_each_context$2(e,y,t));const b=e=>transition_out(w[e],1,1,(()=>{w[e]=null}));let x=v&&create_if_block_1$3(e);return{c(){t=element("div"),i=element("header"),n=text("Keyboard Controls\n      "),o=element("button"),create_component(r.$$.fragment),s=space(),a=element("p"),l=text("Click the edit button to reassign a control button."),c=space(),_&&_.c(),d=space(),u=element("dl");for(let e=0;e<w.length;e+=1)w[e].c();h=space(),x&&x.c(),this.h()},l(e){t=claim_element(e,"DIV",{class:!0});var p=children(t);i=claim_element(p,"HEADER",{class:!0});var m=children(i);n=claim_text(m,"Keyboard Controls\n      "),o=claim_element(m,"BUTTON",{class:!0});var f=children(o);claim_component(r.$$.fragment,f),f.forEach(detach),m.forEach(detach),s=claim_space(p),a=claim_element(p,"P",{class:!0});var g=children(a);l=claim_text(g,"Click the edit button to reassign a control button."),g.forEach(detach),c=claim_space(p),_&&_.l(p),d=claim_space(p),u=claim_element(p,"DL",{class:!0});var v=children(u);for(let e=0;e<w.length;e+=1)w[e].l(v);v.forEach(detach),h=claim_space(p),x&&x.l(p),p.forEach(detach),this.h()},h(){attr(o,"class","svelte-1eamz7m"),attr(i,"class","svelte-1eamz7m"),attr(a,"class","svelte-1eamz7m"),attr(u,"class","svelte-1eamz7m"),attr(t,"class","svelte-1eamz7m")},m(e,p){insert_hydration(e,t,p),append_hydration(t,i),append_hydration(i,n),append_hydration(i,o),mount_component(r,o,null),append_hydration(t,s),append_hydration(t,a),append_hydration(a,l),append_hydration(t,c),_&&_.m(t,null),append_hydration(t,d),append_hydration(t,u);for(let e=0;e<w.length;e+=1)w[e].m(u,null);append_hydration(t,h),x&&x.m(t,null),m=!0,f||(g=listen(o,"click",toggleKeybindingsConfig),f=!0)},p(e,i){if(e[0]?_?(_.p(e,i),1&i&&transition_in(_,1)):(_=create_if_block_2$2(e),_.c(),transition_in(_,1),_.m(t,d)):_&&(group_outros(),transition_out(_,1,1,(()=>{_=null})),check_outros()),10&i){let t;for(y=Object.keys(e[1]),t=0;t<y.length;t+=1){const n=get_each_context$2(e,y,t);w[t]?(w[t].p(n,i),transition_in(w[t],1)):(w[t]=create_each_block$2(n),w[t].c(),transition_in(w[t],1),w[t].m(u,null))}for(group_outros(),t=y.length;t<w.length;t+=1)b(t);check_outros()}2&i&&(v=Object.values(e[1]).some(func)),v?x?(x.p(e,i),2&i&&transition_in(x,1)):(x=create_if_block_1$3(e),x.c(),transition_in(x,1),x.m(t,null)):x&&(group_outros(),transition_out(x,1,1,(()=>{x=null})),check_outros())},i(e){if(!m){transition_in(r.$$.fragment,e),transition_in(_);for(let e=0;e<y.length;e+=1)transition_in(w[e]);transition_in(x),add_render_callback((()=>{p||(p=create_bidirectional_transition(t,fade,{},!0)),p.run(1)})),m=!0}},o(e){transition_out(r.$$.fragment,e),transition_out(_),w=w.filter(Boolean);for(let e=0;e<w.length;e+=1)transition_out(w[e]);transition_out(x),p||(p=create_bidirectional_transition(t,fade,{},!1)),p.run(0),m=!1},d(e){e&&detach(t),destroy_component(r),_&&_.d(),destroy_each(w,e),x&&x.d(),e&&p&&p.end(),f=!1,g()}}}function create_if_block_2$2(e){let t,i,n,o;return{c(){t=element("p"),i=text(e[0]),this.h()},l(n){t=claim_element(n,"P",{class:!0});var o=children(t);i=claim_text(o,e[0]),o.forEach(detach),this.h()},h(){attr(t,"class","error-message svelte-1eamz7m")},m(e,n){insert_hydration(e,t,n),append_hydration(t,i),o=!0},p(e,t){(!o||1&t)&&set_data(i,e[0])},i(e){o||(add_render_callback((()=>{n||(n=create_bidirectional_transition(t,slide,{},!0)),n.run(1)})),o=!0)},o(e){n||(n=create_bidirectional_transition(t,slide,{},!1)),n.run(0),o=!1},d(e){e&&detach(t),e&&n&&n.end()}}}function create_each_block$2(e){let t,i;return t=new KeyboardShortcutEditorRow({props:{shortcut:e[1][e[8]],meta:keyMapMeta[e[8]]}}),t.$on("update",(function(...t){return e[6](e[8],...t)})),t.$on("reset",(function(){return e[7](e[8])})),{c(){create_component(t.$$.fragment)},l(e){claim_component(t.$$.fragment,e)},m(e,n){mount_component(t,e,n),i=!0},p(i,n){e=i;const o={};2&n&&(o.shortcut=e[1][e[8]]),2&n&&(o.meta=keyMapMeta[e[8]]),t.$set(o)},i(e){i||(transition_in(t.$$.fragment,e),i=!0)},o(e){transition_out(t.$$.fragment,e),i=!1},d(e){destroy_component(t,e)}}}function create_if_block_1$3(e){let t,i,n,o,r,s,a,l;return o=new Icon({props:{name:"reset",height:"24",width:"24"}}),{c(){t=element("p"),i=text("Reset to defaults: "),n=element("button"),create_component(o.$$.fragment),this.h()},l(e){t=claim_element(e,"P",{class:!0});var r=children(t);i=claim_text(r,"Reset to defaults: "),n=claim_element(r,"BUTTON",{class:!0});var s=children(n);claim_component(o.$$.fragment,s),s.forEach(detach),r.forEach(detach),this.h()},h(){attr(n,"class","svelte-1eamz7m"),attr(t,"class","reset svelte-1eamz7m")},m(r,c){insert_hydration(r,t,c),append_hydration(t,i),append_hydration(t,n),mount_component(o,n,null),s=!0,a||(l=listen(n,"click",e[4]),a=!0)},p:noop,i(e){s||(transition_in(o.$$.fragment,e),add_render_callback((()=>{r||(r=create_bidirectional_transition(t,slide,{},!0)),r.run(1)})),s=!0)},o(e){transition_out(o.$$.fragment,e),r||(r=create_bidirectional_transition(t,slide,{},!1)),r.run(0),s=!1},d(e){e&&detach(t),destroy_component(o),e&&r&&r.end(),a=!1,l()}}}function create_fragment$b(e){let t,i,n,o,r=e[2]&&create_if_block$4(e);return{c(){r&&r.c(),t=empty()},l(e){r&&r.l(e),t=empty()},m(s,a){r&&r.m(s,a),insert_hydration(s,t,a),i=!0,n||(o=listen(window,"keydown",e[5]),n=!0)},p(e,[i]){e[2]?r?(r.p(e,i),4&i&&transition_in(r,1)):(r=create_if_block$4(e),r.c(),transition_in(r,1),r.m(t.parentNode,t)):r&&(group_outros(),transition_out(r,1,1,(()=>{r=null})),check_outros())},i(e){i||(transition_in(r),i=!0)},o(e){transition_out(r),i=!1},d(e){r&&r.d(e),e&&detach(t),n=!1,o()}}}const showKeybindingsConfig=writable$1(!1),toggleKeybindingsConfig=()=>showKeybindingsConfig.update((e=>!e)),func=e=>e.isChanged;function instance$b(e,t,i){let n,o,r;component_subscribe(e,keyMap,(e=>i(1,n=e))),component_subscribe(e,showKeybindingsConfig,(e=>i(2,o=e)));const s=(e,t)=>{i(0,r=void 0),Object.values(n).map((({code:e})=>e)).includes(t.code)&&t.code!==n[e].code?i(0,r=`The "${t.key}" key is already assigned.`):unusableKeys.includes(t.code)?i(0,r=`The "${t.key}" key cannot be assigned.`):(set_store_value(keyMap,n[e].code=t.code,n),set_store_value(keyMap,n[e].key=alternativeIndicatorText[t.code]||t.key,n),set_store_value(keyMap,n[e].isChanged=t.key!==defaultKeyMap[e].key,n))};return[r,n,o,s,()=>{i(0,r=void 0),set_store_value(keyMap,n=JSON.parse(JSON.stringify(defaultKeyMap)),n)},({code:e})=>{"Escape"===e&&o&&toggleKeybindingsConfig()},(e,{detail:t})=>s(e,t),e=>s(e,defaultKeyMap[e])]}class KeyboardShortcutEditor extends SvelteComponent{constructor(e){super(),init(this,e,instance$b,create_fragment$b,safe_not_equal,{})}}if("undefined"!=typeof document){const e="div.svelte-1hzo31a{display:flex;flex-direction:column;flex:1 1 auto;overflow:hidden;position:relative}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}if("undefined"!=typeof document){const e=":root{--navigator-width:40px}div.svelte-1bkw8gr.svelte-1bkw8gr{text-align:right}input.svelte-1bkw8gr.svelte-1bkw8gr{display:none}label.svelte-1bkw8gr.svelte-1bkw8gr{display:inline-block;padding:0.2em 0.2em 0;border:2px solid rgba(0, 0, 0, 0.4);border-radius:0.25em;transition:all 0.2s;opacity:0.4;cursor:pointer}label.svelte-1bkw8gr.svelte-1bkw8gr:hover{background-color:unset;color:unset}input.svelte-1bkw8gr:checked+label.svelte-1bkw8gr{color:white;background-color:var(--primary-accent);cursor:unset;opacity:1}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function get_each_context$1(e,t,i){const n=e.slice();return n[4]=t[i],n}function create_if_block_2$1(e){let t,i;return t=new Icon({props:{name:"piano",height:"24",width:"24"}}),{c(){create_component(t.$$.fragment)},l(e){claim_component(t.$$.fragment,e)},m(e,n){mount_component(t,e,n),i=!0},i(e){i||(transition_in(t.$$.fragment,e),i=!0)},o(e){transition_out(t.$$.fragment,e),i=!1},d(e){destroy_component(t,e)}}}function create_if_block_1$2(e){let t,i;return t=new Icon({props:{name:"cog",height:"24",width:"24"}}),{c(){create_component(t.$$.fragment)},l(e){claim_component(t.$$.fragment,e)},m(e,n){mount_component(t,e,n),i=!0},i(e){i||(transition_in(t.$$.fragment,e),i=!0)},o(e){transition_out(t.$$.fragment,e),i=!1},d(e){destroy_component(t,e)}}}function create_if_block$3(e){let t,i;return t=new Icon({props:{name:"sliders",height:"24",width:"24"}}),{c(){create_component(t.$$.fragment)},l(e){claim_component(t.$$.fragment,e)},m(e,n){mount_component(t,e,n),i=!0},i(e){i||(transition_in(t.$$.fragment,e),i=!0)},o(e){transition_out(t.$$.fragment,e),i=!1},d(e){destroy_component(t,e)}}}function create_each_block$1(e){let t,i,n,o,r,s,a,l,c,d,u,h;const p=[create_if_block$3,create_if_block_1$2,create_if_block_2$1],m=[];return~(s=function(e,t){return"controls"===e[4]?0:"settings"===e[4]?1:"audio"===e[4]?2:-1}(e))&&(a=m[s]=p[s](e)),{c(){t=element("input"),o=space(),r=element("label"),a&&a.c(),l=space(),this.h()},l(e){t=claim_element(e,"INPUT",{type:!0,name:!0,id:!0,class:!0}),o=claim_space(e),r=claim_element(e,"LABEL",{for:!0,class:!0});var i=children(r);a&&a.l(i),l=claim_space(i),i.forEach(detach),this.h()},h(){attr(t,"type","radio"),attr(t,"name","panel-switcher"),t.__value=i=e[4],t.value=t.__value,attr(t,"id",n=e[4]),attr(t,"class","svelte-1bkw8gr"),e[3][0].push(t),attr(r,"for",c=e[4]),attr(r,"class","svelte-1bkw8gr")},m(i,n){insert_hydration(i,t,n),t.checked=t.__value===e[0],insert_hydration(i,o,n),insert_hydration(i,r,n),~s&&m[s].m(r,null),append_hydration(r,l),d=!0,u||(h=listen(t,"change",e[2]),u=!0)},p(e,i){1&i&&(t.checked=t.__value===e[0])},i(e){d||(transition_in(a),d=!0)},o(e){transition_out(a),d=!1},d(i){i&&detach(t),e[3][0].splice(e[3][0].indexOf(t),1),i&&detach(o),i&&detach(r),~s&&m[s].d(),u=!1,h()}}}function create_fragment$a(e){let t,i,n=e[1],o=[];for(let t=0;t<n.length;t+=1)o[t]=create_each_block$1(get_each_context$1(e,n,t));const r=e=>transition_out(o[e],1,1,(()=>{o[e]=null}));return{c(){t=element("div");for(let e=0;e<o.length;e+=1)o[e].c();this.h()},l(e){t=claim_element(e,"DIV",{class:!0});var i=children(t);for(let e=0;e<o.length;e+=1)o[e].l(i);i.forEach(detach),this.h()},h(){attr(t,"class","svelte-1bkw8gr")},m(e,n){insert_hydration(e,t,n);for(let e=0;e<o.length;e+=1)o[e].m(t,null);i=!0},p(e,[i]){if(3&i){let s;for(n=e[1],s=0;s<n.length;s+=1){const r=get_each_context$1(e,n,s);o[s]?(o[s].p(r,i),transition_in(o[s],1)):(o[s]=create_each_block$1(r),o[s].c(),transition_in(o[s],1),o[s].m(t,null))}for(group_outros(),s=n.length;s<o.length;s+=1)r(s);check_outros()}},i(e){if(!i){for(let e=0;e<n.length;e+=1)transition_in(o[e]);i=!0}},o(e){o=o.filter(Boolean);for(let e=0;e<o.length;e+=1)transition_out(o[e]);i=!1},d(e){e&&detach(t),destroy_each(o,e)}}}function instance$a(e,t,i){let{selectedPanel:n}=t;return e.$$set=e=>{"selectedPanel"in e&&i(0,n=e.selectedPanel)},[n,["controls","settings","audio"],function(){n=this.__value,i(0,n)},[[]]]}class PanelSwitcher extends SvelteComponent{constructor(e){super(),init(this,e,instance$a,create_fragment$a,safe_not_equal,{selectedPanel:0})}}if("undefined"!=typeof document){const e=":root{--navigator-width:40px}#playback-controls.svelte-1h10p6a.svelte-1h10p6a{margin:0 0.5em}button.svelte-1h10p6a.svelte-1h10p6a{background-color:var(--primary-accent);border-radius:0.25em;border:0.1em solid #ffffff;color:#ffffff;cursor:pointer;display:inline-block;margin:0;padding:0.35em 0.8em;transition:all 0.2s}button.svelte-1h10p6a.svelte-1h10p6a:hover{color:var(--primary-accent);border-color:var(--primary-accent);background-color:#ffffff}button.pedal-on.svelte-1h10p6a.svelte-1h10p6a{background-color:yellow;border-color:var(--primary-accent);color:var(--primary-accent)}button.svelte-1h10p6a kbd.svelte-1h10p6a{margin:0 -0.4em 0 0.4em}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function create_fragment$9(e){let t,i,n,o,r,s,a,l,c,d,u,h,p,m,f,g,v,_,y,w,b,x,T,S,k,C,A,E,N,O=e[2].PLAY_PAUSE.key+"",P=e[2].REWIND.key+"",M=e[2].SOFT.key+"",R=e[2].SUSTAIN.key+"",I=e[2].ACCENT.key+"";return{c(){t=element("div"),i=element("button"),n=text("Play/Pause\n    "),o=element("kbd"),r=text(O),s=space(),a=element("button"),l=text("Rewind\n    "),c=element("kbd"),d=text(P),u=space(),h=element("button"),p=text("Soft\n    "),m=element("kbd"),f=text(M),g=space(),v=element("button"),_=text("Sustain\n    "),y=element("kbd"),w=text(R),b=space(),x=element("br"),T=space(),S=element("button"),k=text("Accent\n    "),C=element("kbd"),A=text(I),this.h()},l(e){t=claim_element(e,"DIV",{id:!0,class:!0});var E=children(t);i=claim_element(E,"BUTTON",{type:!0,class:!0});var N=children(i);n=claim_text(N,"Play/Pause\n    "),o=claim_element(N,"KBD",{class:!0});var F=children(o);r=claim_text(F,O),F.forEach(detach),N.forEach(detach),s=claim_space(E),a=claim_element(E,"BUTTON",{type:!0,class:!0});var D=children(a);l=claim_text(D,"Rewind\n    "),c=claim_element(D,"KBD",{class:!0});var j=children(c);d=claim_text(j,P),j.forEach(detach),D.forEach(detach),u=claim_space(E),h=claim_element(E,"BUTTON",{type:!0,"aria-pressed":!0,class:!0});var z=children(h);p=claim_text(z,"Soft\n    "),m=claim_element(z,"KBD",{class:!0});var L=children(m);f=claim_text(L,M),L.forEach(detach),z.forEach(detach),g=claim_space(E),v=claim_element(E,"BUTTON",{type:!0,"aria-pressed":!0,class:!0});var B=children(v);_=claim_text(B,"Sustain\n    "),y=claim_element(B,"KBD",{class:!0});var $=children(y);w=claim_text($,R),$.forEach(detach),B.forEach(detach),b=claim_space(E),x=claim_element(E,"BR",{}),T=claim_space(E),S=claim_element(E,"BUTTON",{type:!0,style:!0,"aria-pressed":!0,class:!0});var W=children(S);k=claim_text(W,"Accent\n    "),C=claim_element(W,"KBD",{class:!0});var V=children(C);A=claim_text(V,I),V.forEach(detach),W.forEach(detach),E.forEach(detach),this.h()},h(){attr(o,"class","svelte-1h10p6a"),toggle_class(o,"depressed",e[2].PLAY_PAUSE.active),attr(i,"type","button"),attr(i,"class","svelte-1h10p6a"),attr(c,"class","svelte-1h10p6a"),toggle_class(c,"depressed",e[2].REWIND.active),attr(a,"type","button"),attr(a,"class","svelte-1h10p6a"),attr(m,"class","svelte-1h10p6a"),toggle_class(m,"depressed",e[3]),attr(h,"type","button"),attr(h,"aria-pressed",e[3]),attr(h,"class","svelte-1h10p6a"),toggle_class(h,"pedal-on",e[3]),attr(y,"class","svelte-1h10p6a"),toggle_class(y,"depressed",e[4]),attr(v,"type","button"),attr(v,"aria-pressed",e[4]),attr(v,"class","svelte-1h10p6a"),toggle_class(v,"pedal-on",e[4]),attr(C,"class","svelte-1h10p6a"),toggle_class(C,"depressed",e[5]),attr(S,"type","button"),set_style(S,"width","100%"),attr(S,"aria-pressed",e[5]),attr(S,"class","svelte-1h10p6a"),toggle_class(S,"pedal-on",e[5]),attr(t,"id","playback-controls"),attr(t,"class","svelte-1h10p6a")},m(O,P){insert_hydration(O,t,P),append_hydration(t,i),append_hydration(i,n),append_hydration(i,o),append_hydration(o,r),append_hydration(t,s),append_hydration(t,a),append_hydration(a,l),append_hydration(a,c),append_hydration(c,d),append_hydration(t,u),append_hydration(t,h),append_hydration(h,p),append_hydration(h,m),append_hydration(m,f),append_hydration(t,g),append_hydration(t,v),append_hydration(v,_),append_hydration(v,y),append_hydration(y,w),append_hydration(t,b),append_hydration(t,x),append_hydration(t,T),append_hydration(t,S),append_hydration(S,k),append_hydration(S,C),append_hydration(C,A),E||(N=[listen(window,"mouseup",e[6]),listen(i,"click",(function(){is_function(e[0])&&e[0].apply(this,arguments)})),listen(a,"click",(function(){is_function(e[1])&&e[1].apply(this,arguments)})),listen(h,"click",e[7]),listen(v,"click",e[8]),listen(S,"mousedown",e[9])],E=!0)},p(t,[i]){e=t,4&i&&O!==(O=e[2].PLAY_PAUSE.key+"")&&set_data(r,O),4&i&&toggle_class(o,"depressed",e[2].PLAY_PAUSE.active),4&i&&P!==(P=e[2].REWIND.key+"")&&set_data(d,P),4&i&&toggle_class(c,"depressed",e[2].REWIND.active),4&i&&M!==(M=e[2].SOFT.key+"")&&set_data(f,M),8&i&&toggle_class(m,"depressed",e[3]),8&i&&attr(h,"aria-pressed",e[3]),8&i&&toggle_class(h,"pedal-on",e[3]),4&i&&R!==(R=e[2].SUSTAIN.key+"")&&set_data(w,R),16&i&&toggle_class(y,"depressed",e[4]),16&i&&attr(v,"aria-pressed",e[4]),16&i&&toggle_class(v,"pedal-on",e[4]),4&i&&I!==(I=e[2].ACCENT.key+"")&&set_data(A,I),32&i&&toggle_class(C,"depressed",e[5]),32&i&&attr(S,"aria-pressed",e[5]),32&i&&toggle_class(S,"pedal-on",e[5])},i:noop,o:noop,d(e){e&&detach(t),E=!1,run_all(N)}}}function instance$9(e,t,i){let n,o,r,s;component_subscribe(e,keyMap,(e=>i(2,n=e))),component_subscribe(e,softOnOff,(e=>i(3,o=e))),component_subscribe(e,sustainOnOff,(e=>i(4,r=e))),component_subscribe(e,accentOnOff,(e=>i(5,s=e)));let{playPauseApp:a}=t,{stopApp:l}=t;return e.$$set=e=>{"playPauseApp"in e&&i(0,a=e.playPauseApp),"stopApp"in e&&i(1,l=e.stopApp)},[a,l,n,o,r,s,()=>set_store_value(accentOnOff,s=!1,s),()=>set_store_value(softOnOff,o=!o,o),()=>set_store_value(sustainOnOff,r=!r,r),()=>set_store_value(accentOnOff,s=!0,s)]}class PlaybackControls extends SvelteComponent{constructor(e){super(),init(this,e,instance$9,create_fragment$9,safe_not_equal,{playPauseApp:0,stopApp:1})}}if("undefined"!=typeof document){const e=':root{--navigator-width:40px}#playback-settings.svelte-hr2zcp{overflow-y:auto}.control.svelte-hr2zcp{align-items:center;display:grid;gap:0.5em;padding:0 0.5em 0.5em;grid:"title value" auto "slider slider" auto/1fr auto}.control.svelte-hr2zcp input[type="range"]{grid-area:slider;width:100%}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}if("undefined"!=typeof document){const e=":root{--navigator-width:40px}[type=range].svelte-s76za2{-webkit-appearance:none;background:transparent;margin:14px 0;width:18em}[type=range].svelte-s76za2::-moz-focus-outer{border:0}[type=range].svelte-s76za2:focus{outline:0}[type=range].svelte-s76za2:focus::-webkit-slider-runnable-track{background:#f7f7f7}[type=range].svelte-s76za2:focus::-ms-fill-lower{background:#eaeaea}[type=range].svelte-s76za2:focus::-ms-fill-upper{background:#f7f7f7}[type=range].svelte-s76za2::-webkit-slider-runnable-track{cursor:default;height:8px;-webkit-transition:all 0.2s ease;transition:all 0.2s ease;width:100%;box-shadow:1px 1px 1px rgba(0, 0, 0, 0.2), 0 0 1px rgba(13, 13, 13, 0.2);background:#eaeaea;border:0px solid #cfd8dc;border-radius:5px}[type=range].svelte-s76za2::-webkit-slider-thumb{box-shadow:2px 2px 4px rgba(0, 0, 0, 0.2), 0 0 2px rgba(13, 13, 13, 0.2);background:var(--primary-accent);border:2px solid #eaeaea;border-radius:12px;box-sizing:border-box;cursor:default;height:28px;width:12px;-webkit-appearance:none;margin-top:-10px}[type=range].svelte-s76za2::-moz-range-track{box-shadow:1px 1px 1px rgba(0, 0, 0, 0.2), 0 0 1px rgba(13, 13, 13, 0.2);cursor:default;height:8px;-moz-transition:all 0.2s ease;transition:all 0.2s ease;width:100%;background:#eaeaea;border:0px solid #cfd8dc;border-radius:5px;height:4px}[type=range].svelte-s76za2::-moz-range-thumb{box-shadow:2px 2px 4px rgba(0, 0, 0, 0.2), 0 0 2px rgba(13, 13, 13, 0.2);background:var(--primary-accent);border:2px solid #eaeaea;border-radius:12px;box-sizing:border-box;cursor:default;height:28px;width:12px}[type=range].svelte-s76za2::-ms-track{cursor:default;height:8px;-ms-transition:all 0.2s ease;transition:all 0.2s ease;width:100%;background:transparent;border-color:transparent;border-width:14px 0;color:transparent}[type=range].svelte-s76za2::-ms-fill-lower{box-shadow:1px 1px 1px rgba(0, 0, 0, 0.2), 0 0 1px rgba(13, 13, 13, 0.2);background:#dddddd;border:0px solid #cfd8dc;border-radius:10px}[type=range].svelte-s76za2::-ms-fill-upper{box-shadow:1px 1px 1px rgba(0, 0, 0, 0.2), 0 0 1px rgba(13, 13, 13, 0.2);background:#eaeaea;border:0px solid #cfd8dc;border-radius:10px}[type=range].svelte-s76za2::-ms-thumb{box-shadow:2px 2px 4px rgba(0, 0, 0, 0.2), 0 0 2px rgba(13, 13, 13, 0.2);background:var(--primary-accent);border:2px solid #eaeaea;border-radius:12px;box-sizing:border-box;cursor:default;height:28px;width:12px;margin-top:2px}[type=range].svelte-s76za2:disabled::-webkit-slider-thumb,[type=range].svelte-s76za2:disabled::-moz-range-thumb,[type=range].svelte-s76za2:disabled::-ms-thumb,[type=range].svelte-s76za2:disabled::-webkit-slider-runnable-track,[type=range].svelte-s76za2:disabled::-ms-fill-lower,[type=range].svelte-s76za2:disabled::-ms-fill-upper{cursor:not-allowed}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function create_fragment$8(e){let t,i,n;return{c(){t=element("input"),this.h()},l(e){t=claim_element(e,"INPUT",{type:!0,min:!0,max:!0,step:!0,name:!0,class:!0}),this.h()},h(){attr(t,"type","range"),attr(t,"min",e[1]),attr(t,"max",e[2]),attr(t,"step",e[3]),attr(t,"name",e[4]),attr(t,"class","svelte-s76za2")},m(o,r){insert_hydration(o,t,r),set_input_value(t,e[0]),i||(n=[listen(t,"change",e[9]),listen(t,"input",e[9]),listen(t,"input",e[7]),listen(t,"change",e[8]),listen(t,"mousewheel",(function(){is_function(e[5]?e[6]:mousewheel_handler)&&(e[5]?e[6]:mousewheel_handler).apply(this,arguments)}))],i=!0)},p(i,[n]){e=i,2&n&&attr(t,"min",e[1]),4&n&&attr(t,"max",e[2]),8&n&&attr(t,"step",e[3]),16&n&&attr(t,"name",e[4]),1&n&&set_input_value(t,e[0])},i:noop,o:noop,d(e){e&&detach(t),i=!1,run_all(n)}}}const mousewheel_handler=()=>{};function instance$8(e,t,i){let{min:n}=t,{max:o}=t,{step:r}=t,{name:s}=t,{value:a}=t,{mousewheel:l=!0}=t;const c=e=>Math.min(Math.max(e,n),o);return e.$$set=e=>{"min"in e&&i(1,n=e.min),"max"in e&&i(2,o=e.max),"step"in e&&i(3,r=e.step),"name"in e&&i(4,s=e.name),"value"in e&&i(0,a=e.value),"mousewheel"in e&&i(5,l=e.mousewheel)},[a,n,o,r,s,l,e=>{const t=(r.split(".")[1]||"").length;e.deltaY>0?i(0,a=c((Number(a)+Number(r)).toFixed(t))):i(0,a=c((Number(a)-Number(r)).toFixed(t)))},function(t){bubble.call(this,e,t)},function(t){bubble.call(this,e,t)},function(){a=to_number(this.value),i(0,a)}]}class RangeSlider extends SvelteComponent{constructor(e){super(),init(this,e,instance$8,create_fragment$8,safe_not_equal,{min:1,max:2,step:3,name:4,value:0,mousewheel:5})}}function create_fragment$7(e){let t,i,n,o,r,s,a,l,c,d,u,h,p,m,f,g,v,_,y,w,b,x,T,S,k,C,A,E,N,O,P,M,R,I,F,D,j,z,L,B,$,W,V,q,H,U,G,Z,X,K,Y,Q,J,ee,te,ie,ne,oe,re,se,ae,le,ce,de,ue,he,pe,me,fe,ge,ve,_e,ye,we,be,xe,Te=e[1].VOLUME_DOWN.key+"",Se=e[1].VOLUME_UP.key+"",ke=e[1].BASS_VOLUME_DOWN.key+"",Ce=e[1].BASS_VOLUME_UP.key+"",Ae=e[1].TREBLE_VOLUME_DOWN.key+"",Ee=e[1].TREBLE_VOLUME_UP.key+"",Ne=e[1].TEMPO_DOWN.key+"",Oe=e[1].TEMPO_UP.key+"",Pe=(100*e[5]).toFixed(0)+"",Me=(100*e[6]).toFixed(2)+"";function Re(t){e[7](t)}let Ie={min:controlsConfig.volume.min,max:controlsConfig.volume.max,step:controlsConfig.volume.delta,name:"volume"};function Fe(t){e[8](t)}void 0!==e[2]&&(Ie.value=e[2]),f=new RangeSlider({props:Ie}),binding_callbacks.push((()=>bind(f,"value",Re)));let De={min:controlsConfig.bassVolume.min,max:controlsConfig.bassVolume.max,step:controlsConfig.bassVolume.delta,name:"bass-volume"};function je(t){e[9](t)}void 0!==e[3]&&(De.value=e[3]),P=new RangeSlider({props:De}),binding_callbacks.push((()=>bind(P,"value",Fe)));let ze={min:controlsConfig.trebleVolume.min,max:controlsConfig.trebleVolume.max,step:controlsConfig.trebleVolume.delta,name:"treble-volume"};function Le(t){e[10](t)}void 0!==e[4]&&(ze.value=e[4]),G=new RangeSlider({props:ze}),binding_callbacks.push((()=>bind(G,"value",je)));let Be={min:controlsConfig.tempo.min,max:controlsConfig.tempo.max,step:controlsConfig.tempo.delta,name:"tempo"};return void 0!==e[5]&&(Be.value=e[5]),de=new RangeSlider({props:Be}),binding_callbacks.push((()=>bind(de,"value",Le))),be=new RangeSlider({props:{min:"0",max:"1",step:"0.001",value:e[6],name:"progress",mousewheel:!1}}),be.$on("input",e[11]),{c(){t=element("div"),i=element("div"),n=element("span"),o=text("Volume:\n      "),r=element("kbd"),s=text(Te),a=text("↓\n      "),l=element("kbd"),c=text(Se),d=text("↑"),u=space(),h=element("span"),p=text(e[2]),m=space(),create_component(f.$$.fragment),v=space(),_=element("div"),y=element("span"),w=text("Bass Volume:\n      "),b=element("kbd"),x=text(ke),T=text("↓\n      "),S=element("kbd"),k=text(Ce),C=text("↑"),A=space(),E=element("span"),N=text(e[3]),O=space(),create_component(P.$$.fragment),R=space(),I=element("div"),F=element("span"),D=text("Treble Volume:\n      "),j=element("kbd"),z=text(Ae),L=text("↓\n      "),B=element("kbd"),$=text(Ee),W=text("↑"),V=space(),q=element("span"),H=text(e[4]),U=space(),create_component(G.$$.fragment),X=space(),K=element("div"),Y=element("span"),Q=text("Tempo:\n      "),J=element("kbd"),ee=text(Ne),te=text("↓\n      "),ie=element("kbd"),ne=text(Oe),oe=text("↑"),re=space(),se=element("span"),ae=text(Pe),le=text("%"),ce=space(),create_component(de.$$.fragment),he=space(),pe=element("div"),me=element("span"),fe=text("Progress:"),ge=space(),ve=element("span"),_e=text(Me),ye=text("%"),we=space(),create_component(be.$$.fragment),this.h()},l(g){t=claim_element(g,"DIV",{id:!0,class:!0});var M=children(t);i=claim_element(M,"DIV",{class:!0});var Z=children(i);n=claim_element(Z,"SPAN",{});var ue=children(n);o=claim_text(ue,"Volume:\n      "),r=claim_element(ue,"KBD",{});var xe=children(r);s=claim_text(xe,Te),xe.forEach(detach),a=claim_text(ue,"↓\n      "),l=claim_element(ue,"KBD",{});var Re=children(l);c=claim_text(Re,Se),Re.forEach(detach),d=claim_text(ue,"↑"),ue.forEach(detach),u=claim_space(Z),h=claim_element(Z,"SPAN",{});var Ie=children(h);p=claim_text(Ie,e[2]),Ie.forEach(detach),m=claim_space(Z),claim_component(f.$$.fragment,Z),Z.forEach(detach),v=claim_space(M),_=claim_element(M,"DIV",{class:!0});var Fe=children(_);y=claim_element(Fe,"SPAN",{});var De=children(y);w=claim_text(De,"Bass Volume:\n      "),b=claim_element(De,"KBD",{});var je=children(b);x=claim_text(je,ke),je.forEach(detach),T=claim_text(De,"↓\n      "),S=claim_element(De,"KBD",{});var ze=children(S);k=claim_text(ze,Ce),ze.forEach(detach),C=claim_text(De,"↑"),De.forEach(detach),A=claim_space(Fe),E=claim_element(Fe,"SPAN",{});var Le=children(E);N=claim_text(Le,e[3]),Le.forEach(detach),O=claim_space(Fe),claim_component(P.$$.fragment,Fe),Fe.forEach(detach),R=claim_space(M),I=claim_element(M,"DIV",{class:!0});var Be=children(I);F=claim_element(Be,"SPAN",{});var $e=children(F);D=claim_text($e,"Treble Volume:\n      "),j=claim_element($e,"KBD",{});var We=children(j);z=claim_text(We,Ae),We.forEach(detach),L=claim_text($e,"↓\n      "),B=claim_element($e,"KBD",{});var Ve=children(B);$=claim_text(Ve,Ee),Ve.forEach(detach),W=claim_text($e,"↑"),$e.forEach(detach),V=claim_space(Be),q=claim_element(Be,"SPAN",{});var qe=children(q);H=claim_text(qe,e[4]),qe.forEach(detach),U=claim_space(Be),claim_component(G.$$.fragment,Be),Be.forEach(detach),X=claim_space(M),K=claim_element(M,"DIV",{class:!0});var He=children(K);Y=claim_element(He,"SPAN",{});var Ue=children(Y);Q=claim_text(Ue,"Tempo:\n      "),J=claim_element(Ue,"KBD",{});var Ge=children(J);ee=claim_text(Ge,Ne),Ge.forEach(detach),te=claim_text(Ue,"↓\n      "),ie=claim_element(Ue,"KBD",{});var Ze=children(ie);ne=claim_text(Ze,Oe),Ze.forEach(detach),oe=claim_text(Ue,"↑"),Ue.forEach(detach),re=claim_space(He),se=claim_element(He,"SPAN",{});var Xe=children(se);ae=claim_text(Xe,Pe),le=claim_text(Xe,"%"),Xe.forEach(detach),ce=claim_space(He),claim_component(de.$$.fragment,He),He.forEach(detach),he=claim_space(M),pe=claim_element(M,"DIV",{class:!0});var Ke=children(pe);me=claim_element(Ke,"SPAN",{});var Ye=children(me);fe=claim_text(Ye,"Progress:"),Ye.forEach(detach),ge=claim_space(Ke),ve=claim_element(Ke,"SPAN",{});var Qe=children(ve);_e=claim_text(Qe,Me),ye=claim_text(Qe,"%"),Qe.forEach(detach),we=claim_space(Ke),claim_component(be.$$.fragment,Ke),Ke.forEach(detach),M.forEach(detach),this.h()},h(){toggle_class(r,"depressed",e[1].VOLUME_DOWN.active),toggle_class(l,"depressed",e[1].VOLUME_UP.active),attr(i,"class","control svelte-hr2zcp"),toggle_class(b,"depressed",e[1].BASS_VOLUME_DOWN.active),toggle_class(S,"depressed",e[1].BASS_VOLUME_UP.active),attr(_,"class","control svelte-hr2zcp"),toggle_class(j,"depressed",e[1].TREBLE_VOLUME_DOWN.active),toggle_class(B,"depressed",e[1].TREBLE_VOLUME_UP.active),attr(I,"class","control svelte-hr2zcp"),toggle_class(J,"depressed",e[1].TEMPO_DOWN.active),toggle_class(ie,"depressed",e[1].TEMPO_UP.active),attr(K,"class","control svelte-hr2zcp"),attr(pe,"class","control svelte-hr2zcp"),attr(t,"id","playback-settings"),attr(t,"class","svelte-hr2zcp")},m(e,g){insert_hydration(e,t,g),append_hydration(t,i),append_hydration(i,n),append_hydration(n,o),append_hydration(n,r),append_hydration(r,s),append_hydration(n,a),append_hydration(n,l),append_hydration(l,c),append_hydration(n,d),append_hydration(i,u),append_hydration(i,h),append_hydration(h,p),append_hydration(i,m),mount_component(f,i,null),append_hydration(t,v),append_hydration(t,_),append_hydration(_,y),append_hydration(y,w),append_hydration(y,b),append_hydration(b,x),append_hydration(y,T),append_hydration(y,S),append_hydration(S,k),append_hydration(y,C),append_hydration(_,A),append_hydration(_,E),append_hydration(E,N),append_hydration(_,O),mount_component(P,_,null),append_hydration(t,R),append_hydration(t,I),append_hydration(I,F),append_hydration(F,D),append_hydration(F,j),append_hydration(j,z),append_hydration(F,L),append_hydration(F,B),append_hydration(B,$),append_hydration(F,W),append_hydration(I,V),append_hydration(I,q),append_hydration(q,H),append_hydration(I,U),mount_component(G,I,null),append_hydration(t,X),append_hydration(t,K),append_hydration(K,Y),append_hydration(Y,Q),append_hydration(Y,J),append_hydration(J,ee),append_hydration(Y,te),append_hydration(Y,ie),append_hydration(ie,ne),append_hydration(Y,oe),append_hydration(K,re),append_hydration(K,se),append_hydration(se,ae),append_hydration(se,le),append_hydration(K,ce),mount_component(de,K,null),append_hydration(t,he),append_hydration(t,pe),append_hydration(pe,me),append_hydration(me,fe),append_hydration(pe,ge),append_hydration(pe,ve),append_hydration(ve,_e),append_hydration(ve,ye),append_hydration(pe,we),mount_component(be,pe,null),xe=!0},p(e,[t]){(!xe||2&t)&&Te!==(Te=e[1].VOLUME_DOWN.key+"")&&set_data(s,Te),2&t&&toggle_class(r,"depressed",e[1].VOLUME_DOWN.active),(!xe||2&t)&&Se!==(Se=e[1].VOLUME_UP.key+"")&&set_data(c,Se),2&t&&toggle_class(l,"depressed",e[1].VOLUME_UP.active),(!xe||4&t)&&set_data(p,e[2]);const i={};!g&&4&t&&(g=!0,i.value=e[2],add_flush_callback((()=>g=!1))),f.$set(i),(!xe||2&t)&&ke!==(ke=e[1].BASS_VOLUME_DOWN.key+"")&&set_data(x,ke),2&t&&toggle_class(b,"depressed",e[1].BASS_VOLUME_DOWN.active),(!xe||2&t)&&Ce!==(Ce=e[1].BASS_VOLUME_UP.key+"")&&set_data(k,Ce),2&t&&toggle_class(S,"depressed",e[1].BASS_VOLUME_UP.active),(!xe||8&t)&&set_data(N,e[3]);const n={};!M&&8&t&&(M=!0,n.value=e[3],add_flush_callback((()=>M=!1))),P.$set(n),(!xe||2&t)&&Ae!==(Ae=e[1].TREBLE_VOLUME_DOWN.key+"")&&set_data(z,Ae),2&t&&toggle_class(j,"depressed",e[1].TREBLE_VOLUME_DOWN.active),(!xe||2&t)&&Ee!==(Ee=e[1].TREBLE_VOLUME_UP.key+"")&&set_data($,Ee),2&t&&toggle_class(B,"depressed",e[1].TREBLE_VOLUME_UP.active),(!xe||16&t)&&set_data(H,e[4]);const o={};!Z&&16&t&&(Z=!0,o.value=e[4],add_flush_callback((()=>Z=!1))),G.$set(o),(!xe||2&t)&&Ne!==(Ne=e[1].TEMPO_DOWN.key+"")&&set_data(ee,Ne),2&t&&toggle_class(J,"depressed",e[1].TEMPO_DOWN.active),(!xe||2&t)&&Oe!==(Oe=e[1].TEMPO_UP.key+"")&&set_data(ne,Oe),2&t&&toggle_class(ie,"depressed",e[1].TEMPO_UP.active),(!xe||32&t)&&Pe!==(Pe=(100*e[5]).toFixed(0)+"")&&set_data(ae,Pe);const a={};!ue&&32&t&&(ue=!0,a.value=e[5],add_flush_callback((()=>ue=!1))),de.$set(a),(!xe||64&t)&&Me!==(Me=(100*e[6]).toFixed(2)+"")&&set_data(_e,Me);const d={};64&t&&(d.value=e[6]),be.$set(d)},i(e){xe||(transition_in(f.$$.fragment,e),transition_in(P.$$.fragment,e),transition_in(G.$$.fragment,e),transition_in(de.$$.fragment,e),transition_in(be.$$.fragment,e),xe=!0)},o(e){transition_out(f.$$.fragment,e),transition_out(P.$$.fragment,e),transition_out(G.$$.fragment,e),transition_out(de.$$.fragment,e),transition_out(be.$$.fragment,e),xe=!1},d(e){e&&detach(t),destroy_component(f),destroy_component(P),destroy_component(G),destroy_component(de),destroy_component(be)}}}function instance$7(e,t,i){let n,o,r,s,a,l;component_subscribe(e,keyMap,(e=>i(1,n=e))),component_subscribe(e,volumeCoefficient,(e=>i(2,o=e))),component_subscribe(e,bassVolumeCoefficient,(e=>i(3,r=e))),component_subscribe(e,trebleVolumeCoefficient,(e=>i(4,s=e))),component_subscribe(e,tempoCoefficient,(e=>i(5,a=e))),component_subscribe(e,playbackProgress,(e=>i(6,l=e)));let{skipToPercentage:c}=t;return e.$$set=e=>{"skipToPercentage"in e&&i(0,c=e.skipToPercentage)},[c,n,o,r,s,a,l,function(e){o=e,volumeCoefficient.set(o)},function(e){r=e,bassVolumeCoefficient.set(r)},function(e){s=e,trebleVolumeCoefficient.set(s)},function(e){a=e,tempoCoefficient.set(a)},({target:{value:e}})=>c(e)]}class BasicSettings extends SvelteComponent{constructor(e){super(),init(this,e,instance$7,create_fragment$7,safe_not_equal,{skipToPercentage:0})}}if("undefined"!=typeof document){const e=":root{--navigator-width:40px}div#settings-panel.svelte-1d714bx.svelte-1d714bx.svelte-1d714bx{background:linear-gradient(var(--background-angle), var(--background-darker) 0%, var(--background-color) 25%, var(--background-color) 75%, var(--background-darker) 100%);background-attachment:fixed;background-position:center;height:100%;left:0;position:absolute;top:0;width:100%}div#settings-panel.svelte-1d714bx div.svelte-1d714bx+div.svelte-1d714bx{margin-top:1em}fieldset.svelte-1d714bx.svelte-1d714bx.svelte-1d714bx{margin:2em 0;padding:1em 0.75em}fieldset.svelte-1d714bx div.svelte-1d714bx.svelte-1d714bx{display:flex;justify-content:space-between}legend.svelte-1d714bx.svelte-1d714bx.svelte-1d714bx{font-family:serif;font-size:1.4em}.theme-selector.svelte-1d714bx button.svelte-1d714bx.svelte-1d714bx{height:1.5em;width:1.5em;border-radius:1.5em;border:none;margin:0 0.5em}.theme-selector.svelte-1d714bx button.active.svelte-1d714bx.svelte-1d714bx{outline:1px solid var(--primary-accent);outline-offset:4px}.theme-selector.svelte-1d714bx button.cardinal.svelte-1d714bx.svelte-1d714bx{background:#8c1515}.theme-selector.svelte-1d714bx button.blue.svelte-1d714bx.svelte-1d714bx{background:steelblue}.theme-selector.svelte-1d714bx button.green.svelte-1d714bx.svelte-1d714bx{background:darkolivegreen}.theme-selector.svelte-1d714bx button.grey.svelte-1d714bx.svelte-1d714bx{background:darkslategrey}button.full-width.svelte-1d714bx.svelte-1d714bx.svelte-1d714bx{margin:1em 0;padding:3px 0;width:100%}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function get_each_context(e,t,i){const n=e.slice();return n[14]=t[i],n}function create_each_block(e){let t,i,n,o;function r(){return e[12](e[14])}return{c(){t=element("button"),this.h()},l(e){t=claim_element(e,"BUTTON",{class:!0}),children(t).forEach(detach),this.h()},h(){attr(t,"class",i=null_to_empty(e[14])+" svelte-1d714bx"),toggle_class(t,"active",e[0].theme===e[14])},m(e,i){insert_hydration(e,t,i),n||(o=listen(t,"click",r),n=!0)},p(i,n){e=i,33&n&&toggle_class(t,"active",e[0].theme===e[14])},d(e){e&&detach(t),n=!1,o()}}}function create_fragment$6(e){let t,i,n,o,r,s,a,l,c,d,u,h,p,m,f,g,v,_,y,w,b,x,T,S,k,C,A,E,N,O,P,M,R,I,F,D,j,z,L,B,$,W,V,q,H,U=e[5],G=[];for(let t=0;t<U.length;t+=1)G[t]=create_each_block(get_each_context(e,U,t));return{c(){t=element("div"),i=element("fieldset"),n=element("legend"),o=text("Visualization Settings"),r=space(),s=element("div"),a=text("Show Details for Active Notes:\n      "),l=element("input"),c=space(),d=element("div"),u=text("Display Note Velocities:\n      "),h=element("input"),p=space(),m=element("div"),f=text("Highlight Enabled Holes:\n      "),g=element("input"),v=space(),_=element("fieldset"),y=element("legend"),w=text("Roll Emulation Settings"),b=space(),x=element("div"),T=text("Play Expressions:\n      "),S=element("input"),C=space(),A=element("div"),E=text("Use Roll Pedaling:\n      "),N=element("input"),P=space(),M=element("div"),R=text("Emulate Roll Acceleration:\n      "),I=element("input"),F=space(),D=element("div"),j=text("Theme:\n    ");for(let e=0;e<G.length;e+=1)G[e].c();z=space(),L=element("button"),B=text("Configure Key Bindings"),$=space(),W=element("button"),V=text("Reset All Settings"),this.h()},l(e){t=claim_element(e,"DIV",{id:!0,class:!0});var k=children(t);i=claim_element(k,"FIELDSET",{class:!0});var O=children(i);n=claim_element(O,"LEGEND",{class:!0});var q=children(n);o=claim_text(q,"Visualization Settings"),q.forEach(detach),r=claim_space(O),s=claim_element(O,"DIV",{class:!0});var H=children(s);a=claim_text(H,"Show Details for Active Notes:\n      "),l=claim_element(H,"INPUT",{type:!0}),H.forEach(detach),c=claim_space(O),d=claim_element(O,"DIV",{class:!0});var U=children(d);u=claim_text(U,"Display Note Velocities:\n      "),h=claim_element(U,"INPUT",{type:!0}),U.forEach(detach),p=claim_space(O),m=claim_element(O,"DIV",{class:!0});var Z=children(m);f=claim_text(Z,"Highlight Enabled Holes:\n      "),g=claim_element(Z,"INPUT",{type:!0}),Z.forEach(detach),O.forEach(detach),v=claim_space(k),_=claim_element(k,"FIELDSET",{class:!0});var X=children(_);y=claim_element(X,"LEGEND",{class:!0});var K=children(y);w=claim_text(K,"Roll Emulation Settings"),K.forEach(detach),b=claim_space(X),x=claim_element(X,"DIV",{class:!0});var Y=children(x);T=claim_text(Y,"Play Expressions:\n      "),S=claim_element(Y,"INPUT",{type:!0}),Y.forEach(detach),C=claim_space(X),A=claim_element(X,"DIV",{class:!0});var Q=children(A);E=claim_text(Q,"Use Roll Pedaling:\n      "),N=claim_element(Q,"INPUT",{type:!0}),Q.forEach(detach),P=claim_space(X),M=claim_element(X,"DIV",{class:!0});var J=children(M);R=claim_text(J,"Emulate Roll Acceleration:\n      "),I=claim_element(J,"INPUT",{type:!0}),J.forEach(detach),X.forEach(detach),F=claim_space(k),D=claim_element(k,"DIV",{class:!0});var ee=children(D);j=claim_text(ee,"Theme:\n    ");for(let e=0;e<G.length;e+=1)G[e].l(ee);ee.forEach(detach),z=claim_space(k),L=claim_element(k,"BUTTON",{class:!0});var te=children(L);B=claim_text(te,"Configure Key Bindings"),te.forEach(detach),$=claim_space(k),W=claim_element(k,"BUTTON",{class:!0});var ie=children(W);V=claim_text(ie,"Reset All Settings"),ie.forEach(detach),k.forEach(detach),this.h()},h(){attr(n,"class","svelte-1d714bx"),attr(l,"type","checkbox"),attr(s,"class","svelte-1d714bx"),attr(h,"type","checkbox"),attr(d,"class","svelte-1d714bx"),attr(g,"type","checkbox"),attr(m,"class","svelte-1d714bx"),attr(i,"class","svelte-1d714bx"),attr(y,"class","svelte-1d714bx"),attr(S,"type","checkbox"),S.disabled=k=!e[1],attr(x,"class","svelte-1d714bx"),attr(N,"type","checkbox"),N.disabled=O=!e[1],attr(A,"class","svelte-1d714bx"),attr(I,"type","checkbox"),attr(M,"class","svelte-1d714bx"),attr(_,"class","svelte-1d714bx"),attr(D,"class","theme-selector svelte-1d714bx"),attr(L,"class","full-width svelte-1d714bx"),attr(W,"class","full-width svelte-1d714bx"),attr(t,"id","settings-panel"),attr(t,"class","svelte-1d714bx")},m(k,O){insert_hydration(k,t,O),append_hydration(t,i),append_hydration(i,n),append_hydration(n,o),append_hydration(i,r),append_hydration(i,s),append_hydration(s,a),append_hydration(s,l),l.checked=e[0].activeNoteDetails,append_hydration(i,c),append_hydration(i,d),append_hydration(d,u),append_hydration(d,h),h.checked=e[0].showNoteVelocities,append_hydration(i,p),append_hydration(i,m),append_hydration(m,f),append_hydration(m,g),g.checked=e[0].highlightEnabledHoles,append_hydration(t,v),append_hydration(t,_),append_hydration(_,y),append_hydration(y,w),append_hydration(_,b),append_hydration(_,x),append_hydration(x,T),append_hydration(x,S),S.checked=e[2],append_hydration(_,C),append_hydration(_,A),append_hydration(A,E),append_hydration(A,N),N.checked=e[3],append_hydration(_,P),append_hydration(_,M),append_hydration(M,R),append_hydration(M,I),I.checked=e[4],append_hydration(t,F),append_hydration(t,D),append_hydration(D,j);for(let e=0;e<G.length;e+=1)G[e].m(D,null);append_hydration(t,z),append_hydration(t,L),append_hydration(L,B),append_hydration(t,$),append_hydration(t,W),append_hydration(W,V),q||(H=[listen(l,"change",e[6]),listen(h,"change",e[7]),listen(g,"change",e[8]),listen(S,"change",e[9]),listen(N,"change",e[10]),listen(I,"change",e[11]),listen(L,"click",toggleKeybindingsConfig),listen(W,"click",e[13])],q=!0)},p(e,[t]){if(1&t&&(l.checked=e[0].activeNoteDetails),1&t&&(h.checked=e[0].showNoteVelocities),1&t&&(g.checked=e[0].highlightEnabledHoles),2&t&&k!==(k=!e[1])&&(S.disabled=k),4&t&&(S.checked=e[2]),2&t&&O!==(O=!e[1])&&(N.disabled=O),8&t&&(N.checked=e[3]),16&t&&(I.checked=e[4]),33&t){let i;for(U=e[5],i=0;i<U.length;i+=1){const n=get_each_context(e,U,i);G[i]?G[i].p(n,t):(G[i]=create_each_block(n),G[i].c(),G[i].m(D,null))}for(;i<G.length;i+=1)G[i].d(1);G.length=U.length}},i:noop,o:noop,d(e){e&&detach(t),destroy_each(G,e),q=!1,run_all(H)}}}function instance$6(e,t,i){let n,o,r,s,a;component_subscribe(e,userSettings,(e=>i(0,n=e))),component_subscribe(e,rollHasExpressions,(e=>i(1,o=e))),component_subscribe(e,playExpressionsOnOff,(e=>i(2,r=e))),component_subscribe(e,rollPedalingOnOff,(e=>i(3,s=e))),component_subscribe(e,useMidiTempoEventsOnOff,(e=>i(4,a=e)));return e.$$.update=()=>{1&e.$$.dirty&&document.documentElement.setAttribute("data-theme",n.theme)},[n,o,r,s,a,["cardinal","blue","green","grey"],function(){n.activeNoteDetails=this.checked,userSettings.set(n)},function(){n.showNoteVelocities=this.checked,userSettings.set(n)},function(){n.highlightEnabledHoles=this.checked,userSettings.set(n)},function(){r=this.checked,playExpressionsOnOff.set(r)},function(){s=this.checked,rollPedalingOnOff.set(s)},function(){a=this.checked,useMidiTempoEventsOnOff.set(a)},e=>userSettings.update((t=>({...t,theme:e}))),()=>{userSettings.reset(),sampleVolumes.reset(),sampleVelocities.reset(),reverbWetDry.reset(),notify({message:"Settings have been reset!",type:"success",timeout:4e3})}]}class AdvancedSettings extends SvelteComponent{constructor(e){super(),init(this,e,instance$6,create_fragment$6,safe_not_equal,{})}}if("undefined"!=typeof document){const e=':root{--navigator-width:40px}div#audio-panel.svelte-12tb8ci.svelte-12tb8ci.svelte-12tb8ci{background:linear-gradient(var(--background-angle), var(--background-darker) 0%, var(--background-color) 25%, var(--background-color) 75%, var(--background-darker) 100%);background-attachment:fixed;background-position:center;height:100%;left:0;position:absolute;top:0;width:100%;overflow-y:auto}div#audio-panel.svelte-12tb8ci div.svelte-12tb8ci+div.svelte-12tb8ci{margin-top:1em}.control.svelte-12tb8ci.svelte-12tb8ci.svelte-12tb8ci{align-items:center;display:grid;gap:0.5em;padding:0 0.5em 0.5em;grid:"title value" auto "slider slider" auto/1fr auto}.control.svelte-12tb8ci input[type="range"]{grid-area:slider;width:100%}fieldset.svelte-12tb8ci.svelte-12tb8ci.svelte-12tb8ci{margin:2em 0;padding:1em 0.75em}fieldset.svelte-12tb8ci div.svelte-12tb8ci.svelte-12tb8ci{display:flex;justify-content:space-between}legend.svelte-12tb8ci.svelte-12tb8ci.svelte-12tb8ci{font-family:serif;font-size:1.4em}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function create_fragment$5(e){let t,i,n,o,r,s,a,l,c,d,u,h,p,m,f,g,v,_,y,w,b,x,T,S,k,C,A,E,N,O,P,M,R,I,F,D,j,z,L,B,$,W,V,q,H,U,G,Z,X,K,Y,Q,J,ee,te,ie,ne,oe,re,se,ae,le,ce,de,ue,he,pe,me,fe,ge=e[4].strings+"",ve=e[4].harmonics+"",_e=e[4].pedal+"",ye=e[4].keybed+"";function we(t){e[5](t)}let be={min:"-60",max:"10",step:"1",name:"strings-volume"};function xe(t){e[6](t)}void 0!==e[4].strings&&(be.value=e[4].strings),p=new RangeSlider({props:be}),binding_callbacks.push((()=>bind(p,"value",we)));let Te={min:"-60",max:"10",step:"1",name:"harmonics-volume"};function Se(t){e[7](t)}void 0!==e[4].harmonics&&(Te.value=e[4].harmonics),T=new RangeSlider({props:Te}),binding_callbacks.push((()=>bind(T,"value",xe)));let ke={min:"-60",max:"10",step:"1",name:"pedals-volume"};function Ce(t){e[8](t)}void 0!==e[4].pedal&&(ke.value=e[4].pedal),R=new RangeSlider({props:ke}),binding_callbacks.push((()=>bind(R,"value",Se)));let Ae={min:"-60",max:"10",step:"1",name:"keybed-volume"};function Ee(t){e[9](t)}void 0!==e[4].keybed&&(Ae.value=e[4].keybed),V=new RangeSlider({props:Ae}),binding_callbacks.push((()=>bind(V,"value",Ce)));let Ne={min:"1",max:"16",step:"1",mousewheel:!1,name:"sample-velocities"};function Oe(t){e[11](t)}void 0!==e[2]&&(Ne.value=e[2]),ne=new RangeSlider({props:Ne}),binding_callbacks.push((()=>bind(ne,"value",Ee))),ne.$on("change",e[10]);let Pe={min:"0",max:"1",step:".05",mousewheel:!1,name:"reverb-wetdry"};return void 0!==e[3]&&(Pe.value=e[3]),pe=new RangeSlider({props:Pe}),binding_callbacks.push((()=>bind(pe,"value",Oe))),pe.$on("change",e[12]),{c(){t=element("div"),i=element("fieldset"),n=element("legend"),o=text("Piano Sample Volumes"),r=space(),s=element("div"),a=element("span"),l=text("Strings"),c=space(),d=element("span"),u=text(ge),h=space(),create_component(p.$$.fragment),f=space(),g=element("div"),v=element("span"),_=text("Harmonics"),y=space(),w=element("span"),b=text(ve),x=space(),create_component(T.$$.fragment),k=space(),C=element("div"),A=element("span"),E=text("Pedals"),N=space(),O=element("span"),P=text(_e),M=space(),create_component(R.$$.fragment),F=space(),D=element("div"),j=element("span"),z=text("Keybed"),L=space(),B=element("span"),$=text(ye),W=space(),create_component(V.$$.fragment),H=space(),U=element("fieldset"),G=element("legend"),Z=text("Audio Controls"),X=space(),K=element("div"),Y=element("span"),Q=text("Sample Count"),J=space(),ee=element("span"),te=text(e[2]),ie=space(),create_component(ne.$$.fragment),re=space(),se=element("div"),ae=element("span"),le=text("Reverb"),ce=space(),de=element("span"),ue=text(e[3]),he=space(),create_component(pe.$$.fragment),this.h()},l(m){t=claim_element(m,"DIV",{id:!0,class:!0});var S=children(t);i=claim_element(S,"FIELDSET",{class:!0});var I=children(i);n=claim_element(I,"LEGEND",{class:!0});var q=children(n);o=claim_text(q,"Piano Sample Volumes"),q.forEach(detach),r=claim_space(I),s=claim_element(I,"DIV",{class:!0});var oe=children(s);a=claim_element(oe,"SPAN",{});var me=children(a);l=claim_text(me,"Strings"),me.forEach(detach),c=claim_space(oe),d=claim_element(oe,"SPAN",{});var fe=children(d);u=claim_text(fe,ge),fe.forEach(detach),h=claim_space(oe),claim_component(p.$$.fragment,oe),oe.forEach(detach),f=claim_space(I),g=claim_element(I,"DIV",{class:!0});var we=children(g);v=claim_element(we,"SPAN",{});var be=children(v);_=claim_text(be,"Harmonics"),be.forEach(detach),y=claim_space(we),w=claim_element(we,"SPAN",{});var xe=children(w);b=claim_text(xe,ve),xe.forEach(detach),x=claim_space(we),claim_component(T.$$.fragment,we),we.forEach(detach),k=claim_space(I),C=claim_element(I,"DIV",{class:!0});var Te=children(C);A=claim_element(Te,"SPAN",{});var Se=children(A);E=claim_text(Se,"Pedals"),Se.forEach(detach),N=claim_space(Te),O=claim_element(Te,"SPAN",{});var ke=children(O);P=claim_text(ke,_e),ke.forEach(detach),M=claim_space(Te),claim_component(R.$$.fragment,Te),Te.forEach(detach),F=claim_space(I),D=claim_element(I,"DIV",{class:!0});var Ce=children(D);j=claim_element(Ce,"SPAN",{});var Ae=children(j);z=claim_text(Ae,"Keybed"),Ae.forEach(detach),L=claim_space(Ce),B=claim_element(Ce,"SPAN",{});var Ee=children(B);$=claim_text(Ee,ye),Ee.forEach(detach),W=claim_space(Ce),claim_component(V.$$.fragment,Ce),Ce.forEach(detach),I.forEach(detach),H=claim_space(S),U=claim_element(S,"FIELDSET",{class:!0});var Ne=children(U);G=claim_element(Ne,"LEGEND",{class:!0});var Oe=children(G);Z=claim_text(Oe,"Audio Controls"),Oe.forEach(detach),X=claim_space(Ne),K=claim_element(Ne,"DIV",{class:!0});var Pe=children(K);Y=claim_element(Pe,"SPAN",{});var Me=children(Y);Q=claim_text(Me,"Sample Count"),Me.forEach(detach),J=claim_space(Pe),ee=claim_element(Pe,"SPAN",{});var Re=children(ee);te=claim_text(Re,e[2]),Re.forEach(detach),ie=claim_space(Pe),claim_component(ne.$$.fragment,Pe),Pe.forEach(detach),re=claim_space(Ne),se=claim_element(Ne,"DIV",{class:!0});var Ie=children(se);ae=claim_element(Ie,"SPAN",{});var Fe=children(ae);le=claim_text(Fe,"Reverb"),Fe.forEach(detach),ce=claim_space(Ie),de=claim_element(Ie,"SPAN",{});var De=children(de);ue=claim_text(De,e[3]),De.forEach(detach),he=claim_space(Ie),claim_component(pe.$$.fragment,Ie),Ie.forEach(detach),Ne.forEach(detach),S.forEach(detach),this.h()},h(){attr(n,"class","svelte-12tb8ci"),attr(s,"class","control svelte-12tb8ci"),attr(g,"class","control svelte-12tb8ci"),attr(C,"class","control svelte-12tb8ci"),attr(D,"class","control svelte-12tb8ci"),attr(i,"class","svelte-12tb8ci"),attr(G,"class","svelte-12tb8ci"),attr(K,"class","control svelte-12tb8ci"),attr(se,"class","control svelte-12tb8ci"),attr(U,"class","svelte-12tb8ci"),attr(t,"id","audio-panel"),attr(t,"class","svelte-12tb8ci")},m(e,m){insert_hydration(e,t,m),append_hydration(t,i),append_hydration(i,n),append_hydration(n,o),append_hydration(i,r),append_hydration(i,s),append_hydration(s,a),append_hydration(a,l),append_hydration(s,c),append_hydration(s,d),append_hydration(d,u),append_hydration(s,h),mount_component(p,s,null),append_hydration(i,f),append_hydration(i,g),append_hydration(g,v),append_hydration(v,_),append_hydration(g,y),append_hydration(g,w),append_hydration(w,b),append_hydration(g,x),mount_component(T,g,null),append_hydration(i,k),append_hydration(i,C),append_hydration(C,A),append_hydration(A,E),append_hydration(C,N),append_hydration(C,O),append_hydration(O,P),append_hydration(C,M),mount_component(R,C,null),append_hydration(i,F),append_hydration(i,D),append_hydration(D,j),append_hydration(j,z),append_hydration(D,L),append_hydration(D,B),append_hydration(B,$),append_hydration(D,W),mount_component(V,D,null),append_hydration(t,H),append_hydration(t,U),append_hydration(U,G),append_hydration(G,Z),append_hydration(U,X),append_hydration(U,K),append_hydration(K,Y),append_hydration(Y,Q),append_hydration(K,J),append_hydration(K,ee),append_hydration(ee,te),append_hydration(K,ie),mount_component(ne,K,null),append_hydration(U,re),append_hydration(U,se),append_hydration(se,ae),append_hydration(ae,le),append_hydration(se,ce),append_hydration(se,de),append_hydration(de,ue),append_hydration(se,he),mount_component(pe,se,null),fe=!0},p(e,[t]){(!fe||16&t)&&ge!==(ge=e[4].strings+"")&&set_data(u,ge);const i={};!m&&16&t&&(m=!0,i.value=e[4].strings,add_flush_callback((()=>m=!1))),p.$set(i),(!fe||16&t)&&ve!==(ve=e[4].harmonics+"")&&set_data(b,ve);const n={};!S&&16&t&&(S=!0,n.value=e[4].harmonics,add_flush_callback((()=>S=!1))),T.$set(n),(!fe||16&t)&&_e!==(_e=e[4].pedal+"")&&set_data(P,_e);const o={};!I&&16&t&&(I=!0,o.value=e[4].pedal,add_flush_callback((()=>I=!1))),R.$set(o),(!fe||16&t)&&ye!==(ye=e[4].keybed+"")&&set_data($,ye);const r={};!q&&16&t&&(q=!0,r.value=e[4].keybed,add_flush_callback((()=>q=!1))),V.$set(r),(!fe||4&t)&&set_data(te,e[2]);const s={};!oe&&4&t&&(oe=!0,s.value=e[2],add_flush_callback((()=>oe=!1))),ne.$set(s),(!fe||8&t)&&set_data(ue,e[3]);const a={};!me&&8&t&&(me=!0,a.value=e[3],add_flush_callback((()=>me=!1))),pe.$set(a)},i(e){fe||(transition_in(p.$$.fragment,e),transition_in(T.$$.fragment,e),transition_in(R.$$.fragment,e),transition_in(V.$$.fragment,e),transition_in(ne.$$.fragment,e),transition_in(pe.$$.fragment,e),fe=!0)},o(e){transition_out(p.$$.fragment,e),transition_out(T.$$.fragment,e),transition_out(R.$$.fragment,e),transition_out(V.$$.fragment,e),transition_out(ne.$$.fragment,e),transition_out(pe.$$.fragment,e),fe=!1},d(e){e&&detach(t),destroy_component(p),destroy_component(T),destroy_component(R),destroy_component(V),destroy_component(ne),destroy_component(pe)}}}function instance$5(e,t,i){let n,o,r,s,a;component_subscribe(e,reverbWetDry,(e=>i(0,n=e))),component_subscribe(e,sampleVelocities,(e=>i(1,o=e))),component_subscribe(e,sampleVolumes,(e=>i(4,r=e)));return e.$$.update=()=>{2&e.$$.dirty&&i(2,s=o),1&e.$$.dirty&&i(3,a=n)},[n,o,s,a,r,function(t){e.$$.not_equal(r.strings,t)&&(r.strings=t,sampleVolumes.set(r))},function(t){e.$$.not_equal(r.harmonics,t)&&(r.harmonics=t,sampleVolumes.set(r))},function(t){e.$$.not_equal(r.pedal,t)&&(r.pedal=t,sampleVolumes.set(r))},function(t){e.$$.not_equal(r.keybed,t)&&(r.keybed=t,sampleVolumes.set(r))},function(e){s=e,i(2,s),i(1,o)},({target:{value:e}})=>set_store_value(sampleVelocities,o=e,o),function(e){a=e,i(3,a),i(0,n)},({target:{value:e}})=>set_store_value(reverbWetDry,n=e,n)]}class AudioSettings extends SvelteComponent{constructor(e){super(),init(this,e,instance$5,create_fragment$5,safe_not_equal,{})}}function create_if_block_1$1(e){let t,i;return t=new AudioSettings({}),{c(){create_component(t.$$.fragment)},l(e){claim_component(t.$$.fragment,e)},m(e,n){mount_component(t,e,n),i=!0},i(e){i||(transition_in(t.$$.fragment,e),i=!0)},o(e){transition_out(t.$$.fragment,e),i=!1},d(e){destroy_component(t,e)}}}function create_if_block$2(e){let t,i;return t=new AdvancedSettings({}),{c(){create_component(t.$$.fragment)},l(e){claim_component(t.$$.fragment,e)},m(e,n){mount_component(t,e,n),i=!0},i(e){i||(transition_in(t.$$.fragment,e),i=!0)},o(e){transition_out(t.$$.fragment,e),i=!1},d(e){destroy_component(t,e)}}}function create_fragment$4(e){let t,i,n,o,r,s,a,l,c,d,u;function h(t){e[4](t)}let p={};void 0!==e[3]&&(p.selectedPanel=e[3]),t=new PanelSwitcher({props:p}),binding_callbacks.push((()=>bind(t,"selectedPanel",h))),r=new BasicSettings({props:{skipToPercentage:e[1]}});const m=[create_if_block$2,create_if_block_1$1],f=[];function g(e,t){return"settings"===e[3]?0:"audio"===e[3]?1:-1}return~(a=g(e))&&(l=f[a]=m[a](e)),d=new PlaybackControls({props:{playPauseApp:e[0],stopApp:e[2]}}),{c(){create_component(t.$$.fragment),n=space(),o=element("div"),create_component(r.$$.fragment),s=space(),l&&l.c(),c=space(),create_component(d.$$.fragment),this.h()},l(e){claim_component(t.$$.fragment,e),n=claim_space(e),o=claim_element(e,"DIV",{class:!0});var i=children(o);claim_component(r.$$.fragment,i),s=claim_space(i),l&&l.l(i),i.forEach(detach),c=claim_space(e),claim_component(d.$$.fragment,e),this.h()},h(){attr(o,"class","svelte-1hzo31a")},m(e,i){mount_component(t,e,i),insert_hydration(e,n,i),insert_hydration(e,o,i),mount_component(r,o,null),append_hydration(o,s),~a&&f[a].m(o,null),insert_hydration(e,c,i),mount_component(d,e,i),u=!0},p(e,[n]){const s={};!i&&8&n&&(i=!0,s.selectedPanel=e[3],add_flush_callback((()=>i=!1))),t.$set(s);const c={};2&n&&(c.skipToPercentage=e[1]),r.$set(c);let u=a;a=g(e),a!==u&&(l&&(group_outros(),transition_out(f[u],1,1,(()=>{f[u]=null})),check_outros()),~a?(l=f[a],l||(l=f[a]=m[a](e),l.c()),transition_in(l,1),l.m(o,null)):l=null);const h={};1&n&&(h.playPauseApp=e[0]),4&n&&(h.stopApp=e[2]),d.$set(h)},i(e){u||(transition_in(t.$$.fragment,e),transition_in(r.$$.fragment,e),transition_in(l),transition_in(d.$$.fragment,e),u=!0)},o(e){transition_out(t.$$.fragment,e),transition_out(r.$$.fragment,e),transition_out(l),transition_out(d.$$.fragment,e),u=!1},d(e){destroy_component(t,e),e&&detach(n),e&&detach(o),destroy_component(r),~a&&f[a].d(),e&&detach(c),destroy_component(d,e)}}}function instance$4(e,t,i){let{playPauseApp:n}=t,{skipToPercentage:o}=t,{stopApp:r}=t,s="controls";return e.$$set=e=>{"playPauseApp"in e&&i(0,n=e.playPauseApp),"skipToPercentage"in e&&i(1,o=e.skipToPercentage),"stopApp"in e&&i(2,r=e.stopApp)},[n,o,r,s,function(e){s=e,i(3,s)}]}class TabbedPanel extends SvelteComponent{constructor(e){super(),init(this,e,instance$4,create_fragment$4,safe_not_equal,{playPauseApp:0,skipToPercentage:1,stopApp:2})}}if("undefined"!=typeof document){const e=":root{--navigator-width:40px}article.svelte-xig6t4{background-color:white;border-radius:5px;box-shadow:0 1px 3px 0 rgba(0, 0, 0, 0.12), 0 1px 2px 0 rgba(0, 0, 0, 0.24);left:50%;max-height:80vh;max-width:728px;padding:20px;position:absolute;text-align:center;top:10vh;transform:translate(-50%);width:calc(100% - 40px);z-index:10}header.svelte-xig6t4{color:var(--primary-accent);font-size:40px;font-weight:bold;width:100%;text-shadow:4px 4px 4px rgba(38, 50, 56, 0.2);border-bottom:1px solid var(--primary-accent);padding-bottom:0.2em}p.svelte-xig6t4{margin:2em 0}a.svelte-xig6t4{color:var(--primary-accent);text-decoration:none}a.svelte-xig6t4:hover{color:#333;text-decoration:none}button.svelte-xig6t4{float:right}img.svelte-xig6t4{height:176px;width:300px;opacity:0;transition:opacity 1s ease}",t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function create_fragment$3(e){let t,i,n,o,r,s,a,l,c,d,u,h,p,m,f,g,v,_,y,w,b;return{c(){t=element("article"),i=element("header"),n=text("Welcome to the Pianolatron"),o=space(),r=element("p"),s=text("This site is under active development."),a=element("br"),l=text("Please direct enquiries and\n    feedback to\n    "),c=element("a"),d=text("contact-cidr@stanford.edu"),u=text(".\n    "),h=element("a"),p=element("img"),f=space(),g=element("button"),v=text("Dismiss, and don't show again"),this.h()},l(e){t=claim_element(e,"ARTICLE",{class:!0});var m=children(t);i=claim_element(m,"HEADER",{class:!0});var _=children(i);n=claim_text(_,"Welcome to the Pianolatron"),_.forEach(detach),o=claim_space(m),r=claim_element(m,"P",{class:!0});var y=children(r);s=claim_text(y,"This site is under active development."),a=claim_element(y,"BR",{}),l=claim_text(y,"Please direct enquiries and\n    feedback to\n    "),c=claim_element(y,"A",{href:!0,class:!0});var w=children(c);d=claim_text(w,"contact-cidr@stanford.edu"),w.forEach(detach),u=claim_text(y,".\n    "),h=claim_element(y,"A",{href:!0,title:!0,class:!0});var b=children(h);p=claim_element(b,"IMG",{src:!0,alt:!0,class:!0}),b.forEach(detach),y.forEach(detach),f=claim_space(m),g=claim_element(m,"BUTTON",{class:!0});var x=children(g);v=claim_text(x,"Dismiss, and don't show again"),x.forEach(detach),m.forEach(detach),this.h()},h(){attr(i,"class","svelte-xig6t4"),attr(c,"href","mailto:contact-cidr@stanford.edu"),attr(c,"class","svelte-xig6t4"),src_url_equal(p.src,m="cidr.trsp.300x176.png")||attr(p,"src","cidr.trsp.300x176.png"),attr(p,"alt","CIDR logo"),attr(p,"class","svelte-xig6t4"),attr(h,"href","http://cidr.stanford.edu/"),attr(h,"title","Center for Interdisciplinary Digital Research @ Stanford Libraries"),attr(h,"class","svelte-xig6t4"),attr(r,"class","svelte-xig6t4"),attr(g,"class","svelte-xig6t4"),attr(t,"class","svelte-xig6t4")},m(m,_){insert_hydration(m,t,_),append_hydration(t,i),append_hydration(i,n),append_hydration(t,o),append_hydration(t,r),append_hydration(r,s),append_hydration(r,a),append_hydration(r,l),append_hydration(r,c),append_hydration(c,d),append_hydration(r,u),append_hydration(r,h),append_hydration(h,p),append_hydration(t,f),append_hydration(t,g),append_hydration(g,v),y=!0,w||(b=[listen(window,"keydown",e[2]),listen(p,"load",load_handler),listen(g,"click",e[3]),listen(t,"click",e[4])],w=!0)},p:noop,i(e){y||(add_render_callback((()=>{_||(_=create_bidirectional_transition(t,fly,{y:-400},!0)),_.run(1)})),y=!0)},o(e){_||(_=create_bidirectional_transition(t,fly,{y:-400},!1)),_.run(0),y=!1},d(e){e&&detach(t),e&&_&&_.end(),w=!1,run_all(b)}}}const showWelcomeScreen=writable$1(!get_store_value(userSettings).welcomeScreenInhibited),load_handler=({target:e})=>e.style.opacity=1;function instance$3(e,t,i){let n,o,r=noop;component_subscribe(e,showWelcomeScreen,(e=>i(0,n=e))),component_subscribe(e,userSettings,(e=>i(1,o=e))),e.$$.on_destroy.push((()=>r()));return[n,o,e=>{"Escape"===e.code&&set_store_value(showWelcomeScreen,n=!1,n)},()=>{set_store_value(userSettings,o.welcomeScreenInhibited=!0,o),set_store_value(showWelcomeScreen,n=!1,n)},()=>set_store_value(showWelcomeScreen,n=!1,n)]}class Welcome extends SvelteComponent{constructor(e){super(),init(this,e,instance$3,create_fragment$3,safe_not_equal,{})}}if("undefined"!=typeof document){const e=':root{--navigator-width:40px}input.svelte-119in9q.svelte-119in9q{display:none}.flex-collapsible.svelte-119in9q.svelte-119in9q{transition:all 0.3s ease}.flex-collapsible.svelte-119in9q>div.svelte-119in9q{bottom:0;display:flex;flex-direction:column;gap:0.5em;overflow:visible;padding:0.5em;position:absolute;top:0}.flex-collapsible.svelte-119in9q.svelte-119in9q:hover:not(.hidden){box-shadow:2px -3px 3px rgba(0, 0, 0, 0.4)}.flex-collapsible:hover:not(.hidden).left.svelte-119in9q.svelte-119in9q{box-shadow:-2px -3px 3px rgba(0, 0, 0, 0.4)}.flex-collapsible.svelte-119in9q:hover label.svelte-119in9q{opacity:1}.flex-collapsible.left.svelte-119in9q label.svelte-119in9q{left:-40px;border-radius:4px 0 0 4px}.flex-collapsible.left.svelte-119in9q label.svelte-119in9q::after{content:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="white" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="14" y1="12" x2="4" y2="12" /><line x1="14" y1="12" x2="10" y2="16" /><line x1="14" y1="12" x2="10" y2="8" /><line x1="20" y1="4" x2="20" y2="20" /></svg>\')}.hidden.svelte-119in9q label.svelte-119in9q{opacity:1}.hidden.svelte-119in9q label.svelte-119in9q::after{content:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="white" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="20" y1="12" x2="10" y2="12" /><line x1="20" y1="12" x2="16" y2="16" /><line x1="20" y1="12" x2="16" y2="8" /><line x1="4" y1="4" x2="4" y2="20" /></svg>\')}.hidden.left.svelte-119in9q label.svelte-119in9q::after{content:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="white" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="12" x2="14" y2="12" /><line x1="4" y1="12" x2="8" y2="16" /><line x1="4" y1="12" x2="8" y2="8" /><line x1="20" y1="4" x2="20" y2="20" /></svg>\')}label.svelte-119in9q.svelte-119in9q{background:rgba(0, 0, 0, 0.4);border-radius:0 4px 4px 0;cursor:pointer;display:grid;height:40px;left:100%;opacity:0;place-items:center;position:relative;top:1em;transition:all 0.3s ease;width:40px;z-index:4}label.svelte-119in9q.svelte-119in9q::after{content:url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="white" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="10" y1="12" x2="20" y2="12" /><line x1="10" y1="12" x2="14" y2="16" /><line x1="10" y1="12" x2="14" y2="8" /><line x1="4" y1="4" x2="4" y2="20" /></svg>\')}',t=document.createElement("style"),i=document.createTextNode(e);t.type="text/css",t.appendChild(i),document.head.appendChild(t)}function create_fragment$2(e){let t,i,n,o,r,s,a,l,c,d,u,h,p,m;const f=e[5].default,g=create_slot(f,e,e[4],null);return{c(){t=element("div"),i=element("input"),o=space(),r=element("label"),a=space(),l=element("div"),g&&g.c(),this.h()},l(e){t=claim_element(e,"DIV",{id:!0,class:!0,style:!0});var n=children(t);i=claim_element(n,"INPUT",{type:!0,id:!0,class:!0}),o=claim_space(n),r=claim_element(n,"LABEL",{for:!0,class:!0}),children(r).forEach(detach),a=claim_space(n),l=claim_element(n,"DIV",{style:!0,class:!0});var s=children(l);g&&g.l(s),s.forEach(detach),n.forEach(detach),this.h()},h(){attr(i,"type","checkbox"),attr(i,"id",n=`${e[0]}_collapse`),attr(i,"class","svelte-119in9q"),attr(r,"for",s=`${e[0]}_collapse`),attr(r,"class","svelte-119in9q"),attr(l,"style",c=`width: ${e[1]};`),attr(l,"class","svelte-119in9q"),attr(t,"id",e[0]),attr(t,"class",d=null_to_empty(`flex-collapsible ${e[2]}`)+" svelte-119in9q"),attr(t,"style",u=`width: ${e[3]?0:e[1]};`),toggle_class(t,"hidden",e[3])},m(n,s){insert_hydration(n,t,s),append_hydration(t,i),i.checked=e[3],append_hydration(t,o),append_hydration(t,r),append_hydration(t,a),append_hydration(t,l),g&&g.m(l,null),h=!0,p||(m=listen(i,"change",e[6]),p=!0)},p(e,[o]){(!h||1&o&&n!==(n=`${e[0]}_collapse`))&&attr(i,"id",n),8&o&&(i.checked=e[3]),(!h||1&o&&s!==(s=`${e[0]}_collapse`))&&attr(r,"for",s),g&&g.p&&(!h||16&o)&&update_slot_base(g,f,e,e[4],h?get_slot_changes(f,e[4],o,null):get_all_dirty_from_scope(e[4]),null),(!h||2&o&&c!==(c=`width: ${e[1]};`))&&attr(l,"style",c),(!h||1&o)&&attr(t,"id",e[0]),(!h||4&o&&d!==(d=null_to_empty(`flex-collapsible ${e[2]}`)+" svelte-119in9q"))&&attr(t,"class",d),(!h||10&o&&u!==(u=`width: ${e[3]?0:e[1]};`))&&attr(t,"style",u),12&o&&toggle_class(t,"hidden",e[3])},i(e){h||(transition_in(g,e),h=!0)},o(e){transition_out(g,e),h=!1},d(e){e&&detach(t),g&&g.d(e),p=!1,m()}}}function instance$2(e,t,i){let{$$slots:n={},$$scope:o}=t,{id:r}=t,{width:s}=t,{position:a="right"}=t,l=!1;return e.$$set=e=>{"id"in e&&i(0,r=e.id),"width"in e&&i(1,s=e.width),"position"in e&&i(2,a=e.position),"$$scope"in e&&i(4,o=e.$$scope)},[r,s,a,l,o,n,function(){l=this.checked,i(3,l)}]}class FlexCollapsible extends SvelteComponent{constructor(e){super(),init(this,e,instance$2,create_fragment$2,safe_not_equal,{id:0,width:1,position:2})}}function create_if_block$1(e){let t,i,n,o,r,s,a,l,c,d,u,h,p,m,f;return{c(){t=element("div"),i=element("div"),n=element("span"),o=text(" \n      "),r=element("span"),s=text(" \n      "),a=element("span"),l=text(" \n      "),c=element("span"),d=text(" \n      "),u=element("span"),h=space(),p=text(e[1]),this.h()},l(m){t=claim_element(m,"DIV",{id:!0});var f=children(t);i=claim_element(f,"DIV",{});var g=children(i);n=claim_element(g,"SPAN",{}),children(n).forEach(detach),o=claim_text(g," \n      "),r=claim_element(g,"SPAN",{}),children(r).forEach(detach),s=claim_text(g," \n      "),a=claim_element(g,"SPAN",{}),children(a).forEach(detach),l=claim_text(g," \n      "),c=claim_element(g,"SPAN",{}),children(c).forEach(detach),d=claim_text(g," \n      "),u=claim_element(g,"SPAN",{}),children(u).forEach(detach),g.forEach(detach),h=claim_space(f),p=claim_text(f,e[1]),f.forEach(detach),this.h()},h(){attr(t,"id","loading")},m(e,m){insert_hydration(e,t,m),append_hydration(t,i),append_hydration(i,n),append_hydration(i,o),append_hydration(i,r),append_hydration(i,s),append_hydration(i,a),append_hydration(i,l),append_hydration(i,c),append_hydration(i,d),append_hydration(i,u),append_hydration(t,h),append_hydration(t,p),f=!0},p(e,t){(!f||2&t)&&set_data(p,e[1])},i(e){f||(add_render_callback((()=>{m||(m=create_bidirectional_transition(t,fade,{},!0)),m.run(1)})),f=!0)},o(e){m||(m=create_bidirectional_transition(t,fade,{},!1)),m.run(0),f=!1},d(e){e&&detach(t),e&&m&&m.end()}}}function create_fragment$1(e){let t,i,n=e[0]&&create_if_block$1(e);return{c(){n&&n.c(),t=empty()},l(e){n&&n.l(e),t=empty()},m(e,o){n&&n.m(e,o),insert_hydration(e,t,o),i=!0},p(e,[i]){e[0]?n?(n.p(e,i),1&i&&transition_in(n,1)):(n=create_if_block$1(e),n.c(),transition_in(n,1),n.m(t.parentNode,t)):n&&(group_outros(),transition_out(n,1,1,(()=>{n=null})),check_outros())},i(e){i||(transition_in(n),i=!0)},o(e){transition_out(n),i=!1},d(e){n&&n.d(e),e&&detach(t)}}}function instance$1(e,t,i){let{showLoadingSpinner:n}=t,{loadingSpinnerText:o="Loading resources..."}=t;return e.$$set=e=>{"showLoadingSpinner"in e&&i(0,n=e.showLoadingSpinner),"loadingSpinnerText"in e&&i(1,o=e.loadingSpinnerText)},[n,o]}class LoadingSpinner extends SvelteComponent{constructor(e){super(),init(this,e,instance$1,create_fragment$1,safe_not_equal,{showLoadingSpinner:0,loadingSpinnerText:1})}}let json=[{druid:"my670qk6863",image_url:"https://stacks.stanford.edu/image/iiif/my670qk6863%2Fmy670qk6863_0001/info.json",label:"2673 Welte-Mignon",title:"Adam - Hymns",type:"welte-red"},{druid:"sj617nc3041",image_url:"https://stacks.stanford.edu/image/iiif/sj617nc3041%2Fsj617nc3041_0001/info.json",label:"2543 Welte-Mignon",title:"Adam/Bernick - Si j'étais roi. ouverture",type:"welte-red"},{druid:"sz948zd1422",image_url:"https://stacks.stanford.edu/image/iiif/sz948zd1422%2Fsz948zd1422_0002/info.json",label:"4538 Princesa",title:"Akst - Dinah: charlestón",type:"88-note"},{druid:"ty610zx2946",image_url:"https://stacks.stanford.edu/image/iiif/ty610zx2946%2Fty610zx2946_0001/info.json",label:"416 Welte-Mignon",title:"Albert/Albert - Tiefland ballade",type:"welte-red"},{druid:"mb915gc4689",image_url:"https://stacks.stanford.edu/image/iiif/mb915gc4689%2Fmb915gc4689_0001/info.json",label:"520 Welte-Mignon",title:"Alkan/Petri - Ancienne melodie de la synagogue a. d. präludien: op. 31",type:"welte-red"},{druid:"xn196fs1128",image_url:"https://stacks.stanford.edu/image/iiif/xn196fs1128%2Fxn196fs1128_0002/info.json",label:"4652 Princesa",title:"Alonso - La parranda. ronda de las solteras",type:"88-note"},{druid:"cy287wz7683",image_url:"https://stacks.stanford.edu/image/iiif/cy287wz7683%2Fcy287wz7683_0002/info.json",label:"653 P.O.C.H.",title:"Alonso - Las castigadoras. charlestón",type:"88-note"},{druid:"nw222vm1898",image_url:"https://stacks.stanford.edu/image/iiif/nw222vm1898%2Fnw222vm1898_0002/info.json",label:"4566 Princesa",title:"Alonso - Las castigadoras. pasodoble",type:"88-note"},{druid:"pz594dj8436",image_url:"https://stacks.stanford.edu/image/iiif/pz594dj8436%2Fpz594dj8436_0002/info.json",label:"4391 Princesa",title:"Alonso - Las corsarias: selecciones",type:"88-note"},{druid:"tn412mq0486",image_url:"https://stacks.stanford.edu/image/iiif/tn412mq0486%2Ftn412mq0486_0002/info.json",label:"40076 Princesa",title:"Alonso - Por si las moscas. schotis",type:"88-note"},{druid:"rs892mq5364",image_url:"https://stacks.stanford.edu/image/iiif/rs892mq5364%2Frs892mq5364_0002/info.json",label:"40008 Princesa",title:"Barta - Rosa de madrid: schotis",type:"88-note"},{druid:"ch984dr4932",image_url:"https://stacks.stanford.edu/image/iiif/ch984dr4932%2Fch984dr4932_0002/info.json",label:"1894",title:"Beethoven - Cuarteto op. 130. iii, andante con moto ma non troppo",type:"88-note"},{druid:"vz386xg9451",image_url:"https://stacks.stanford.edu/image/iiif/vz386xg9451%2Fvz386xg9451_0002/info.json",label:"4155 Victoria",title:"Beethoven - Sonata op. 31, no 1: rondó",type:"88-note"},{druid:"hb523vs3190",image_url:"https://stacks.stanford.edu/image/iiif/hb523vs3190%2Fhb523vs3190_0002/info.json",label:"4108 Victoria",title:"Beethoven - Sonata, op. 2, no 1, en fa menor: minuetto",type:"88-note"},{druid:"bq744nq5945",image_url:"https://stacks.stanford.edu/image/iiif/bq744nq5945%2Fbq744nq5945_0001/info.json",label:"1462 Welte-Mignon",title:"Beethoven/Bloomfield-Zeisler - Sonata op. 111, c minor. 1st movement",type:"welte-red"},{druid:"yt974cv2625",image_url:"https://stacks.stanford.edu/image/iiif/yt974cv2625%2Fyt974cv2625_0001/info.json",label:"1463 Welte-Mignon",title:"Beethoven/Bloomfield-Zeisler - Sonate op. 111, c-moll. ii. teil",type:"welte-red"},{druid:"bc072xf6791",image_url:"https://stacks.stanford.edu/image/iiif/bc072xf6791%2Fbc072xf6791_0001/info.json",label:"443 Welte-Mignon",title:"Beethoven/Busoni - Adelaïde: (transcription)",type:"welte-red"},{druid:"qz671pq0609",image_url:"https://stacks.stanford.edu/image/iiif/qz671pq0609%2Fqz671pq0609_0001/info.json",label:"372 Welte-Mignon",title:"Beethoven/Carreño - Sonate c-dur, op. 53: (waldstein). 1. teil",type:"welte-red"},{druid:"kg263bn9176",image_url:"https://stacks.stanford.edu/image/iiif/kg263bn9176%2Fkg263bn9176_0001/info.json",label:"373 Welte-Mignon",title:"Beethoven/Carreño - Waldstein sonata. (2nd movement)",type:"welte-red"},{druid:"ph692rh6823",image_url:"https://stacks.stanford.edu/image/iiif/ph692rh6823%2Fph692rh6823_0001/info.json",label:"2311 Welte-Mignon",title:"Beethoven/Del Grande - Symphonie eroica. i. satz",type:"welte-red"},{druid:"dz112ky5575",image_url:"https://stacks.stanford.edu/image/iiif/dz112ky5575%2Fdz112ky5575_0001/info.json",label:"2312 Welte-Mignon",title:"Beethoven/Del Grande - Symphonie eroica. ii. satz",type:"welte-red"},{druid:"ht339gy6128",image_url:"https://stacks.stanford.edu/image/iiif/ht339gy6128%2Fht339gy6128_0001/info.json",label:"2313 Welte-Mignon",title:"Beethoven/Del Grande - Symphonie eroica. iii. satz",type:"welte-red"},{druid:"ks452px2704",image_url:"https://stacks.stanford.edu/image/iiif/ks452px2704%2Fks452px2704_0001/info.json",label:"2314 Welte-Mignon",title:"Beethoven/Del Grande - Symphonie eroica. iv. satz",type:"welte-red"},{druid:"xx766cn9843",image_url:"https://stacks.stanford.edu/image/iiif/xx766cn9843%2Fxx766cn9843_0001/info.json",label:"1326 Welte-Mignon",title:"Beethoven/Fryer - Menuett es-dur",type:"welte-red"},{druid:"ty382mw3181",image_url:"https://stacks.stanford.edu/image/iiif/ty382mw3181%2Fty382mw3181_0001/info.json",label:"3026 Welte-Mignon",title:"Beethoven/Hofmann - Sonate a-dur, op. 101. i. und ii. teil",type:"welte-red"},{druid:"jk842rg9750",image_url:"https://stacks.stanford.edu/image/iiif/jk842rg9750%2Fjk842rg9750_0001/info.json",label:"3027 Welte-Mignon",title:"Beethoven/Hofmann - Sonate op. 103. iii. und iv. teil",type:"welte-red"},{druid:"mw870hc7232",image_url:"https://stacks.stanford.edu/image/iiif/mw870hc7232%2Fmw870hc7232_0001/info.json",label:"3156 Welte-Mignon",title:"Beethoven/Kiek - 2nd symphony. movements 2 & 3",type:"welte-red"},{druid:"ch718mg2581",image_url:"https://stacks.stanford.edu/image/iiif/ch718mg2581%2Fch718mg2581_0001/info.json",label:"284 Welte-Mignon",title:"Beethoven/Lambrino - Menuett (from sonata op. 31 e flat major)",type:"welte-red"},{druid:"wt621xq0875",image_url:"https://stacks.stanford.edu/image/iiif/wt621xq0875%2Fwt621xq0875_0001/info.json",label:"561 Welte-Mignon",title:"Beethoven/Lamond - Sonate pathétique. ii. satz",type:"welte-red"},{druid:"kr397bv2881",image_url:"https://stacks.stanford.edu/image/iiif/kr397bv2881%2Fkr397bv2881_0001/info.json",label:"562 Welte-Mignon",title:"Beethoven/Lamond - Sonate pathétique: op. 13, 3rd movement",type:"welte-red"},{druid:"dx555xv9093",image_url:"https://stacks.stanford.edu/image/iiif/dx555xv9093%2Fdx555xv9093_0001/info.json",label:"1246 Welte-Mignon",title:"Beethoven/Paderewski - Moonlight sonata: c sharp minor. 1st & 2nd movements",type:"welte-red"},{druid:"xm993qd2681",image_url:"https://stacks.stanford.edu/image/iiif/xm993qd2681%2Fxm993qd2681_0001/info.json",label:"1247 Welte-Mignon",title:"Beethoven/Paderewski - Sonata c sharp minor: (moonlight). part 3",type:"welte-red"},{druid:"yb187qn0290",image_url:"https://stacks.stanford.edu/image/iiif/yb187qn0290%2Fyb187qn0290_0001/info.json",label:"1246 Welte-Mignon",title:"Beethoven/Paderewski - Sonate cis-moll: (mondschein). i. und ii. teil",type:"welte-red"},{druid:"wp877mn0317",image_url:"https://stacks.stanford.edu/image/iiif/wp877mn0317%2Fwp877mn0317_0001/info.json",label:"1247 Welte-Mignon",title:"Beethoven/Paderewski - Sonate cis-moll: (mondschein). iii. teil",type:"welte-red"},{druid:"wk295jd5289",image_url:"https://stacks.stanford.edu/image/iiif/wk295jd5289%2Fwk295jd5289_0001/info.json",label:"527 Welte-Mignon",title:"Beethoven/Petri - 32 variationen: c-moll",type:"welte-red"},{druid:"pv279zy5193",image_url:"https://stacks.stanford.edu/image/iiif/pv279zy5193%2Fpv279zy5193_0001/info.json",label:"1505 Welte-Mignon",title:"Beethoven/Pückler - Sonata appassionata. ii. u. iii. teil",type:"welte-red"},{druid:"tt435dd2897",image_url:"https://stacks.stanford.edu/image/iiif/tt435dd2897%2Ftt435dd2897_0001/info.json",label:"326 Welte-Mignon",title:"Beethoven/Reisenauer - Rondo capriccioso: g-dur, op. 129: (die wut über den verlorenen groschen)",type:"welte-red"},{druid:"wb381qd3151",image_url:"https://stacks.stanford.edu/image/iiif/wb381qd3151%2Fwb381qd3151_0001/info.json",label:"330 Welte-Mignon",title:"Beethoven/Reisenauer - Rondo op. 51",type:"welte-red"},{druid:"dp801zr4347",image_url:"https://stacks.stanford.edu/image/iiif/dp801zr4347%2Fdp801zr4347_0001/info.json",label:"3130 Welte-Mignon",title:"Beethoven/Ritter - Leonora no. 3 overture",type:"welte-red"},{druid:"gm170gy7498",image_url:"https://stacks.stanford.edu/image/iiif/gm170gy7498%2Fgm170gy7498_0001/info.json",label:"239 Welte-Mignon",title:"Beethoven/Scharwenka - Sonata appassionata, op. 57. part 1",type:"welte-red"},{druid:"mh156nr8259",image_url:"https://stacks.stanford.edu/image/iiif/mh156nr8259%2Fmh156nr8259_0001/info.json",label:"1442 Welte-Mignon",title:"Beethoven/Schelling - Sonata appassionata: op. 57, f minor. 1st movement",type:"welte-red"},{druid:"bf074nj8801",image_url:"https://stacks.stanford.edu/image/iiif/bf074nj8801%2Fbf074nj8801_0001/info.json",label:"1443 Welte-Mignon",title:"Beethoven/Schelling - Sonata appassionata: op. 57, f minor. 2nd and 3rd movements",type:"welte-red"},{druid:"fz215xr4723",image_url:"https://stacks.stanford.edu/image/iiif/fz215xr4723%2Ffz215xr4723_0001/info.json",label:"1443 Welte-Mignon",title:"Beethoven/Schelling - Sonata appassionata: op. 57, f minor. 2nd and 3rd movements",type:"welte-red"},{druid:"pp798fc0175",image_url:"https://stacks.stanford.edu/image/iiif/pp798fc0175%2Fpp798fc0175_0001/info.json",label:"5667 Welte-Mignon",title:"Berlin/Haass - All alone: waltz",type:"welte-red"},{druid:"bz327kz4744",image_url:"https://stacks.stanford.edu/image/iiif/bz327kz4744%2Fbz327kz4744_0001/info.json",label:"5634 Welte-Mignon",title:"Berlin/Hare - What'll i do: waltz",type:"welte-red"},{druid:"dr971dy1221",image_url:"https://stacks.stanford.edu/image/iiif/dr971dy1221%2Fdr971dy1221_0001/info.json",label:"965 Welte-Mignon",title:"Berlioz/Landowska - Ballet des sylves",type:"welte-red"},{druid:"kt852zf4103",image_url:"https://stacks.stanford.edu/image/iiif/kt852zf4103%2Fkt852zf4103_0001/info.json",label:"137 Welte-Mignon",title:"Bizet/Adam-Benard - Carmens lied: tralalala",type:"welte-red"},{druid:"tp747vf1137",image_url:"https://stacks.stanford.edu/image/iiif/tp747vf1137%2Ftp747vf1137_0001/info.json",label:"163 Welte-Mignon",title:"Bizet/Adam-Benard - Lied des don josé und duo aus carmen: 2. akt (carmens tanz)",type:"welte-red"},{druid:"gr034qm4805",image_url:"https://stacks.stanford.edu/image/iiif/gr034qm4805%2Fgr034qm4805_0001/info.json",label:"1593 Welte-Mignon",title:"Bizet/Francklyn - Carmen: selection",type:"welte-red"},{druid:"xg976jt9573",image_url:"https://stacks.stanford.edu/image/iiif/xg976jt9573%2Fxg976jt9573_0001/info.json",label:"5521 Welte-Mignon",title:"Blaufuss/Dark - My isle of golden dreams: waltz",type:"welte-red"},{druid:"ps108fn1431",image_url:"https://stacks.stanford.edu/image/iiif/ps108fn1431%2Fps108fn1431_0001/info.json",label:"1288 Welte-Mignon",title:"Borel-Clerc/Fichter - La mattchiche",type:"welte-red"},{druid:"rk591jt8964",image_url:"https://stacks.stanford.edu/image/iiif/rk591jt8964%2Frk591jt8964_0001/info.json",label:"1148 Welte-Mignon",title:"Brahms/Carreño - Sonata f minor, op. 5, 1st movement",type:"welte-red"},{druid:"jj589sc7898",image_url:"https://stacks.stanford.edu/image/iiif/jj589sc7898%2Fjj589sc7898_0001/info.json",label:"497 Welte-Mignon",title:"Brahms/Dohnányi - Cappriccio op. 76, no. 2",type:"welte-red"},{druid:"yw484ky7093",image_url:"https://stacks.stanford.edu/image/iiif/yw484ky7093%2Fyw484ky7093_0001/info.json",label:"589 Welte-Mignon",title:"Brahms/Galston - Waltzes op. 39, 6 and 11",type:"welte-red"},{druid:"tx437pj1389",image_url:"https://stacks.stanford.edu/image/iiif/tx437pj1389%2Ftx437pj1389_0001/info.json",label:"1108 Welte-Mignon",title:"Brahms/Ney - Sonata f minor, op. 5. 2nd movement",type:"welte-red"},{druid:"dc661yr7679",image_url:"https://stacks.stanford.edu/image/iiif/dc661yr7679%2Fdc661yr7679_0001/info.json",label:"1085 Welte-Mignon",title:"Brahms/Nikisch - Ungarischer tanz. no. 1",type:"welte-red"},{druid:"jf938sf5847",image_url:"https://stacks.stanford.edu/image/iiif/jf938sf5847%2Fjf938sf5847_0001/info.json",label:"2555 Welte-Mignon",title:"Brahms/Paur - Intermezzo op. 76, no. 2",type:"welte-red"},{druid:"rk796xd9697",image_url:"https://stacks.stanford.edu/image/iiif/rk796xd9697%2Frk796xd9697_0001/info.json",label:"1476 Welte-Mignon",title:"Brahms/Samaroff Stokowski - Ii. rhapsodie",type:"welte-red"},{druid:"dj406yq6980",image_url:"https://stacks.stanford.edu/image/iiif/dj406yq6980%2Fdj406yq6980_0001/info.json",label:"663 Welte-Mignon",title:"Brassin/Hofmann - Feuerzauber",type:"welte-red"},{druid:"ht999gf1829",image_url:"https://stacks.stanford.edu/image/iiif/ht999gf1829%2Fht999gf1829_0002/info.json",label:"2191 Princesa",title:"Caballero - Gigantes y cabezudos: selección",type:"88-note"},{druid:"jc718cb5784",image_url:"https://stacks.stanford.edu/image/iiif/jc718cb5784%2Fjc718cb5784_0001/info.json",label:"2594 Welte-Mignon",title:"Chaminade/Bloomfield-Zeisler - Le retour",type:"welte-red"},{druid:"cd435bw2771",image_url:"https://stacks.stanford.edu/image/iiif/cd435bw2771%2Fcd435bw2771_0001/info.json",label:"2539 Welte-Mignon",title:"Chaminade/Mero - Arlequine",type:"welte-red"},{druid:"rx933wn3761",image_url:"https://stacks.stanford.edu/image/iiif/rx933wn3761%2Frx933wn3761_0001/info.json",label:"2537 Welte-Mignon",title:"Chaminade/Mero - Automne: op. 35, no. 2",type:"welte-red"},{druid:"cw378sb0125",image_url:"https://stacks.stanford.edu/image/iiif/cw378sb0125%2Fcw378sb0125_0001/info.json",label:"2538 Welte-Mignon",title:"Chaminade/Mero - Elevation: op. 76, no. 2",type:"welte-red"},{druid:"tm408mz6807",image_url:"https://stacks.stanford.edu/image/iiif/tm408mz6807%2Ftm408mz6807_0001/info.json",label:"2538 Welte-Mignon",title:"Chaminade/Mero - Elévation: romance sans paroles: op. 76, no. 2",type:"welte-red"},{druid:"tr243mz6407",image_url:"https://stacks.stanford.edu/image/iiif/tr243mz6407%2Ftr243mz6407_0001/info.json",label:"2540 Welte-Mignon",title:"Chaminade/Mero - La lisonjera",type:"welte-red"},{druid:"zf037wk3650",image_url:"https://stacks.stanford.edu/image/iiif/zf037wk3650%2Fzf037wk3650_0001/info.json",label:"1127 Welte-Mignon",title:"Chaminade/Uzielli - Pierrette: air de ballet, op. 41",type:"welte-red"},{druid:"ms604gp1206",image_url:"https://stacks.stanford.edu/image/iiif/ms604gp1206%2Fms604gp1206_0002/info.json",label:"4466 Princesa",title:"Chapí - El puñao de rosas: selecciones",type:"88-note"},{druid:"br351xc9456",image_url:"https://stacks.stanford.edu/image/iiif/br351xc9456%2Fbr351xc9456_0002/info.json",label:"1944 Princesa",title:"Chapí - La tempestad: valses sobre varios motivos",type:"88-note"},{druid:"wx138dx1211",image_url:"https://stacks.stanford.edu/image/iiif/wx138dx1211%2Fwx138dx1211_0002/info.json",label:"4108 Victoria",title:"Chopin - Nocturno, op. 15, no 1, en fa",type:"88-note"},{druid:"nq628rc4181",image_url:"https://stacks.stanford.edu/image/iiif/nq628rc4181%2Fnq628rc4181_0001/info.json",label:"83 Welte-Mignon",title:"Chopin/Adam-Benard - Nocturne op. 9, no. 2, e flat major",type:"welte-red"},{druid:"gf160gq3516",image_url:"https://stacks.stanford.edu/image/iiif/gf160gq3516%2Fgf160gq3516_0001/info.json",label:"2979 Welte-Mignon",title:"Chopin/Albert - Nocturne op. 9, no. 1, b-flat minor",type:"welte-red"},{druid:"fr853pn6519",image_url:"https://stacks.stanford.edu/image/iiif/fr853pn6519%2Ffr853pn6519_0001/info.json",label:"419 Welte-Mignon",title:"Chopin/Albert - Polonaise op. 53, a flat",type:"welte-red"},{druid:"zp866tm4852",image_url:"https://stacks.stanford.edu/image/iiif/zp866tm4852%2Fzp866tm4852_0001/info.json",label:"3310 Welte-Mignon",title:"Chopin/Backhaus - Pianoforte concerto op. ii, e minor. 2nd movement",type:"welte-red"},{druid:"qd784zj3903",image_url:"https://stacks.stanford.edu/image/iiif/qd784zj3903%2Fqd784zj3903_0001/info.json",label:"3310 Welte-Mignon",title:"Chopin/Backhaus - Romanze a. e-moll konzert. ii. satz",type:"welte-red"},{druid:"pj688nx2384",image_url:"https://stacks.stanford.edu/image/iiif/pj688nx2384%2Fpj688nx2384_0001/info.json",label:"1464 Welte-Mignon",title:"Chopin/Bloomfield-Zeisler - Scherzo b-moll",type:"welte-red"},{druid:"fh358rd2268",image_url:"https://stacks.stanford.edu/image/iiif/fh358rd2268%2Ffh358rd2268_0001/info.json",label:"2586 Welte-Mignon",title:"Chopin/Bloomfield-Zeisler - Sonata op. 35, b minor. part 1",type:"welte-red"},{druid:"kw738fg7467",image_url:"https://stacks.stanford.edu/image/iiif/kw738fg7467%2Fkw738fg7467_0001/info.json",label:"2588 Welte-Mignon",title:"Chopin/Bloomfield-Zeisler - Sonata op. 35. funeralmarch and presto",type:"welte-red"},{druid:"zw904vm6502",image_url:"https://stacks.stanford.edu/image/iiif/zw904vm6502%2Fzw904vm6502_0001/info.json",label:"1465 Welte-Mignon",title:"Chopin/Bloomfield-Zeisler - Waltz, op. 70, no. 1",type:"welte-red"},{druid:"wz719qg6993",image_url:"https://stacks.stanford.edu/image/iiif/wz719qg6993%2Fwz719qg6993_0001/info.json",label:"441 Welte-Mignon",title:"Chopin/Busoni - Nocturne op. 15, no. 2, fis-dur",type:"welte-red"},{druid:"gc795vb4435",image_url:"https://stacks.stanford.edu/image/iiif/gc795vb4435%2Fgc795vb4435_0001/info.json",label:"1319 Welte-Mignon",title:"Chopin/Busoni - Prelude op. 28, nr. 15, d flat",type:"welte-red"},{druid:"sn610pr8684",image_url:"https://stacks.stanford.edu/image/iiif/sn610pr8684%2Fsn610pr8684_0001/info.json",label:"3184 Welte-Mignon",title:"Chopin/Carreras - Preludes. no. 3, g major ; no. 6, b minor",type:"welte-red"},{druid:"bj606rp8160",image_url:"https://stacks.stanford.edu/image/iiif/bj606rp8160%2Fbj606rp8160_0001/info.json",label:"367 Welte-Mignon",title:"Chopin/Carreño - Ballade op. 23, g minor",type:"welte-red"},{druid:"rj799hj0968",image_url:"https://stacks.stanford.edu/image/iiif/rj799hj0968%2Frj799hj0968_0001/info.json",label:"364 Welte-Mignon",title:"Chopin/Carreño - Nocturne g major, op. 37, no. 2",type:"welte-red"},{druid:"st828pc9818",image_url:"https://stacks.stanford.edu/image/iiif/st828pc9818%2Fst828pc9818_0001/info.json",label:"364 Welte-Mignon",title:"Chopin/Carreño - Nocturne op. 37, no. 2, g major",type:"welte-red"},{druid:"gs556hk6631",image_url:"https://stacks.stanford.edu/image/iiif/gs556hk6631%2Fgs556hk6631_0001/info.json",label:"366 Welte-Mignon",title:"Chopin/Carreño - Nocturne op. 48, no. 1, c minor",type:"welte-red"},{druid:"wg598sj1504",image_url:"https://stacks.stanford.edu/image/iiif/wg598sj1504%2Fwg598sj1504_0001/info.json",label:"2621 Welte-Mignon",title:"Chopin/Di Benici - Etude ges dur, op. 10, no. 5. (schwarze tasten)",type:"welte-red"},{druid:"jm300wy4714",image_url:"https://stacks.stanford.edu/image/iiif/jm300wy4714%2Fjm300wy4714_0001/info.json",label:"2622 Welte-Mignon",title:"Chopin/Di Benici - Prelude op. 28, no. 18, f minor",type:"welte-red"},{druid:"nf733yv1324",image_url:"https://stacks.stanford.edu/image/iiif/nf733yv1324%2Fnf733yv1324_0001/info.json",label:"498 Welte-Mignon",title:"Chopin/Dohnányi - Valse op. 64, no. 2, cis-moll",type:"welte-red"},{druid:"kv601my2750",image_url:"https://stacks.stanford.edu/image/iiif/kv601my2750%2Fkv601my2750_0001/info.json",label:"1077 Welte-Mignon",title:"Chopin/Esipova - Prelude, a flat major",type:"welte-red"},{druid:"gs573tj9547",image_url:"https://stacks.stanford.edu/image/iiif/gs573tj9547%2Fgs573tj9547_0001/info.json",label:"1328 Welte-Mignon",title:"Chopin/Fryer - Preludes op. 28, nos. 6 & 11",type:"welte-red"},{druid:"mj416dn1432",image_url:"https://stacks.stanford.edu/image/iiif/mj416dn1432%2Fmj416dn1432_0001/info.json",label:"594 Welte-Mignon",title:"Chopin/Galston - Etude op. 10, no. 12: (revolutions-etude)",type:"welte-red"},{druid:"qf640sj3141",image_url:"https://stacks.stanford.edu/image/iiif/qf640sj3141%2Fqf640sj3141_0001/info.json",label:"2159 Welte-Mignon",title:"Chopin/Goraïnoff - Concert e-moll, op. 11. 1. teil",type:"welte-red"},{druid:"bs279zc9206",image_url:"https://stacks.stanford.edu/image/iiif/bs279zc9206%2Fbs279zc9206_0001/info.json",label:"2160 Welte-Mignon",title:"Chopin/Goraïnoff - Concerto e minor. part ii",type:"welte-red"},{druid:"yk477xx5343",image_url:"https://stacks.stanford.edu/image/iiif/yk477xx5343%2Fyk477xx5343_0001/info.json",label:"2161 Welte-Mignon",title:"Chopin/Goraïnoff - Concerto op. 11, e minor. 3rd movement",type:"welte-red"},{druid:"gg384dv5303",image_url:"https://stacks.stanford.edu/image/iiif/gg384dv5303%2Fgg384dv5303_0001/info.json",label:"194 Welte-Mignon",title:"Chopin/Grünfeld - Nocturne h-dur op. 32",type:"welte-red"},{druid:"wj177bx9196",image_url:"https://stacks.stanford.edu/image/iiif/wj177bx9196%2Fwj177bx9196_0001/info.json",label:"931 Welte-Mignon",title:"Chopin/Hambourg - Mazurka a-moll: (posthume)",type:"welte-red"},{druid:"vs167qc5364",image_url:"https://stacks.stanford.edu/image/iiif/vs167qc5364%2Fvs167qc5364_0001/info.json",label:"668 Welte-Mignon",title:"Chopin/Hofmann - Nocturne, d flat major, op. 27, no. 2",type:"welte-red"},{druid:"qq244fh1388",image_url:"https://stacks.stanford.edu/image/iiif/qq244fh1388%2Fqq244fh1388_0001/info.json",label:"669 Welte-Mignon",title:"Chopin/Hofmann - Polonaise op. 44, fis-moll",type:"welte-red"},{druid:"xm418xm6937",image_url:"https://stacks.stanford.edu/image/iiif/xm418xm6937%2Fxm418xm6937_0001/info.json",label:"3976 Welte-Mignon",title:"Chopin/Koczalski - Concerto op. 11, e minor, 1st movement. allegro maestoso",type:"welte-red"},{druid:"nf274ng7905",image_url:"https://stacks.stanford.edu/image/iiif/nf274ng7905%2Fnf274ng7905_0001/info.json",label:"209 Welte-Mignon",title:"Chopin/Krah - Nocturne op. 55, no. 2, e flat major",type:"welte-red"},{druid:"kt780tm7975",image_url:"https://stacks.stanford.edu/image/iiif/kt780tm7975%2Fkt780tm7975_0001/info.json",label:"568 Welte-Mignon",title:"Chopin/Lamond - Valse op. 70",type:"welte-red"},{druid:"bm016sg7202",image_url:"https://stacks.stanford.edu/image/iiif/bm016sg7202%2Fbm016sg7202_0001/info.json",label:"1671 Welte-Mignon",title:"Chopin/Margolies - Polonaise: (polonaise militaire): op. 40, no. 1",type:"welte-red"},{druid:"ym117yd8356",image_url:"https://stacks.stanford.edu/image/iiif/ym117yd8356%2Fym117yd8356_0001/info.json",label:"1670 Welte-Mignon",title:"Chopin/Margolies - Sonata b-moll, op. 35. parts 2, 3, & 4",type:"welte-red"},{druid:"xc665jf8254",image_url:"https://stacks.stanford.edu/image/iiif/xc665jf8254%2Fxc665jf8254_0001/info.json",label:"719 Welte-Mignon",title:"Chopin/Motta - Scherzo e-dur, op. 54",type:"welte-red"},{druid:"ky458kj7325",image_url:"https://stacks.stanford.edu/image/iiif/ky458kj7325%2Fky458kj7325_0001/info.json",label:"2882 Welte-Mignon",title:"Chopin/Novaes - Ballade, op. 47, a major",type:"welte-red"},{druid:"wq296df7434",image_url:"https://stacks.stanford.edu/image/iiif/wq296df7434%2Fwq296df7434_0001/info.json",label:"1212 Welte-Mignon",title:"Chopin/Pachmann - Prelude op. 28, no. 16, b-flat minor",type:"welte-red"},{druid:"fn111kx0654",image_url:"https://stacks.stanford.edu/image/iiif/fn111kx0654%2Ffn111kx0654_0001/info.json",label:"1213 Welte-Mignon",title:"Chopin/Pachmann - Prélude op. 28, no. 20, c-moll",type:"welte-red"},{druid:"cw078rn1143",image_url:"https://stacks.stanford.edu/image/iiif/cw078rn1143%2Fcw078rn1143_0001/info.json",label:"1220 Welte-Mignon",title:"Chopin/Pachmann - Waltz, d flat major, op. 64, no. 1",type:"welte-red"},{druid:"hc229ht1024",image_url:"https://stacks.stanford.edu/image/iiif/hc229ht1024%2Fhc229ht1024_0001/info.json",label:"1249 Welte-Mignon",title:"Chopin/Paderewski - Ballade op. 47, a flat major",type:"welte-red"},{druid:"qv334zb6243",image_url:"https://stacks.stanford.edu/image/iiif/qv334zb6243%2Fqv334zb6243_0001/info.json",label:"1254 Welte-Mignon",title:"Chopin/Paderewski - Etude e-dur, op. 10, no. 3",type:"welte-red"},{druid:"ft746ns5736",image_url:"https://stacks.stanford.edu/image/iiif/ft746ns5736%2Fft746ns5736_0001/info.json",label:"1253 Welte-Mignon",title:"Chopin/Paderewski - Etude op. 25, no. 9, g flat",type:"welte-red"},{druid:"sm246yb9650",image_url:"https://stacks.stanford.edu/image/iiif/sm246yb9650%2Fsm246yb9650_0001/info.json",label:"1256 Welte-Mignon",title:"Chopin/Paderewski - Polonaise a flat major, op. 53",type:"welte-red"},{druid:"zc614qh7060",image_url:"https://stacks.stanford.edu/image/iiif/zc614qh7060%2Fzc614qh7060_0001/info.json",label:"545 Welte-Mignon",title:"Chopin/Pugno - Grande polonaise: op. 22, es-dur",type:"welte-red"},{druid:"vm423wb2944",image_url:"https://stacks.stanford.edu/image/iiif/vm423wb2944%2Fvm423wb2944_0001/info.json",label:"548 Welte-Mignon",title:"Chopin/Pugno - Nocturn op. 15, no. 2, fis-dur",type:"welte-red"},{druid:"bj021jc9795",image_url:"https://stacks.stanford.edu/image/iiif/bj021jc9795%2Fbj021jc9795_0001/info.json",label:"328 Welte-Mignon",title:"Chopin/Reisenauer - Berceuse",type:"welte-red"},{druid:"mv259zt7103",image_url:"https://stacks.stanford.edu/image/iiif/mv259zt7103%2Fmv259zt7103_0001/info.json",label:"325 Welte-Mignon",title:"Chopin/Reisenauer - Chant polonais. (des mädchens wunsch)",type:"welte-red"},{druid:"tx963yw9164",image_url:"https://stacks.stanford.edu/image/iiif/tx963yw9164%2Ftx963yw9164_0001/info.json",label:"807 Welte-Mignon",title:"Chopin/Saint-Saëns - Nocturne f sharp, op. 15, no. 2",type:"welte-red"},{druid:"dw559kr7002",image_url:"https://stacks.stanford.edu/image/iiif/dw559kr7002%2Fdw559kr7002_0001/info.json",label:"1472 Welte-Mignon",title:"Chopin/Samaroff Stokowski - Sonata b minor. 1st and 2nd movement",type:"welte-red"},{druid:"wz252pk3255",image_url:"https://stacks.stanford.edu/image/iiif/wz252pk3255%2Fwz252pk3255_0001/info.json",label:"1473 Welte-Mignon",title:"Chopin/Samaroff Stokowski - Sonata b minor. 3rd and 4th movement",type:"welte-red"},{druid:"ch197br4742",image_url:"https://stacks.stanford.edu/image/iiif/ch197br4742%2Fch197br4742_0001/info.json",label:"881 Welte-Mignon",title:"Chopin/Sauer - Etude op. 25, no. 9: (staccato)",type:"welte-red"},{druid:"rp390kt0160",image_url:"https://stacks.stanford.edu/image/iiif/rp390kt0160%2Frp390kt0160_0001/info.json",label:"879 Welte-Mignon",title:"Chopin/Sauer - Nocturne des-dur, op. 27, no. 2",type:"welte-red"},{druid:"vy018tw5237",image_url:"https://stacks.stanford.edu/image/iiif/vy018tw5237%2Fvy018tw5237_0001/info.json",label:"245 Welte-Mignon",title:"Chopin/Scharwenka - Valse op. 42 as-dur",type:"welte-red"},{druid:"kg488qt3887",image_url:"https://stacks.stanford.edu/image/iiif/kg488qt3887%2Fkg488qt3887_0001/info.json",label:"1447 Welte-Mignon",title:"Chopin/Schelling - 2 préludes: op. 28, nr. 1, c-dur u. nr. 21, b-dur",type:"welte-red"},{druid:"pz175wg5571",image_url:"https://stacks.stanford.edu/image/iiif/pz175wg5571%2Fpz175wg5571_0001/info.json",label:"1447 Welte-Mignon",title:"Chopin/Schelling - Préludes, op. 28, no. 1, c major, op. 28, no. 21, b flat",type:"welte-red"},{druid:"st755cm2486",image_url:"https://stacks.stanford.edu/image/iiif/st755cm2486%2Fst755cm2486_0001/info.json",label:"390 Welte-Mignon",title:"Chopin/Schnabel - Etude op. 10, no. 5, ges-dur",type:"welte-red"},{druid:"ww627mg3287",image_url:"https://stacks.stanford.edu/image/iiif/ww627mg3287%2Fww627mg3287_0001/info.json",label:"1035 Welte-Mignon",title:"Chopin/Stavenhagen - Chant polonaise: ges-dur: (nach persönlichen erinnerungen)",type:"welte-red"},{druid:"kv921kh0629",image_url:"https://stacks.stanford.edu/image/iiif/kv921kh0629%2Fkv921kh0629_0001/info.json",label:"1039 Welte-Mignon",title:"Chopin/Stavenhagen - Valse op. 69, no. 1, as-dur",type:"welte-red"},{druid:"jh069yf5255",image_url:"https://stacks.stanford.edu/image/iiif/jh069yf5255%2Fjh069yf5255_0001/info.json",label:"704 Welte-Mignon",title:"Chopin/Wurmser - Waltz op. 64, no. 2, c-sharp minor",type:"welte-red"},{druid:"vy941zv8672",image_url:"https://stacks.stanford.edu/image/iiif/vy941zv8672%2Fvy941zv8672_0001/info.json",label:"470 Welte-Mignon",title:"Chopin/Zadora - Preludes. nos. 2, 4, 9, 13 and 22",type:"welte-red"},{druid:"vc943nk4921",image_url:"https://stacks.stanford.edu/image/iiif/vc943nk4921%2Fvc943nk4921_0002/info.json",label:"4319 Princesa",title:"Chueca - La alegría de la huerta: selecciones",type:"88-note"},{druid:"rh357hg0211",image_url:"https://stacks.stanford.edu/image/iiif/rh357hg0211%2Frh357hg0211_0002/info.json",label:"4301 Princesa",title:"Clará - Modern pericón",type:"88-note"},{druid:"kz454tt7354",image_url:"https://stacks.stanford.edu/image/iiif/kz454tt7354%2Fkz454tt7354_0002/info.json",label:"4629 Princesa",title:"Clará - Qué mujer, qué mujer!: vals de la revista bis bis",type:"88-note"},{druid:"cg834ff4729",image_url:"https://stacks.stanford.edu/image/iiif/cg834ff4729%2Fcg834ff4729_0001/info.json",label:"3647 Welte-Mignon",title:"Cuvillier/Heineck - Lilac domino: hesitation waltz",type:"welte-red"},{druid:"wn516xn5163",image_url:"https://stacks.stanford.edu/image/iiif/wn516xn5163%2Fwn516xn5163_0001/info.json",label:"2430 Welte-Mignon",title:"Czerny/Lhévinne - Oktavenetude: op. 740, no. 5",type:"welte-red"},{druid:"rq642tt1626",image_url:"https://stacks.stanford.edu/image/iiif/rq642tt1626%2Frq642tt1626_0001/info.json",label:"2580 Welte-Mignon",title:"D'Egville/D'Egville - A canadian rondo: a passing-fancy",type:"welte-red"},{druid:"wp666fn2104",image_url:"https://stacks.stanford.edu/image/iiif/wp666fn2104%2Fwp666fn2104_0001/info.json",label:"5537 Welte-Mignon",title:"Daly/Coach - Oh gee! oh gosh!: from stop flirting: fox-trot",type:"welte-red"},{druid:"jh696my0069",image_url:"https://stacks.stanford.edu/image/iiif/jh696my0069%2Fjh696my0069_0001/info.json",label:"1765 Welte-Mignon",title:"Debussy/Buhlig - Poissons d'or",type:"welte-red"},{druid:"dc920rk8870",image_url:"https://stacks.stanford.edu/image/iiif/dc920rk8870%2Fdc920rk8870_0001/info.json",label:"2733 Welte-Mignon",title:"Debussy/Debussy - Children's corner",type:"welte-red"},{druid:"ws250sr1272",image_url:"https://stacks.stanford.edu/image/iiif/ws250sr1272%2Fws250sr1272_0001/info.json",label:"2739 Welte-Mignon",title:"Debussy/Debussy - Preludes. le vent dans la plaine ; minstrels",type:"welte-red"},{druid:"tq268fs9721",image_url:"https://stacks.stanford.edu/image/iiif/tq268fs9721%2Ftq268fs9721_0001/info.json",label:"3045 Welte-Mignon",title:"Debussy/Ganz - Preludes. la fille aux cheveux de lin ; la puerto del vino",type:"welte-red"},{druid:"dw005gw3358",image_url:"https://stacks.stanford.edu/image/iiif/dw005gw3358%2Fdw005gw3358_0001/info.json",label:"1450 Welte-Mignon",title:"Debussy/Schelling - La soirée dane granade",type:"welte-red"},{druid:"rg591sj4242",image_url:"https://stacks.stanford.edu/image/iiif/rg591sj4242%2Frg591sj4242_0001/info.json",label:"1451 Welte-Mignon",title:"Debussy/Schelling - Toccata",type:"welte-red"},{druid:"bs533ns1949",image_url:"https://stacks.stanford.edu/image/iiif/bs533ns1949%2Fbs533ns1949_0001/info.json",label:"3398 Welte-Mignon",title:"Delibes/Blumen - Naïla: walzer",type:"welte-red"},{druid:"xn585zh2707",image_url:"https://stacks.stanford.edu/image/iiif/xn585zh2707%2Fxn585zh2707_0001/info.json",label:"2805 Welte-Mignon",title:"Delibes/Gayraud - Lakmé: fantasie i",type:"welte-red"},{druid:"fz632cv0288",image_url:"https://stacks.stanford.edu/image/iiif/fz632cv0288%2Ffz632cv0288_0001/info.json",label:"1828 Welte-Mignon",title:"Dohnányi/Mero - Rhapsody, c major, op. 11, no. 3",type:"welte-red"},{druid:"bp952tr1116",image_url:"https://stacks.stanford.edu/image/iiif/bp952tr1116%2Fbp952tr1116_0001/info.json",label:"399 Welte-Mignon",title:"Dohnányi/Weiss - Ii rhapsodie op. 11",type:"welte-red"},{druid:"hh429fw8081",image_url:"https://stacks.stanford.edu/image/iiif/hh429fw8081%2Fhh429fw8081_0001/info.json",label:"274 Welte-Mignon",title:"Droucker - Gnomenreigen",type:"welte-red"},{druid:"xy699sy1462",image_url:"https://stacks.stanford.edu/image/iiif/xy699sy1462%2Fxy699sy1462_0001/info.json",label:"1324 Welte-Mignon",title:"Dvořák/Fryer - Humoreske op. 10, no. 7",type:"welte-red"},{druid:"dy191sv5188",image_url:"https://stacks.stanford.edu/image/iiif/dy191sv5188%2Fdy191sv5188_0001/info.json",label:"2261 Welte-Mignon",title:"Epstein - Wiener walzer",type:"welte-red"},{druid:"nt812xg8796",image_url:"https://stacks.stanford.edu/image/iiif/nt812xg8796%2Fnt812xg8796_0001/info.json",label:"3567 Welte-Mignon",title:"Europe/Europe - Castle house rag: one-step",type:"welte-red"},{druid:"mv647hz9361",image_url:"https://stacks.stanford.edu/image/iiif/mv647hz9361%2Fmv647hz9361_0001/info.json",label:"5669 Welte-Mignon",title:"Fall/Black - Sergeant percy: one-step",type:"welte-red"},{druid:"qk926qc7779",image_url:"https://stacks.stanford.edu/image/iiif/qk926qc7779%2Fqk926qc7779_0001/info.json",label:"5728 Welte-Mignon",title:"Fall/Haass - Was machst du mit dem knie, lieber hans?: paso doble",type:"welte-red"},{druid:"hj604wr7502",image_url:"https://stacks.stanford.edu/image/iiif/hj604wr7502%2Fhj604wr7502_0001/info.json",label:"1526 Welte-Mignon",title:'Fall/Utz - Potpourri aus "der fidele bauer"',type:"welte-red"},{druid:"mw139zj5450",image_url:"https://stacks.stanford.edu/image/iiif/mw139zj5450%2Fmw139zj5450_0002/info.json",label:"4420 Aeolian Co.",title:"Font y de Anta - El organillo y... yo: schotish",type:"88-note"},{druid:"jt036qh8967",image_url:"https://stacks.stanford.edu/image/iiif/jt036qh8967%2Fjt036qh8967_0001/info.json",label:"3549 Welte-Mignon",title:"Foster/Merrigan - Old black joe: old folks at home: (way upon the swanee river)",type:"welte-red"},{druid:"xz373zg4809",image_url:"https://stacks.stanford.edu/image/iiif/xz373zg4809%2Fxz373zg4809_0002/info.json",label:"40.007 Princesa",title:"Franco Ribate - Gitanillo de triana: pasodoble",type:"88-note"},{druid:"vd312rr8990",image_url:"https://stacks.stanford.edu/image/iiif/vd312rr8990%2Fvd312rr8990_0001/info.json",label:"3568 Welte-Mignon",title:'Friml/Europe - Ting-a-ling-a-ling: (from "high jinks")',type:"welte-red"},{druid:"zk082zq3962",image_url:"https://stacks.stanford.edu/image/iiif/zk082zq3962%2Fzk082zq3962_0001/info.json",label:"5707 Welte-Mignon",title:'Friml/Johnson - Rose marie: fox-trot: from the musical play "rose marie"',type:"welte-red"},{druid:"kz819wb8990",image_url:"https://stacks.stanford.edu/image/iiif/kz819wb8990%2Fkz819wb8990_0001/info.json",label:"3505 Welte-Mignon",title:'Friml/Savino - Sympathy: (waltz song): from the comedy-opera "the firefly"',type:"welte-red"},{druid:"wq696jd1149",image_url:"https://stacks.stanford.edu/image/iiif/wq696jd1149%2Fwq696jd1149_0002/info.json",label:"4663 Princesa",title:"Fugazot - Barrio reo: tango",type:"88-note"},{druid:"zn339mg3395",image_url:"https://stacks.stanford.edu/image/iiif/zn339mg3395%2Fzn339mg3395_0001/info.json",label:"297 Welte-Mignon",title:"Gabrilowitsch/Gabrilowitsch - Caprice-burlesque op. 3",type:"welte-red"},{druid:"rv703vf3503",image_url:"https://stacks.stanford.edu/image/iiif/rv703vf3503%2Frv703vf3503_0001/info.json",label:"3042 Welte-Mignon",title:"Ganz - Song of the boatmen of the volga =: (schifferlied auf der wolga)",type:"welte-red"},{druid:"dk418xy4378",image_url:"https://stacks.stanford.edu/image/iiif/dk418xy4378%2Fdk418xy4378_0002/info.json",label:"4668 Princesa",title:"García Ibáñez - Félix rodríguez. pasodoble flamenco",type:"88-note"},{druid:"qd424rx3516",image_url:"https://stacks.stanford.edu/image/iiif/qd424rx3516%2Fqd424rx3516_0001/info.json",label:"3671 Welte-Mignon",title:"German/La Forge - Three dances from henry viii",type:"welte-red"},{druid:"ry050yb9492",image_url:"https://stacks.stanford.edu/image/iiif/ry050yb9492%2Fry050yb9492_0001/info.json",label:"2525 Welte-Mignon",title:"Gilbert/Ebenstein - Die keusche susanna: potpourri",type:"welte-red"},{druid:"zm791gz4425",image_url:"https://stacks.stanford.edu/image/iiif/zm791gz4425%2Fzm791gz4425_0002/info.json",label:"4490 Princesa",title:"Giménez - El barbero de sevilla: selecciones: zarzuela española",type:"88-note"},{druid:"qd454gb9111",image_url:"https://stacks.stanford.edu/image/iiif/qd454gb9111%2Fqd454gb9111_0002/info.json",label:"4514 Princesa",title:"Giménez - La tempranica: selecciones",type:"88-note"},{druid:"nz678zw1579",image_url:"https://stacks.stanford.edu/image/iiif/nz678zw1579%2Fnz678zw1579_0001/info.json",label:"1939 Welte-Mignon",title:"Glazunov/Glazunov - 1. sonata op. 74, b flat. 2nd movement, andante",type:"welte-red"},{druid:"dq276yn8963",image_url:"https://stacks.stanford.edu/image/iiif/dq276yn8963%2Fdq276yn8963_0001/info.json",label:"1945 Welte-Mignon",title:"Glazunov/Glazunov - Les saisons, ballet",type:"welte-red"},{druid:"vs880hb3425",image_url:"https://stacks.stanford.edu/image/iiif/vs880hb3425%2Fvs880hb3425_0001/info.json",label:"1942 Welte-Mignon",title:"Glazunov/Glazunov - Raymonda",type:"welte-red"},{druid:"kx293yk2859",image_url:"https://stacks.stanford.edu/image/iiif/kx293yk2859%2Fkx293yk2859_0001/info.json",label:"1996 Welte-Mignon",title:"Glazunov/Hoffmann - Theme and variations, f sharp minor",type:"welte-red"},{druid:"kq892pn7618",image_url:"https://stacks.stanford.edu/image/iiif/kq892pn7618%2Fkq892pn7618_0001/info.json",label:"1968 Welte-Mignon",title:"Glazunov/Kimontt-Jacynowa - Grand valse de concert: op. 41",type:"welte-red"},{druid:"fn744pq2157",image_url:"https://stacks.stanford.edu/image/iiif/fn744pq2157%2Ffn744pq2157_0001/info.json",label:"1990 Welte-Mignon",title:"Glazunov/Lemba - Grande valse de concert: op. 47, d major",type:"welte-red"},{druid:"xb072rc7617",image_url:"https://stacks.stanford.edu/image/iiif/xb072rc7617%2Fxb072rc7617_0001/info.json",label:"4028 Welte-Mignon",title:"Gomes/Haass - Il guarany: fantasie",type:"welte-red"},{druid:"jy277ht0636",image_url:"https://stacks.stanford.edu/image/iiif/jy277ht0636%2Fjy277ht0636_0001/info.json",label:"1819 Welte-Mignon",title:"Gottschalk/Utz - The last hope: (meditation réligieuse)",type:"welte-red"},{druid:"hm373bm3807",image_url:"https://stacks.stanford.edu/image/iiif/hm373bm3807%2Fhm373bm3807_0001/info.json",label:"57 Welte-Mignon",title:"Gounod/Adam-Benard - Faust prelude",type:"welte-red"},{druid:"py987gg6088",image_url:"https://stacks.stanford.edu/image/iiif/py987gg6088%2Fpy987gg6088_0001/info.json",label:"57 Welte-Mignon",title:"Gounod/Adam-Benard - Faust prelude",type:"welte-red"},{druid:"hr679fk5315",image_url:"https://stacks.stanford.edu/image/iiif/hr679fk5315%2Fhr679fk5315_0001/info.json",label:"2172 Welte-Mignon",title:"Gounod/Adam-Benard - Nazareth: sacred song",type:"welte-red"},{druid:"rg931dy5023",image_url:"https://stacks.stanford.edu/image/iiif/rg931dy5023%2Frg931dy5023_0001/info.json",label:"2944 Welte-Mignon",title:"Gounod/Cor de Las - Faust reminiscenzen a. d. iii. und iv. akt",type:"welte-red"},{druid:"sj582bt2976",image_url:"https://stacks.stanford.edu/image/iiif/sj582bt2976%2Fsj582bt2976_0001/info.json",label:"2799 Welte-Mignon",title:"Gounod/Gayraud - Faust: selection i",type:"welte-red"},{druid:"nw765mr4994",image_url:"https://stacks.stanford.edu/image/iiif/nw765mr4994%2Fnw765mr4994_0001/info.json",label:"3790 Welte-Mignon",title:'Grainger/Haass - British folkmusic. settings nr. 4, "shepherd\'s hey"',type:"welte-red"},{druid:"qv976bq3639",image_url:"https://stacks.stanford.edu/image/iiif/qv976bq3639%2Fqv976bq3639_0001/info.json",label:"3791 Welte-Mignon",title:"Grainger/Haass - British folkmusic. settings nr. 6, irish tune from county derry",type:"welte-red"},{druid:"jw822wm2644",image_url:"https://stacks.stanford.edu/image/iiif/jw822wm2644%2Fjw822wm2644_0001/info.json",label:"1275 Welte-Mignon",title:"Grieg/Grieg - Butterfly: op. 43, no. 1",type:"welte-red"},{druid:"mh255vw4599",image_url:"https://stacks.stanford.edu/image/iiif/mh255vw4599%2Fmh255vw4599_0001/info.json",label:"1276 Welte-Mignon",title:"Grieg/Grieg - Norwegischer brautzug im vorüberziehen",type:"welte-red"},{druid:"zf882fv0052",image_url:"https://stacks.stanford.edu/image/iiif/zf882fv0052%2Fzf882fv0052_0001/info.json",label:"1277 Welte-Mignon",title:"Grieg/Grieg - Vögelein a. lyrische stücke, op. 43",type:"welte-red"},{druid:"kj344bw3083",image_url:"https://stacks.stanford.edu/image/iiif/kj344bw3083%2Fkj344bw3083_0001/info.json",label:"1307 Welte-Mignon",title:"Grieg/Pugno - An den frühling: op. 43, no. 1: (lyrische stücke)",type:"welte-red"},{druid:"yr522jf5585",image_url:"https://stacks.stanford.edu/image/iiif/yr522jf5585%2Fyr522jf5585_0001/info.json",label:"1478 Welte-Mignon",title:"Grieg/Samaroff Stokowski - Concerto a minor, op. 16",type:"welte-red"},{druid:"ym773gh2267",image_url:"https://stacks.stanford.edu/image/iiif/ym773gh2267%2Fym773gh2267_0001/info.json",label:"1478 Welte-Mignon",title:"Grieg/Samaroff Stokowski - Concerto a minor. 1st movement",type:"welte-red"},{druid:"bf644yy6536",image_url:"https://stacks.stanford.edu/image/iiif/bf644yy6536%2Fbf644yy6536_0001/info.json",label:"1480 Welte-Mignon",title:"Grieg/Samaroff Stokowski - Peer gynt suite ii",type:"welte-red"},{druid:"vz717bq6543",image_url:"https://stacks.stanford.edu/image/iiif/vz717bq6543%2Fvz717bq6543_0001/info.json",label:"1480 Welte-Mignon",title:"Grieg/Samaroff Stokowski - Peer gynt suite. no. 1",type:"welte-red"},{druid:"hk155fw7898",image_url:"https://stacks.stanford.edu/image/iiif/hk155fw7898%2Fhk155fw7898_0001/info.json",label:"1005 Welte-Mignon",title:"Grieg/Stebel - Schmetterling",type:"welte-red"},{druid:"hs635sh6729",image_url:"https://stacks.stanford.edu/image/iiif/hs635sh6729%2Fhs635sh6729_0001/info.json",label:"378 Welte-Mignon",title:"Grieg/Wendling - Hochzeitstag auf troldhangen op. 65 no. 1",type:"welte-red"},{druid:"km927sd2616",image_url:"https://stacks.stanford.edu/image/iiif/km927sd2616%2Fkm927sd2616_0002/info.json",label:"4323 Caecilia",title:"Guerrero - Don quintín el amargao. java",type:"88-note"},{druid:"gn803sk7089",image_url:"https://stacks.stanford.edu/image/iiif/gn803sk7089%2Fgn803sk7089_0002/info.json",label:"4504 Princesa",title:"Guerrero - El huésped del sevillano. lagarteranas",type:"88-note"},{druid:"vk572hg6636",image_url:"https://stacks.stanford.edu/image/iiif/vk572hg6636%2Fvk572hg6636_0002/info.json",label:"4540 Princesa",title:"Guerrero - El sobre verde. bombones de chocolate",type:"88-note"},{druid:"hx789sg2918",image_url:"https://stacks.stanford.edu/image/iiif/hx789sg2918%2Fhx789sg2918_0001/info.json",label:"3376 Welte-Mignon",title:"Halévy/Berend - Die jüdin",type:"welte-red"},{druid:"sw740gd4329",image_url:"https://stacks.stanford.edu/image/iiif/sw740gd4329%2Fsw740gd4329_0001/info.json",label:"76 Welte-Mignon",title:"Handel/Adam-Benard - Largo",type:"welte-red"},{druid:"hx184ww0780",image_url:"https://stacks.stanford.edu/image/iiif/hx184ww0780%2Fhx184ww0780_0001/info.json",label:"10 Welte-Mignon",title:"Handel/Adam-Benard - The harmonius blacksmith: e major, 5th suite = le forgeron harmonieux",type:"welte-red"},{druid:"cw965qx3168",image_url:"https://stacks.stanford.edu/image/iiif/cw965qx3168%2Fcw965qx3168_0001/info.json",label:"5661 Welte-Mignon",title:"Henderson/Johnson - Follow the swallow: fox-trot",type:"welte-red"},{druid:"fb623cd1247",image_url:"https://stacks.stanford.edu/image/iiif/fb623cd1247%2Ffb623cd1247_0001/info.json",label:"1654 Welte-Mignon",title:"Henselt/Cory - Si oiseau j'étais",type:"welte-red"},{druid:"sc787kg5664",image_url:"https://stacks.stanford.edu/image/iiif/sc787kg5664%2Fsc787kg5664_0001/info.json",label:"1654 Welte-Mignon",title:"Henselt/Cory - Si oiseau j'étais",type:"welte-red"},{druid:"kr645mg0298",image_url:"https://stacks.stanford.edu/image/iiif/kr645mg0298%2Fkr645mg0298_0001/info.json",label:"1405 Welte-Mignon",title:"Holzmann/Orlando - Love land",type:"welte-red"},{druid:"sb388kg1678",image_url:"https://stacks.stanford.edu/image/iiif/sb388kg1678%2Fsb388kg1678_0002/info.json",label:"40019 Princesa",title:"Hoyos - El carrerito: tango argentino",type:"88-note"},{druid:"rt308hy9235",image_url:"https://stacks.stanford.edu/image/iiif/rt308hy9235%2Frt308hy9235_0001/info.json",label:"646 Welte-Mignon",title:"Humperdinck/Humperdinck - Traumscene a. hänsel und gretel",type:"welte-red"},{druid:"fb100cb2366",image_url:"https://stacks.stanford.edu/image/iiif/fb100cb2366%2Ffb100cb2366_0001/info.json",label:"2948 Welte-Mignon",title:'Humperdinck/Sommer - Selections from "hansel & gretel"',type:"welte-red"},{druid:"zy618kz1670",image_url:"https://stacks.stanford.edu/image/iiif/zy618kz1670%2Fzy618kz1670_0002/info.json",label:"4677 Victoria",title:"Joyce - Remembrance",type:"88-note"},{druid:"fr859hh7893",image_url:"https://stacks.stanford.edu/image/iiif/fr859hh7893%2Ffr859hh7893_0001/info.json",label:"3524 Welte-Mignon",title:"Joyce/Dyck - Dreaming: waltz",type:"welte-red"},{druid:"mr400mf6531",image_url:"https://stacks.stanford.edu/image/iiif/mr400mf6531%2Fmr400mf6531_0001/info.json",label:"5662 Welte-Mignon",title:"Keefer/Johnson - Dream daddy: fox-trot",type:"welte-red"},{druid:"gm296rz0673",image_url:"https://stacks.stanford.edu/image/iiif/gm296rz0673%2Fgm296rz0673_0001/info.json",label:"3055 Welte-Mignon",title:"Korngold/Ganz - Sonate e-dur, op. 2, no. 2. i. und ii. satz",type:"welte-red"},{druid:"rb861vm6094",image_url:"https://stacks.stanford.edu/image/iiif/rb861vm6094%2Frb861vm6094_0001/info.json",label:"3056 Welte-Mignon",title:"Korngold/Ganz - Sonate e-dur, op. 2, no. 2. iii. und iv. satz",type:"welte-red"},{druid:"ct503bz7189",image_url:"https://stacks.stanford.edu/image/iiif/ct503bz7189%2Fct503bz7189_0001/info.json",label:"3842 Welte-Mignon",title:"Korngold/Heinemann - Märchenbilder. 5-7",type:"welte-red"},{druid:"xh403hj3866",image_url:"https://stacks.stanford.edu/image/iiif/xh403hj3866%2Fxh403hj3866_0001/info.json",label:"384 Welte-Mignon",title:"Kreisler/Schnabel - Old vienna waltzes",type:"welte-red"},{druid:"ft113cg5195",image_url:"https://stacks.stanford.edu/image/iiif/ft113cg5195%2Fft113cg5195_0001/info.json",label:"2810 Welte-Mignon",title:"Lecocq/Gayraud - La fille de madame angot: (fantasie mosaïque)",type:"welte-red"},{druid:"pc364sy7115",image_url:"https://stacks.stanford.edu/image/iiif/pc364sy7115%2Fpc364sy7115_0001/info.json",label:"2609 Welte-Mignon",title:"Lehár/Goodall - Graf von luxemburg: selektion i",type:"welte-red"},{druid:"wj488tq5861",image_url:"https://stacks.stanford.edu/image/iiif/wj488tq5861%2Fwj488tq5861_0001/info.json",label:"1338 Welte-Mignon",title:"Lehár/Starke - Die lustige witwe: ii. potpourri",type:"welte-red"},{druid:"jg699wz4435",image_url:"https://stacks.stanford.edu/image/iiif/jg699wz4435%2Fjg699wz4435_0001/info.json",label:"106 Welte-Mignon",title:"Leoncavallo/Adam-Benard - Prolog a. bajazzo",type:"welte-red"},{druid:"zw751nw0097",image_url:"https://stacks.stanford.edu/image/iiif/zw751nw0097%2Fzw751nw0097_0001/info.json",label:"1023 Welte-Mignon",title:'Leoncavallo/Leoncavallo - Valse de musette: a. ii. act "die bohème"',type:"welte-red"},{druid:"ts972sy8288",image_url:"https://stacks.stanford.edu/image/iiif/ts972sy8288%2Fts972sy8288_0001/info.json",label:"1196 Welte-Mignon",title:"Leschetizky/Leschetizky - Barcarolle op. 39, no. 1",type:"welte-red"},{druid:"ws749sk4778",image_url:"https://stacks.stanford.edu/image/iiif/ws749sk4778%2Fws749sk4778_0001/info.json",label:"1203 Welte-Mignon",title:"Leschetizky/Leschetizky - The two larks",type:"welte-red"},{druid:"xk500gs5691",image_url:"https://stacks.stanford.edu/image/iiif/xk500gs5691%2Fxk500gs5691_0001/info.json",label:"337 Welte-Mignon",title:"Lincke/Kupfernagel - Berliner luft: marsch",type:"welte-red"},{druid:"fw547rc7021",image_url:"https://stacks.stanford.edu/image/iiif/fw547rc7021%2Ffw547rc7021_0001/info.json",label:"1396 Welte-Mignon",title:'Lincke/Orlando - Luna-walzer: a. d. operette "frau luna"',type:"welte-red"},{druid:"xq762nt7491",image_url:"https://stacks.stanford.edu/image/iiif/xq762nt7491%2Fxq762nt7491_0001/info.json",label:"26 Welte-Mignon",title:"Liszt/Adam-Benard - Faust-walzer",type:"welte-red"},{druid:"vs059bb4318",image_url:"https://stacks.stanford.edu/image/iiif/vs059bb4318%2Fvs059bb4318_0001/info.json",label:"104 Welte-Mignon",title:"Liszt/Adam-Benard - Nocturne no. 2",type:"welte-red"},{druid:"gg920pz0818",image_url:"https://stacks.stanford.edu/image/iiif/gg920pz0818%2Fgg920pz0818_0001/info.json",label:"415 Welte-Mignon",title:"Liszt/Albert - Loves dream",type:"welte-red"},{druid:"ky445sz4630",image_url:"https://stacks.stanford.edu/image/iiif/ky445sz4630%2Fky445sz4630_0001/info.json",label:"412 Welte-Mignon",title:"Liszt/Albert - Soirée de vienne. i [i.e., 2]",type:"welte-red"},{druid:"yj598pj2879",image_url:"https://stacks.stanford.edu/image/iiif/yj598pj2879%2Fyj598pj2879_0001/info.json",label:"412 Welte-Mignon",title:"Liszt/Albert - Soirée de vienne. i [i.e., 2]",type:"welte-red"},{druid:"vy193qr6005",image_url:"https://stacks.stanford.edu/image/iiif/vy193qr6005%2Fvy193qr6005_0001/info.json",label:"2988 Welte-Mignon",title:"Liszt/Albert - Sonata b minor, 2nd part",type:"welte-red"},{druid:"gy310qs3678",image_url:"https://stacks.stanford.edu/image/iiif/gy310qs3678%2Fgy310qs3678_0001/info.json",label:"2987 Welte-Mignon",title:"Liszt/Albert - Sonata b minor, part 1",type:"welte-red"},{druid:"kv550vj8954",image_url:"https://stacks.stanford.edu/image/iiif/kv550vj8954%2Fkv550vj8954_0001/info.json",label:"444 Welte-Mignon",title:"Liszt/Busoni - La campanella: paganini etude no. 3",type:"welte-red"},{druid:"tp302mb4101",image_url:"https://stacks.stanford.edu/image/iiif/tp302mb4101%2Ftp302mb4101_0001/info.json",label:"1321 Welte-Mignon",title:"Liszt/Busoni - Norma: fantasie",type:"welte-red"},{druid:"mf443ns5829",image_url:"https://stacks.stanford.edu/image/iiif/mf443ns5829%2Fmf443ns5829_0001/info.json",label:"445 Welte-Mignon",title:"Liszt/Busoni - Rigoletto: (paraphrase)",type:"welte-red"},{druid:"yx536mq2915",image_url:"https://stacks.stanford.edu/image/iiif/yx536mq2915%2Fyx536mq2915_0001/info.json",label:"365 Welte-Mignon",title:"Liszt/Carreño - 6th hungarian rhapsody",type:"welte-red"},{druid:"yc867qr9425",image_url:"https://stacks.stanford.edu/image/iiif/yc867qr9425%2Fyc867qr9425_0001/info.json",label:"2456 Welte-Mignon",title:"Liszt/Danziger - Gondoliera from venezia e napoli",type:"welte-red"},{druid:"bg098gg3899",image_url:"https://stacks.stanford.edu/image/iiif/bg098gg3899%2Fbg098gg3899_0001/info.json",label:"494 Welte-Mignon",title:"Liszt/Dohnányi - 13th rhapsody",type:"welte-red"},{druid:"dp563zh2166",image_url:"https://stacks.stanford.edu/image/iiif/dp563zh2166%2Fdp563zh2166_0001/info.json",label:"492 Welte-Mignon",title:"Liszt/Dohnányi - Rakoczy-marsch",type:"welte-red"},{druid:"hn488rk0690",image_url:"https://stacks.stanford.edu/image/iiif/hn488rk0690%2Fhn488rk0690_0001/info.json",label:"496 Welte-Mignon",title:"Liszt/Dohnányi - Soiree de vienne, no. 4",type:"welte-red"},{druid:"tb707nd8515",image_url:"https://stacks.stanford.edu/image/iiif/tb707nd8515%2Ftb707nd8515_0001/info.json",label:"993 Welte-Mignon",title:"Liszt/Elvyn - Widmung",type:"welte-red"},{druid:"mx460bt7026",image_url:"https://stacks.stanford.edu/image/iiif/mx460bt7026%2Fmx460bt7026_0001/info.json",label:"198 Welte-Mignon",title:"Liszt/Friedheim - Xii rhapsodie",type:"welte-red"},{druid:"ch401rm7382",image_url:"https://stacks.stanford.edu/image/iiif/ch401rm7382%2Fch401rm7382_0001/info.json",label:"3058 Welte-Mignon",title:"Liszt/Ganz - Mignon's lied",type:"welte-red"},{druid:"jf649gs2184",image_url:"https://stacks.stanford.edu/image/iiif/jf649gs2184%2Fjf649gs2184_0001/info.json",label:"936 Welte-Mignon",title:"Liszt/Hambourg - Polonaise e major",type:"welte-red"},{druid:"cv806rf2664",image_url:"https://stacks.stanford.edu/image/iiif/cv806rf2664%2Fcv806rf2664_0001/info.json",label:"3410 Welte-Mignon",title:"Liszt/Kwast-Hodapp - Wilde jagd: etude",type:"welte-red"},{druid:"rb625rv7300",image_url:"https://stacks.stanford.edu/image/iiif/rb625rv7300%2Frb625rv7300_0001/info.json",label:"569 Welte-Mignon",title:"Liszt/Lamond - Etude no. 3, des-dur",type:"welte-red"},{druid:"kz379jn2491",image_url:"https://stacks.stanford.edu/image/iiif/kz379jn2491%2Fkz379jn2491_0001/info.json",label:"570 Welte-Mignon",title:"Liszt/Lamond - Liebestraum",type:"welte-red"},{druid:"ng103jj1150",image_url:"https://stacks.stanford.edu/image/iiif/ng103jj1150%2Fng103jj1150_0001/info.json",label:"570 Welte-Mignon",title:"Liszt/Lamond - Liebestraum: nocturn no. 3",type:"welte-red"},{druid:"dw083wh0675",image_url:"https://stacks.stanford.edu/image/iiif/dw083wh0675%2Fdw083wh0675_0001/info.json",label:"1302 Welte-Mignon",title:"Liszt/Lhévinne - Loreley",type:"welte-red"},{druid:"jg717nb8731",image_url:"https://stacks.stanford.edu/image/iiif/jg717nb8731%2Fjg717nb8731_0001/info.json",label:"2703 Welte-Mignon",title:"Liszt/Lohr - Ii. ungarische rhapsodie: mit cadenz von prof. h. vetter",type:"welte-red"},{druid:"jy572md2211",image_url:"https://stacks.stanford.edu/image/iiif/jy572md2211%2Fjy572md2211_0001/info.json",label:"3333 Welte-Mignon",title:"Liszt/Lászlò - Piano-concert e major. 1st movement",type:"welte-red"},{druid:"zk440mh1715",image_url:"https://stacks.stanford.edu/image/iiif/zk440mh1715%2Fzk440mh1715_0001/info.json",label:"757 Welte-Mignon",title:"Liszt/Mero - 2nd hungarian rhapsody",type:"welte-red"},{druid:"hg174cq6672",image_url:"https://stacks.stanford.edu/image/iiif/hg174cq6672%2Fhg174cq6672_0001/info.json",label:"757 Welte-Mignon",title:"Liszt/Mero - Ii. ungarische rhapsodie",type:"welte-red"},{druid:"cz847th6835",image_url:"https://stacks.stanford.edu/image/iiif/cz847th6835%2Fcz847th6835_0001/info.json",label:"1112 Welte-Mignon",title:"Liszt/Ney - Viii. rhapsodie",type:"welte-red"},{druid:"wp442mf3514",image_url:"https://stacks.stanford.edu/image/iiif/wp442mf3514%2Fwp442mf3514_0001/info.json",label:"1216 Welte-Mignon",title:"Liszt/Pachmann - Etude de concert: no. 2, f-moll",type:"welte-red"},{druid:"zv884mc0794",image_url:"https://stacks.stanford.edu/image/iiif/zv884mc0794%2Fzv884mc0794_0001/info.json",label:"1259 Welte-Mignon",title:"Liszt/Paderewski - 10th hungarian rhapsody",type:"welte-red"},{druid:"qg121rz6125",image_url:"https://stacks.stanford.edu/image/iiif/qg121rz6125%2Fqg121rz6125_0001/info.json",label:"1259 Welte-Mignon",title:"Liszt/Paderewski - X. rhapsodie",type:"welte-red"},{druid:"gz430tm0196",image_url:"https://stacks.stanford.edu/image/iiif/gz430tm0196%2Fgz430tm0196_0001/info.json",label:"844 Welte-Mignon",title:"Liszt/Pauer - Harmonie du soir",type:"welte-red"},{druid:"fd761bx2206",image_url:"https://stacks.stanford.edu/image/iiif/fd761bx2206%2Ffd761bx2206_0001/info.json",label:"518 Welte-Mignon",title:"Liszt/Petri - Années de pélerinage, iii, no. 4: les jeux d'eaux de la villa d'este",type:"welte-red"},{druid:"qq914np5449",image_url:"https://stacks.stanford.edu/image/iiif/qq914np5449%2Fqq914np5449_0001/info.json",label:"324 Welte-Mignon",title:"Liszt/Reisenauer - X ung. rhapsodie",type:"welte-red"},{druid:"zw755dp8285",image_url:"https://stacks.stanford.edu/image/iiif/zw755dp8285%2Fzw755dp8285_0001/info.json",label:"483 Welte-Mignon",title:"Liszt/Ripper - Faust-walzer",type:"welte-red"},{druid:"fv104hn7521",image_url:"https://stacks.stanford.edu/image/iiif/fv104hn7521%2Ffv104hn7521_0001/info.json",label:"304 Welte-Mignon",title:"Liszt/Rössel - V. hungarian rhapsody: (heroide elegique)",type:"welte-red"},{druid:"ns598kr8616",image_url:"https://stacks.stanford.edu/image/iiif/ns598kr8616%2Fns598kr8616_0001/info.json",label:"1474 Welte-Mignon",title:"Liszt/Samaroff Stokowski - Tannhauser march",type:"welte-red"},{druid:"fj448by1666",image_url:"https://stacks.stanford.edu/image/iiif/fj448by1666%2Ffj448by1666_0001/info.json",label:"1474 Welte-Mignon",title:"Liszt/Samaroff Stokowski - Tannhäuser-marsch",type:"welte-red"},{druid:"rq927dq9061",image_url:"https://stacks.stanford.edu/image/iiif/rq927dq9061%2Frq927dq9061_0001/info.json",label:"951 Welte-Mignon",title:'Liszt/Sapellnikoff - Nocturne. no. 1, "hohe liebe"',type:"welte-red"},{druid:"hm523dq5554",image_url:"https://stacks.stanford.edu/image/iiif/hm523dq5554%2Fhm523dq5554_0001/info.json",label:"876 Welte-Mignon",title:"Liszt/Sauer - Don juan: fantasie",type:"welte-red"},{druid:"yt837kd6607",image_url:"https://stacks.stanford.edu/image/iiif/yt837kd6607%2Fyt837kd6607_0001/info.json",label:"244 Welte-Mignon",title:"Liszt/Scharwenka - Ricordanza",type:"welte-red"},{druid:"ny706rg1119",image_url:"https://stacks.stanford.edu/image/iiif/ny706rg1119%2Fny706rg1119_0001/info.json",label:"895 Welte-Mignon",title:"Liszt/Schnitzer - Ix. rhapsodie",type:"welte-red"},{druid:"st011pr3757",image_url:"https://stacks.stanford.edu/image/iiif/st011pr3757%2Fst011pr3757_0001/info.json",label:"738 Welte-Mignon",title:"Liszt/Schumann - Waldesrauschen: 1st concert étude",type:"welte-red"},{druid:"bx815rz0622",image_url:"https://stacks.stanford.edu/image/iiif/bx815rz0622%2Fbx815rz0622_0001/info.json",label:"1033 Welte-Mignon",title:"Liszt/Stavenhagen - 12th hungarian rhapsody: (as played by liszt)",type:"welte-red"},{druid:"ry948sf9078",image_url:"https://stacks.stanford.edu/image/iiif/ry948sf9078%2Fry948sf9078_0001/info.json",label:"1032 Welte-Mignon",title:"Liszt/Stavenhagen - Ii. legende. der hl. franziskus über die wogen schreitend",type:"welte-red"},{druid:"hg282mg9396",image_url:"https://stacks.stanford.edu/image/iiif/hg282mg9396%2Fhg282mg9396_0001/info.json",label:"1033 Welte-Mignon",title:"Liszt/Stavenhagen - Xii. ungar. rapsodie: (nach persönlicher erinnerung an liszt = (played by as liszt)",type:"welte-red"},{druid:"np829dt9039",image_url:"https://stacks.stanford.edu/image/iiif/np829dt9039%2Fnp829dt9039_0001/info.json",label:"1386 Welte-Mignon",title:"Liszt/Timanoff - I. ungarische rhapsodie",type:"welte-red"},{druid:"sr504pc8797",image_url:"https://stacks.stanford.edu/image/iiif/sr504pc8797%2Fsr504pc8797_0001/info.json",label:"376 Welte-Mignon",title:"Liszt/Wendling - Lohengrin. elsa's bridal procession",type:"welte-red"},{druid:"gx118hr0306",image_url:"https://stacks.stanford.edu/image/iiif/gx118hr0306%2Fgx118hr0306_0001/info.json",label:"1957 Welte-Mignon",title:"Li͡apunov/Drozdov - Carillon",type:"welte-red"},{druid:"gv741wj6162",image_url:"https://stacks.stanford.edu/image/iiif/gv741wj6162%2Fgv741wj6162_0002/info.json",label:"4478 Princesa",title:"Lope - Gallito: paso doble flamenco",type:"88-note"},{druid:"gx107hd3026",image_url:"https://stacks.stanford.edu/image/iiif/gx107hd3026%2Fgx107hd3026_0001/info.json",label:"3316 Welte-Mignon",title:"Lászlò - 8th symphony b minor. 2nd movement: andante con motto (unfinished)",type:"welte-red"},{druid:"xy812vy7103",image_url:"https://stacks.stanford.edu/image/iiif/xy812vy7103%2Fxy812vy7103_0001/info.json",label:"3681 Welte-Mignon",title:"MacDowell/Cone - An old love story: op. 61, no. 1",type:"welte-red"},{druid:"fk269mx8427",image_url:"https://stacks.stanford.edu/image/iiif/fk269mx8427%2Ffk269mx8427_0001/info.json",label:"2998 Welte-Mignon",title:"MacDowell/Winogradoff-Gorges - Polonaise e minor, op. 46, no. 12",type:"welte-red"},{druid:"dp497dz1055",image_url:"https://stacks.stanford.edu/image/iiif/dp497dz1055%2Fdp497dz1055_0001/info.json",label:"469 Welte-Mignon",title:"MacDowell/Zadora - Hexentanz: op. 17, no. 2",type:"welte-red"},{druid:"md908xy8241",image_url:"https://stacks.stanford.edu/image/iiif/md908xy8241%2Fmd908xy8241_0001/info.json",label:"5551 Welte-Mignon",title:"Malderen/Schrempp - Tango du rêve: (traum tango)",type:"welte-red"},{druid:"qh464nj1973",image_url:"https://stacks.stanford.edu/image/iiif/qh464nj1973%2Fqh464nj1973_0002/info.json",label:"4671 Princesa",title:"Marquina - Ecos españoles: pasodoble",type:"88-note"},{druid:"jp202jq5812",image_url:"https://stacks.stanford.edu/image/iiif/jp202jq5812%2Fjp202jq5812_0002/info.json",label:"1606 Caecilia",title:"Martínez Valls - Serenata poética, en forma de fox trot",type:"88-note"},{druid:"ps751km7125",image_url:"https://stacks.stanford.edu/image/iiif/ps751km7125%2Fps751km7125_0001/info.json",label:"814 Welte-Mignon",title:"Marx-Goldschmidt/Marx-Goldschmidt - Rhapsodie hongroise: nach sarasates zigeunerweisen",type:"welte-red"},{druid:"vm351pv9656",image_url:"https://stacks.stanford.edu/image/iiif/vm351pv9656%2Fvm351pv9656_0001/info.json",label:"253 Welte-Mignon",title:"Mascagni/Zscherneck - Intermezzo aus cavalleria rusticana",type:"welte-red"},{druid:"jd052zg1047",image_url:"https://stacks.stanford.edu/image/iiif/jd052zg1047%2Fjd052zg1047_0001/info.json",label:"2685 Welte-Mignon",title:"Mason/Adam - Nearer my god to thee",type:"welte-red"},{druid:"fm197wc9522",image_url:"https://stacks.stanford.edu/image/iiif/fm197wc9522%2Ffm197wc9522_0001/info.json",label:"2908 Welte-Mignon",title:"Massenet/Epstein - Manon: selection",type:"welte-red"},{druid:"rs765sm2000",image_url:"https://stacks.stanford.edu/image/iiif/rs765sm2000%2Frs765sm2000_0001/info.json",label:"2822 Welte-Mignon",title:"Massenet/Gayraud - Thaïs: fantasia mosaïc",type:"welte-red"},{druid:"zr938kz3902",image_url:"https://stacks.stanford.edu/image/iiif/zr938kz3902%2Fzr938kz3902_0001/info.json",label:"2823 Welte-Mignon",title:"Massenet/Gayraud - Werther: fantasia, part i",type:"welte-red"},{druid:"nz852nk6103",image_url:"https://stacks.stanford.edu/image/iiif/nz852nk6103%2Fnz852nk6103_0001/info.json",label:"2556 Welte-Mignon",title:"Massenet/Paur - Thais, meditation",type:"welte-red"},{druid:"xn796bh4368",image_url:"https://stacks.stanford.edu/image/iiif/xn796bh4368%2Fxn796bh4368_0001/info.json",label:"216 Welte-Mignon",title:"Mendelssohn-Bartholdy/Adam-Benard - Lied ohne worte. moderato, no. 4",type:"welte-red"},{druid:"mx599qs6329",image_url:"https://stacks.stanford.edu/image/iiif/mx599qs6329%2Fmx599qs6329_0001/info.json",label:"40 Welte-Mignon",title:"Mendelssohn-Bartholdy/Adam-Benard - Lied ohne worte. volkslied, no. 23",type:"welte-red"},{druid:"jk702cg2022",image_url:"https://stacks.stanford.edu/image/iiif/jk702cg2022%2Fjk702cg2022_0001/info.json",label:"1466 Welte-Mignon",title:"Mendelssohn-Bartholdy/Bloomfield-Zeisler - Frühlingslied",type:"welte-red"},{druid:"cw427tw4145",image_url:"https://stacks.stanford.edu/image/iiif/cw427tw4145%2Fcw427tw4145_0001/info.json",label:"2000 Welte-Mignon",title:"Mendelssohn-Bartholdy/Goraïnoff - Rondo capriccioso",type:"welte-red"},{druid:"cd381jt9273",image_url:"https://stacks.stanford.edu/image/iiif/cd381jt9273%2Fcd381jt9273_0001/info.json",label:"3172 Welte-Mignon",title:"Mendelssohn-Bartholdy/Kiek - 3th symphony. allegro vivacissimo",type:"welte-red"},{druid:"bd915bs0646",image_url:"https://stacks.stanford.edu/image/iiif/bd915bs0646%2Fbd915bs0646_0001/info.json",label:"3162 Welte-Mignon",title:"Mendelssohn-Bartholdy/Kiek - Capriccio brilliante b major",type:"welte-red"},{druid:"zv706jf8277",image_url:"https://stacks.stanford.edu/image/iiif/zv706jf8277%2Fzv706jf8277_0001/info.json",label:"458 Welte-Mignon",title:"Mendelssohn-Bartholdy/Kleeberg - Duetto: (song without words): a flat major",type:"welte-red"},{druid:"ym420hv4366",image_url:"https://stacks.stanford.edu/image/iiif/ym420hv4366%2Fym420hv4366_0001/info.json",label:"231 Welte-Mignon",title:"Mendelssohn-Bartholdy/Möhle - Lied ohne worte, op. 62, [no. 4], no. 28",type:"welte-red"},{druid:"xp003dy0437",image_url:"https://stacks.stanford.edu/image/iiif/xp003dy0437%2Fxp003dy0437_0001/info.json",label:"882 Welte-Mignon",title:"Mendelssohn-Bartholdy/Sauer - Auf flügeln des gesangs",type:"welte-red"},{druid:"mz508vq7890",image_url:"https://stacks.stanford.edu/image/iiif/mz508vq7890%2Fmz508vq7890_0001/info.json",label:"232 Welte-Mignon",title:"Mendelssohn-Bartholdy/Scharwenka - Scherzo e-moll",type:"welte-red"},{druid:"sg713kb1834",image_url:"https://stacks.stanford.edu/image/iiif/sg713kb1834%2Fsg713kb1834_0001/info.json",label:"3548 Welte-Mignon",title:"Merrigan - Carry me back to ole virginny",type:"welte-red"},{druid:"rf416pb7833",image_url:"https://stacks.stanford.edu/image/iiif/rf416pb7833%2Frf416pb7833_0001/info.json",label:"3452 Welte-Mignon",title:"Meyer-Helmund/Haass - Zauberlied",type:"welte-red"},{druid:"sq235zh0909",image_url:"https://stacks.stanford.edu/image/iiif/sq235zh0909%2Fsq235zh0909_0001/info.json",label:"612 Welte-Mignon",title:"Meyer-Helmund/Meyer-Helmund - Dein gedenk ich, margarethe",type:"welte-red"},{druid:"qf152xr6941",image_url:"https://stacks.stanford.edu/image/iiif/qf152xr6941%2Fqf152xr6941_0002/info.json",label:"4660 Princesa",title:"Moreno Torroba - La marchenera. petenera",type:"88-note"},{druid:"mn110mt1775",image_url:"https://stacks.stanford.edu/image/iiif/mn110mt1775%2Fmn110mt1775_0001/info.json",label:"3556 Welte-Mignon",title:"Moszkowski/Danziger - Barcarole: (from tales of hoffman)",type:"welte-red"},{druid:"hq933dq4264",image_url:"https://stacks.stanford.edu/image/iiif/hq933dq4264%2Fhq933dq4264_0001/info.json",label:"449 Welte-Mignon",title:"Moszkowski/Kleeberg - Liebes walzer: op. 57 no. 5 = (love's waltz)",type:"welte-red"},{druid:"jx095ty1753",image_url:"https://stacks.stanford.edu/image/iiif/jx095ty1753%2Fjx095ty1753_0001/info.json",label:"1204 Welte-Mignon",title:"Mozart/Pachmann - Sonate, a-dur, nr. 9",type:"welte-red"},{druid:"zb497jz4405",image_url:"https://stacks.stanford.edu/image/iiif/zb497jz4405%2Fzb497jz4405_0001/info.json",label:"182 Welte-Mignon",title:"Mozart/Reinecke - Türkischer marsch",type:"welte-red"},{druid:"dq126tp4234",image_url:"https://stacks.stanford.edu/image/iiif/dq126tp4234%2Fdq126tp4234_0001/info.json",label:"3143 Welte-Mignon",title:"Mozart/Ritter - Don juan. overture",type:"welte-red"},{druid:"zx785pg9042",image_url:"https://stacks.stanford.edu/image/iiif/zx785pg9042%2Fzx785pg9042_0002/info.json",label:"4636 Princesa",title:"Muñoz Aceña - La cieguita: tango-canción",type:"88-note"},{druid:"tr981xw2871",image_url:"https://stacks.stanford.edu/image/iiif/tr981xw2871%2Ftr981xw2871_0001/info.json",label:"1613 Welte-Mignon",title:"Offenbach/Francklyn - Tales of hoffmann: selection",type:"welte-red"},{druid:"jf942gh3232",image_url:"https://stacks.stanford.edu/image/iiif/jf942gh3232%2Fjf942gh3232_0001/info.json",label:"258 Welte-Mignon",title:'Offenbach/Zscherneck - Barcarole aus "hoffmann\'s erzählungen"',type:"welte-red"},{druid:"pd354nj6106",image_url:"https://stacks.stanford.edu/image/iiif/pd354nj6106%2Fpd354nj6106_0001/info.json",label:"1454 Welte-Mignon",title:"Orlando - God save the king: (national anthem)",type:"welte-red"},{druid:"qb477sd2923",image_url:"https://stacks.stanford.edu/image/iiif/qb477sd2923%2Fqb477sd2923_0001/info.json",label:"1226 Welte-Mignon",title:'Pachmann/Pachmann - Improvisation on "the maiden\'s prayer"',type:"welte-red"},{druid:"dw479gk0103",image_url:"https://stacks.stanford.edu/image/iiif/dw479gk0103%2Fdw479gk0103_0001/info.json",label:"1263 Welte-Mignon",title:"Paderewski/Paderewski - Minuett g major",type:"welte-red"},{druid:"qt363fp0799",image_url:"https://stacks.stanford.edu/image/iiif/qt363fp0799%2Fqt363fp0799_0001/info.json",label:"1262 Welte-Mignon",title:"Paderewski/Paderewski - Nocturne op. 16, no. 4",type:"welte-red"},{druid:"sb487jm2092",image_url:"https://stacks.stanford.edu/image/iiif/sb487jm2092%2Fsb487jm2092_0001/info.json",label:"1262 Welte-Mignon",title:"Paderewski/Paderewski - Nocturno op. 16, no. 4",type:"welte-red"},{druid:"bp752qs6053",image_url:"https://stacks.stanford.edu/image/iiif/bp752qs6053%2Fbp752qs6053_0002/info.json",label:"4291 Princesa",title:"Pancho Pérez - Grana y oro: pasodoble",type:"88-note"},{druid:"qj765hb3428",image_url:"https://stacks.stanford.edu/image/iiif/qj765hb3428%2Fqj765hb3428_0002/info.json",label:"40059 Princesa",title:"Patiño - Suspiro flamenco: pasodoble",type:"88-note"},{druid:"rx870zt5437",image_url:"https://stacks.stanford.edu/image/iiif/rx870zt5437%2Frx870zt5437_0002/info.json",label:"4394 Princesa",title:"Pettorossi - Galleguita: tango argentino",type:"88-note"},{druid:"mf940cg4339",image_url:"https://stacks.stanford.edu/image/iiif/mf940cg4339%2Fmf940cg4339_0001/info.json",label:"1468 Welte-Mignon",title:"Poldini/Bloomfield-Zeisler - Poupée valsante",type:"welte-red"},{druid:"ms935qj0194",image_url:"https://stacks.stanford.edu/image/iiif/ms935qj0194%2Fms935qj0194_0001/info.json",label:"2255 Welte-Mignon",title:"Puccini/Epstein - La boheme: selection",type:"welte-red"},{druid:"fk036vh7282",image_url:"https://stacks.stanford.edu/image/iiif/fk036vh7282%2Ffk036vh7282_0001/info.json",label:"2254 Welte-Mignon",title:"Puccini/Epstein - Madam butterfly: selection",type:"welte-red"},{druid:"pf050rx0162",image_url:"https://stacks.stanford.edu/image/iiif/pf050rx0162%2Fpf050rx0162_0001/info.json",label:"2254 Welte-Mignon",title:"Puccini/Epstein - Madam butterfly: selektion",type:"welte-red"},{druid:"rr990ym0199",image_url:"https://stacks.stanford.edu/image/iiif/rr990ym0199%2Frr990ym0199_0001/info.json",label:"2560 Welte-Mignon",title:"Puccini/Paur - Tosca, fantasia",type:"welte-red"},{druid:"jg489yw0942",image_url:"https://stacks.stanford.edu/image/iiif/jg489yw0942%2Fjg489yw0942_0002/info.json",label:"4309 Princesa",title:"Pérez Soriano - El guitarrico. jota",type:"88-note"},{druid:"kj388dj3308",image_url:"https://stacks.stanford.edu/image/iiif/kj388dj3308%2Fkj388dj3308_0001/info.json",label:"2079 Welte-Mignon",title:"Rachmaninoff/Hill - Prelude op. 3, no. 2, c sharp minor",type:"welte-red"},{druid:"pr464zk8674",image_url:"https://stacks.stanford.edu/image/iiif/pr464zk8674%2Fpr464zk8674_0001/info.json",label:"1567 Welte-Mignon",title:"Rachmaninoff/Pintel - Prélude d-dur",type:"welte-red"},{druid:"yg250xz9762",image_url:"https://stacks.stanford.edu/image/iiif/yg250xz9762%2Fyg250xz9762_0001/info.json",label:"1571 Welte-Mignon",title:"Rachmaninoff/Pintel - Prélude g minor",type:"welte-red"},{druid:"qj203cn5343",image_url:"https://stacks.stanford.edu/image/iiif/qj203cn5343%2Fqj203cn5343_0001/info.json",label:"1959 Welte-Mignon",title:"Rachmaninoff/Pouishnoff - Polichenelle: op. 3, no. 4",type:"welte-red"},{druid:"jy320zw1102",image_url:"https://stacks.stanford.edu/image/iiif/jy320zw1102%2Fjy320zw1102_0002/info.json",label:"4486 Victoria",title:"Raff - Valse impromptu",type:"88-note"},{druid:"kw215gn3365",image_url:"https://stacks.stanford.edu/image/iiif/kw215gn3365%2Fkw215gn3365_0001/info.json",label:"3357 Welte-Mignon",title:"Raff/Flohr - Cachoucha",type:"welte-red"},{druid:"hh466mq4616",image_url:"https://stacks.stanford.edu/image/iiif/hh466mq4616%2Fhh466mq4616_0001/info.json",label:"296 Welte-Mignon",title:"Raff/Gabrilowitsch - Rigaudon d-dur",type:"welte-red"},{druid:"vq227vv6345",image_url:"https://stacks.stanford.edu/image/iiif/vq227vv6345%2Fvq227vv6345_0001/info.json",label:"424 Welte-Mignon",title:"Raff/Wendling - La fileuse: op. 157, no. 2",type:"welte-red"},{druid:"rd899zb5188",image_url:"https://stacks.stanford.edu/image/iiif/rd899zb5188%2Frd899zb5188_0001/info.json",label:"5608 Welte-Mignon",title:'Rimsky-Korsakov/Black - Play that song of india again: fox-trot-song after "korsakow\'s sadko"',type:"welte-red"},{druid:"rv790qz2532",image_url:"https://stacks.stanford.edu/image/iiif/rv790qz2532%2Frv790qz2532_0001/info.json",label:"226 Welte-Mignon",title:"Rosenzweig/Popper - Sei mir gut: walzerlied",type:"welte-red"},{druid:"xr433hz5827",image_url:"https://stacks.stanford.edu/image/iiif/xr433hz5827%2Fxr433hz5827_0001/info.json",label:"5718 Welte-Mignon",title:"Rosoff/Johnson - When you and i were seventeen",type:"welte-red"},{druid:"sb158jt0685",image_url:"https://stacks.stanford.edu/image/iiif/sb158jt0685%2Fsb158jt0685_0001/info.json",label:"953 Welte-Mignon",title:"Rossini/Sapellnikoff - William tell. overture",type:"welte-red"},{druid:"dv468zh8208",image_url:"https://stacks.stanford.edu/image/iiif/dv468zh8208%2Fdv468zh8208_0002/info.json",label:"4246 Princesa",title:"Rouget de Lisle - La marsellesa: himno francés",type:"88-note"},{druid:"dt352gh2011",image_url:"https://stacks.stanford.edu/image/iiif/dt352gh2011%2Fdt352gh2011_0001/info.json",label:"2457 Welte-Mignon",title:"Rubinstein/Danziger - Kamennoi ostrow: op. 10, nr. 22",type:"welte-red"},{druid:"xr682fm1233",image_url:"https://stacks.stanford.edu/image/iiif/xr682fm1233%2Fxr682fm1233_0001/info.json",label:"660 Welte-Mignon",title:"Rubinstein/Hofmann - Melodie op. 3, f major",type:"welte-red"},{druid:"td134mh2760",image_url:"https://stacks.stanford.edu/image/iiif/td134mh2760%2Ftd134mh2760_0001/info.json",label:"660 Welte-Mignon",title:"Rubinstein/Hofmann - Melodie op. 3, f-dur",type:"welte-red"},{druid:"zc568zf0361",image_url:"https://stacks.stanford.edu/image/iiif/zc568zf0361%2Fzc568zf0361_0001/info.json",label:"661 Welte-Mignon",title:"Rubinstein/Hofmann - Valse allemande",type:"welte-red"},{druid:"wv641dn9264",image_url:"https://stacks.stanford.edu/image/iiif/wv641dn9264%2Fwv641dn9264_0001/info.json",label:"1304 Welte-Mignon",title:'Rubinstein/Lhévinne - Polka a. "le bal"',type:"welte-red"},{druid:"cp145vd3423",image_url:"https://stacks.stanford.edu/image/iiif/cp145vd3423%2Fcp145vd3423_0001/info.json",label:"1382 Welte-Mignon",title:"Rubinstein/Timanoff - Sérénade espagnole: op. 16, no 3",type:"welte-red"},{druid:"cp259ms0085",image_url:"https://stacks.stanford.edu/image/iiif/cp259ms0085%2Fcp259ms0085_0001/info.json",label:"2260 Welte-Mignon",title:"Saint-Saëns/Epstein - Samson and delilah. cantabile du grand duo",type:"welte-red"},{druid:"pc276zv7038",image_url:"https://stacks.stanford.edu/image/iiif/pc276zv7038%2Fpc276zv7038_0001/info.json",label:"2260 Welte-Mignon",title:"Saint-Saëns/Epstein - Samson and delilah. cantabile du grand duo",type:"welte-red"},{druid:"fy803vj4057",image_url:"https://stacks.stanford.edu/image/iiif/fy803vj4057%2Ffy803vj4057_0001/info.json",label:"799 Welte-Mignon",title:"Saint-Saëns/Saint-Saëns - Mazurka, no. 3",type:"welte-red"},{druid:"pk349zj4179",image_url:"https://stacks.stanford.edu/image/iiif/pk349zj4179%2Fpk349zj4179_0001/info.json",label:"797 Welte-Mignon",title:"Saint-Saëns/Saint-Saëns - Samson and delilah. finale, act 1",type:"welte-red"},{druid:"zk199jz1564",image_url:"https://stacks.stanford.edu/image/iiif/zk199jz1564%2Fzk199jz1564_0002/info.json",label:"4670 Princesa",title:"Sanders - Adiós muchachos: tango",type:"88-note"},{druid:"cz952kx0008",image_url:"https://stacks.stanford.edu/image/iiif/cz952kx0008%2Fcz952kx0008_0001/info.json",label:"1453 Welte-Mignon",title:"Schelling/Schelling - Romanze cis-moll",type:"welte-red"},{druid:"sz207mm8382",image_url:"https://stacks.stanford.edu/image/iiif/sz207mm8382%2Fsz207mm8382_0001/info.json",label:"1296 Welte-Mignon",title:"Schlözer/Lhévinne - Etude de concert e flat",type:"welte-red"},{druid:"sq640bh1919",image_url:"https://stacks.stanford.edu/image/iiif/sq640bh1919%2Fsq640bh1919_0001/info.json",label:"1296 Welte-Mignon",title:"Schlözer/Lhévinne - Etude e flat major",type:"welte-red"},{druid:"gb034mq5877",image_url:"https://stacks.stanford.edu/image/iiif/gb034mq5877%2Fgb034mq5877_0001/info.json",label:"422 Welte-Mignon",title:"Schubert/Albert - Impromptu g major, op. 90, no. 3",type:"welte-red"},{druid:"gq401ng9171",image_url:"https://stacks.stanford.edu/image/iiif/gq401ng9171%2Fgq401ng9171_0001/info.json",label:"3309 Welte-Mignon",title:"Schubert/Backhaus - Military march e-flat",type:"welte-red"},{druid:"jq774vx6544",image_url:"https://stacks.stanford.edu/image/iiif/jq774vx6544%2Fjq774vx6544_0001/info.json",label:"3309 Welte-Mignon",title:"Schubert/Backhaus - Militärmarsch in es-dur",type:"welte-red"},{druid:"kf903tz5142",image_url:"https://stacks.stanford.edu/image/iiif/kf903tz5142%2Fkf903tz5142_0001/info.json",label:"3312 Welte-Mignon",title:"Schubert/Backhaus - Wanderer-fantasie. 1st and 2nd movements",type:"welte-red"},{druid:"cm852bp8620",image_url:"https://stacks.stanford.edu/image/iiif/cm852bp8620%2Fcm852bp8620_0001/info.json",label:"3313 Welte-Mignon",title:"Schubert/Backhaus - Wanderer-fantasie. iii. und iv. satz",type:"welte-red"},{druid:"rc749wx0227",image_url:"https://stacks.stanford.edu/image/iiif/rc749wx0227%2Frc749wx0227_0001/info.json",label:"1471 Welte-Mignon",title:"Schubert/Bloomfield-Zeisler - Militär-marsch =: (military march)",type:"welte-red"},{druid:"md331fy4209",image_url:"https://stacks.stanford.edu/image/iiif/md331fy4209%2Fmd331fy4209_0001/info.json",label:"723 Welte-Mignon",title:"Schubert/Burmeister - Ave maria",type:"welte-red"},{druid:"sx417qf9868",image_url:"https://stacks.stanford.edu/image/iiif/sx417qf9868%2Fsx417qf9868_0001/info.json",label:"723 Welte-Mignon",title:"Schubert/Burmeister - Ave maria",type:"welte-red"},{druid:"yg667ds7662",image_url:"https://stacks.stanford.edu/image/iiif/yg667ds7662%2Fyg667ds7662_0001/info.json",label:"446 Welte-Mignon",title:"Schubert/Busoni - Hungarian march: (hungarian melodies)",type:"welte-red"},{druid:"gq898yv9510",image_url:"https://stacks.stanford.edu/image/iiif/gq898yv9510%2Fgq898yv9510_0001/info.json",label:"665 Welte-Mignon",title:"Schubert/Hofmann - Erlkönig",type:"welte-red"},{druid:"fg074rf2950",image_url:"https://stacks.stanford.edu/image/iiif/fg074rf2950%2Ffg074rf2950_0001/info.json",label:"2386 Welte-Mignon",title:"Schubert/Mackle - Am meer",type:"welte-red"},{druid:"sk832rf0203",image_url:"https://stacks.stanford.edu/image/iiif/sk832rf0203%2Fsk832rf0203_0001/info.json",label:"2388 Welte-Mignon",title:"Schubert/Mackle - Der wanderer",type:"welte-red"},{druid:"tj337qh7786",image_url:"https://stacks.stanford.edu/image/iiif/tj337qh7786%2Ftj337qh7786_0001/info.json",label:"1211 Welte-Mignon",title:"Schubert/Pachmann - Moment musical: op. 94, no. 3, f minor",type:"welte-red"},{druid:"jv484vp9065",image_url:"https://stacks.stanford.edu/image/iiif/jv484vp9065%2Fjv484vp9065_0001/info.json",label:"1248 Welte-Mignon",title:"Schubert/Paderewski - Impromptu op. 142, b-dur",type:"welte-red"},{druid:"sc188ff2842",image_url:"https://stacks.stanford.edu/image/iiif/sc188ff2842%2Fsc188ff2842_0001/info.json",label:"1260 Welte-Mignon",title:"Schubert/Paderewski - The erl king",type:"welte-red"},{druid:"vc908xz3554",image_url:"https://stacks.stanford.edu/image/iiif/vc908xz3554%2Fvc908xz3554_0002/info.json",label:"7822 Ideal",title:"Schulhoff - Carnaval de venezia",type:"88-note"},{druid:"yn137rt9938",image_url:"https://stacks.stanford.edu/image/iiif/yn137rt9938%2Fyn137rt9938_0001/info.json",label:"1305 Welte-Mignon",title:'Schulz-Evler/Lhévinne - Arabesque über "an der schönen blauen donau"',type:"welte-red"},{druid:"tc493dq4498",image_url:"https://stacks.stanford.edu/image/iiif/tc493dq4498%2Ftc493dq4498_0002/info.json",label:"3020 Victoria",title:"Schumann - Fantaisiestück, op. 12. n. 8, amici, comedia finita est",type:"88-note"},{druid:"rt595wj4442",image_url:"https://stacks.stanford.edu/image/iiif/rt595wj4442%2Frt595wj4442_0001/info.json",label:"28 Welte-Mignon",title:"Schumann/Adam-Benard - Klavierconcert a-moll, op. 54. allegro affectuoso, allegro molto",type:"welte-red"},{druid:"bj093nh2591",image_url:"https://stacks.stanford.edu/image/iiif/bj093nh2591%2Fbj093nh2591_0001/info.json",label:"28 Welte-Mignon",title:"Schumann/Adam-Benard - Piano concerto op. 54, a minor. allegro affectuoso, allegro molto",type:"welte-red"},{druid:"ps931qh5746",image_url:"https://stacks.stanford.edu/image/iiif/ps931qh5746%2Fps931qh5746_0001/info.json",label:"2591 Welte-Mignon",title:"Schumann/Bloomfield-Zeisler - Caprice e dur",type:"welte-red"},{druid:"vw531zy4220",image_url:"https://stacks.stanford.edu/image/iiif/vw531zy4220%2Fvw531zy4220_0001/info.json",label:"2591 Welte-Mignon",title:"Schumann/Bloomfield-Zeisler - Caprice e dur",type:"welte-red"},{druid:"gf569df0451",image_url:"https://stacks.stanford.edu/image/iiif/gf569df0451%2Fgf569df0451_0001/info.json",label:"361 Welte-Mignon",title:"Schumann/Carreño - Fantasia op. 17, c-major. part 1",type:"welte-red"},{druid:"vm096df0179",image_url:"https://stacks.stanford.edu/image/iiif/vm096df0179%2Fvm096df0179_0001/info.json",label:"363 Welte-Mignon",title:"Schumann/Carreño - Fantasie c-dur, op. 17. iii. satz",type:"welte-red"},{druid:"kx034vy1374",image_url:"https://stacks.stanford.edu/image/iiif/kx034vy1374%2Fkx034vy1374_0001/info.json",label:"362 Welte-Mignon",title:"Schumann/Carreño - Fantasie op. 17, c-dur. ii. satz",type:"welte-red"},{druid:"kq525dc4373",image_url:"https://stacks.stanford.edu/image/iiif/kq525dc4373%2Fkq525dc4373_0001/info.json",label:"1755 Welte-Mignon",title:"Schumann/Collins - Widmung =: (devotion)",type:"welte-red"},{druid:"jb107tz1859",image_url:"https://stacks.stanford.edu/image/iiif/jb107tz1859%2Fjb107tz1859_0001/info.json",label:"1772 Welte-Mignon",title:"Schumann/Davies - Kinderscenen. 1-6",type:"welte-red"},{druid:"ds710xd1794",image_url:"https://stacks.stanford.edu/image/iiif/ds710xd1794%2Fds710xd1794_0001/info.json",label:"1773 Welte-Mignon",title:"Schumann/Davies - Scenes from childhood. no. 7-13",type:"welte-red"},{druid:"nk632jz1564",image_url:"https://stacks.stanford.edu/image/iiif/nk632jz1564%2Fnk632jz1564_0001/info.json",label:"501 Welte-Mignon",title:"Schumann/Dohnányi - Romance op. 28, no. 2, fis-dur",type:"welte-red"},{druid:"ph502kz9777",image_url:"https://stacks.stanford.edu/image/iiif/ph502kz9777%2Fph502kz9777_0001/info.json",label:"270 Welte-Mignon",title:"Schumann/Droucker - Arabesque c major op. 18",type:"welte-red"},{druid:"sk293jg8184",image_url:"https://stacks.stanford.edu/image/iiif/sk293jg8184%2Fsk293jg8184_0001/info.json",label:"1063 Welte-Mignon",title:"Schumann/Grosz - 2nd sonata, op. 22, no. 2, g minor. adantino",type:"welte-red"},{druid:"hn285vs3930",image_url:"https://stacks.stanford.edu/image/iiif/hn285vs3930%2Fhn285vs3930_0001/info.json",label:"1064 Welte-Mignon",title:"Schumann/Grosz - 2nd sonata, op. 22, no. 2, g minor: scherzo, rondo, presto",type:"welte-red"},{druid:"yg150mb0559",image_url:"https://stacks.stanford.edu/image/iiif/yg150mb0559%2Fyg150mb0559_0001/info.json",label:"207 Welte-Mignon",title:"Schumann/Grünfeld - Des abends op. 12",type:"welte-red"},{druid:"wv912mm2332",image_url:"https://stacks.stanford.edu/image/iiif/wv912mm2332%2Fwv912mm2332_0001/info.json",label:"225 Welte-Mignon",title:"Schumann/Grünfeld - Traumerei: op. 15, no. 7",type:"welte-red"},{druid:"mf320jq4997",image_url:"https://stacks.stanford.edu/image/iiif/mf320jq4997%2Fmf320jq4997_0001/info.json",label:"225 Welte-Mignon",title:"Schumann/Grünfeld - Träumerei",type:"welte-red"},{druid:"kx695yq4528",image_url:"https://stacks.stanford.edu/image/iiif/kx695yq4528%2Fkx695yq4528_0001/info.json",label:"1301 Welte-Mignon",title:"Schumann/Lhévinne - Toccata c major, op. 7",type:"welte-red"},{druid:"cw211cn1219",image_url:"https://stacks.stanford.edu/image/iiif/cw211cn1219%2Fcw211cn1219_0001/info.json",label:"691 Welte-Mignon",title:"Schumann/Neitzel - Davidsbündler dances",type:"welte-red"},{druid:"qw257qp8232",image_url:"https://stacks.stanford.edu/image/iiif/qw257qp8232%2Fqw257qp8232_0001/info.json",label:"690 Welte-Mignon",title:"Schumann/Neitzel - Symphonische etüde",type:"welte-red"},{druid:"xj540rr2929",image_url:"https://stacks.stanford.edu/image/iiif/xj540rr2929%2Fxj540rr2929_0001/info.json",label:"1208 Welte-Mignon",title:"Schumann/Pachmann - Vogel als prophet",type:"welte-red"},{druid:"jk211zx0169",image_url:"https://stacks.stanford.edu/image/iiif/jk211zx0169%2Fjk211zx0169_0001/info.json",label:"525 Welte-Mignon",title:"Schumann/Petri - Abegg varationen: op. 1",type:"welte-red"},{druid:"xw872bc8052",image_url:"https://stacks.stanford.edu/image/iiif/xw872bc8052%2Fxw872bc8052_0001/info.json",label:"321 Welte-Mignon",title:"Schumann/Reisenauer - Carneval part. 1",type:"welte-red"},{druid:"zt739gs4926",image_url:"https://stacks.stanford.edu/image/iiif/zt739gs4926%2Fzt739gs4926_0001/info.json",label:"321 Welte-Mignon",title:"Schumann/Reisenauer - Carneval. part. 1",type:"welte-red"},{druid:"wk320bj4724",image_url:"https://stacks.stanford.edu/image/iiif/wk320bj4724%2Fwk320bj4724_0001/info.json",label:"322 Welte-Mignon",title:"Schumann/Reisenauer - Carneval. part. 2",type:"welte-red"},{druid:"cs175wr2428",image_url:"https://stacks.stanford.edu/image/iiif/cs175wr2428%2Fcs175wr2428_0001/info.json",label:"248 Welte-Mignon",title:"Schumann/Scharwenka - Kreisleriana",type:"welte-red"},{druid:"hy749gh2331",image_url:"https://stacks.stanford.edu/image/iiif/hy749gh2331%2Fhy749gh2331_0001/info.json",label:"2086 Welte-Mignon",title:"Schumann/Schorr - Schlummerlied",type:"welte-red"},{druid:"dz678wd2724",image_url:"https://stacks.stanford.edu/image/iiif/dz678wd2724%2Fdz678wd2724_0001/info.json",label:"970 Welte-Mignon",title:"Schytte/Schytte - Berceuse op. 26, nr. 7",type:"welte-red"},{druid:"pb026mb0704",image_url:"https://stacks.stanford.edu/image/iiif/pb026mb0704%2Fpb026mb0704_0001/info.json",label:"921 Welte-Mignon",title:"Schütt/Conne - Kunstlerleben waltz: concert paraphrase",type:"welte-red"},{druid:"ny937ph6981",image_url:"https://stacks.stanford.edu/image/iiif/ny937ph6981%2Fny937ph6981_0001/info.json",label:"3745 Welte-Mignon",title:"Schütt/Danziger - Romance op. 38, no. 2",type:"welte-red"},{druid:"sp773vt2651",image_url:"https://stacks.stanford.edu/image/iiif/sp773vt2651%2Fsp773vt2651_0001/info.json",label:"3695 Welte-Mignon",title:"Schütt/Seckendorf Popper - Carnaval mignon: scènes pantomimiques: op. 48",type:"welte-red"},{druid:"vq862qw5039",image_url:"https://stacks.stanford.edu/image/iiif/vq862qw5039%2Fvq862qw5039_0002/info.json",label:"40011 Princesa",title:"Sciammarella - No te engañes corazón: tango",type:"88-note"},{druid:"vf252dc4872",image_url:"https://stacks.stanford.edu/image/iiif/vf252dc4872%2Fvf252dc4872_0001/info.json",label:"1697 Welte-Mignon",title:"Scott/Scott - A song from the east: danse nègre",type:"welte-red"},{druid:"zf673fy4620",image_url:"https://stacks.stanford.edu/image/iiif/zf673fy4620%2Fzf673fy4620_0001/info.json",label:"2068 Welte-Mignon",title:"Scriabin/Scriabin - Poême: op. 32, no. 1",type:"welte-red"},{druid:"sk925fn6049",image_url:"https://stacks.stanford.edu/image/iiif/sk925fn6049%2Fsk925fn6049_0001/info.json",label:"2021 Welte-Mignon",title:"Scriabin/Vengerova - Prelude für die linke hand",type:"welte-red"},{druid:"vp438dy0628",image_url:"https://stacks.stanford.edu/image/iiif/vp438dy0628%2Fvp438dy0628_0001/info.json",label:"3356 Welte-Mignon",title:"Sibelius/Flohr - Finlandia",type:"welte-red"},{druid:"zw828tx0197",image_url:"https://stacks.stanford.edu/image/iiif/zw828tx0197%2Fzw828tx0197_0001/info.json",label:"3537 Welte-Mignon",title:"Silésu/Daly - Un peu d'amour: popular song",type:"welte-red"},{druid:"qg041hb4569",image_url:"https://stacks.stanford.edu/image/iiif/qg041hb4569%2Fqg041hb4569_0001/info.json",label:"2993 Welte-Mignon",title:"Sinding/Albert - March grotesque",type:"welte-red"},{druid:"qk333zc6515",image_url:"https://stacks.stanford.edu/image/iiif/qk333zc6515%2Fqk333zc6515_0001/info.json",label:"2637 Welte-Mignon",title:"Sinding/Di Benici - Frühlingsrauschen: op. 32, no. 3",type:"welte-red"},{druid:"gq990gn6753",image_url:"https://stacks.stanford.edu/image/iiif/gq990gn6753%2Fgq990gn6753_0001/info.json",label:"375 Welte-Mignon",title:"Sinding/Wendling - Rustle of spring: op. 32, no. 3",type:"welte-red"},{druid:"gs012fx5529",image_url:"https://stacks.stanford.edu/image/iiif/gs012fx5529%2Fgs012fx5529_0001/info.json",label:"1343 Welte-Mignon",title:"Starke - Romeo and juliette: potpourri",type:"welte-red"},{druid:"fr396nf3639",image_url:"https://stacks.stanford.edu/image/iiif/fr396nf3639%2Ffr396nf3639_0001/info.json",label:"1539 Welte-Mignon",title:"Steinway/Brightwell - Madeleine: valse poetique",type:"welte-red"},{druid:"jt308hp0877",image_url:"https://stacks.stanford.edu/image/iiif/jt308hp0877%2Fjt308hp0877_0001/info.json",label:"2198 Welte-Mignon",title:"Straus/Burkard - Walzer: der tapfere soldat",type:"welte-red"},{druid:"qp421cd7297",image_url:"https://stacks.stanford.edu/image/iiif/qp421cd7297%2Fqp421cd7297_0001/info.json",label:"2613 Welte-Mignon",title:"Straus/Goodall - The chocolate soldier: selection 1",type:"welte-red"},{druid:"rn154dd5329",image_url:"https://stacks.stanford.edu/image/iiif/rn154dd5329%2Frn154dd5329_0001/info.json",label:"357 Welte-Mignon",title:"Strauss/Brzeziński - An der schönen blauen donau",type:"welte-red"},{druid:"sj250cc6451",image_url:"https://stacks.stanford.edu/image/iiif/sj250cc6451%2Fsj250cc6451_0001/info.json",label:"277 Welte-Mignon",title:"Strauss/Brzeziński - Rosen a. d. süden",type:"welte-red"},{druid:"sk565bp3463",image_url:"https://stacks.stanford.edu/image/iiif/sk565bp3463%2Fsk565bp3463_0001/info.json",label:"349 Welte-Mignon",title:"Strauss/Kupfernagel - Wiener blut: walzer",type:"welte-red"},{druid:"qp506dy4541",image_url:"https://stacks.stanford.edu/image/iiif/qp506dy4541%2Fqp506dy4541_0001/info.json",label:"1398 Welte-Mignon",title:"Strauss/Orlando - Du und du: aus fledermaus: walzer",type:"welte-red"},{druid:"kt568yb8982",image_url:"https://stacks.stanford.edu/image/iiif/kt568yb8982%2Fkt568yb8982_0001/info.json",label:"382 Welte-Mignon",title:"Strauss/Schnabel - Village swallows",type:"welte-red"},{druid:"sv842td3290",image_url:"https://stacks.stanford.edu/image/iiif/sv842td3290%2Fsv842td3290_0001/info.json",label:"4190 Welte-Mignon",title:"Strauss/Serkin - Delirien-walzer",type:"welte-red"},{druid:"zw485gh6070",image_url:"https://stacks.stanford.edu/image/iiif/zw485gh6070%2Fzw485gh6070_0001/info.json",label:"1184 Welte-Mignon",title:'Strauss/Strauss - Liebesscene a. "heldenleben"',type:"welte-red"},{druid:"kp368nb7707",image_url:"https://stacks.stanford.edu/image/iiif/kp368nb7707%2Fkp368nb7707_0001/info.json",label:"532 Welte-Mignon",title:"Strauss/Zadora - Man lives but once",type:"welte-red"},{druid:"rh801bs4556",image_url:"https://stacks.stanford.edu/image/iiif/rh801bs4556%2Frh801bs4556_0001/info.json",label:"2615 Welte-Mignon",title:"Sullivan/Goodall - The gondoliers, or the king of barataria",type:"welte-red"},{druid:"xg228jc5213",image_url:"https://stacks.stanford.edu/image/iiif/xg228jc5213%2Fxg228jc5213_0001/info.json",label:"2616 Welte-Mignon",title:"Sullivan/Goodall - The mikado, or the town of titibu: i (selection)",type:"welte-red"},{druid:"zp424ps8426",image_url:"https://stacks.stanford.edu/image/iiif/zp424ps8426%2Fzp424ps8426_0001/info.json",label:"2617 Welte-Mignon",title:"Sullivan/Goodall - The mikado, or the town of titibu: ii (selection)",type:"welte-red"},{druid:"fg895gs1373",image_url:"https://stacks.stanford.edu/image/iiif/fg895gs1373%2Ffg895gs1373_0001/info.json",label:"2618 Welte-Mignon",title:"Sullivan/Goodall - The yeomen of the guard, or the merry man and his maid",type:"welte-red"},{druid:"zc118hn1152",image_url:"https://stacks.stanford.edu/image/iiif/zc118hn1152%2Fzc118hn1152_0001/info.json",label:"2995 Welte-Mignon",title:"Tchaikovsky/Albert - Casse noisette suite op. 71, i. teil",type:"welte-red"},{druid:"fk960pq3086",image_url:"https://stacks.stanford.edu/image/iiif/fk960pq3086%2Ffk960pq3086_0001/info.json",label:"2995 Welte-Mignon",title:"Tchaikovsky/Albert - Casse noisette suite: op. 71, part 1",type:"welte-red"},{druid:"hk752ck1008",image_url:"https://stacks.stanford.edu/image/iiif/hk752ck1008%2Fhk752ck1008_0001/info.json",label:"3330 Welte-Mignon",title:"Tchaikovsky/Lászlò - Symphonic pathétic op. 74, no. 6, part ii",type:"welte-red"},{druid:"bk297ff8944",image_url:"https://stacks.stanford.edu/image/iiif/bk297ff8944%2Fbk297ff8944_0001/info.json",label:"3329 Welte-Mignon",title:"Tchaikovsky/Lászlò - Symphonic pathétic op. 74, part. i (final)",type:"welte-red"},{druid:"rv766dc1369",image_url:"https://stacks.stanford.edu/image/iiif/rv766dc1369%2Frv766dc1369_0001/info.json",label:"3328 Welte-Mignon",title:"Tchaikovsky/Lászlò - Symphony pathétique op. 74, no. 6, part i",type:"welte-red"},{druid:"gr136pc5388",image_url:"https://stacks.stanford.edu/image/iiif/gr136pc5388%2Fgr136pc5388_0001/info.json",label:"3331 Welte-Mignon",title:"Tchaikovsky/Lászlò - Symphony pathétique op. 74, no. 6, part iii",type:"welte-red"},{druid:"qm069fy5200",image_url:"https://stacks.stanford.edu/image/iiif/qm069fy5200%2Fqm069fy5200_0001/info.json",label:"3332 Welte-Mignon",title:"Tchaikovsky/Lászlò - Symphony pathétique op. 74, no. 6, part iv",type:"welte-red"},{druid:"jv485mx5227",image_url:"https://stacks.stanford.edu/image/iiif/jv485mx5227%2Fjv485mx5227_0002/info.json",label:"40003 Princesa",title:"Texidor - Amparito roca: pasodoble",type:"88-note"},{druid:"vj052cw2158",image_url:"https://stacks.stanford.edu/image/iiif/vj052cw2158%2Fvj052cw2158_0001/info.json",label:"1534 Welte-Mignon",title:"Thalberg/Brightwell - Home sweet home",type:"welte-red"},{druid:"xg924dm1245",image_url:"https://stacks.stanford.edu/image/iiif/xg924dm1245%2Fxg924dm1245_0001/info.json",label:"3430 Welte-Mignon",title:"Toselli/Haass - Serenade",type:"welte-red"},{druid:"cw746gb6753",image_url:"https://stacks.stanford.edu/image/iiif/cw746gb6753%2Fcw746gb6753_0002/info.json",label:"473 Princesa",title:"Verdi - Aida. acto ii, marcha triunfal",type:"88-note"},{druid:"sr577gv4813",image_url:"https://stacks.stanford.edu/image/iiif/sr577gv4813%2Fsr577gv4813_0001/info.json",label:"2844 Welte-Mignon",title:"Verdi/Gayraud - Rigoletto: fantasia",type:"welte-red"},{druid:"np204br1080",image_url:"https://stacks.stanford.edu/image/iiif/np204br1080%2Fnp204br1080_0001/info.json",label:"2844 Welte-Mignon",title:"Verdi/Gayraud - Rigoletto: fantasie",type:"welte-red"},{druid:"nq190zp1066",image_url:"https://stacks.stanford.edu/image/iiif/nq190zp1066%2Fnq190zp1066_0001/info.json",label:"1341 Welte-Mignon",title:"Verdi/Starke - Aïda: fantasie",type:"welte-red"},{druid:"nx970yn7253",image_url:"https://stacks.stanford.edu/image/iiif/nx970yn7253%2Fnx970yn7253_0001/info.json",label:"1339 Welte-Mignon",title:"Verdi/Starke - La traviata: fantasie",type:"welte-red"},{druid:"tw054jm0773",image_url:"https://stacks.stanford.edu/image/iiif/tw054jm0773%2Ftw054jm0773_0001/info.json",label:"1339 Welte-Mignon",title:"Verdi/Starke - La traviata: fantasie",type:"welte-red"},{druid:"vr247rd6766",image_url:"https://stacks.stanford.edu/image/iiif/vr247rd6766%2Fvr247rd6766_0002/info.json",label:"4312 Princesa",title:"Vidal - Porque era negro: tango",type:"88-note"},{druid:"tp613xb9088",image_url:"https://stacks.stanford.edu/image/iiif/tp613xb9088%2Ftp613xb9088_0002/info.json",label:"4518 Princesa",title:"Viladomat - El tango de la cocaína",type:"88-note"},{druid:"ps866sb0637",image_url:"https://stacks.stanford.edu/image/iiif/ps866sb0637%2Fps866sb0637_0002/info.json",label:"2841 Victoria",title:"Villa - Cantos asturianos, no 1. andante, allegro non molto",type:"88-note"},{druid:"sm344xv2220",image_url:"https://stacks.stanford.edu/image/iiif/sm344xv2220%2Fsm344xv2220_0002/info.json",label:"357 Princesa",title:"Vives - Bohemios. escena y coro",type:"88-note"},{druid:"gh208gz5033",image_url:"https://stacks.stanford.edu/image/iiif/gh208gz5033%2Fgh208gz5033_0001/info.json",label:"763 Welte-Mignon",title:"Vogrich/Mero - Staccato caprice",type:"welte-red"},{druid:"yr287jf4422",image_url:"https://stacks.stanford.edu/image/iiif/yr287jf4422%2Fyr287jf4422_0001/info.json",label:"144 Welte-Mignon",title:"Wagner/Adam-Benard - Lied a. d. abendstern: a. tannhäuser op. 94",type:"welte-red"},{druid:"ys288dd6430",image_url:"https://stacks.stanford.edu/image/iiif/ys288dd6430%2Fys288dd6430_0001/info.json",label:"118 Welte-Mignon",title:"Wagner/Adam-Benard - Schwanenlied aus lohengrin",type:"welte-red"},{druid:"fd660zf8362",image_url:"https://stacks.stanford.edu/image/iiif/fd660zf8362%2Ffd660zf8362_0001/info.json",label:"990 Welte-Mignon",title:"Wagner/Elvyn - Meistersinger von nürnberg: vorspiel",type:"welte-red"},{druid:"bs173rx9307",image_url:"https://stacks.stanford.edu/image/iiif/bs173rx9307%2Fbs173rx9307_0001/info.json",label:"188 Welte-Mignon",title:"Wagner/Grünfeld - Isoldens liebestod",type:"welte-red"},{druid:"qf751dd5412",image_url:"https://stacks.stanford.edu/image/iiif/qf751dd5412%2Fqf751dd5412_0001/info.json",label:"662 Welte-Mignon",title:"Wagner/Hofmann - Tannhauser overture",type:"welte-red"},{druid:"hh095vc8073",image_url:"https://stacks.stanford.edu/image/iiif/hh095vc8073%2Fhh095vc8073_0001/info.json",label:"662 Welte-Mignon",title:"Wagner/Hofmann - Tannhäuser overture",type:"welte-red"},{druid:"dr835xg3992",image_url:"https://stacks.stanford.edu/image/iiif/dr835xg3992%2Fdr835xg3992_0001/info.json",label:"3335 Welte-Mignon",title:"Wagner/Lászlò - Rienzi: ouverture",type:"welte-red"},{druid:"rp146dk0477",image_url:"https://stacks.stanford.edu/image/iiif/rp146dk0477%2Frp146dk0477_0001/info.json",label:"1352 Welte-Mignon",title:"Wagner/Mottl - Am stillen herd zur winterszeit: a. die meistersinger von nürnberg",type:"welte-red"},{druid:"mg285ps6787",image_url:"https://stacks.stanford.edu/image/iiif/mg285ps6787%2Fmg285ps6787_0001/info.json",label:"1352 Welte-Mignon",title:"Wagner/Mottl - Die meistersinger von nürnberg. am stillen herd zur winterszeit",type:"welte-red"},{druid:"jn038xx9588",image_url:"https://stacks.stanford.edu/image/iiif/jn038xx9588%2Fjn038xx9588_0001/info.json",label:"1348 Welte-Mignon",title:"Wagner/Mottl - Lohengrin. bridal chorus",type:"welte-red"},{druid:"dt046tz6296",image_url:"https://stacks.stanford.edu/image/iiif/dt046tz6296%2Fdt046tz6296_0001/info.json",label:"1349 Welte-Mignon",title:"Wagner/Mottl - Lohengrin. elsa's dream",type:"welte-red"},{druid:"nn203bm7432",image_url:"https://stacks.stanford.edu/image/iiif/nn203bm7432%2Fnn203bm7432_0001/info.json",label:"1347 Welte-Mignon",title:"Wagner/Mottl - Tristan und isolde. vorspiel",type:"welte-red"},{druid:"xx912rs1788",image_url:"https://stacks.stanford.edu/image/iiif/xx912rs1788%2Fxx912rs1788_0001/info.json",label:"1346 Welte-Mignon",title:"Wagner/Mottl - Vorspiel zu parsival",type:"welte-red"},{druid:"hg709nf1997",image_url:"https://stacks.stanford.edu/image/iiif/hg709nf1997%2Fhg709nf1997_0001/info.json",label:"3019 Welte-Mignon",title:"Wagner/Rybner - Die meistersinger von nürnberg: konzert-paraphrase",type:"welte-red"},{druid:"xy736dn5214",image_url:"https://stacks.stanford.edu/image/iiif/xy736dn5214%2Fxy736dn5214_0002/info.json",label:"2539",title:"Waldteufel - Très jolie: suite de valses",type:"65-note"},{druid:"xg670df7262",image_url:"https://stacks.stanford.edu/image/iiif/xg670df7262%2Fxg670df7262_0001/info.json",label:"2466 Welte-Mignon",title:"Waldteufel/Dubois - Immer oder nimmer: walzer",type:"welte-red"},{druid:"jn782fq7439",image_url:"https://stacks.stanford.edu/image/iiif/jn782fq7439%2Fjn782fq7439_0001/info.json",label:"134 Welte-Mignon",title:"Weber/Adam-Benard - Rondo brillante op. 62",type:"welte-red"},{druid:"jd143sb1087",image_url:"https://stacks.stanford.edu/image/iiif/jd143sb1087%2Fjd143sb1087_0001/info.json",label:"5553 Welte-Mignon",title:"Whiteman/Wolf - Wonderful one: waltz song",type:"welte-red"},{druid:"sx275gw8801",image_url:"https://stacks.stanford.edu/image/iiif/sx275gw8801%2Fsx275gw8801_0001/info.json",label:"5675 Welte-Mignon",title:"Youmans/Johnson - Tea for two: fox-trot",type:"welte-red"},{druid:"yk645sm6970",image_url:"https://stacks.stanford.edu/image/iiif/yk645sm6970%2Fyk645sm6970_0001/info.json",label:"5905 Welte-Mignon",title:'Youmans/Sommer - Hallelujah!: fox-trot from "hit the deck"',type:"welte-red"}];const{window:window_1}=globals;function create_if_block_5(e){let t,i,n,o;t=new RollDetails({props:{metadata:e[4]}});let r=!e[6].count&&create_if_block_6();return{c(){create_component(t.$$.fragment),i=space(),r&&r.c(),n=empty()},l(e){claim_component(t.$$.fragment,e),i=claim_space(e),r&&r.l(e),n=empty()},m(e,s){mount_component(t,e,s),insert_hydration(e,i,s),r&&r.m(e,s),insert_hydration(e,n,s),o=!0},p(e,i){const o={};16&i[0]&&(o.metadata=e[4]),t.$set(o),e[6].count?r&&(r.d(1),r=null):r||(r=create_if_block_6(),r.c(),r.m(n.parentNode,n))},i(e){o||(transition_in(t.$$.fragment,e),o=!0)},o(e){transition_out(t.$$.fragment,e),o=!1},d(e){destroy_component(t,e),e&&detach(i),r&&r.d(e),e&&detach(n)}}}function create_if_block_6(e){let t,i,n,o;return{c(){t=element("p"),i=text("Note:"),n=element("br"),o=text("Hole visualization data is not available for this roll at\n            this time. Hole highlighting will not be enabled."),this.h()},l(e){t=claim_element(e,"P",{class:!0});var r=children(t);i=claim_text(r,"Note:"),n=claim_element(r,"BR",{}),o=claim_text(r,"Hole visualization data is not available for this roll at\n            this time. Hole highlighting will not be enabled."),r.forEach(detach),this.h()},h(){attr(t,"class","svelte-j1qpzb")},m(e,r){insert_hydration(e,t,r),append_hydration(t,i),append_hydration(t,n),append_hydration(t,o)},d(e){e&&detach(t)}}}function create_default_slot_1(e){let t,i,n,o,r;function s(t){e[24](t)}let a={rollListItems:e[13]};void 0!==e[0]&&(a.currentRoll=e[0]),t=new RollSelector({props:a}),binding_callbacks.push((()=>bind(t,"currentRoll",s)));let l=e[2]&&create_if_block_5(e);return{c(){create_component(t.$$.fragment),n=space(),l&&l.c(),o=empty()},l(e){claim_component(t.$$.fragment,e),n=claim_space(e),l&&l.l(e),o=empty()},m(e,i){mount_component(t,e,i),insert_hydration(e,n,i),l&&l.m(e,i),insert_hydration(e,o,i),r=!0},p(e,n){const r={};!i&&1&n[0]&&(i=!0,r.currentRoll=e[0],add_flush_callback((()=>i=!1))),t.$set(r),e[2]?l?(l.p(e,n),4&n[0]&&transition_in(l,1)):(l=create_if_block_5(e),l.c(),transition_in(l,1),l.m(o.parentNode,o)):l&&(group_outros(),transition_out(l,1,1,(()=>{l=null})),check_outros())},i(e){r||(transition_in(t.$$.fragment,e),transition_in(l),r=!0)},o(e){transition_out(t.$$.fragment,e),transition_out(l),r=!1},d(e){destroy_component(t,e),e&&detach(n),l&&l.d(e),e&&detach(o)}}}function create_if_block_3(e){let t,i,n,o,r,s,a={imageUrl:e[0].image_url,holeData:e[5],holesByTickInterval:e[6],skipToTick:e[15]};i=new RollViewer({props:a}),e[25](i);let l=e[11].showKeyboard&&e[11].overlayKeyboard&&create_if_block_4(e);return r=new FlexCollapsible({props:{id:"right-sidebar",width:"20vw",position:"left",$$slots:{default:[create_default_slot]},$$scope:{ctx:e}}}),{c(){t=element("div"),create_component(i.$$.fragment),n=space(),l&&l.c(),o=space(),create_component(r.$$.fragment),this.h()},l(e){t=claim_element(e,"DIV",{id:!0,class:!0});var s=children(t);claim_component(i.$$.fragment,s),n=claim_space(s),l&&l.l(s),s.forEach(detach),o=claim_space(e),claim_component(r.$$.fragment,e),this.h()},h(){attr(t,"id","roll"),attr(t,"class","svelte-j1qpzb")},m(e,a){insert_hydration(e,t,a),mount_component(i,t,null),append_hydration(t,n),l&&l.m(t,null),insert_hydration(e,o,a),mount_component(r,e,a),s=!0},p(e,n){const o={};1&n[0]&&(o.imageUrl=e[0].image_url),32&n[0]&&(o.holeData=e[5]),64&n[0]&&(o.holesByTickInterval=e[6]),i.$set(o),e[11].showKeyboard&&e[11].overlayKeyboard?l?(l.p(e,n),2048&n[0]&&transition_in(l,1)):(l=create_if_block_4(e),l.c(),transition_in(l,1),l.m(t,null)):l&&(group_outros(),transition_out(l,1,1,(()=>{l=null})),check_outros());const s={};4096&n[1]&&(s.$$scope={dirty:n,ctx:e}),r.$set(s)},i(e){s||(transition_in(i.$$.fragment,e),transition_in(l),transition_in(r.$$.fragment,e),s=!0)},o(e){transition_out(i.$$.fragment,e),transition_out(l),transition_out(r.$$.fragment,e),s=!1},d(n){n&&detach(t),e[25](null),destroy_component(i),l&&l.d(),n&&detach(o),destroy_component(r,n)}}}function create_if_block_4(e){let t,i,n,o;return i=new Keyboard({props:{keyCount:"88",activeNotes:activeNotes,startNote:e[8],stopNote:e[9]}}),{c(){t=element("div"),create_component(i.$$.fragment),this.h()},l(e){t=claim_element(e,"DIV",{id:!0,class:!0});var n=children(t);claim_component(i.$$.fragment,n),n.forEach(detach),this.h()},h(){attr(t,"id","keyboard-overlay"),attr(t,"class","svelte-j1qpzb")},m(e,n){insert_hydration(e,t,n),mount_component(i,t,null),o=!0},p(e,t){const n={};256&t[0]&&(n.startNote=e[8]),512&t[0]&&(n.stopNote=e[9]),i.$set(n)},i(e){o||(transition_in(i.$$.fragment,e),add_render_callback((()=>{n||(n=create_bidirectional_transition(t,fade,{},!0)),n.run(1)})),o=!0)},o(e){transition_out(i.$$.fragment,e),n||(n=create_bidirectional_transition(t,fade,{},!1)),n.run(0),o=!1},d(e){e&&detach(t),destroy_component(i),e&&n&&n.end()}}}function create_default_slot(e){let t,i;return t=new TabbedPanel({props:{playPauseApp:e[17],stopApp:e[18],skipToPercentage:e[16]}}),{c(){create_component(t.$$.fragment)},l(e){claim_component(t.$$.fragment,e)},m(e,n){mount_component(t,e,n),i=!0},p:noop,i(e){i||(transition_in(t.$$.fragment,e),i=!0)},o(e){transition_out(t.$$.fragment,e),i=!1},d(e){destroy_component(t,e)}}}function create_if_block_2(e){let t,i;return t=new KeyboardControls({props:{outside:!0}}),{c(){create_component(t.$$.fragment)},l(e){claim_component(t.$$.fragment,e)},m(e,n){mount_component(t,e,n),i=!0},p:noop,i(e){i||(transition_in(t.$$.fragment,e),i=!0)},o(e){transition_out(t.$$.fragment,e),i=!1},d(e){destroy_component(t,e)}}}function create_if_block_1(e){let t,i,n,o;return i=new Keyboard({props:{keyCount:"88",activeNotes:activeNotes,startNote:e[8],stopNote:e[9]}}),{c(){t=element("div"),create_component(i.$$.fragment),this.h()},l(e){t=claim_element(e,"DIV",{id:!0,class:!0});var n=children(t);claim_component(i.$$.fragment,n),n.forEach(detach),this.h()},h(){attr(t,"id","keyboard-container"),attr(t,"class","svelte-j1qpzb")},m(e,n){insert_hydration(e,t,n),mount_component(i,t,null),o=!0},p(e,t){const n={};256&t[0]&&(n.startNote=e[8]),512&t[0]&&(n.stopNote=e[9]),i.$set(n)},i(r){o||(transition_in(i.$$.fragment,r),add_render_callback((()=>{n||(n=create_bidirectional_transition(t,e[14],{},!0)),n.run(1)})),o=!0)},o(r){transition_out(i.$$.fragment,r),n||(n=create_bidirectional_transition(t,e[14],{},!1)),n.run(0),o=!1},d(e){e&&detach(t),destroy_component(i),e&&n&&n.end()}}}function create_if_block(e){let t,i;return t=new Welcome({}),{c(){create_component(t.$$.fragment)},l(e){claim_component(t.$$.fragment,e)},m(e,n){mount_component(t,e,n),i=!0},i(e){i||(transition_in(t.$$.fragment,e),i=!0)},o(e){transition_out(t.$$.fragment,e),i=!1},d(e){destroy_component(t,e)}}}function create_fragment(e){let t,i,n,o,r,s,a,l,c,d,u,h,p,m,f,g,v,_,y,w,b,x;n=new FlexCollapsible({props:{id:"left-sidebar",width:"20vw",$$slots:{default:[create_default_slot_1]},$$scope:{ctx:e}}});let T=e[2]&&create_if_block_3(e);const S=[create_if_block_1,create_if_block_2],k=[];function C(e,t){return e[11].showKeyboard&&!e[11].overlayKeyboard?0:e[11].showKeyboard?-1:1}~(s=C(e))&&(a=k[s]=S[s](e)),c=new LoadingSpinner({props:{showLoadingSpinner:e[3]}});u=new SamplePlayer({props:{}}),e[26](u),u.$on("loading",e[27]),p=new KeyboardShortcuts({props:{playPauseApp:e[17],stopApp:e[18],updateTickByViewportIncrement:e[10]}}),f=new KeyboardShortcutEditor({}),v=new Notification({});let A=e[12]&&create_if_block();return{c(){t=element("div"),i=element("div"),create_component(n.$$.fragment),o=space(),T&&T.c(),r=space(),a&&a.c(),l=space(),create_component(c.$$.fragment),d=space(),create_component(u.$$.fragment),h=space(),create_component(p.$$.fragment),m=space(),create_component(f.$$.fragment),g=space(),create_component(v.$$.fragment),_=space(),A&&A.c(),y=empty(),this.h()},l(e){t=claim_element(e,"DIV",{id:!0,class:!0});var s=children(t);i=claim_element(s,"DIV",{class:!0});var w=children(i);claim_component(n.$$.fragment,w),o=claim_space(w),T&&T.l(w),w.forEach(detach),r=claim_space(s),a&&a.l(s),l=claim_space(s),claim_component(c.$$.fragment,s),s.forEach(detach),d=claim_space(e),claim_component(u.$$.fragment,e),h=claim_space(e),claim_component(p.$$.fragment,e),m=claim_space(e),claim_component(f.$$.fragment,e),g=claim_space(e),claim_component(v.$$.fragment,e),_=claim_space(e),A&&A.l(e),y=empty(),this.h()},h(){attr(i,"class","svelte-j1qpzb"),attr(t,"id","app"),attr(t,"class","svelte-j1qpzb")},m(a,S){insert_hydration(a,t,S),append_hydration(t,i),mount_component(n,i,null),append_hydration(i,o),T&&T.m(i,null),append_hydration(t,r),~s&&k[s].m(t,null),append_hydration(t,l),mount_component(c,t,null),insert_hydration(a,d,S),mount_component(u,a,S),insert_hydration(a,h,S),mount_component(p,a,S),insert_hydration(a,m,S),mount_component(f,a,S),insert_hydration(a,g,S),mount_component(v,a,S),insert_hydration(a,_,S),A&&A.m(a,S),insert_hydration(a,y,S),w=!0,b||(x=listen(window_1,"popstate",e[23]),b=!0)},p(e,o){const r={};85&o[0]|4096&o[1]&&(r.$$scope={dirty:o,ctx:e}),n.$set(r),e[2]?T?(T.p(e,o),4&o[0]&&transition_in(T,1)):(T=create_if_block_3(e),T.c(),transition_in(T,1),T.m(i,null)):T&&(group_outros(),transition_out(T,1,1,(()=>{T=null})),check_outros());let d=s;s=C(e),s===d?~s&&k[s].p(e,o):(a&&(group_outros(),transition_out(k[d],1,1,(()=>{k[d]=null})),check_outros()),~s?(a=k[s],a?a.p(e,o):(a=k[s]=S[s](e),a.c()),transition_in(a,1),a.m(t,l)):a=null);const h={};8&o[0]&&(h.showLoadingSpinner=e[3]),c.$set(h);u.$set({});const m={};1024&o[0]&&(m.updateTickByViewportIncrement=e[10]),p.$set(m),e[12]?A?4096&o[0]&&transition_in(A,1):(A=create_if_block(),A.c(),transition_in(A,1),A.m(y.parentNode,y)):A&&(group_outros(),transition_out(A,1,1,(()=>{A=null})),check_outros())},i(e){w||(transition_in(n.$$.fragment,e),transition_in(T),transition_in(a),transition_in(c.$$.fragment,e),transition_in(u.$$.fragment,e),transition_in(p.$$.fragment,e),transition_in(f.$$.fragment,e),transition_in(v.$$.fragment,e),transition_in(A),w=!0)},o(e){transition_out(n.$$.fragment,e),transition_out(T),transition_out(a),transition_out(c.$$.fragment,e),transition_out(u.$$.fragment,e),transition_out(p.$$.fragment,e),transition_out(f.$$.fragment,e),transition_out(v.$$.fragment,e),transition_out(A),w=!1},d(i){i&&detach(t),destroy_component(n),T&&T.d(),~s&&k[s].d(),destroy_component(c),i&&detach(d),e[26](null),destroy_component(u,i),i&&detach(h),destroy_component(p,i),i&&detach(m),destroy_component(f,i),i&&detach(g),destroy_component(v,i),i&&detach(_),A&&A.d(i),i&&detach(y),b=!1,x()}}}function instance(e,t,i){let n,o,r,s,a,l,c,d;component_subscribe(e,currentTick,(e=>i(22,n=e))),component_subscribe(e,isReproducingRoll,(e=>i(35,o=e))),component_subscribe(e,rollPedalingOnOff,(e=>i(36,r=e))),component_subscribe(e,playExpressionsOnOff,(e=>i(37,s=e))),component_subscribe(e,scrollDownwards,(e=>i(38,a=e))),component_subscribe(e,rollMetadata,(e=>i(39,l=e))),component_subscribe(e,userSettings,(e=>i(11,c=e))),component_subscribe(e,showWelcomeScreen,(e=>i(12,d=e)));let u,h,p,m,f,g,v,_,y,w,b,x,T,S,k,C,A,E=!1,N=!0,O=new __pika_web_default_export_for_treeshaking__;const P=json.map((e=>{const[t,i]=e.label.split(" ");return{...e,_label:`${t} ${e.title}${i?` [${i}]`:""}`}})),M=e=>{e<0&&T(),set_store_value(currentTick,n=e,n),w((()=>_.skipToTick(n)))},R=e=>{u=fetch(`./midi/${e.druid}.mid`).then((e=>{if(200===e.status)return e.arrayBuffer();throw new Error("Error fetching MIDI file! (Operation cancelled)")})).then((e=>{C?.$destroy(),u=!1,clearNotification(),i(2,E=!1),T(),k(),playbackProgress.reset(),tempoCoefficient.reset(),bassVolumeCoefficient.reset(),trebleVolumeCoefficient.reset(),i(6,O=new __pika_web_default_export_for_treeshaking__),_.loadArrayBuffer(e)})).catch((e=>{notify({title:"Error!",message:e,type:"error"}),i(0,p=m)})),h=fetch(`./json/${e.druid}.json`).then((e=>{if(200===e.status)return e.json();throw new Error("Error fetching metadata file! (Operation cancelled)")})).catch((e=>{notify({title:"Error!",message:e,type:"error"}),i(0,p=m)})),Promise.all([u,h,y]).then((([,e])=>{i(4,f=(({holeData:e,...t})=>t)(e)),i(5,g=e.holeData),annotateHoleData(g,l,a),(()=>{const{FIRST_HOLE:e}=l,t=parseInt(e,10);g.forEach((e=>{const{y:i,h:n}=e,o=i-t,r=i+n-t;O.insert(o,r,e)}))})(),set_store_value(playExpressionsOnOff,s=o,s),set_store_value(rollPedalingOnOff,r=o,r),i(2,E=!0),i(3,N=!1),i(20,m=p);const t=new URLSearchParams(window.location.search);if(t.has("druid")&&t.get("druid")!==p.druid){const e=new URL(window.location);e.searchParams.set("druid",p.druid),window.history.pushState({roll:p},"",e)}}))},I=()=>{const e=new URLSearchParams(window.location.search);if(e.has("druid")){const t=e.get("druid"),n=P.find((e=>e.druid===t));void 0!==n?i(0,p=n):notify({title:"DRUID not found!",message:"Please check the specified DRUID, or select a roll to continue.",type:"error",closable:!1})}else i(0,p=P[Math.floor(Math.random()*P.length)])};onMount((async()=>{document.getElementById("loading").remove(),i(21,({midiSamplePlayer:_,pianoReady:y,updatePlayer:w,startNote:b,stopNote:x,pausePlayback:T,startPlayback:S,resetPlayback:k}=v),_,i(8,b),i(9,x)),I()}));return e.$$.update=()=>{1048577&e.$$.dirty[0]&&p!==m&&R(p),6291456&e.$$.dirty[0]&&playbackProgress.update((()=>clamp$1(n/_?.totalTicks,0,1))),2&e.$$.dirty[0]&&C&&i(10,({updateTickByViewportIncrement:A}=C),A)},[p,C,E,N,f,g,O,v,b,x,A,c,d,P,(e,{delay:t=0,duration:i=300})=>{const n=parseInt(getComputedStyle(e).height,10);return{delay:t,duration:i,css:e=>`height: ${quartInOut(e)*n}px`}},M,e=>M(_.totalTicks*e),()=>{_.isPlaying()?T():S()},()=>{T(),k()},I,m,_,n,({state:e})=>e?.roll?i(0,p=e.roll):I(),function(e){p=e,i(0,p)},function(e){binding_callbacks[e?"unshift":"push"]((()=>{C=e,i(1,C)}))},function(e){binding_callbacks[e?"unshift":"push"]((()=>{v=e,i(7,v)}))},({detail:e})=>{i(3,N=!0),e.then((()=>i(3,N=!1))).catch((()=>{}))}]}class Pianolatron extends SvelteComponent{constructor(e){super(),init(this,e,instance,create_fragment,safe_not_equal,{},null,[-1,-1])}}export{Pianolatron as default};
